define("modules/clean/abuse/report_flag",["require","exports","tslib","external/react","modules/clean/react/title_bubble","modules/clean/react/css","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r,i,s,a){"use strict";var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getHref=function(){var e={};return this.props.sharedLink&&(e.ssu=this.props.sharedLink),new a({scheme:"https",authority:"www.dropbox.com",path:"/report_abuse",query:e}).toString()},t.prototype.render=function(){return o.createElement(r,{content:s._("Report an issue"),position:r.POSITIONS.RIGHT,distanceFromTarget:5,isTargetPositionFixed:!0},o.createElement("div",{className:"report-flag"},o.createElement("a",{href:this.getHref(),rel:"noopener noreferrer",className:"flag-link",target:"_blank",title:s._("Report as issue")}," ")))},t}(o.Component),c=i(l,["/static/css/abuse/report_flag-vflt1ytDn.css"]);t.ReportFlag=c}),define("modules/clean/accessibility/utils",["require","exports","modules/clean/keycode"],function(e,t,n){"use strict";t.accessibleColorPalette=["#006AFF","#0073E1","#007BC3","#007F9B","#008578","#008750","#008928","#008800","#0573EB","#0579C3","#0580A0","#05857D","#058655","#058932","#05890A","#0A71F0","#0A78CD","#0A7FAA","#0A8487","#0A855F","#0A8737","#0A880F","#0F6EF5","#0F76D7","#0F7DB4","#0F818C","#0F8669","#0F8741","#0F8819","#146DFF","#1475DC","#147BBE","#14819B","#148473","#14864B","#148723","#1969FF","#1972E1","#1979C3","#1980A0","#198278","#198550","#198728","#198700","#1E70E6","#1E79C8","#1E7FA5","#1E837D","#1E8555","#1E8832","#1E880A","#236EEB","#2376D2","#237CAF","#238187","#23845F","#23883C","#238914","#286DF5","#2876D7","#287CB4","#28808C","#288469","#288541","#288619","#2D6AFA","#2D73DC","#2D7BB9","#2D8096","#2D836E","#2D8446","#2D8823","#3267FF","#3271E1","#3279C3","#327D9B","#328378","#328550","#328528","#328600","#376EE6","#3777C8","#377DA5","#37807D","#37855A","#378632","#37860A","#3C6CEB","#3C74CD","#3C7BAA","#3C8087","#3C835F","#3C8437","#3C8614","#416AF5","#4173D7","#4179B9","#417E91","#418069","#418341","#418419","#4667FA","#466FDC","#4676BE","#467B9B","#468073","#46824B","#468423","#4B63FF","#4B6DE1","#4B75BE","#4B7B9B","#4B8078","#4B8150","#4B8228","#4B8300","#5069E6","#5072C8","#5079A5","#507C7D","#50815A","#508232","#50830A","#5567F0","#556FD2","#5575AA","#557A87","#557E5F","#55823C","#558314","#5A65F5","#5A6DD7","#5A75B4","#5A7A91","#5A7D69","#5A7F41","#5A821E","#5F61FA","#5F69DC","#5F71BE","#5F779B","#5F7E50","#5F7F28","#5F8100","#6466E6","#646DC3","#6475A5","#647D55","#647E2D","#648005","#6964EB","#696BC8","#6972A5","#697C55","#697E2D","#697F05","#6E62EB","#6E6AC8","#6E71A5","#6E7C46","#6E7E1E","#7358FF","#7363E1","#736ABE","#7372A0","#785CEB","#7864CD","#786DAF","#7D53FF","#7D5EE1","#7D66C3","#7D6EA0","#8255F5","#825FD7","#8268B9","#826D91","#8756F0","#8760D2","#8766AA","#8C4AFF","#8C56E6","#8C60C8","#8C66A0","#914BF5","#9157DC","#9160BE","#916596","#964BEB","#9655D2","#965EAF","#966691","#9B47F0","#9B51D2","#9B5CB4","#9B6191","#A041F5","#A04EDC","#A058B9","#A06196","#A53BF5","#A548DC","#A553BE","#A55A96","#AA34FA","#AA42E6","#AA4FC8","#AA58A0","#AA5F78","#AA614B","#AA6623","#AF29FF","#AF38E6","#AF47D2","#AF52AF","#AF5782","#AF5E5A","#AF622D","#AF6400","#B42CF0","#B43CD7","#B447B4","#B45291","#B45864","#B45D37","#B45D05","#B919FF","#B92CE6","#B93BC8","#B94AAA","#B9547D","#B95B4B","#B95A14","#BE0CF0","#BE1FEB","#BE31CD","#BE41B4","#BE4C87","#BE5455","#BE561E","#C307EB","#C31AE1","#C32CC8","#C33DB4","#C3488C","#C34F5A","#C35428","#C803E1","#C816E1","#C826C3","#C836AF","#C8428C","#C8495F","#C84F32","#C85200","#CD11C8","#CD22C8","#CD31AF","#CD3B87","#CD4664","#CD4B37","#CD4D0A","#D20CC3","#D21CB4","#D229A0","#D23587","#D23E64","#D23F37","#D2430F","#D708AF","#D716A0","#D72291","#D73087","#D7355F","#D73A3C","#D73A14","#DC0596","#DC119B","#DC1D91","#DC256E","#DC2E5A","#DC343C","#DC3419","#E1027D","#E10C87","#E11882","#E11B5A","#E12755","#E12A37","#E12919","#E13200","#E6075F","#E60C4B","#E61655","#E61D46","#E62132","#E61B14","#E61A00","#EB0232","#EB0214","#EB0D30"],t.accessibleTriggerProps=function(e,t){return void 0===t&&(t="button"),{role:t,tabIndex:0,onClick:e,onKeyDown:function(t){return t.keyCode===n.ENTER||t.keyCode===n.SPACE?e(t):void 0}}}}),define("modules/clean/account/change_email_modals",["jquery","external/react","external/react-dom","modules/core/notify","modules/core/i18n","modules/clean/form","modules/clean/account/email_verify","modules/clean/account/set_password_modal","modules/clean/react/bubble_dropdown","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/viewer","modules/clean/ajax"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){var _,m,f,g,v,y,E,b,S,w,T,C,I,P;return w=r._,I=r.render_sentences,P=r.ungettext,b=a.SetPasswordModal,y=u.Modal,C=t.DOM,T=t.createElement,l=t.createFactory(l),S=t.createFactory(c.text),E=t.createFactory(c.password),v=t.createClass({displayName:"ChangeEmailWarningModal",propTypes:{user:t.PropTypes.object,inboxCount:t.PropTypes.number,onContinue:t.PropTypes.func},render:function(){return T(y,{title:w("Warning!"),acceptButtonText:w("Continue anyway"),dismissButtonText:w("Cancel"),onAccept:this.showChange,ref:"modal"},this.getSSOWarning(),this.getInboxWarning())},getSSOWarning:function(){var e,t,n;return e=p.get_viewer().is_paired,n=e&&"work"===this.props.user.role,t=this.props.user.sso_required,n&&t?C.div({},w("Your %(team)s Dropbox uses single sign-on. If you change your email address you may not be able to sign in.").format({team:p.get_viewer().team_name})):null},getInboxWarning:function(){var e;return e=p.get_viewer().is_paired,0===this.props.inboxCount?null:e&&"personal"===this.props.user.role?P("Your %(num)d existing shared folder invitation in your personal Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your personal Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount}):e&&"work"===this.props.user.role?P("Your %(num)d existing shared folder invitation in your %(team)s Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your %(team)s Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount,team:p.get_viewer().team_name}):P("Your %(num)d existing shared folder invitation will be removed if you change your email address.","Your %(num)d existing shared folder invitations will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount})},showChange:function(e){var t,n;return e.preventDefault(),n=this.refs.modal,n.close(),"function"==typeof(t=this.props).onContinue?t.onContinue():void 0}}),m=t.createClass({displayName:"ChangeEmailModal",propTypes:{user:t.PropTypes.object,onChange:t.PropTypes.func,onVerificationCheck:t.PropTypes.func,fromCheckup:t.PropTypes.bool},getInitialState:function(){return{submitting:!1,errors:{},userConfirmedSetPassword:!1}},render:function(){return this.props.user.has_never_set_password&&!this.state.userConfirmedSetPassword?T(b,{email:this.props.user.email,reason:w("For your security, Dropbox requires you to set a password to change your email."),onUserConfirm:function(e){return function(){return e.setState({userConfirmedSetPassword:!0})}}(this),closeOnConfirm:!1}):T(y,{title:w("Update ‘%(email)s’").format({email:this.props.user.email}),className:"change-email-modal",acceptButtonText:w("Update email"),dismissButtonText:w("Cancel"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},C.form({action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},C.div({},this.getPrompt()),C.div({className:"change-email-inputs"},S({name:"email",label:w("New email",{comment:"'email' refers to the email address"}),error:this.state.errors.email,autoComplete:"off"}),S({name:"confirm_email",label:w("Confirm email",{comment:"'email' refers to the email address"}),error:this.state.errors.confirm_email,autoComplete:"off"}),E({name:"password",label:w("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),C.input({type:"hidden",name:"_subject_uid",value:this.props.user.id}),C.input({type:"hidden",name:"from_checkup",value:!!this.props.fromCheckup}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(t){var o;return this.setState({submitting:!0,errors:{}}),o=e(n.findDOMNode(this.refs.form)),i.submit(o,this._success,this._error,this._complete)},_success:function(t){var o,r,i,s,a,l;return a=this.refs.modal,s=this.refs.form,i=e(n.findDOMNode(s)).find('input[name="email"]').val(),l="NEEDS_VERIFICATION"===t,a.close(),l?"function"==typeof(o=this.props).onVerificationCheck?o.onVerificationCheck(i):void 0:"function"==typeof(r=this.props).onChange?r.onChange(i):void 0},_error:function(e){return"string"==typeof e?o.error(e):e?this.setState({errors:e}):o.error(w("There was a problem completing this request."))},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=p.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&"personal"===this.props.user.role?(t.push(w("Enter a new email address for your personal Dropbox.")),n&&t.push(w("You’ll need to verify your new email address in order to finish updating your personal email."))):e&&"work"===this.props.user.role?(t.push(w("Enter a new email address for your %(team)s Dropbox.").format({team:p.get_viewer().team_name})),n&&t.push(w("You’ll need to verify your new email address in order to finish updating your %(team)s email.").format({team:p.get_viewer().team_name}))):n&&t.push(w("You’ll need to verify your new email address in order to finish updating your email.")),t.length?I(t):""}}),f=t.createClass({displayName:"ChangeEmailOptionsEntry",propTypes:{name:t.PropTypes.string.isRequired,type:t.PropTypes.string.isRequired,address:t.PropTypes.string,verified:t.PropTypes.bool,doChangeAddress:t.PropTypes.func,doMakePrimary:t.PropTypes.func,doCreateAlias:t.PropTypes.func,doDeleteAlias:t.PropTypes.func},render:function(){var e;return e=this.props.verified?"address verified":"address pending",C.div({className:"email-row bs-row clearfix clear","data-type":this.props.type},C.span({className:"type"},this.props.name),null!=this.props.address?C.span({className:e},this.props.address):void 0,null!=this.props.address?l({targetButton:C.button({className:"sprite-button"},T(d,{group:"web",name:"gear",alt:w("Options")})),arrow_position:"top-right",ref:"dropdown"},C.div({className:"list-menu list-menu-hover"},this.props.verified?void 0:C.div({className:"list-item",onClick:function(e){return function(){return e.refs.dropdown.hide(),o.info(w("Sending verification email...")),s.send_verification_email(e.props.user,e.props.email,"generic",function(){return o.success(w("Verification email sent to %(email)s").format({email:e.props.address}))})}}(this)},w("Resend verification")),"primary"===this.props.type?C.div({className:"list-item",onClick:this.props.doChangeAddress},w("Change email address")):(C.div({className:"list-item",onClick:this.props.doMakePrimary},w("Make primary",{comment:"Make [this email address] primary"})),C.div({className:"list-item",onClick:function(e){return function(){return e.props.doDeleteAlias(e.props.address)}}(this)},w("Delete email",{comment:"'email' refers to the email address"}))))):C.a({className:"address prompt",onClick:this.props.doCreateAlias},w("Add %(type_of_email)s email",{comment:"'email' refers to the email address"}).format({type_of_email:this.props.name.toLowerCase()})))}}),_=t.createClass({displayName:"AddRecoveryEmailModal",propTypes:{user:t.PropTypes.object,onSuccess:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return T(y,{title:w("Add recovery email"),className:"change-email-modal",acceptButtonText:w("Add recovery email"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},C.form({action:"/account/alias/add/recovery_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},C.div({},w("If you request a password reset, we’ll send a link to both your primary and recovery emails.")),C.div({className:"change-email-inputs"},S({name:"email_alias",label:w("New email"),error:this.state.errors.email_alias,autoComplete:"off",onChange:function(e){return function(t){return e.newAddress=t.target.value}}(this)}),E({name:"password",label:w("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),C.input({type:"hidden",name:"_subject_uid",value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(t){var o;return this.setState({submitting:!0,errors:{}}),o=e(n.findDOMNode(this.refs.form)),i.submit(o,this._success,this._error,this._complete)},_success:function(e){var t,n,r,i;return r=this.refs.modal,n=this.refs.form,t=this.newAddress,i="ok:NEEDS_VERIFICATION"===e,i&&o.success(w("Please check your email to verify your recovery email.")),r.close(),this.props.onSuccess(t,!i)},_error:function(e){return"string"==typeof e?o.error(e):e?this.setState({errors:e}):o.error(w("There was a problem completing this request."))},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=p.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&"personal"===this.props.user.role?(t.push(w("Enter a new email address for your personal Dropbox.")),n&&t.push(w("You'll need to verify your new email address in order to finish updating your personal email."))):e&&"work"===this.props.user.role?(t.push(w("Enter a new email address for your %(team)s Dropbox.").format({team:p.get_viewer().team_name})),n&&t.push(w("You'll need to verify your new email address in order to finish updating your %(team)s email.").format({team:p.get_viewer().team_name}))):n&&t.push(w("You'll need to verify your new email address in order to finish updating your email.")),t.length?I(t):""}}),g=t.createClass({displayName:"ChangeEmailOptionsModal",propTypes:{initialAliases:t.PropTypes.array,user:t.PropTypes.object,onAliasChange:t.PropTypes.func,startChangePrimaryFlow:t.PropTypes.func},getInitialState:function(){return{aliases:this.props.initialAliases}},deleteAlias:function(e){return new h.WebRequest({url:"/account/alias/remove",type:"POST",subject_user:this.props.user,data:{alias_type:"recovery_email",alias:e},success:function(t){return function(n){var o,r,i;i=t.state.aliases.slice();for(r in i)if(o=i[r],o.alias===e){i.splice(r,1);break}return t.setState({aliases:i}),t.props.onAliasChange(i)}}(this)})},createAlias:function(){return y.showInstance(T(_,{user:this.props.user,onSuccess:function(e){return function(t,n){var o;return o=e.state.aliases.slice(),o.push({alias:t,type:"recovery_email",verified:n}),e.props.onAliasChange(o)}}(this)}))},render:function(){var e;return T(y,{title:w("Change %(role)s emails",{comment:"email refers to an email address"}).format({role:"personal"}),className:"change-email-options-modal",acceptButtonText:w("Close"),ref:"modal"},C.div({className:"email-list-container"},T(f,{user:this.props.user,name:w("Primary",{comment:"Primary email address"}),type:"primary",address:this.props.user.email,verified:this.props.user.is_email_verified,doChangeAddress:function(e){return function(){return e.props.startChangePrimaryFlow()}}(this)}),function(){var t,n,o,r;for(o=this.state.aliases,r=[],t=0,n=o.length;n>t;t++)e=o[t],"recovery_email"===e.type&&r.push(T(f,{user:this.props.user,name:w("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",address:e.alias,verified:e.verified,doDeleteAlias:this.deleteAlias}));return r}.call(this),0===this.state.aliases.length?T(f,{user:this.props.user,name:w("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",doCreateAlias:this.createAlias}):void 0))}}),{ChangeEmailWarningModal:v,ChangeEmailModal:m,ChangeEmailOptionsModal:g,AddRecoveryEmailModal:_}}),define("modules/clean/account/email",["jquery","external/classnames","external/react","modules/core/browser","modules/core/notify","modules/core/i18n","modules/core/uri","modules/clean/ajax","modules/clean/account/change_email_modals","modules/clean/account/email_verify","modules/clean/account/verify_email_modals","modules/clean/react/modal","modules/clean/viewer"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A;return I=i._,f=l.ChangeEmailModal,g=l.ChangeEmailOptionsModal,v=l.ChangeEmailWarningModal,_=l.AddRecoveryEmailModal,T=u.VerifyEmailModal,w=u.ResendVerifyEmailModal,C=u.VerifyEmailSentModal,b=u.EmailVerifiedModal,y=u.ChangedEmailVerifiedModal,S=d.Modal,P=n.createElement,E=function(){function e(e){var t;this.role=e,this.role?this.user=p.get_viewer().get_user_by_role(this.role,!0):this.user=p.get_viewer().deprecated_first_user_in_the_cookie,this.email_to_verify=null!=(t=this.user)?t.email:void 0,this.verify_for_change=!1}return e.prototype.polling=!1,e.prototype.show_resend=!1,e.shouldUseSimpleUI=!1,e.getForRole=function(t){return this.initalized||(this.legacy=new e(null),this.personal=new e("personal"),this.work=new e("work"),null!=this.reason&&this.propagate_reason(),this.initalized=!0),"personal"===t?this.personal:"work"===t?this.work:this.legacy},e.get_for_user=function(e){return this.getForRole(e.role)},e.set_should_use_simple_ui=function(e){return this.shouldUseSimpleUI=e},e.reset=function(){return this.shouldUseSimpleUI=!1,this.initalized=!1},e.set_reason=function(e){return this.reason=e,this.initalized?this.propagate_reason():void 0},e.propagate_reason=function(){var e,t,n,o,r;for(n=[this.legacy,this.personal,this.work],o=[],e=0,t=n.length;t>e;e++)r=n[e],o.push(r.reason=this.reason);return o},e.prototype.set_email_to_verify=function(e){return this.email_to_verify=e,this.verify_for_change=this.email_to_verify!==this.user.email},e.prototype.send_email=function(e,t){return c.send_verification_email(this.user,this.email_to_verify,e,t)},e.prototype.send_email_and_show_resend_modal=function(e,t){return this.send_email(e,function(n){return function(){return n.email_sent(t,e)}}(this))},e.prototype.flash_email_sent_notification=function(){return r.success(I("Verification email sent to %(email)s").format({email:this.email_to_verify}))},e.prototype.ensure_polling=function(e){return c.listen_for_verification(this.user,this.email_to_verify,function(t){return function(){return null!=e?(t.user.is_email_verified=!0,e()):o.reload()}}(this))},e.prototype.email_sent=function(e,t){return this.show_resend=!0,this.show(null,t),this.flash_email_sent_notification(),this.ensure_polling(e)},e.prototype.show=function(t,n){return null!=n&&e.set_reason(n),this.show_resend?this.show_resend_verify_modal(n):this.show_verify_modal(t,n)},e.prototype.show_verify_modal=function(t,n){return null==n&&(n=this.verify_for_change?"change_email":this.reason),S.showInstance(P(T,{user:this.user,reason:n,email:this.email_to_verify,onShowChange:function(e){return function(){return m.show(e.user)}}(this),onEmailSent:function(n){return function(){var o;return o=e.get_for_user(n.user),o.email_sent(t)}}(this),shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_resend_verify_modal=function(t){return null==t&&(t=this.verify_for_change?"change_email":this.reason),S.showInstance(P(w,{user:this.user,email:this.email_to_verify,reason:t,onShowChange:function(e){return function(){return m.show(e.user)}}(this),onEmailSent:function(t){return function(){var n;return n=e.get_for_user(t.user),n.email_sent()}}(this),shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.verified_or_send_and_show=function(e,t){return this.user.is_email_verified?("function"==typeof t&&t(),!0):(this.send_email(e,function(n){return function(){return n.email_sent(function(){return n.close(),"function"==typeof t?t():void 0},e)}}(this)),!1)},e.prototype.verified_or_show=function(e){return this.user.is_email_verified?!0:(this.show(null,e),!1)},e.prototype.show_sent_modal=function(){return S.showInstance(P(C,{email:this.email_to_verify,shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_verified_modal=function(){return S.showInstance(P(b,{reason:e.REASON,email:this.email_to_verify,shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_verified_and_changed_modal=function(){return S.showInstance(P(y,{user:this.user,email:this.email_to_verify}))},e.prototype.close=function(){return S.close()},e}(),m={inbox_counts:{},set_inbox_counts:function(t){return e.extend(this.inbox_counts,t)},show_options:function(e){var t,n,o,r;return r=e.user_id,t=e.aliases,n=e.on_alias_change,o=p.get_viewer().get_user_by_id(r),"work"===o.role?m.show(r):S.showInstance(P(g,{user:o,initialAliases:t,onAliasChange:n,startChangePrimaryFlow:function(e){return function(){return m.show(r)}}(this)}))},show:function(e){var t;return t=p.get_viewer().get_user_by_id(e),this._should_show_warning(t)?this._show_warning_modal(t):this._show_change_modal(t)},_should_show_warning:function(e){var t,n,o,r;return n=p.get_viewer().is_paired,r=n&&"work"===e.role,o=r&&e.sso_required,t=this.inbox_counts[e.id]>0,o||t},_show_change_modal:function(e){return function(e){return S.showInstance(P(f,{user:e,onChange:function(t){return m.trigger_change(e,t),"/account"!==s.parse(o.get_href()).path?o.redirect("/home?send_verification_email=1"):t!==e.email?o.reload():void 0},onVerificationCheck:function(t){var n;return m.trigger_change(e,t,e.is_email_verified),n=E.get_for_user(e),n.set_email_to_verify(t),n.email_sent()}}))}}(this),_show_warning_modal:function(e){return S.showInstance(P(v,{user:e,inboxCount:this.inbox_counts[e.id],onContinue:function(t){return function(){return t._show_change_modal(e)}}(this)}))},listen_for_change:function(t,n){var o;return o=this._email_change_event_for_user(t),e(document).on(o,n)},trigger_change:function(t,n,o){var r;return r=this._email_change_event_for_user(t),e(document).trigger(r,[n,o])},_email_change_event_for_user:function(e){return"db:email_changed:"+e.id}},A=n.DOM,h=n.createClass({displayName:"AccountPageEmailBlock",propTypes:{userId:n.PropTypes.number,emailName:n.PropTypes.string,emailIsInvalid:n.PropTypes.bool,initialPendingEmail:n.PropTypes.string,initialAliases:n.PropTypes.array,openChangeEmailModal:n.PropTypes.bool,showRecoveryEmailsGui:n.PropTypes.bool,showAliasGui:n.PropTypes.bool,showChangeEmail:n.PropTypes.bool},getInitialState:function(){return{pendingEmail:this.props.initialPendingEmail,aliases:void 0!==this.props.initialAliases?this.props.initialAliases:[]}},pendingVerifyLinkClick:function(e){return e.preventDefault(),E.get_for_user(this.user).show(),!1},pendingVerifyCancelClick:function(e){return e.preventDefault(),a.WebRequest({url:"/cancelpendingemailchange",success:function(e){return function(){return e.setState({pendingEmail:void 0})}}(this),subject_user:this.user.id}),!1},onAliasChange:function(e){return this.setState({aliases:e})},onUserAddressChange:function(e,t,n){return n?this.setState({pendingEmail:t}):(this.user.email=t,this.forceUpdate())},componentWillMount:function(){return this.user=p.get_viewer().get_user_by_id(this.props.userId),this.props.initialPendingEmail?E.get_for_user(this.user).set_email_to_verify(this.props.initialPendingEmail):void 0},componentDidMount:function(){return m.listen_for_change(this.user,this.onUserAddressChange),this.props.emailIsInvalid&&this.props.openChangeEmailModal?m.show(this.props.userId,this.state.aliases):void 0},render:function(){var e;return A.div({className:"fieldset user-info"},A.div({},A.h3({},this.props.emailName,this.props.showRecoveryEmailsGui&&this.props.showChangeEmail&&this.user.is_email_verified?A.button({className:"button-as-link inline-change",onClick:function(e){return function(t){t.preventDefault(),m.show_options({user_id:e.props.userId,aliases:e.state.aliases,on_alias_change:e.onAliasChange})}}(this)},I("Change",{comment:"Change the user's contact methods (primary email, recovery email, maybe phone?)"})):void 0),this.props.showRecoveryEmailsGui?A.h4({className:"email-type-header"},I("Primary",{comment:"Primary email address"})):void 0,A.div({className:t({"invalid-email":this.props.emailIsInvalid})},this.user.email),this.user.is_email_verified||this.props.emailIsInvalid?this.props.showChangeEmail?!this.props.showRecoveryEmailsGui||this.props.emailIsInvalid?A.button({className:"button-as-link",onClick:function(e){return function(t){t.preventDefault(),m.show(e.props.userId,e.state.aliases)}}(this)},I("Change email")):void 0:A.a({href:"/account#work"},I("Contact your team admin to change email")):A.div({},A.button({className:"button-as-link",onClick:function(e){return function(t){t.preventDefault(),"work"===e.user.role?E.getForRole("work").verified_or_show():E.getForRole("personal").verified_or_show()}}(this)},I("Verify email"))),this.props.showAliasGui&&"work"!==this.user.role?A.div({},A.button({className:"button-as-link",onClick:function(e){e.preventDefault()}},I("Other ways to contact you"))):void 0),this.state.pendingEmail?A.div({className:"pending-unverified-email-container"},A.br({}),A.div({}),"work"===this.user.role?A.h3({},I("Pending %(team_name)s email change").format({team_name:p.get_viewer().team_name})):"personal"===this.user.role?A.h3({},I("Pending personal email change")):A.h3({},I("Pending email change")),A.div({className:"pending-unverified-email"},this.state.pendingEmail),A.div({},A.button({className:"button-as-link",onClick:this.pendingVerifyLinkClick},I("Verify email"))),A.div({}),A.button({className:"button-as-link",onClick:this.pendingVerifyCancelClick},I("Cancel"))):void 0,this.props.showRecoveryEmailsGui&&"work"!==this.user.role&&this.user.is_email_verified?A.div({},A.br({}),A.h4({className:"email-type-header"},I("Recovery",{comment:"Recovery email address; 'backup email'"})),function(){var t,n,o,r;if(0!==this.state.aliases.length){for(o=this.state.aliases,r=[],t=0,n=o.length;n>t;t++)e=o[t],"recovery_email"===e.type&&r.push(A.div({},A.span({},e.alias),e.verified?void 0:A.span({},I(" (pending)"))));return r}return A.button({className:"button-as-link",onClick:function(e){return function(t){t.preventDefault(),S.showInstance(P(_,{user:e.user,onSuccess:function(t,n){var o;return o=e.state.aliases.slice(),o.push({alias:t,type:"recovery_email",verified:n}),e.setState({aliases:o})}}))}}(this)},I("Add a recovery email"))}.call(this)):void 0)}}),{EmailVerification:E,ChangeEmail:m,AccountPageEmailBlock:h,initialize_module:function(e){return E.set_reason(e.reason),m.set_inbox_counts(e.inbox_counts)}}}),define("modules/clean/account/email_verify",["jquery","modules/clean/ajax","modules/core/exception"],function(e,t,n){var o;return o={_POLLING:{},send_verification_email:function(e,o,r,i){return null==r&&n.raiseAndReport("Debugging T53160: reason should not be null",{severity:n.SEVERITY.NONCRITICAL,tags:["email_verify:null_reason"]}),t.WebRequest({url:"/sendverifyemail",data:{email:o,reason:r},success:function(){return i()},subject_user:e})},check_verification:function(e,n,o,r){return t.SilentBackgroundRequest({url:"/isemailverified",data:{email:n},success:function(e){return"ok"===e?o():r()},subject_user:e})},listen_for_verification:function(e,t,n){var o;return o=e.id+":"+t,this._POLLING[o]?void 0:(this._POLLING[o]=!0,this._poll_for_verification(e,t,n))},_poll_for_verification:function(e,t,n){var o;return o=4e3,this.check_verification(e,t,n,function(r){return function(){return setTimeout(function(){return r._poll_for_verification(e,t,n)},o)}}(this))}}}),define("modules/clean/account/email_verify_reasons",[],function(){var e;return e={SHARE_FOLDER:"share_folder",CREATE_API_APP:"create_api_app",PUBLIC_FOLDER:"public_folder",GENERIC:"generic",SHMODAL:"shmodal",MOBILE_SHARE_FOLDER:"mobile_share_folder",EMAIL_ALIAS:"email_alias",CHANGE_EMAIL:"change_email",PROMPT_CAMPAIGN:"prompt_campaign",ADD_COMMENT:"add_comment",SUBSCRIBE_TO_COMMENTS:"subscribe_to_comments",CREATE_FILE_COLLECTOR:"create_file_collector",JOIN_DISCOVERED_TEAM:"join_discovery",CREATE_TEAM:"create_team",NEW_DFB_TEAM_TRY:"new_dfb_team_try",NEW_DFB_TEAM_BUY:"new_dfb_team_buy",GIFT_BUY:"gift_buy",REFER_FRIENDS:"refer_friends"}}),define("modules/clean/account/set_password_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/react/modal","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a){"use strict";var l=function(e){function t(t){var n=e.call(this,t)||this;return n.state={sent:!1,submitting:!1},n}return n.__extends(t,e),t.prototype.resetResponseSuccess=function(e){"OK"===e.status?(a.success(s._("Sent an email to %(email)s").format({email:this.props.email})),this.setState({sent:!0,submitting:this.state.submitting})):this.resetEmailError()},t.prototype.resetEmailError=function(){a.error(s._("Could not send email. Please try again"))},t.prototype.sendResetEmail=function(e){var t=this;e.preventDefault(),this.setState({sent:this.state.sent,submitting:!0}),r.FormWebRequest({url:"/ajax_reset_start",data:{email:this.props.email},success:function(e){return t.resetResponseSuccess(JSON.parse(e))},error:function(){return t.resetEmailError()},complete:function(){t.setState({sent:t.state.sent,submitting:!1})}})},t.prototype.userConfirmSetPassword=function(){this.props.onUserConfirm?this.props.onUserConfirm():i.Modal.close()},t.showInstance=function(e){i.Modal.showInstance(o.createElement(t,n.__assign({},e)))},t.prototype.render=function(){var e=this,t=s._("Dropbox will send an email to %(email)s with further instructions.\n    You may need to check your spam folder or unblock no-reply@dropbox.com.").format({email:this.props.email}),n=this.state.sent?s._("Resend email"):s._("Send email"),r=s._("I’ve set a password"),a=this.sendResetEmail.bind(this),l=this.userConfirmSetPassword.bind(this),c=o.createElement(i.ModalButtons,null,o.createElement(i.ModalButton,{importance:"primary",disabled:!this.state.sent,onClick:l},r),o.createElement(i.ModalButton,{importance:"tertiary",onClick:a},n));return o.createElement(i.Modal,{title:s._("Set Password"),onAccept:function(){return e.userConfirmSetPassword()},buttonComponent:c},o.createElement("p",null,this.props.reason),o.createElement("p",null,t))},t}(o.Component);t.SetPasswordModal=l}),define("modules/clean/account/verify_email_modals",["external/react","modules/core/i18n","modules/clean/account/email_verify","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/react/button","modules/clean/react/modal","modules/clean/viewer","modules/clean/react_format"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h,_,m,f,g,v,y,E,b;return v=t._,_=r.UserActivityLogger,c=i.Button,p=s.Modal,b=l.reactFormat,y=e.createElement,E=e.DOM,f={getStyle:function(){return this.props.shouldUseSimpleUI?"simple":"default"},renderChangeEmail:function(){return this.props.shouldUseSimpleUI?void 0:E.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},v("Update email address"))}},m=e.createClass({displayName:"VerifyEmailModal",mixins:[f],propTypes:{user:e.PropTypes.object,reason:e.PropTypes.string,email:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func,shouldUseSimpleUI:e.PropTypes.bool},render:function(){var e;return e={reason:this.props.reason},_.log("web","email_verify_shown",e),y(p,{title:v("Verify your email address"),className:"verify-email",acceptButtonText:v("Send email"),dismissButtonText:v("Cancel"),onAccept:this.sendEmail,ref:"modal",style:this.getStyle()},E.div({},E.div({},this.getPrompt()),this.renderChangeEmail()));
},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},close:function(){var e;return null!=(e=this.refs.modal)?e.close():void 0},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},showChangeEmail:function(e){var t,n;return n={reason:this.props.reason},_.log("web","email_verify_change_first",n),e.preventDefault(),this.close(),"function"==typeof(t=this.props).onShowChange?t.onShowChange():void 0},getPrompt:function(){var e;switch(this.props.reason){case o.ADD_COMMENT:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can add comments. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.SUBSCRIBE_TO_COMMENTS:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can subscribe. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.SHARE_FOLDER:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to share folders. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.NEW_DFB_TEAM:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to add members to your team. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.SHMODAL:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to share links. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.CREATE_API_APP:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can register an API app. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.PUBLIC_FOLDER:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to enable your Public folder. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.CHANGE_EMAIL:return e=a.get_viewer().is_paired,e&&"personal"===this.props.user.role?b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your personal email. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email}):e&&"work"===this.props.user.role?b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your %(team)s email. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email,team:a.get_viewer().team_name}):b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your email. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.CREATE_FILE_COLLECTOR:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> to create file requests. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.GIFT_BUY:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can send gifts to your friends. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.REFER_FRIENDS:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can invite friends. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});case o.CREATE_TEAM:return b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can create or join a team. It’s as simple as clicking the link in the verification email we send to you."),{strong:E.strong(),email:this.props.email});default:return b(v("Verify your email address at <strong>%(email)s</strong> to share folders and ensure your account can be recovered."),{strong:E.strong(),email:this.props.email})}}}),h=e.createClass({displayName:"ResendVerifyEmailModal",mixins:[f],propTypes:{user:e.PropTypes.object,email:e.PropTypes.string,reason:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func,shouldUseSimpleUI:e.PropTypes.bool},render:function(){var e;return e={reason:this.props.reason},_.log("web","email_verify_resend_shown",e),y(p,{title:v("Verify your email address"),buttonComponent:this.renderButtons(),ref:"modal",style:this.getStyle()},E.div({},E.div({},this.getPrompt()),this.renderChangeEmail()))},renderButtons:function(){return E.div({className:"db-modal-buttons"},y(c,{key:"primary",className:"dbmodal-button",importance:"primary",disabled:!1,onClick:this.close},v("Done")),y(c,{key:"tertiary",className:"dbmodal-button",importance:"tertiary",disabled:!1,onClick:this.sendEmail},v("Resend email")))},close:function(){var e;return null!=(e=this.refs.modal)?e.close():void 0},showChangeEmail:function(e){var t,n;return n={reason:this.props.reason},_.log("web","email_verify_resend_change_first",n),e.preventDefault(),this.close(),"function"==typeof(t=this.props).onShowChange?t.onShowChange():void 0},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},getPrompt:function(){var e;return e=a.get_viewer().is_paired,this.props.reason===o.REFER_FRIENDS?b(v("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can invite friends. Check your inbox and click the link in the email to verify your address. If you can’t find it, check your spam folder."),{strong:E.strong(),email:this.props.email}):this.props.reason!==o.CHANGE_EMAIL?b(v("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),{strong:E.strong(),email:this.props.email}):e&&"personal"===this.props.user.role?b(v("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your personal email. If you can't find it, check your spam folder or click the button to resend the email."),{strong:E.strong(),email:this.props.email}):e&&"work"===this.props.user.role?b(v("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your %(team)s email. If you can't find it, check your spam folder or click the button to resend the email."),{strong:E.strong(),email:this.props.email,team:a.get_viewer().team_name}):b(v("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your email. If you can't find it, check your spam folder or click the button to resend the email."),{strong:E.strong(),email:this.props.email})}}),g=e.createClass({displayName:"VerifyEmailSentModal",propTypes:{email:e.PropTypes.string},render:function(){var e;return e=b(v("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),{strong:E.strong(),email:this.props.email}),y(p,{title:v("Verification email sent!"),acceptButtonText:v("Done")},E.div({},e))}}),d=e.createClass({displayName:"EmailVerifiedModal",propTypes:{reason:e.PropTypes.string,email:e.PropTypes.string},render:function(){return y(p,{title:v("Your email address is now verified"),acceptButtonText:v("Done")},E.div({},this.getPrompt()))},getPrompt:function(){switch(this.props.reason){case o.CREATE_TEAM:return b(v("Thanks for verifying your email address: <strong>%(email)s</strong>. Now you can invite members to your team."),{strong:E.strong(),email:this.props.email});case o.SHARE_FOLDER:return b(v("Thanks for verifying your email address: <strong>%(email)s</strong>. You can now share and receive files on Dropbox."),{strong:E.strong(),email:this.props.email});case o.CREATE_API_APP:return b(v("Thanks for verifying your email address: <strong>%(email)s</strong>. You can now register API apps."),{strong:E.strong(),email:this.props.email});case o.PUBLIC_FOLDER:return b(v("Thanks for verifying your email address. You can now enable the Public folder for your <strong>%(email)s</strong> Dropbox."),{strong:E.strong(),email:this.props.email});default:return b(v("Thanks for verifying your email address: <strong>%(email)s</strong>."),{strong:E.strong(),email:this.props.email})}}}),u=e.createClass({displayName:"ChangedEmailVerifiedModal",propTypes:{email:e.PropTypes.string,user:e.PropTypes.object},render:function(){return y(p,{title:v("Your email address is now verified"),acceptButtonText:v("Done")},E.div({},this.getPrompt()))},getPrompt:function(){var e;return e=a.get_viewer().is_paired,e&&"personal"===this.props.user.role?b(v("Thanks for verifying your email address <strong>%(email)s</strong>. Your personal account has successfully been changed."),{strong:E.strong(),email:this.props.email}):e&&"work"===this.props.user.role?b(v("Thanks for verifying your email address <strong>%(email)s</strong>. Your %(team)s account has successfully been changed."),{strong:E.strong(),email:this.props.email,team:a.get_viewer().team_name}):b(v("Thanks for verifying your email address <strong>%(email)s</strong>. Your account has successfully been changed."),{strong:E.strong(),email:this.props.email})}}),{VerifyEmailModal:m,ResendVerifyEmailModal:h,VerifyEmailSentModal:g,EmailVerifiedModal:d,ChangedEmailVerifiedModal:u}}),define("modules/clean/activity/activity_user",["require","exports","tslib","external/deep-freeze","modules/clean/comments/lib/type_check","modules/clean/immutability_helper","modules/core/types","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=function(){function e(e){var t=void 0===e?{}:e,n=t.id,r=void 0===n?null:n,i=t.fname,s=void 0===i?null:i,a=t.lname,l=void 0===a?null:a,c=t.display_name,u=void 0===c?null:c,d=t.email,p=void 0===d?null:d,h=t.photo_url,_=void 0===h?null:h,m=t.photo_circle_url,f=void 0===m?null:m,g=t.initials,v=void 0===g?null:g,y=t.is_email_verified,E=void 0===y?!1:y,b=t.is_signed_in,S=void 0===b?!1:b;this.id=r,this.fname=s,this.lname=l,this.display_name=u,this.email=p,this.photo_url=_,this.photo_circle_url=f,this.initials=v,this.is_email_verified=E,this.is_signed_in=S,o(this)}return e.fromDict=function(t){var n=i.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!!t.id});return new e(n)},e.fromUser=function(t){var n=i.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!0});return new e(n)},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){var e=22;return null!=this.display_name?c.em_snippet(this.display_name,e):null!=this.email?c.em_snippet(this.email,e):a._("Anonymous user")},e}();u.__anonymous=new u,n.__decorate([r.takes({id:Number,fname:String,lname:String,display_name:String,email:String,photo_url:s.Maybe(String),photo_circle_url:s.Maybe(String)})],u,"fromDict",null),t.ActivityUser=u}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";var n;!function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"}(n=t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/annotations/annotation",["external/underscore"],function(e){var t,n,o;return o={MARKER:0,HIGHLIGHT:1,REGION:2},n={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}},t=function(){function e(e,t,n){null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n,o;return n=new e,n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=(o=t.viewportCoordinates)?o:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e;return e={type:this.type,subtype:this.subtype},this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===o.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){var e;switch(this.type){case o.MARKER:return e=this.getFirstViewportCoordinates(),{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case o.HIGHLIGHT:return this._getViewportBoundingRectangle();case o.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,o){var r;return null==n&&(n=0),null==o&&(o=0),r=this.getBoundingBox(),r.left=r.left-n,r.right=r.right-n,r.top=r.top-o,r.bottom=r.bottom-o,r.top=Math.min(Math.max(r.top,0),t-1),r.right=Math.min(Math.max(r.right,0),e-1),r.bottom=Math.min(Math.max(r.bottom,0),t-1),r.left=Math.min(Math.max(r.left,0),e-1),r},e.prototype._getViewportBoundingRectangle=function(){var e,t,n,o,r,i,s,a,l,c,u;for(l=s=this.getFirstViewportCoordinates().x,c=a=this.getFirstViewportCoordinates().y,u=this.viewportCoordinates,n=0,r=u.length;r>n;n++)for(e=u[n],o=0,i=e.length;i>o;o++)t=e[o],l=Math.min(l,t.x),s=Math.max(s,t.x),c=Math.min(c,t.y),a=Math.max(a,t.y);return{top:c,right:s,bottom:a,left:l}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){var e,t;return null!=(e=this.image_coordinates)&&null!=(t=e[0].coordinates)?t[0]:void 0},e.prototype.getFirstPdfCoordinates=function(){var e;return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=(e=this.pdf_coordinates[0].coordinates)?e[0]:void 0},e.prototype.getFirstPdfPage=function(){var e;return this.isOldCoordinatesFormat()?null!=(e=this.pdf_coordinates)?e.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===o.MARKER?this.annotationSize:null},e}(),{Annotation:t,AnnotationTypes:o,AnnotationSubtypes:n}}),define("modules/clean/annotations/annotation_controller",["external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_region","jquery"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h;return a=n.Annotation,u=n.AnnotationTypes,c=n.AnnotationSubtypes,h=e.DOM,p=e.addons.CSSTransitionGroup,d="ephemeral-annotation-container",l=e.createClass({displayName:"AnnotationController",propTypes:{controllerEventHandlers:e.PropTypes.object,onAnnotationPlacedCallback:e.PropTypes.func,onAnnotationHiddenCallback:e.PropTypes.func,onAnnotationStartDragCallback:e.PropTypes.func,onAnnotationEndDragCallback:e.PropTypes.func,onAnnotationScrollCallback:e.PropTypes.func,onAnnotationScaleChangeCallback:e.PropTypes.func,onAnnotationEnterCallback:e.PropTypes.func,onAnnotationLeaveCallback:e.PropTypes.func,isAnnotationMarkerEnabled:e.PropTypes.bool,isAnnotationHighlightEnabled:e.PropTypes.bool,isAnnotationRegionEnabled:e.PropTypes.bool,isAnnotationCreationEnabled:e.PropTypes.bool,parentContainerOffset:e.PropTypes.object},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){var e,t,n,o,r,i;return null!=(e=this.props.controllerEventHandlers)&&(e.onHideAnnotation=this.onHideAnnotation),null!=(t=this.props.controllerEventHandlers)&&(t.onMouseMoveCallback=this.onMouseMoveCallback),null!=(n=this.props.controllerEventHandlers)&&(n.onMouseDownCallback=this.onMouseDownCallback),null!=(o=this.props.controllerEventHandlers)&&(o.onMouseUpCallback=this.onMouseUpCallback),null!=(r=this.props.controllerEventHandlers)&&(r.onScrollCallback=this.onScrollCallback),null!=(i=this.props.controllerEventHandlers)?i.onScaleChangeCallback=this.onScaleChangeCallback:void 0},_getViewerX:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageX:void 0)||0},_getViewerY:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},function(e){return function(){return"function"==typeof t?t():void 0}}(this)),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var n;return n=t.findDOMNode(this.refs.activeAnnotation),null!=n&&(e.target===n||s.contains(n,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case u.MARKER:return this.props.isAnnotationMarkerEnabled;case u.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case u.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n,o,r,i,a,l,c;if(o=s(e.target),t=o.contents(),n=(null!=(c=o.css("cursor"))?c:"").split(","),n=n[n.length-1].trim(),"text"===n||"vertical-text"===n||o.is("a")&&0===t.length)return!0;if("auto"!==n)return!1;for(i=!1,a=0,l=t.length;l>a;a++)r=t[a],r.nodeType===Node.TEXT_NODE&&(i=!0);return i},_deselectAllText:function(){var e,t;return null!=(t=document.selection)&&"function"==typeof t.empty&&t.empty(),"function"==typeof window.getSelection&&"function"==typeof(e=window.getSelection()).removeAllRanges?e.removeAllRanges():void 0},onHideAnnotation:function(){var e;return null!=(e=this.refs.activeAnnotation)?e.hideAnnotation():void 0},onMouseDownCallback:function(e){var t,n;if(!this.isMouseDown)return this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,!this._isOnRegion(e)&&this._isOnText(e)?(t=u.HIGHLIGHT,this._trySetActiveAnnotationType(t,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0}}(this))):void 0):null!=(n=this.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0},onMouseMoveCallback:function(e){var t,n;if(this.isMouseDown)return null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,this.isMouseDown&&null===t&&(t=u.REGION),this._trySetActiveAnnotationType(t,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0}}(this))):null!=(n=this.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0},onMouseUpCallback:function(e){var t,n,o,r,i,s;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){if(i=this.state.activeAnnotationType,null===i){if(this._isAnnotationTypeCreationEnabled(u.MARKER))i=u.MARKER;else if(this._isAnnotationTypeCreationEnabled(u.REGION))return void this._trySetActiveAnnotationType(u.REGION,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)&&"function"==typeof n.createDefaultRegion?n.createDefaultRegion(e):void 0}}(this))}else i===u.REGION&&this._isAnnotationTypeCreationEnabled(u.MARKER)&&(t={x:e.pageX,y:e.pageY},n=t.x-this.positionAtLastMouseDown.x,o=t.y-this.positionAtLastMouseDown.y,r=Math.sqrt(n*n+o*o),34>=r&&(i=u.MARKER));return this._trySetActiveAnnotationType(i,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseUpCallback(e):void 0}}(this))}return null!=(s=this.refs.activeAnnotation)?s.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){var e;return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){var t;return this._disallowAnnotationTypeSwitch(),"function"==typeof(t=this.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScrollCallback?t.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScaleChangeCallback?t.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case u.MARKER:return e.createElement(o,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case u.HIGHLIGHT:return e.createElement(r,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case u.REGION:return e.createElement(i,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return h.div({className:""+d},this._renderActiveAnnotation())}})}),define("modules/clean/annotations/annotation_highlight",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o){var r,i,s,a,l;return r=o.Annotation,a=o.AnnotationTypes,s=o.AnnotationSubtypes,l=t.DOM,i=t.createClass({displayName:"AnnotationHighlight",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return{isShown:!1}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return this.type=a.HIGHLIGHT,this.subtype=s.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},hideAnnotation:function(){return this._hideAnnotation()},_updateViewportBoundaries:function(){var e,t,n;return e=window.getSelection(),e.rangeCount>0?(t=this._isBrowserIE()?this._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):this._extractViewportClientRectangles(e.getRangeAt(0)),n=this._consolidateClientRectangles(t),this._setViewportCoordinatesFromRectangles(n)):void 0},_extractViewportClientRectangles:function(e){var t,n,o,r;for(t=[],n=e.endContainer,o=e.endOffset,r=e.cloneRange();n!==e.commonAncestorContainer;)r.setStart(n,0),r.setEnd(n,o),Array.prototype.push.apply(t,r.getClientRects()),o=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return r=e.cloneRange(),r.setEnd(n,o),Array.prototype.push.apply(t,r.getClientRects()),t},_extractViewportClientRectanglesIEHack:function(e){var t,n,o;if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();for(t=[],o=e.cloneRange(),o.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,o.getClientRects()),n=e.startContainer.parentNode.nextSibling;n!==e.endContainer.parentNode;)Array.prototype.push.apply(t,n.getClientRects()),n=n.nextSibling;return o.setStart(e.endContainer,0),o.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,o.getClientRects()),t},_isBrowserIE:function(){var e,t,n;return n=window.navigator.userAgent,t=n.indexOf("Trident/"),e=n.indexOf("Edge/"),t>0||e>0},_consolidateClientRectangles:function(e){var t,n,o,r,i,s;for(n=[],o=0,r=e.length;r>o;o++)s=e[o],0!==s.width&&0!==s.height&&(n.length>0&&(i=n[n.length-1],this._isWithinConsolidationVerticalBuffer(i,s)&&this._isWithinConsolidationHorizontalBuffer(i,s))?(t=this._calculateBoundingBox(i,s),i.top=t.top,i.right=t.right,i.bottom=t.bottom,i.left=t.left):n.push({top:s.top,right:s.right,bottom:s.bottom,left:s.left}));return n},_isWithinConsolidationVerticalBuffer:function(e,t){return Math.abs(e.top-t.top)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-t.bottom)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},_isWithinConsolidationHorizontalBuffer:function(e,t){var n,o,r;return n=this._calculateBoundingBox(e,t),o=n.right-n.left,r=t.width+(e.right-e.left),o-r<this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},_calculateBoundingBox:function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},_setViewportCoordinatesFromRectangles:function(e){var t,n,o,r,i;for(i=[],n=0,o=e.length;o>n;n++)r=e[n],t=[],t.push({x:r.left,y:r.top}),t.push({x:r.right,y:r.bottom}),i.push(t);return this.annotation.viewportCoordinates=i},_getPositionRelativeToParentContainer:function(e){return{x:e.x-this.props.parentContainerOffset.left,y:e.y-this.props.parentContainerOffset.top}},_updateHighlightedText:function(){return this.annotation.text_highlight={snippet_before:this._getTextBeforeHighlight(),text:this._getHighlightedText(),snippet_after:this._getTextAfterHighlight()}},_generateAnnotation:function(){return this.annotation=new r(this.type,this.subtype),this._updateViewportBoundaries(),this._updateHighlightedText()},_hideAnnotation:function(){return this._isBrowserIE()&&this.state.isShown&&this.setState({isShown:!1,viewportCoordinates:null}),this.annotation=null,this.props.onAnnotationHiddenCallback()},_updateViewportCoordinatesFromUI:function(){var t,n,o,r,i,s,a,l;if(this.state.isShown){for(i=[],l=e(".annotation-highlight"),o=0,r=l.length;r>o;o++)s=l[o],n=[],t=e(s),a=t.offset(),n.push({x:a.left,y:a.top}),n.push({x:a.left+t.width(),y:a.top+t.height()}),i.push(n);return this.annotation.viewportCoordinates=i}},_getHighlightedText:function(){var e;return e=window.getSelection().toString().trim(),e=e.replace(/\s+/g," ")},_getTextBeforeHighlight:function(){return""},_getTextAfterHighlight:function(){return""},_isTextSelected:function(){return""!==this._getHighlightedText()},onMouseDownCallback:function(e){return{}},onMouseMoveCallback:function(e){return{}},onMouseUpCallback:function(e){return setTimeout(function(e){return function(){var t,n,o,r,i,s,a,l;if(!e._isTextSelected())return e._hideAnnotation();if(e._generateAnnotation(),e.props.onAnnotationPlacedCallback(e.annotation),e._isBrowserIE()){for(l=[],s=e.annotation.viewportCoordinates,o=0,i=s.length;i>o;o++)t=s[o],n=[],r=e._getPositionRelativeToParentContainer(t[0]),a=e._getPositionRelativeToParentContainer(t[1]),n.push({x:r.x,y:r.y}),n.push({x:a.x,y:a.y}),l.push(n);return e.setState({isShown:!0,viewportCoordinates:l})}}}(this),0)},onScrollCallback:function(){var e;return null!=this.annotation?(this._isBrowserIE()?this._updateViewportCoordinatesFromUI():this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return null!=this.annotation?(this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseUp:function(e){return{}},render:function(){var e,t,n,o,r,i,s;return l.div({className:"annotation-highlight-container",ref:"highlightContainer"},function(){var a,c,u;if(this.state.isShown){for(t=[],u=this.state.viewportCoordinates,a=0,c=u.length;c>a;a++)o=u[a],n=o[0].x,s=o[0].y,r=o[1].x,e=o[1].y,i={left:n,top:s,width:r-n,height:e-s},t.push(l.div({className:"annotation-highlight",style:i}));return t}}.call(this))}})}),define("modules/clean/annotations/annotation_highlight_ui",["jquery","external/classnames","external/react","external/react-dom","modules/clean/annotations/annotation"],function(e,t,n,o,r){
var i,s,a,l,c,u;return i=r.Annotation,l=r.AnnotationTypes,a=r.AnnotationSubtypes,u=n.DOM,c=18,s=n.createClass({displayName:"AnnotationHighlightUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{isHover:!1}},componentWillMount:function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=i.createAnnotationFromDict(this.props.annotation)},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onHighlightClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseEnter:function(e){var t;return this.setState({isHover:!0}),clearTimeout(this.mouseLeaveTimeout),this._updateViewportCoordinates(),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseOver:function(e){return{}},_onHighlightMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback&&t.onAnnotationLeaveCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}),this.mouseLeaveTimeout=setTimeout(function(e){return function(){return e.setState({isHover:!1})}}(this),100)},_updateViewportCoordinates:function(){var t,n,r,i,s,a,l,c;for(t=e(o.findDOMNode(this.refs.highlightContainer)),l=[],i=t.children(),s=0,a=i.length;a>s;s++)r=i[s],n=[],c=e(r).offset(),n.push({x:c.left,y:c.top}),n.push({x:c.left+e(r).width(),y:c.top+e(r).height()}),l.push(n);return this.annotation.viewportCoordinates=l},render:function(){var e,n,o,r,i,s,a,l,d,p,h,_,m,f,g,v,y,E;for(a=[],d=null!=(m=this.props.commentActivity)&&null!=(f=m.comment)?f.resolved:void 0,e=t({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":d,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),i=-1,g=this.initialViewport,l=0,h=g.length;h>l;l++)_=g[l],p=_[0].x,E=_[0].y,v=_[1].x,s=_[1].y,(-1===i||i>E)&&(o=p,i=E),y={left:p,top:E,width:v-p,height:s-E},a.push(u.div({className:e,style:y,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}));return u.div({className:"annotation-highlight-container",ref:"highlightContainer"},a,this.props.options.isAnnotationNumberingEnabled?(r={left:o-c/2,top:i-c/2},n=t({"annotation-number":!0,"annotation-number--resolved":d,"annotation-number--hover":this.state.isHover}),u.div({className:n,style:r},this.props.options.annotationNumber)):void 0)}})}),define("modules/clean/annotations/annotation_marker",["jquery","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o,r){var i,s,a,l,c,u;return i=r.Annotation,l=r.AnnotationTypes,a=r.AnnotationSubtypes,u=t.DOM,c=t.addons.CSSTransitionGroup,s=t.createClass({displayName:"AnnotationMarker",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return this.type=l.MARKER,this.subtype=a.MARKER.CIRCLE,this.size=28,this.isInDragMode=!1,this._resetPositionDelta(),{isToolVisible:!1,viewerX:0,viewerY:0}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return{}},hideAnnotation:function(){return this._hideAnnotation()},_getSelectionText:function(){var e;return e="",window.getSelection&&(e=window.getSelection().toString()),e},_hasSelectedText:function(){return""!==this._getSelectionText()},_resetPositionDelta:function(){return this.positionDelta={x:0,y:0}},_getOffsetPosition:function(e){var t,n,o,r,i,s,a,l;return t=e.offsetX||(null!=(o=e.nativeEvent)?o.offsetX:void 0)||(null!=(r=e.nativeEvent)&&null!=(i=r.originalEvent)?i.layerX:void 0),n=e.offsetY||(null!=(s=e.nativeEvent)?s.offsetY:void 0)||(null!=(a=e.nativeEvent)&&null!=(l=a.originalEvent)?l.layerY:void 0),{x:t-this.annotation.getSize()/2,y:n-this.annotation.getSize()/2}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_calculateMarkerPos:function(e){var t,n;return n=this._getPositionRelativeToParentContainer(e),t=this.size/2,{x:n.x-t-this.positionDelta.x,y:n.y-t-this.positionDelta.y}},_generateAnnotation:function(e){return this.annotation=new i(this.type,this.subtype,this.size),this._updateViewportCoordinatesFromEvent(e),this.annotation},_updateViewportCoordinatesFromEvent:function(e){var t;return t={x:e.clientX-this.positionDelta.x,y:e.clientY-this.positionDelta.y},this.annotation.viewportCoordinates[0]=[t]},_hideAnnotation:function(e){var t;return this.annotation=null,this.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof(t=this.props).onAnnotationHiddenCallback?t.onAnnotationHiddenCallback():void 0},_placeAnnotation:function(e){return this.setState({isToolVisible:!0,viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y},function(t){return function(){var n;return t._generateAnnotation(e),"function"==typeof(n=t.props).onAnnotationPlacedCallback?n.onAnnotationPlacedCallback(t.annotation):void 0}}(this))},updateViewportCoordinatesFromMarker:function(){var t,o,r,i;return this.state.isToolVisible&&(i=n.findDOMNode(this.refs.annotationMarker),i&&(t=e(i),o=t.offset(),r={x:o.left+this.annotation.getSize()/2,y:o.top+this.annotation.getSize()/2},this.annotation.viewportCoordinates[0]=[r])),null},_startAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!0,this.positionDelta=this._getOffsetPosition(e),this._updateViewportCoordinatesFromEvent(e),"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(this.annotation):void 0},_endAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!1,this._updateViewportCoordinatesFromEvent(e),this._resetPositionDelta(),"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(this.annotation):void 0},_isOnMarker:function(t){var o;return this.state.isToolVisible?(o=n.findDOMNode(this.refs.annotationMarker),null!=o?t.target===o||e.contains(o,t.target):!1):void 0},onMouseDownCallback:function(e){return this.state.isToolVisible&&this._isOnMarker(e)?(this._startAnnotationDrag(e),e.preventDefault()):void 0},onMouseMoveCallback:function(e){return this.isInDragMode&&this.state.isToolVisible?(this.setState({viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y}),e.preventDefault()):void 0},onMouseUpCallback:function(e){return this.state.isToolVisible?this.isInDragMode?this._endAnnotationDrag(e):this._hideAnnotation(e):this._hasSelectedText()?void 0:(this._placeAnnotation(e),e.preventDefault())},onScrollCallback:function(){var e;return this.state.isToolVisible?(this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onMarkerMouseUp:function(e){return{}},_onMarkerMouseEnter:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},render:function(){var e;return e=[],this.state.isToolVisible&&(e=[u.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},u.div({className:"annotation-maker-inner"}))]),u.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)}})}),define("modules/clean/annotations/annotation_marker_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,o){var r,i;return i=n.DOM,r=n.createClass({displayName:"AnnotationMarkerUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{}},getDefaultProps:function(){return{options:{}}},componentWillMount:function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onMarkerClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseEnter:function(t){var n,r,i;return n=e(o.findDOMNode(this.refs.annotationMarker)),r=this.props.annotation,null==r.viewportCoordinates&&(r.viewportCoordinates=[]),r.viewportCoordinates[0]=[{x:n.offset().left+r.annotationSize/2,y:n.offset().top+r.annotationSize/2}],"function"==typeof(i=this.props).onAnnotationEnterCallback?i.onAnnotationEnterCallback({annotation:r,commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,o,r;return n=null!=(o=this.props.commentActivity)&&null!=(r=o.comment)?r.resolved:void 0,e=t({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!n,"annotation-marker--resolved":n,"annotation-marker--ghost":this._isGhostAnnotation()}),i.div({className:"annotation-marker-container",ref:"markerContainer"},i.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:e,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},i.div({className:"annotation-maker-inner"})))}})}),define("modules/clean/annotations/annotation_region",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o,r,i){var s,a,l,c,u,d;return s=i.Annotation,c=i.AnnotationTypes,l=i.AnnotationSubtypes,d=n.DOM,u=n.addons.CSSTransitionGroup,a=n.createClass({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:n.PropTypes.func,onAnnotationHiddenCallback:n.PropTypes.func,onAnnotationStartDragCallback:n.PropTypes.func,onAnnotationEndDragCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationScrollCallback:n.PropTypes.func,onAnnotationScaleChangeCallback:n.PropTypes.func,onAnnotationEnterCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,parentContainerOffset:n.PropTypes.object},TYPE:c.REGION,SUBTYPE:l.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e,t,n,o;return o=this.state.rectangle.top+this.props.parentContainerOffset.top,n=this.state.rectangle.right+this.props.parentContainerOffset.left,e=this.state.rectangle.bottom+this.props.parentContainerOffset.top,t=this.state.rectangle.left+this.props.parentContainerOffset.left,this.annotation.viewportCoordinates[0]=[{x:t,y:o},{x:t,y:e},{x:n,y:e},{x:n,y:o}]},_isOnRegion:function(t){var n;return this.state.isToolVisible&&(n=o.findDOMNode(this.refs.annotationRegion),null!=n)?t.target===n||e.contains(n,t.target):!1},_isInResizingMode:function(){return!r.isEmpty(this.state.resizeDirections)},_isModifying:function(){return this.state.isInDragMode||this._isInResizingMode()},_showNewRectangle:function(e){return this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:r.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.setState({isInDragMode:!1,resizeDirections:r.clone(t),anchorRectangle:r.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new s(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){var e;return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t,n,o,r;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),o=n.x,r=n.y,t=this.DEFAULT_REGION_SIZE/2,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:r-t,right:o+t,bottom:r+t,left:o-t}},function(e){return function(){var t;return e._updateAnnotationFromState(),"function"==typeof(t=e.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e.annotation):void 0}}(this))},onMouseDownCallback:function(e){var t,n;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),this.state.isToolVisible?this._isOnRegion(e)&&!this._isInResizingMode()?(this._updateAnnotationFromState(),"function"==typeof(t=this.props).onAnnotationStartDragCallback&&t.onAnnotationStartDragCallback(this.annotation),this._startDragging(n)):void 0:this._showNewRectangle(n)},onMouseMoveCallback:function(e){var t,n,o;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(o=this._getPositionRelativeToParentContainer(e),t={x:o.x-this.state.anchorMouse.x,y:o.y-this.state.anchorMouse.y},n=r.clone(this.state.anchorRectangle),this.state.isInDragMode?n={top:this.state.anchorRectangle.top+t.y,right:this.state.anchorRectangle.right+t.x,bottom:this.state.anchorRectangle.bottom+t.y,left:this.state.anchorRectangle.left+t.x}:this._isInResizingMode()&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?n.top=this.state.anchorRectangle.top+t.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(n.bottom=this.state.anchorRectangle.bottom+t.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?n.left=this.state.anchorRectangle.left+t.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(n.right=this.state.anchorRectangle.right+t.x)),n={top:Math.min(n.top,n.bottom),right:Math.max(n.left,n.right),bottom:Math.max(n.top,n.bottom),left:Math.min(n.left,n.right)},this.setState({rectangle:n})):void 0:(o=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(o))},onMouseUpCallback:function(e){var t,n;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof(t=this.props).onAnnotationPlacedCallback&&t.onAnnotationPlacedCallback(this.annotation):"function"==typeof(n=this.props).onAnnotationEndDragCallback&&n.onAnnotationEndDragCallback(this.annotation),this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e):void 0},onScrollCallback:function(){var e;return this.state.isToolVisible?(this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){var t;return this.setState({isHovering:!0}),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){var t;return this.setState({isHovering:!1}),"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){var n,o;return e.preventDefault(),o=this._getPositionRelativeToParentContainer(e),this._updateAnnotationFromState(),"function"==typeof(n=this.props).onAnnotationStartDragCallback&&n.onAnnotationStartDragCallback(this.annotation),this._startResizing(o,t)},_renderSideHandles:function(){var e;return d.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},function(){var t,n,o,i;for(o=r.values(this.Directions),i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(function(e){return function(t){return d.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})}}(this)(e));return i}.call(this))},_renderCornerHandles:function(){var e,t,n,o,r,i;for(o=[this.Directions.TOP,this.Directions.BOTTOM],r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push(function(){var t,n,o,r;for(o=[this.Directions.LEFT,this.Directions.RIGHT],r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push(function(e){return function(t,n){return d.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(o){return e._onHandleMouseDown(o,[t,n])}},d.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))}}(this)(i,e));return r}.call(this));return r},render:function(){var e,n;return n=[],this.state.isToolVisible&&(e={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering},n=[d.div({key:"annotationRegion",ref:"annotationRegion",className:t(e),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]),d.div({className:"annotation-region-container"},this.state.isToolVisible?n:void 0)}})}),define("modules/clean/annotations/annotation_region_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,o){var r,i;return i=n.DOM,r=n.createClass({displayName:"AnnotationRegionUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{}},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onRegionClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseEnter:function(t){var n,r,i,s,a,l,c;return n=e(o.findDOMNode(this.refs.annotationRegion)),r=this.props.annotation,null==r.viewportCoordinates&&(r.viewportCoordinates=[]),c=n.offset().top,a=n.offset().left,s=c+n.height(),l=a+n.width(),r.viewportCoordinates[0]=[{x:a,y:c},{x:a,y:s},{x:l,y:s},{x:l,y:c}],"function"==typeof(i=this.props).onAnnotationEnterCallback?i.onAnnotationEnterCallback({annotation:r,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseOver:function(e){return{}},_onRegionMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,o,r,s,a;return o=null!=(s=this.props.commentActivity)&&null!=(a=s.comment)?a.resolved:void 0,r=this.props.annotation.getBoundingBox(),e=t({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":o,"annotation-region--ui--resolved":o,"annotation-region--ghost":this._isGhostAnnotation()}),i.div({className:"annotation-region-container"},i.div({key:"annotationRegion",ref:"annotationRegion",className:e,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:r.left,top:r.top,width:r.right-r.left,height:r.bottom-r.top}},i.div({className:"annotation-region-inner"}),this.props.options.isAnnotationNumberingEnabled?(n=t({"annotation-number":!0,"annotation-number--resolved":o}),i.div({className:n},this.props.options.annotationNumber)):void 0))}})}),define("modules/clean/annotations/annotation_renderer_utils",["jquery","external/react","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/underscore"],function(e,t,n,o,r,i,s){var a,l,c;return a=n.Annotation,c=n.AnnotationTypes,l=function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){var n,o,r,i,a,l,c;if((null!=(a=e.annotations)?a.length:void 0)!==(null!=(l=s.keys(t))?l.length:void 0))return!0;for(c=e.annotations,r=0,i=c.length;i>r;r++)if(o=c[r],n=o.commentActivity.activity_key,!s.isEqual(t[n],o))return!0;return!1},e.prototype.renderAnnotation=function(e,t,n){var s,l,u,d;if(null==e.annotation||null==e.commentActivity)return null;if(s=a.createAnnotationFromDict(e.annotation),u=e.commentActivity,null==(null!=s?s.type:void 0)||t(u.activity_key))return null;switch(l=null,s.type){case c.MARKER:l=r;break;case c.HIGHLIGHT:l=o;break;case c.REGION:l=i}return null==l?null:(d=null!=e.options?e.options:{},n(l,s,u,d))},e}()}),define("modules/clean/annotations/preview_image_annotations_toolbar",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/core/dom","modules/core/i18n","modules/clean/keycode","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/constants/comments_panel"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E;return g=s._,E=s.format_percent,f=c.UserActionNames,m=c.UserActionContextNames,v=t.createElement,y=t.DOM,_=3e3,h=t.createClass({displayName:"PreviewImageAnnotationsToolbar",propTypes:{canEnableRegionCreation:t.PropTypes.bool,index:t.PropTypes.number.isRequired,count:t.PropTypes.number.isRequired,zoomPercent:t.PropTypes.number,minimumZoomPercent:t.PropTypes.number,maximumZoomPercent:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func,onFullscreen:t.PropTypes.func,onZoomIn:t.PropTypes.func,onZoomOut:t.PropTypes.func,onZoomOriginalOrFit:t.PropTypes.func,onRegionCreationClick:t.PropTypes.func},getInitialState:function(){return{isToolbarVisible:!0}},componentDidMount:function(){return window.addEventListener("mousemove",this._onMouseMove),r(document).bind("keydown",this._handleKeyPress)},componentWillUnmount:function(){return window.removeEventListener("mousemove",this._onMouseMove),clearTimeout(this.hideToolbarTimeout),r(document).unbind("keydown",this._handleKeyPress)},_onMouseMove:function(e){return this.state.isToolbarVisible||this.setState({isToolbarVisible:!0}),this.state.isToolbarVisible?(clearTimeout(this.hideToolbarTimeout),this.hideToolbarTimeout=setTimeout(function(t){return function(){return t._maybeHideToolbar(e)}}(this),_)):void 0},_handleKeyPress:function(e){var t,n,o,r;return i.focus_in_input()||i.is_input(e.target)?!0:(r=e.keyCode,r===a.EQUALS||r===a.PLUS_EQUALS_FF||r===a.PLUS_CHROME||r===a.PLUS_EQUALS_FF_GERMAN?("function"==typeof(t=this.props).onZoomIn&&t.onZoomIn(),o=!0):r!==a.MINUS_FF_MAC&&r!==a.MINUS_FF&&r!==a.MINUS_CHROME||("function"==typeof(n=this.props).onZoomOut&&n.onZoomOut(),o=!0),o&&null!=e.preventDefault&&e.preventDefault(),!o)},_maybeHideToolbar:function(e){return 0===r(e.target).closest(n.findDOMNode(this.refs.previewToolbar)).length?this.setState({isToolbarVisible:!1}):void 0},_flipLabelText:function(){return g("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})},_zoomToolTipText:function(){return g(1===this.props.zoomPercent?"Zoom to fit":"View actual size")},_getZoomLabel:function(){return this.props.zoomPercent?E(Math.round(100*this.props.zoomPercent)):""},_onZoomMouseDown:function(e,t){return this.isZooming||l.logUserAction(t.action,t.context),this.isZooming=!0,this._keepZooming(e,400)},_keepZooming:function(e,t){return this.isZooming?(e(),setTimeout(function(t){return function(){return t._keepZooming(e,75)}}(this),t)):void 0},_onZoomMouseUp:function(){return this.isZooming=!1},_onZoomMouseLeave:function(){return this.isZooming=!1},_onClickPrevious:function(){return this.props.onPrevious(),l.logUserAction(f.FLIP_PREV,m.TOOLBAR)},_onClickNext:function(){return this.props.onNext(),l.logUserAction(f.FLIP_NEXT,m.TOOLBAR)},_onClickFullscreen:function(){return this.props.onFullscreen(),l.logUserAction(f.TOGGLE_FULLSCREEN_ON,m.TOOLBAR)},render:function(){var t,n,r;return this.state.isToolbarVisible?this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen?!1:(r={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},n={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},t={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation},y.div({className:"preview-toolbar-overlay-container"},y.div({className:"preview-toolbar-overlay",ref:"previewToolbar"},y.div({className:"preview-toolbar-content image-toolbar"},this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext?y.span({className:"flip-buttons image-toolbar__item"},y.div({className:"flip-button flip-button--previous",onClick:this._onClickPrevious},v(u,{group:"web",name:"s_flip_left",alt:g("Previous")})),y.div({className:"nav-text"},this._flipLabelText()),y.div({className:"flip-button flip-button--next",onClick:this._onClickNext},v(u,{group:"web",name:"s_flip_right",alt:g("Next")}))):void 0,null!=this.props.onZoomOut||null!=this.props.onZoomIn?y.span({className:"flip-buttons image-toolbar__item"},null!=this.props.onZoomOut?y.div({className:e(r),onMouseDown:o.partial(this._onZoomMouseDown,this.props.onZoomOut,{action:f.ZOOM_OUT,context:m.TOOLBAR}),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},v(u,{group:"web",name:"zoomout",alt:g("Zoom Out")})):void 0,null!=this.props.onZoomOriginalOrFit?v(d,{content:this._zoomToolTipText(),position:d.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},y.div({ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this._getZoomLabel())):void 0,null!=this.props.onZoomIn?y.div({className:e(n),onMouseDown:o.partial(this._onZoomMouseDown,this.props.onZoomIn,{action:f.ZOOM_IN,context:m.TOOLBAR}),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},v(u,{group:"web",name:"zoom",alt:g("Zoom In")})):void 0):void 0,null!=this.props.onFullscreen?y.div({className:"fullscreen image-toolbar__item item-w-label",onClick:this._onClickFullscreen},v(u,{group:"web",name:"fullscreen",alt:g("Fullscreen")}),y.span({className:"item-w-label__label"},g("Fullscreen"))):void 0,p.ALLOW_VIEW_ANNOTATE_MODES?y.div({className:e(t),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},v(u,{group:"web",name:"ic_comment_area_large",alt:g("Comment on specific areas")}),y.span({className:"item-w-label__label"},g("Comment"))):void 0)))):!1}})}),define("modules/clean/api_v2/client",["require","exports","tslib","jquery","external/underscore","modules/clean/api_v2/error","modules/clean/devtools/perf_hub_actions","external/es6-promise","modules/constants/debug","modules/constants/request","modules/core/i18n","modules/core/cookies","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){"use strict";var _=function(){function e(e,t){if(void 0===e&&(e="async"),"async"===e){if(void 0!==t)throw new Error("syncMode is 'async'; do not specify a syncTimeout")}else{if("syncOrServiceWorker"===e)throw new Error("syncOrServiceWorker mode not yet supported");if(void 0===t)throw new Error("syncMode is "+e+", but syncTimeout was not specified");if(0>=t)throw new Error("syncMode is "+e+", and you passed syncTimeout="+t+". syncTimeout must be a positive number")}this.syncMode=e,this.syncTimeout=t}return e.prototype.rpc=function(e,t,n,o){null==n&&(n=null);var i=d.read(c.JS_CSRF_COOKIE)||"",s={"X-Dropbox-Uid":e,"X-CSRF-Token":i};r.extend(s,o);var a=new h({scheme:"https",authority:"www.dropbox.com",path:"/2/"+t});l.CPROFILE_ENABLED&&a.setQuery({cProfile:l.CPROFILE_PARAMETER,parent_request_id:c.REQUEST_ID});var u=a.toString(),p=a.getPath(),_=JSON.stringify(n);switch(this.syncMode){case"async":return this.executeAsyncRpc(u,p,s,_);case"sync":return this.executeSyncRpc(u,p,s,_);case"syncOrServiceWorker":throw new Error("syncOrServiceWorker mode not yet supported")}},e.prototype.executeAsyncRpc=function(t,n,r,i){return new a.Promise(function(s,a){return o.ajax({type:"POST",url:t,contentType:"application/json",headers:r,data:i}).done(function(t,o,r){return s(e.processXHRSuccess(n,t,o,r))}).fail(function(t){return a(e.processXHRError(t))})})},e.prototype.executeSyncRpc=function(t,n,r,i){
var s=a.Promise.resolve(null),l=function(t,o,r){s=a.Promise.resolve(e.processXHRSuccess(n,t,o,r))},c=function(t){s=a.Promise.reject(e.processXHRError(t))};return o.ajax({type:"POST",url:t,contentType:"application/json",headers:r,data:i,async:!1,timeout:this.syncTimeout,success:l,error:c}),s},e.processXHRSuccess=function(e,t,n,o){return l.CPROFILE_ENABLED&&s.add_ajax_profile({xhr:o,url:e}),null!=o.responseText?JSON.parse(o.responseText):null},e.processXHRError=function(e){return i.ApiError.parseResponse(e.status,e.getAllResponseHeaders(),e.responseText)},e}();t.ApiV2Client=_;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.rpc=function(t,n,o,r,i){void 0===i&&(i=!1);var s=e.prototype.rpc.call(this,t,n,o,r);return s.catch(function(e){var t;return t=null!=e.error?e.error.console_error:e.message?e.message:u._("There was a problem completing this request."),i&&p.error(t),a.Promise.reject(e)})},t}(_);t.TeamActionsClient=m});var hasProp={}.hasOwnProperty,extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/api_v2/error",["modules/core/html","modules/core/i18n"],function(e,t){var n,o,r,i,s,a,l,c;return l=t._,n=function(){function t(){}return t.parseResponse=function(n,c,u,d){var p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P;null==d&&(d=null),null==d&&(d=function(){switch(n){case 400:return i;case 401:return r;case 409:return o;case 429:return s;default:return n>=500?a:t}}()),S={raw:{status:n,headerString:c,responseBody:u}};try{g=JSON.parse(u)||{},S.error=g.error,S.summary=g.error_summary,b=(null!=(w=g.user_message)?w.text:void 0)||""}catch(e){p=e,S.error=null,S.summary=null,b=""}if(429===n&&(b=b||l('Folder updates in progress — please try again later. <a href="/help/9259">Learn more</a>')),b&&(b=new e(b)),S.headers={},null!=c)for(T=c.split("\n"),f=0,E=T.length;E>f;f++)h=T[f],h.length>0&&(C=h.split(": "),y=C[0],P=C[1],S.headers[y]=P);_=new d(b);for(v in S)hasProp.call(S,v)&&(I=S[v],_[v]=I);return _},t}(),i=function(e){function t(e){this.message=e}return extend(t,e),t}(n),r=function(e){function t(e){this.message=e}return extend(t,e),t}(n),o=function(e){function t(e){this.message=e}return extend(t,e),t}(n),s=function(e){function t(e){this.message=e}return extend(t,e),t.prototype.getRetryAfter=function(){var e;return null!=(e=this.headers)?e["retry-after"]:void 0},t}(n),a=function(e){function t(e){this.message=e}return extend(t,e),t}(n),c=function(e){return function(t){if(t instanceof n)return e(t);throw t}},{catchApiError:c,ApiError:n,AppError:o,AuthError:r,BadRequestError:i,RateLimitError:s,ServerError:a}}),define("modules/clean/api_v2/root_aware_client",["require","exports","tslib","external/underscore","modules/clean/api_v2/client","modules/clean/viewer","modules/core/i18n","external/es6-promise","modules/core/notify"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.rpc=function(t,n,r,s){var a={},l=i.get_viewer().get_user_by_id(t);if(l){var c=l.root_ns_id;c&&(a["X-Dropbox-Path-Root"]=c)}return o.extend(a,s),e.prototype.rpc.call(this,t,n,r,a)},t}(r.ApiV2Client);t.ApiV2RootAwareClient=c;var u=function(){function e(){this.client=new c}return e.prototype.rpc=function(e,t,n,o,r){void 0===o&&(o=!1);var i=this.client.rpc(e,t,n,r);return i.catch(function(e){return o&&l.error(e.message||s._("There was a problem completing this request.")),a.Promise.reject(e)})},e}();t.UserActionsRootAwareClient=u});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/api_v2/types",["external/underscore","modules/clean/datetime"],function(e,t){var n,o,r,i,s,a;return s=t.format_date_utc,n=function(){function e(e,t){this.type=e,this.value=t}return e.parse=function(e){var t;return t=e[".tag"],2===Object.keys(e).length&&null!=e[t]?new o(t,e[t]):new r(t,e)},e}(),o=function(e){function t(e,t){this.type=e,this.value=null!=t?t:null,this.isScalar=!0}return extend(t,e),t.prototype.toJSON=function(){var e;return e={".tag":this.type},null!=this.value&&(e[this.type]=this.value),e},t}(n),r=function(t){function n(e,t){this.type=e,this.value=null!=t?t:{},this.isScalar=!1}return extend(n,t),n.prototype.toJSON=function(){var t;return t={".tag":this.type},e.extend(t,this.value),t},n}(n),a="yyyy-MM-ddTHH:mm:ssZ",i=function(e){return s(e,a)},{formatTimestamp:i,Union:n,UnionScalar:o,UnionStruct:r}}),define("modules/clean/avatar/avatar_with_default",["external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/css"],function(e,t,n,o){var r,i,s,a;return s=n.VALID_AVATAR_DIMENSIONS,a=e.DOM,i=e.createFactory(t),r=e.createClass({displayName:"AvatarWithDefault",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(s).isRequired,defaultAvatar:e.PropTypes.element.isRequired,onPhotoClick:e.PropTypes.func,photoUrl:e.PropTypes.string,optionalClass:e.PropTypes.string,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css")},render:function(){return null!=this.props.photoUrl?i({alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photoUrl:this.props.photoUrl,optionalClass:this.props.optionalClass,shape:this.props.shape}):this.props.defaultAvatar}})}),define("modules/clean/avatar/contact_avatar",["external/react","modules/core/i18n","modules/core/user_i18n","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h;return p=t._,l=i.AVATAR_DIMENSION_BY_SIZE,d=i.VALID_AVATAR_DIMENSIONS,c=s.Contact,h=e.createElement,u=e.createClass({displayName:"ContactAvatar",propTypes:{dimension:e.PropTypes.oneOf(d).isRequired,contact:e.PropTypes.instanceOf(c).isRequired,optionalClass:e.PropTypes.string},render:function(){var e,t,i,s,c,u,d;return i=this.props.contact,c=i.name||i.email,u=i.photo_url,i.type===a.FB&&(u="https://graph.facebook.com/"+i.fb_id+"/picture"),s="",this.props.dimension!==l.XSMALL&&(s=n.getInitials(c)),i.type===a.NEW_STYLE_GROUP?(e=p("Group"),d="SQUARE"):(e=p("User"),d="CIRCLE"),t={alt:e,dimension:this.props.dimension,photoUrl:u,shape:d,optionalClass:this.props.optionalClass,defaultAvatar:h(r,{alt:e,dimension:this.props.dimension,name:c,initials:s,shape:d,optionalClass:this.props.optionalClass})},h(o,t)}})}),define("modules/clean/avatar/faceholder",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/react/image","modules/clean/static_urls"],function(e,t,n,o,r,i){var s,a,l,c,u;return a=t.VALID_AVATAR_DIMENSIONS,c=n.getClassName,u=i.static_url,l=e.DOM,s=e.createClass({displayName:"Faceholder",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},statics:{SRC_MAP:{16:u("/static/images/avatar/faceholder-16-vflzvFMED.png"),24:u("/static/images/avatar/faceholder-24-vflpqFBTK.png"),32:u("/static/images/avatar/faceholder-32-vflKWtuU5.png"),48:u("/static/images/avatar/faceholder-48-vfll8Voom.png"),64:u("/static/images/avatar/faceholder-64-vflHTEplh.png")},SRC_HI_RES_MAP:{16:u("/static/images/avatar/faceholder-16@2x-vflBZ7FgU.png"),24:u("/static/images/avatar/faceholder-24@2x-vflVegRLu.png"),32:u("/static/images/avatar/faceholder-32@2x-vflYmh947.png"),48:u("/static/images/avatar/faceholder-48@2x-vflUglZDR.png"),64:u("/static/images/avatar/faceholder-64@2x-vfl8eFSM8.png")}},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css")},render:function(){var t,n;return t=["c-avatar--circle"],this.props.optionalClass&&t.push(this.props.optionalClass),n=e.createElement(r,{alt:this.props.alt||"",src:s.SRC_MAP[this.props.dimension],srcHiRes:s.SRC_HI_RES_MAP[this.props.dimension]}),null!=this.props.onClick&&this.props.alt?(t.push("u-unbutton"),l.button({className:c(this.props.dimension,t),onClick:this.props.onClick},n)):l.div({className:c(this.props.dimension,t),onClick:this.props.onClick},n)}})}),define("modules/clean/avatar/inherited_count_avatar",["external/classnames","external/react","modules/clean/react/css"],function(e,t,n){var o,r;return r=t.DOM,o=t.createClass({displayName:"InheritedMemberCountAvatar",propTypes:{inheritedMemberCount:t.PropTypes.number.isRequired,onClick:t.PropTypes.func},render:function(){var t;return t=e({"inherited-count-avatar u-pad-horizontal-xxs":!0}),null!=this.props.onClick?r.button({className:t,onClick:this.props.onClick},this.props.inheritedMemberCount):r.div({className:t},this.props.inheritedMemberCount)}}),o=n(o,["/static/css/avatar_list-vflOt1Q0x.css","/static/css/scooter/scooter-scoped-vflebHNBy.css"])}),define("modules/clean/avatar/initials_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css"],function(e,t,n,o){var r,i,s,a;return i=t.VALID_AVATAR_DIMENSIONS,a=n.getClassName,s=e.DOM,r=e.createClass({displayName:"InitialsAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(i).isRequired,initials:e.PropTypes.string.isRequired,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"]).isRequired,color:e.PropTypes.string,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css")},render:function(){var e;return e=["c-avatar--no-img","c-avatar--"+this.props.shape.toLowerCase()],null!=this.props.optionalClass&&e.push(this.props.optionalClass),null!=this.props.onClick&&this.props.alt?(e.push("u-unbutton"),s.button({className:a(this.props.dimension,e),onClick:this.props.onClick,style:this.getContainerStyle()},s.span({"aria-hidden":!0},this.props.initials),s.span({className:"ax-visually-hidden"},this.props.alt))):s.div({className:a(this.props.dimension,e),onClick:this.props.onClick,style:this.getContainerStyle()},this.props.alt?[s.span({"aria-hidden":!0},this.props.initials),s.span({className:"ax-visually-hidden"},this.props.alt)]:this.props.initials)},getContainerStyle:function(){var e;return e={},this.props.color&&(e.backgroundColor=this.props.color),e}})}),define("modules/clean/avatar/initials_avatar_with_color",["jquery","external/react","modules/clean/avatar/initials_avatar","modules/clean/avatar/style"],function(e,t,n,o){var r,i,s;return s=o.colorValueForAvatarName,i=t.createElement,r=t.createClass({displayName:"InitialsAvatarWithColorDerivedFromName",propTypes:{name:t.PropTypes.string.isRequired},render:function(){var t;return t=e.extend({color:s(this.props.name)},this.props),delete t.name,i(n,t)}})}),define("modules/clean/avatar/list",["external/classnames","external/react","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css"],function(e,t,n,o,r,i){var s,a,l,c;return a=r.VALID_AVATAR_DIMENSIONS,l=t.createElement,c=t.DOM,s=t.createClass({displayName:"HorizontalAvatarList",propTypes:{avatars:t.PropTypes.array.isRequired,avatarDimension:t.PropTypes.oneOf(a).isRequired,maxVisible:t.PropTypes.number.isRequired,undisplayableCount:t.PropTypes.number.isRequired,onOverflowCountClick:t.PropTypes.func,overflowCountRenderer:t.PropTypes.func,animation:t.PropTypes.bool,inheritedCountAvatar:t.PropTypes.node,className:t.PropTypes.string,isInAudienceBox:t.PropTypes.bool,reverseAvatars:t.PropTypes.bool,isInSFPreviewPanel:t.PropTypes.bool},getDefaultProps:function(){return{className:"",inheritedCountAvatar:null,isInSFPreviewPanel:!1}},_defaultRenderOverflowCount:function(e){return l(o,{count:e,dimension:this.props.avatarDimension,key:"overflow_pill:"+e,onClick:this.props.onOverflowCountClick})},render:function(){var t,n,o,r,i;return t=this.props.avatars,n=this.props.maxVisible,o=0,this.props.undisplayableCount&&(o+=this.props.undisplayableCount),(this.props.undisplayableCount||t.length>n)&&(n--,o+=t.length-n,t=t.slice(0,n)),o&&(i=null!=(r=this.props.overflowCountRenderer)?r:this._defaultRenderOverflowCount,t.push(i(o))),this.props.reverseAvatars&&t.reverse(),c.div({className:e({"c-facepile":!0})},[this.props.inheritedCountAvatar?c.div({className:"u-l-ib u-mar-right-xxs",key:"inherited_count"},this.props.inheritedCountAvatar):void 0,c.div({className:this.getClassName(),key:"facepile"},this.props.isInSFPreviewPanel?c.div({className:"horizontal-avatar-sublist"},t):t)])},getClassName:function(){return e(["horizontal-avatar-list",this.props.className,this.props.animation?["animation","is-animated"]:null])}}),s=i(s,["/static/css/avatar_list-vflOt1Q0x.css"])}),define("modules/clean/avatar/overflow_count_pill",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/core/i18n"],function(e,t,n,o,r){var i,s,a,l,c;return s=t.VALID_AVATAR_DIMENSIONS,l=n.getClassName,c=r.ungettext,a=e.DOM,i=e.createClass({displayName:"OverflowCountPill",propTypes:{dimension:e.PropTypes.oneOf(s).isRequired,count:e.PropTypes.number.isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css")},render:function(){var e,t;return t=" +"+this.props.count+" ",e=c("%(count)s more member","%(count)s more members",this.props.count).format({count:this.props.count}),null!=this.props.onClick?a.button({className:l(this.props.dimension,["overflow-pill c-avatar--meta u-unbutton"]),onClick:this.props.onClick},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e)):a.div({className:l(this.props.dimension,["overflow-pill c-avatar--meta"])},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e))}})}),define("modules/clean/avatar/photo_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style"],function(e,t,n){var o,r,i,s,a;return r=t.VALID_AVATAR_DIMENSIONS,s=n.dynamicInlineStyle,a=n.getClassName,i=e.DOM,o=e.createClass({displayName:"PhotoAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(r).isRequired,photoUrl:e.PropTypes.string.isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"])},getDefaultProps:function(){return{shape:"CIRCLE"}},render:function(){var e,t;return e=["c-avatar--"+this.props.shape.toLowerCase()],null!=this.props.optionalClass&&e.push(this.props.optionalClass),t=i.img({alt:this.props.alt||"",src:this.props.photoUrl,width:this.props.dimension,height:this.props.dimension}),null!=this.props.onClick&&this.props.alt?(e.push("u-unbutton"),i.button({className:a(this.props.dimension,e),onClick:this.props.onClick},t)):i.div({className:a(this.props.dimension,e),onClick:this.props.onClick},t)}})}),define("modules/clean/avatar/shared_link_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,r,i){var s,a,l,c,u,d;return a=t.VALID_AVATAR_DIMENSIONS,u=n.getClassName,d=r.static_url,l=i._,c=e.DOM,s=e.createClass({displayName:"SharedLinkAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,hasAudienceBox:e.PropTypes.bool,isMaestroDesign:e.PropTypes.bool,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css")},render:function(){var e,t,n;return n=c.img({src:d("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||l("Shared link"),width:12,className:this.props.isMaestroDesign&&this.props.hasAudienceBox?"u-mar-horizontal-xs":void 0}),e=["c-avatar--meta"],null!=this.props.optionalClass&&e.push(this.props.optionalClass),null!=this.props.onClick&&e.push("u-unbutton"),t=u(this.props.dimension,e),null!=this.props.onClick?c.button({className:t,onClick:this.props.onClick},n):c.div({className:t,onClick:this.props.onClick},n)}})}),define("modules/clean/avatar/size",[],function(){var e,t,n;return e={XSMALL:16,SMALL:24,MEDIUM:32,LARGE:48,XLARGE:64},t=function(){var t;t=[];for(n in e)t.push(e[n]);return t}(),{AVATAR_DIMENSION_BY_SIZE:e,VALID_AVATAR_DIMENSIONS:t}}),define("modules/clean/avatar/stacked_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/css","modules/core/user_i18n"],function(e,t,n,o,r,i){var s,a,l,c,u;return a=o.VALID_AVATAR_DIMENSIONS,c=e.DOM,u=e.PropTypes,l=e.createElement,s=e.createClass({displayName:"StackedAvatars",propTypes:{user_front:u.object.isRequired,user_back:u.object.isRequired,dimension:u.oneOf(a).isRequired,optionalClass:u.string,shape:u.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){return r.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css")},render:function(){var e,o;return e="stacked-avatar-bottom",o="stacked-avatar-top",this.props.optionalClass&&(e+=" "+this.props.optionalClass,o+=" "+this.props.optionalClass),c.div({className:"stacked-avatars-section u-l-ib"},l(t,{dimension:this.props.dimension,photoUrl:this.props.user_back.avatar_url,optionalClass:e,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_back.display_name||this.props.user_back.email,initials:i.getInitials(this.props.user_back.display_name||this.props.user_back.email),shape:this.props.shape,optionalClass:e})}),l(t,{dimension:this.props.dimension,photoUrl:this.props.user_front.avatar_url,optionalClass:o,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_front.display_name||this.props.user_front.email,initials:i.getInitials(this.props.user_front.display_name||this.props.user_front.email),shape:this.props.shape,optionalClass:o})}))}})}),define("modules/clean/avatar/style",["external/classnames","external/react","modules/clean/accessibility/utils"],function(e,t,n){var o,r,i,s;return r=n.accessibleColorPalette,o={16:"c-avatar--xs",24:"c-avatar--s",32:"c-avatar--m",48:"c-avatar--l",64:"c-avatar--xl"},i=function(e){var t,n;for(null==e&&(e=""),t=5381*e.length,n=0;n<e.length;)t=e.charCodeAt(n)+((t<<6)+(t<<16)-t),n++;return t=Math.abs(t),r[t%r.length]},s=function(t,n){var r;return null==t&&(t=32),null==n&&(n=[]),r=["c-avatar",o[t]],n=n.concat(r),e.apply(this,n)},{colorValueForAvatarName:i,getClassName:s}}),define("modules/clean/avatar/triple_avatars",["external/react","modules/clean/ajax","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h;return c=i.AVATAR_DIMENSION_BY_SIZE,p=e.createElement,h=e.DOM,d=e.createClass({displayName:"TripleAvatars",getPropTypes:function(){return{contacts:e.PropTypes.arrayOf(e.PropTypes.shape({email:e.PropTypes.string,display_name:e.PropTypes.string,photo_url:e.PropTypes.string})),count:e.PropTypes.integer}},getAvatar:function(e){return p(n,{dimension:c.XLARGE,photoUrl:e.photo_url,defaultAvatar:p(o,{dimension:c.XLARGE,shape:"CIRCLE",initials:l.getInitials(e.display_name),name:e.display_name})})},render:function(){var e;return this.props.contacts&&0!==this.props.contacts.length?(e=this.props.contacts.length,this.props.count&&this.props.count>this.props.contacts.length&&(e=this.props.count),h.div({className:"triple-avatars-section"},this.getAvatar(this.props.contacts[0]),this.props.contacts.length>1?this.getAvatar(this.props.contacts[1]):void 0,3===e?this.getAvatar(this.props.contacts[2]):e>3?p(r,{dimension:c.XLARGE,count:e-2}):void 0)):h.div({})}}),u=s(d,["/static/css/scooter/scooter-scoped-vflebHNBy.css"]),{TripleAvatars:u}}),define("modules/clean/avatar/viewer_avatar",["require","exports","tslib","external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/css","modules/core/uri","modules/clean/event_handler"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=function(e){function t(t){var n=e.call(this,t)||this;return n.state={photoUrl:n.props.photoUrl},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;s.require_css("/static/css/scooter/scooter-scoped-vflebHNBy.css"),this.events.on(document,"db:account_photo:photo_set",function(t,n){var o=2*e.props.dimension,r=o+"x"+o,i=a.parse(n.saved_photo_url).updateQuery({size:r}).toString();e.setState({photoUrl:i})}),this.events.on(document,"db:account_photo:photo_deleted",function(){e.setState({photoUrl:null})})},t.prototype.hasPhotoAvatar=function(){return null!=this.state.photoUrl},t.prototype.render=function(){return this.hasPhotoAvatar()?o.createElement(r,{alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photoUrl:this.state.photoUrl,optionalClass:this.props.optionalClass}):this.props.defaultAvatar},t}(o.Component);return c.displayName="ViewerAvatar",c.propTypes={dimension:o.PropTypes.oneOf(i.VALID_AVATAR_DIMENSIONS).isRequired},c=n.__decorate([l.eventHandler],c)}),define("modules/clean/average_counter",[],function(){var e;return e=function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){return this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t,n;return t=e.reduce(function(e,t){return e+t}),n=this.count+e.length,this.average=(this.average*this.count+t)/n,this.count=n},e}()});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/beacon",["external/underscore","jquery","modules/clean/beacon_nodeps","modules/clean/bolt_nodeps","modules/constants/env","modules/core/exception"],function(e,t,n,o,r,i){var s,a;return a=function(n){function o(n,s,a){this._token=n,this._authn_cb=s,this._authz_cb=a,o.__super__.constructor.call(this,this._token,this._authn_cb,this._authz_cb,r.BEACON_SERVER,t.ajax,e,i)}return extend(o,n),o}(n.Transmitter),s=function(n){function s(n,a,l){s.__super__.constructor.call(this,n,a,l,o,r.THUNDER_SERVER,t.ajax,e,i)}return extend(s,n),s}(n.Receiver),{Agent:n.Agent,AgentStatus:n.AgentStatus,Platforms:n.Platforms,PresenceParams:n.PresenceParams,PresenceType:n.PresenceType,Receiver:s,Source:n.Source,Transmitter:a,UserAppPresence:n.UserAppPresence,UserContextPresence:n.UserContextPresence}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/beacon_nodeps",[],function(){var e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w;return o=5e3,r=12e4,l=6e4,c="invalid_agent",e="authorization_error",u=32,m=64,d=64,_=32,p=128,h=32,i="-",s="|",f={WEB:0,IOS:1,ANDROID:2,DESKTOP:3},E=function(){function e(e,t,n){var o,r,i,s;this.platform=e,this.surface=t,this.identifier=null!=n?n:null,r=!1;for(o in f)if(s=f[o],this.platform===s){r=!0;break}if(!r)throw new Error("platform must be from Beacon.Platforms");if(this.surface.length>_||0===this.surface.length)throw new Error("surface must be populated and <= "+_+" chars.");if((null!=(i=this.identifier)?i.length:void 0)>p)throw new Error("identifier must be <= "+p+" chars.");null===this.identifier&&(this.identifier="")}return e.from_json=function(t){return new e(t.platform,t.surface,t.identifier)},e}(),t=function(){function e(e,t,n,o){if(this.user_id=e,this.app=t,this.context=n,this.source=o,this.user_id.length>m)throw new Error("user_id must be <= "+m+" chars.");if(this.app.length>u||0===this.app.length)throw new Error("app must be populated and <= "+u+" chars.");if(this.context.length>d||0===this.context.length)throw new Error("context must be populated and <= "+d+" chars.")}return e.from_json=function(t){var n;return n=E.from_json(t.source),new e(t.user_id,t.app,t.context,n)},e}(),n=function(){function e(e,t,n){if(this.agent=e,this.status=t,this.auth_key=null!=n?n:null,this.status.length>h)throw new Error("status must be <= "+h+" chars")}return e.from_json=function(n){return new e(t.from_json(n.agent),n.status)},e}(),v={UserContext:"UserContext",UserApp:"UserApp",Context:"Context"},g=function(){function e(e,t,n,o,r){var i,s;if(this.type=e,this.user_id=t,this.app=n,this.context=o,this.token=r,this.type!==v.UserContext&&this.type!==v.UserApp&&this.type!==v.Context)throw new Error("Unsupported type: "+this.type+".");if((null!=(i=this.user_id)?i.length:void 0)>m)throw new Error("user_id must be <= "+m+" chars.");if(this.app.length>u)throw new Error("app must be <= "+u+" chars.");if((null!=(s=this.context)?s.length:void 0)>d)throw new Error("context must be <= "+d+" chars.")}return e}(),w=function(){function e(e,t){this.presence_params=e,this.agents=t}return e}(),S=function(){function e(e,t){this.presence_params=e,this.status=t}return e.Status={Offline:1,Online:2},e}(),a=function(){function e(e,t,n){this.presence_params=e,this.snapshot=t,this.delta=n}return e}(),b=function(){function n(e,t,n,o,r,i,s){this._token=e,this._authn_cb=t,this._authz_cb=n,this._beacon_server=o,this._ajax=r,this._u=i,this._exclog=null!=s?s:null,this._handle_heartbeat_error=bind(this._handle_heartbeat_error,this),this._handle_heartbeat_success=bind(this._handle_heartbeat_success,this),this._heartbeat=bind(this._heartbeat,this),this._started=!1,this._heartbeat_xhr=null,this._timeout_id=null,this._presence_data=[],this._offline_agents=[],this._has_changes=!1}return n.prototype.start=function(){return this._started?void 0:(this._backoff_window=o,this._started=!0,this._has_changes=!1,this._heartbeat())},n.prototype.stop=function(){return this._started=!1,this._heartbeat_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},n.prototype.add_or_update_agents=function(e){var t,n,o;for(n=0,o=e.length;o>n;n++)t=e[n],this._has_changes|=this._add_or_update_agent(t);if(!this._heartbeat_xhr&&this._started)return window.clearTimeout(this._timeout_id),this._timeout_id=window.setTimeout(this._heartbeat,0)},n.prototype.update_token=function(e){this._token=e},n.prototype._add_or_update_agent=function(e){var t,n,o,r,i;for(i=this._presence_data,n=t=0,o=i.length;o>t;n=++t)if(r=i[n],this._u.isEqual(r.agent,e.agent))return r.status!==e.status||r.auth_key!==e.auth_key?(this._presence_data[n]=e,!0):!1;return this._presence_data.push(e),!0},n.prototype._heartbeat=function(){return this._started&&0!==this._presence_data.length?(this._offline_agents=this._presence_data.filter(function(e){return""!==e.status}).map(function(e){return e.agent}),this._has_changes=!1,this._heartbeat_xhr=this._ajax({url:"https://"+this._beacon_server+"/1/update",type:"POST",data:JSON.stringify({token:this._token,updates:this._presence_data}),contentType:"application/json; charset=utf-8",dataType:"json",timeout:5e3,success:this._handle_heartbeat_success,error:this._handle_heartbeat_error,xhrFields:{withCredentials:!0}})):void 0},n.prototype._handle_heartbeat_success=function(n,r,i){var s,a,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I;if(this._heartbeat_xhr=null,this._started){for(d=[],w=n.agent_errors||[],m=0,y=w.length;y>m;m++)a=w[m],h=a.error,s=t.from_json(a.agent),h===e?d.push(s):h===c&&null!=(T=this._exclog)&&T.raiseAndReport("Input error: "+a),this._presence_data=this._presence_data.filter(function(e){return function(t){return!e._u.isEqual(t.agent,s)}}(this));for(d.length&&(p=this._authz_cb,window.setTimeout(function(e){return function(){return p(d)}}(this),0)),C=this._offline_agents,g=0,E=C.length;E>g;g++)for(S=C[g],I=this._presence_data,f=v=0,b=I.length;b>v;f=++v)if(u=I[f],this._u.isEqual(u.agent,S)&&""===u.status){this._presence_data.splice(f,1);break}return _=this._has_changes?0:l,this._backoff_window=o,this._timeout_id=window.setTimeout(this._heartbeat,_)}},n.prototype._handle_heartbeat_error=function(e,t,n){var o,i;if(this._heartbeat_xhr=null,this._started){if(e.status>=400&&e.status<500){if(401===e.status)return window.setTimeout(this._authn_cb,0),void this.stop();400===e.status&&null!=(i=this._exclog)&&i.raiseAndReport("Bad request: "+e.responseText)}return o=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,r),this._timeout_id=window.setTimeout(this._heartbeat,o)}},n}(),y=function(){function e(e,t,n,o,r,i,s,a){var l,c;this._presence_params=e,this._update_callback=t,this._refresh_callback=n,this._bolt=o,this._thunder_hostname=r,this._ajax=i,this._u=s,this._exclog=null!=a?a:null,this._on_refresh=bind(this._on_refresh,this),this._on_update=bind(this._on_update,this),this._compact_context_updates=bind(this._compact_context_updates,this),l=function(){var e,t,n,o;for(n=this._presence_params,o=[],e=0,t=n.length;t>e;e++)c=n[e],o.push(this._presence_params_to_bolt_channel(c));return o}.call(this),this._thunder_client=new this._bolt.ThunderClient(l,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog)}return e.prototype.start=function(){return this._thunder_client.start()},e.prototype.stop=function(){return this._thunder_client.unsubscribe()},e.prototype.add_presence_params=function(e){var t,n,o;return o=this._presence_params.length,this._presence_params=this._u.union(e,this._presence_params),this._presence_params.length===o?!1:(this._thunder_client.unsubscribe(),t=function(){var e,t,o,r;for(o=this._presence_params,r=[],e=0,t=o.length;t>e;e++)n=o[e],r.push(this._presence_params_to_bolt_channel(n));return r}.call(this),this._thunder_client=new this._bolt.ThunderClient(t,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog),this._thunder_client.start(),!0)},e.prototype._presence_params_to_bolt_channel=function(e){switch(e.type){case v.UserContext:return new this._bolt.SignedChannelState("beacon_uc"+i+e.app,""+e.user_id+s+e.context,"0",e.token);case v.UserApp:return new this._bolt.SignedChannelState("beacon_ua"+i+e.app,e.user_id,"0",e.token);case v.Context:return new this._bolt.SignedChannelState("beacon_c"+i+e.app,e.context,"0",e.token);default:throw new Error("Unknown type: "+e.type)}},e.prototype._bolt_channel_to_presence_params=function(e){var t,n,o,r,a,l;if(n=e.app_id.split(i),a=e.unique_id.split(s),2!==n.length)throw new Error("Unexpected format of Bolt app_id: "+e.app_id+".");switch(t=n[1],l="",o="",n[0]){case"beacon_uc":if(2!==a.length)throw new Error("Unexpected format of beacon_uc: "+e.unique_id+".");r=v.UserContext,l=a[0],o=a[1];break;case"beacon_ua":if(1!==a.length)throw new Error("Unexpected format of beacon_ua: "+e.unique_id+".");r=v.UserApp,l=a[0];break;case"beacon_c":if(1!==a.length)throw new Error("Unexpected format of beacon_c: "+e.unique_id+".");r=v.Context,o=a[0];break;default:throw new Error("Unknown Bolt app_id: "+e.app_id+".")}return new g(r,l,t,o,null)},e.prototype._compact_context_updates=function(e,t){var n,o,r,i,s,l,c,u,d,p,h,_,m,f,g,v;for(l=!1,n=[],i=0,d=t.length;d>i;i++)if(v=t[i],null!=v.snapshot)l=!0,n=v.snapshot;else if(null!=v.delta)for(f=v.delta,c=0,p=f.length;p>c;c++){for(_=f[c],r=!1,s=u=0,h=n.length;h>u;s=++u)if(m=n[s],this._u.isEqual(m.agent,_.agent)){r=!0,n[s]=_;break}r||n.push(_)}return l?(g=n,o=null):(g=null,o=n),new a(e,g,o)},e.prototype._on_update=function(e){var o,r,i,s,a,l,c,u,d,p,h,_,m;for(m=[],c=0,d=e.length;d>c;c++)s=e[c],a=s.channel_state,i=new this._bolt.ChannelId(a.app_id,a.unique_id),u=this._bolt_channel_to_presence_params(i),m.push(function(){switch(u.type){case v.UserContext:return h=s.payloads.slice(-1)[0].payload,r=null!=h.agents?function(){var e,t,r,i;for(r=h.agents,i=[],e=0,t=r.length;t>e;e++)o=r[e],i.push(n.from_json(o));return i}():[],new w(u,r);case v.UserApp:return h=s.payloads.slice(-1)[0].payload,new S(u,h.status);case v.Context:return l=function(e){var r;return r=E.from_json(e.source),o=new t(e.user_id,u.app,u.context,r),new n(o,e.status)},p=function(e){var t,n,o;
return{snapshot:null!=(null!=(n=e.snapshot)?n.agents:void 0)?function(){var n,o,r,i;for(r=e.snapshot.agents,i=[],n=0,o=r.length;o>n;n++)t=r[n],i.push(l(t));return i}():void 0,delta:null!=(null!=(o=e.delta)?o.agents:void 0)?function(){var n,o,r,i;for(r=e.delta.agents,i=[],n=0,o=r.length;o>n;n++)t=r[n],i.push(l(t));return i}():void 0}},_=function(){var e,t,n,o;for(n=s.payloads,o=[],e=0,t=n.length;t>e;e++)h=n[e],o.push(p(h.payload));return o}(),this._compact_context_updates(u,_)}}.call(this));return this._update_callback(m)},e.prototype._on_refresh=function(e){var t;return this._refresh_callback(function(){var n,o,r;for(r=[],n=0,o=e.length;o>n;n++)t=e[n],r.push(this._bolt_channel_to_presence_params(t));return r}.call(this))},e}(),{Agent:t,AgentStatus:n,Platforms:f,PresenceParams:g,PresenceType:v,Receiver:y,Source:E,Transmitter:b,UserAppPresence:S,UserContextPresence:w}});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/bolt",["jquery","external/underscore","modules/clean/bolt_nodeps","modules/constants/env","modules/core/exception"],function(e,t,n,o,r){var i,s;return i=function(n){function i(n,s,a){i.__super__.constructor.call(this,n,s,a,o.BOLT_SERVER,e.ajax,t,r)}return extend(i,n),i}(n.BoltClient),s=function(n){function i(n,s,a){i.__super__.constructor.call(this,n,s,a,o.THUNDER_SERVER,e.ajax,t,r)}return extend(i,n),i}(n.ThunderClient),{BoltClient:i,ThunderClient:s,ChannelId:n.ChannelId,SignedChannelState:n.SignedChannelState,Payload:n.Payload,ChannelPayloads:n.ChannelPayloads}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/bolt_nodeps",[],function(){var e,t,n,o,r,i,s,a,l,c,u;return e=1e3,t=3e5,s="/2/notify/subscribe",a="/2/payloads/subscribe",r=function(){function e(e,t){this.app_id=e,this.unique_id=t}return e}(),c=function(){function e(e,t,n,o){this.app_id=e,this.unique_id=t,this.revision=n,this.token=o}return e}(),l=function(){function e(e,t){this.revision=e,this.payload=t}return e}(),i=function(){function e(e,t){this.channel_state=e,this.payloads=t}return e}(),n=function(){function n(t,n,o,r,i,s,a){this._update_callback=n,this._refresh_callback=o,this._hostname=r,this._ajax=i,this._u=s,this._exclog=null!=a?a:null,this._handle_poll_error=bind(this._handle_poll_error,this),this._handle_poll_success=bind(this._handle_poll_success,this),this._must_find_state=bind(this._must_find_state,this),this._long_poll=bind(this._long_poll,this),this._find_state=bind(this._find_state,this),this._signed_channel_states=[],this._started=!1,this._sequence_num=0,this._backoff_window=e,this._additional_headers={},this._timeout_id=null,this.update_states(t)}return n.prototype._encode_channel_state=function(e){return{channel_id:{app_id:e.app_id,unique_id:e.unique_id},revision:e.revision,token:e.token}},n.prototype._decode_channel_state=function(e){return new c(e.channel_id.app_id,e.channel_id.unique_id,e.revision,e.token)},n.prototype._decode_channel_id=function(e){return new r(e.app_id,e.unique_id)},n.prototype._compare_revisions=function(e,t){var n,o,r;return n=Math.max(e.length,t.length),o=Array(n-e.length+1).join("0")+e,r=Array(n-t.length+1).join("0")+t,r>o?-1:o>r?1:0},n.prototype._find_state=function(e){return this._u.find(this._signed_channel_states,function(t){return function(n){return t._u.isEqual(e,n.channel_id)}}(this))},n.prototype.update_states=function(e){var t,n,o,r,i;for(i=[],t=0,n=e.length;n>t;t++)r=e[t],r=this._encode_channel_state(r),o=this._find_state(r.channel_id),null==o?i.push(this._signed_channel_states.push(r)):this._compare_revisions(r.revision,o.revision)>=0?(o.revision=r.revision,i.push(o.token=r.token)):i.push(void 0);return i},n.prototype.start=function(){return this._started?void 0:(this._started=!0,this._long_poll())},n.prototype.unsubscribe=function(){return this._started=!1,null!=this._long_poll_xhr&&this._long_poll_xhr.abort(),this._long_poll_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},n.prototype._long_poll=function(){var e;return this._sequence_num++,e=this._sequence_num,this._long_poll_xhr=this._ajax({url:this._subscribe_url(),type:"POST",data:JSON.stringify({channel_states:this._signed_channel_states}),contentType:"application/json; charset=utf-8",headers:this._additional_headers,dataType:"json",timeout:12e4,success:function(t){return function(n,o,r){return t._handle_poll_success(e,n,o,r)}}(this),error:function(t){return function(n,o){return t._handle_poll_error(e,n,o)}}(this),xhrFields:{withCredentials:!0}})},n.prototype._must_find_state=function(e){var t,n,o;return n=this._find_state(e),null==n&&(t="Bolt returned unknown channel id "+e,null!=(o=this._exclog)&&o.raiseAndReport(t)),n},n.prototype._handle_poll_data=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.raiseAndReport(e):void 0},n.prototype._subscribe_url=function(){return"https://"+this._hostname+this._subscribe_endpoint()},n.prototype._subscribe_endpoint=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.raiseAndReport(e):void 0},n.prototype._handle_poll_success=function(t,n,o,r){var i,s,a;if(t===this._sequence_num&&(this._long_poll_xhr=null,this._started))return a=this._handle_poll_data(n,o,r),a.length>0&&this._u.defer(this._update_callback,a),(null!=(s=n.invalid_channels)?s.length:void 0)>0?void this._u.defer(this._refresh_callback,function(){var e,t,o,r;for(o=n.invalid_channels,r=[],e=0,t=o.length;t>e;e++)i=o[e],r.push(this._decode_channel_id(i));return r}.call(this)):(this._backoff_window=e,this._timeout_id=window.setTimeout(this._long_poll,0))},n.prototype._handle_poll_error=function(e,n,o){var r;if(e===this._sequence_num&&(this._long_poll_xhr=null,this._started))return r=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,t),window.setTimeout(this._long_poll,r)},n}(),o=function(e){function t(e,n,o,r,i,s,a){null==a&&(a=null),this._handle_poll_data=bind(this._handle_poll_data,this),t.__super__.constructor.call(this,e,n,o,r,i,s,a)}return extend(t,e),t.prototype._subscribe_endpoint=function(){return s},t.prototype._handle_poll_data=function(e,t,n){var o,r,i,s,a,l;if(l=[],null!=e.channel_states)for(a=e.channel_states,o=0,r=a.length;r>o;o++)s=a[o],i=this._must_find_state(s.channel_id),this._compare_revisions(s.revision,i.revision)>0&&(i.revision=s.revision,i.token=s.token,l.push(this._decode_channel_state(s)));return l},t}(n),u=function(e){function t(e,n,o,r,i,s,a){null==a&&(a=null),this._handle_poll_data=bind(this._handle_poll_data,this),t.__super__.constructor.call(this,e,n,o,r,i,s,a)}var n;return extend(t,e),n="X-Bolt-Session",t.prototype.unsubscribe=function(){return this._additional_headers[n]=null,t.__super__.unsubscribe.call(this)},t.prototype._subscribe_endpoint=function(){return a},t.prototype._handle_poll_data=function(e,t,o){var r,s,a,c,u,d,p,h,_,m,f,g,v;if(v=[],this._additional_headers={},this._additional_headers[n]=o.getResponseHeader(n),null!=e.channel_payloads)for(f=e.channel_payloads,a=0,u=f.length;u>a;a++){for(r=f[a],h=r.channel_state,p=this._must_find_state(h.channel_id),s=this._decode_channel_state(r.channel_state),m=[],g=r.payloads,c=0,d=g.length;d>c;c++)_=g[c],this._compare_revisions(_.revision,p.revision)>0&&m.push(new l(_.revision,_.payload));m.length>0&&v.push(new i(s,m)),this._compare_revisions(h.revision,p.revision)>0&&(p.revision=h.revision,p.token=h.token)}return v},t}(n),{BoltClient:o,ThunderClient:u,ChannelId:r,SignedChannelState:c,Payload:l,ChannelPayloads:i}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/browse/browse_drag_utils",["jquery"],function(e){var t;return t={_dragEnabledChecks:[],getDraggedLink:function(t){var n,o,r,i,s,a,l,c;if(null==t)return null;if(s=indexOf.call(t.types,"Files")>=0,n=indexOf.call(t.types,"text/html")>=0&&e(t.getData("text/html")).attr("draggable")||indexOf.call(t.types,"text/uri-list")>=0&&"about:blank"===t.getData("text/uri-list")||indexOf.call(t.types,"Url")>=0&&"about:blank"===t.getData("Url"),s||n)return null;c=null;try{a=t.getData("text/x-moz-url")}catch(e){o=e}if(null!=a&&(l=a.split("\n"),l.length>=1&&(c=l[0])),!c)try{c=t.getData("text/uri-list")}catch(e){o=e}if(!c)try{c=t.getData("Url")}catch(e){}return c||(c=null),c},buildUrlLinkfileContents:function(e){return"[InternetShortcut]\r\nURL="+e+"\r\n"},isFileDragEnabled:function(){var e,t,n,o;for(o=this._dragEnabledChecks,t=0,n=o.length;n>t;t++)if(e=o[t],!e())return!1;return!0},addFileDragEnabledCheck:function(e){return this._dragEnabledChecks.push(e)},removeFileDragEnabledCheck:function(e){var t;return t=this._dragEnabledChecks.indexOf(e),t>=0?this._dragEnabledChecks.splice(t,1):void 0},removeAllFileDragEnabledChecks:function(){return this._dragEnabledChecks=[]}}}),define("modules/clean/browse_events",[],function(){var e;return e={RENDER:"db:browse:render",BEFORE_UPDATE:"db:browse:before_update",UPDATE:"db:browse:update",NEW_PAGE:"db:browse:new_page",UPDATE_RENDERED:"db:browse:update_rendered",GA_RENDERED:"db:browse:ga_rendered"}}),define("modules/clean/browse_interface",["modules/clean/viewer","modules/core/i18n","modules/core/uri"],function(e,t,n){var o,r,i,s,a;return a=t._,r="/home",s="/work",i="/personal",o={HOME_ROOT:r,WORK_ROOT:s,PERSONAL_ROOT:i,base_prefix:"",get_browse_root:function(t){var n,o,a;return o=i,a=s,n=r,e.get_viewer().is_paired?"personal"===t.role?this.base_prefix+o:this.base_prefix+a:this.base_prefix+n},get_browse_root_name:function(t){return e.get_viewer().is_paired?e.get_root_name(t):a("Files")},get_all_browse_roots:function(){return e.get_viewer().get_users().map(function(e){return{name:o.get_browse_root_name(e),path:o.get_browse_root(e)}})},browse_uri_for_fq_path:function(e,t){return n({scheme:"https",authority:"www.dropbox.com",path:""+o.get_browse_root(e)+t})},set_base_prefix:function(e){return this.base_prefix=e}}}),define("modules/clean/clipboard",["jquery","modules/clean/static_urls","modules/core/dom","external/swfobject"],function(e,t,n,o){var r,i,s,a,l,c;return c=t.static_url,s=function(){var e,t;return e=(new Date).getTime(),t=("00000"+Math.floor(1e6*Math.random())).slice(-6),"swf_"+e+"_"+t},a=function(e,t){return e.on("mouseover",function(){return t.addClass("hovered")}),e.on("mousedown",function(){return t.addClass("pressed")}),e.on("mouseout",function(){return t.removeClass("hovered pressed")}),e.on("mouseup",function(){return t.removeClass("pressed")})},l=function(e,t){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[e]=function(){return t()},"ClipboardSWFRegister."+e},r=function(t,r,i,u){var d,p,h;return null==i&&(i=null),null==u&&(u=null),u=u||e(document.body),h=s(),d=e("<div />",{id:"flash_copy_container"}).append(e("<div />",{id:h})).css({position:"absolute",zIndex:1}),a(d,r),u.append(d),n.clone_position(d,r,{}),p=l(h,i),window.copyLoaded=function(n){return function(){var n;return n=e("#"+h)[0],n.setCopyText(t),n.setCallbackFunction(p)}}(this),o.embedSWF(c("/static/swf/copy_clipboard-vflvMcZTC.swf"),h,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),d},i={clipboard_overlay:r}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/clipboard_v2",["jquery","external/flash_detect","external/react","modules/core/browser","modules/core/exception","modules/clean/clipboard"],function(e,t,n,o,r,i){var s,assert;return assert=r.assert,s=function(){function n(e,t,n,o){this.copyText=e,this.onSuccess=t,this.onError=n,this.clickHandler=o,this.do_copy=bind(this.do_copy,this)}return n.prototype.setupCopy=function(t,o){var r,s,a;return r=e(o),s=e(t),n.is_flashless_clipboard_supported()?void 0:(a=function(e){return function(){return"function"==typeof e.onSuccess&&e.onSuccess(),"function"==typeof e.clickHandler?e.clickHandler():void 0}}(this),i.clipboard_overlay(this.copyText,s,a,r))},n.prototype.do_copy=function(){var e;if(n.is_supported())return n.is_flashless_clipboard_supported()?(e=document.execCommand("copy",!1),e?"function"==typeof this.onSuccess?this.onSuccess():void 0:"function"==typeof this.onError?this.onError():void 0):void 0},n.is_supported=function(){return n.is_flashless_clipboard_supported()||t.installed},n.is_flashless_clipboard_supported=function(){var e;return e=parseInt(o.version),o.chrome?e>=42:o.mozilla?e>=41:o.opera?e>=29:o.msie?e>=9:o.edge?!0:o.safari?e>=10:!1},n}()});var slice=[].slice;define("modules/clean/comments/action_creators",["external/underscore","external/react","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/annotations/annotation","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/logged_out_utils","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/file_activity/models/file_activity","modules/clean/immutability_helper","external/es6-promise","modules/clean/react/file_comments/onboarding","modules/clean/react/file_comments/shared_link_signup_modals","modules/clean/react/file_viewer/actions","modules/clean/react/modal","modules/clean/storage","modules/constants/legacy","modules/constants/comments_panel","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/revisions/file_revisions_iterator"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O){var R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,assert,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de,pe,he,_e,me,fe;return F=n.EmailVerification,M=r.CommentsVortexLogger,R=i.Annotation,L=l.CommentsEvents,D=u.CommentMetadata,k=d.CommentActivity,ie=p.isRevisionOlderThan,oe=p.getFileWithRevision,x=g.FileActivity,le=v.merge,H=y.Promise,B=w.Modal,U=T.LocalStorage,assert=P.assert,q=A._,Q=function(e,t){var n;return n=f.getInstance().commitOptimisticUpdate(t),e.then(function(e){return f.getInstance().rebase(n),e}),e.catch(function(e){return f.getInstance().rollbackOptimisticUpdate(n),H.reject(e)})},K=function(e){var t,n,o,r,i,s,a,l,c;return c=e.targetActivityKey,i=e.pendingCommentActivity,n=h.state.activity.activity_key,o=c===n?null:c,l=i.comment,a=l.raw_comment_text,t=l.comment_metadata,s=m.addComment({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKey:o,text:a,metadata:null!=t?t.toDict():void 0,oref:h.state.oref}),r=f.getInstance().commitOptimisticUpdate(function(e){return e.appendComment(c,i)}),s.then(function(e){var t;return t=f.getInstance(),t.rollbackOptimisticUpdate(r),t.rebase(function(t){return t.appendComment(c,e)})}),[s,r]},G=function(e,t){return le(e,{status:"FAILED",activity_key:t})},V=function(e){var t,n,o,r,i,a,l,c,u,d,p,m,g;return m=e.targetActivityKey,n=e.body,t=e.annotation,o=_.getActivityUser(h.state.actorId),r=h.state.activity,i=r.activity_key,g=null!=(d=n.text)?d:"",a=s.buildCommentMetadata(n,t),c=k.createLocalInstance({commenter:o,rawCommentText:g,metadata:a,status:"POSTING"}),p=K({targetActivityKey:m,pendingCommentActivity:c}),u=p[0],l=p[1],u.catch(function(e){var t;return t=f.getInstance(),t.rollbackOptimisticUpdate(l),t.commitOptimisticUpdate(function(e,t){var n;return n=G(c,t),e.appendComment(m,n)}),H.reject(e)}),[c,u]},Z=function(e,t,n){var r,i,s;return r=_.getActivityUser(h.state.actorId),s=h.state.activity.activity_key,r.is_signed_in?r.is_email_verified?!0:(i=F.get_for_user(r),F.set_should_use_simple_ui(!1),i.show_verify_modal(null,o.ADD_COMMENT),!1):(c.saveActionCreator({name:e,fileActivityKey:s,args:t}),L.emit("show-sign-up-modal",{fileActivityKey:s,variant:b.POST_COMMENT_VARIANT}),c.logSignUpModal({fileActivityKey:s,commentActivityKey:n,originType:C.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.POST_BUTTON}),U.set("tmp-file-comment",null),!1)},ce=function(e){var t,n,o,r,i;return i=e.targetActivityKey,n=e.pendingCommentActivity,M.log("retry-post-attempt"),f.getInstance().rollbackOptimisticUpdate(n.activity_key),n=n.setStatus("POSTING"),r=K({targetActivityKey:i,pendingCommentActivity:n}),o=r[0],t=r[1],o.catch(function(e){var o;return o=f.getInstance(),o.rollbackOptimisticUpdate(t),o.commitOptimisticUpdate(function(e){var o;return o=G(n,t),e.appendComment(i,o)}),H.reject(e)}),a.addedComment(),o.then(function(){return M.log("retry-post-success")})},X=function(e){var t,n,o,r;if(Z("addFileComment",[e]))return M.log("add-comment-attempt"),r=h.state.activity.activity_key,o=V({targetActivityKey:r,body:e}),t=o[0],n=o[1],a.addedComment(),n.then(function(){return M.log("add-comment-success")})},J=function(e){var t,n,o,r;return t=h.state.createAnnotation.annotation,null!=t&&Z("addInlineAnnotation",[e])?(M.log("add-annotation-attempt"),r=V({targetActivityKey:h.state.activity.activity_key,body:e,annotation:t}),n=r[0],o=r[1],W(n),a.addedComment(),o.then(function(){return M.log("add-annotation-success")})):void 0},$=function(e){var t,n,o,r,i;return i=e.targetActivityKey,t=e.body,Z("addReply",[{targetActivityKey:i,body:t}])?(M.log("add-reply-attempt"),r=V({targetActivityKey:i,body:t}),n=r[0],o=r[1],W(n),a.addedComment(),o.then(function(){return M.log("add-reply-success")})):void 0},W=function(t){return e.defer(function(){return de({activityKey:t.activity_key,expandConversation:!1})})},ee=function(e){var t,n;return t=e.commentActivityKey,M.log("delete-comment-attempt"),assert(null!=h.state.activity.findCommentByKey(t),"Comment activity to delete does not exist: "+t),n=m.deleteComment({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKey:t,oref:h.state.oref}),Q(n,function(e){return e.purgeCommentByKey(t)}),n.then(function(){return M.log("delete-comment-success")})},pe=function(e){var t,n,o,r,i;return n=e.commentActivityKey,i=e.resolved,M.log("set-resolved-attempt"),t=h.state.activity.findCommentByKey(n),assert(null!=t,"Comment activity to resolve/unresolve does not exist: "+n),r=m.updateResolveComment({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKey:n,resolved:i,oref:h.state.oref}),o=t.comment.resolved?function(e){return e.unresolveCommentByKey(n)}:function(e){return e.resolveCommentByKey(n)},Q(r,o),r.then(function(){return M.log("set-resolved-success")})},_e=function(e){var t,n,o;return t=e.enabled,M.log("set-enabled-attempt"),o=m.updateCommentSetting({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,enableComment:t,oref:h.state.oref}),n=h.state.activity.feedback_off?function(e){return e.enableCommenting()}:function(e){return e.disableCommenting()},Q(o,n),t?a.enableCommenting():a.disableCommenting(),o.then(function(){return M.log("set-enabled-success")})},he=function(e){var t,n,r,i,s;return s=e.subscribed,t=_.getActivityUser(h.state.actorId),r=h.state.activity.activity_key,t.is_signed_in?t.is_email_verified?(M.log("set-subscribed-attempt"),i=m.updateFileActivitySubscription({actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,targetUserEmail:null,subscribed:s,oref:h.state.oref}),s?i.then(function(){return N.success(q("You have been subscribed."))}).catch(function(e){return N.error(q("We failed to unsubscribe you.")),H.reject(e)}):i.then(function(){return N.success(q("You have been unsubscribed."))}).catch(function(e){return N.error(q("We failed to unsubscribe you.")),H.reject(e)}),i.then(function(){return M.log("set-subscribe-success")})):(n=F.get_for_user(t),F.set_should_use_simple_ui(!1),void n.show_verify_modal(null,o.SUBSCRIBE_TO_COMMENTS)):(c.saveActionCreator({name:"setCommentSubscribed",fileActivityKey:r,args:slice.call(arguments)}),L.emit("show-sign-up-modal",{fileActivityKey:r,variant:b.SUBSCRIBE_VARIANT}),void c.logSignUpModal({fileActivityKey:r,originType:C.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.SUBSCRIBE_BUTTON}))},ae=function(t){var n,o,r,i,s,a,l;return i=h.state.activity,o=i.findConversationByKey(t),n=_.getActivityUser(h.state.actorId),null!=o&&n.is_signed_in&&(s=function(e){return!(e.is_pending||e.is_seen)},r=o.comment_activities.filter(s),s(o)&&r.push(o),r.length>0)?(M.log("mark-conversation-seen-attempt"),a=e.pluck(r,"activity_key"),l=m.markCommentSeenBatch({isBackgroundRequest:!0,actorId:h.state.actorId,context:h.state.viewing.context,contextData:h.state.viewing.contextData,commentActivityKeys:a}),Q(l,function(e){return i.markCommentSeenByKeyBatch(a)}),l.then(function(){return M.log("mark-conversation-seen-success")})):void 0},de=function(e){var t,n;return t=e.activityKey,n=e.expandConversation,L.emit("reveal-comment-in-pane",{activityKey:t,expandConversation:n})},ue=function(e){var t,n,o,r,i,s,l;return r=h.state.activity,null!=r&&(o=r.findConversationByKey(e),null!=o&&null!=(i=o.comment.comment_metadata)?i.annotation:void 0)?(s=o.comment.comment_metadata,n=s.annotation,l=s.revision,t=R.createAnnotationFromDict(n),null!=l&&a.switchRevision({revision:l,commentActivity:o}),L.emit("reveal-annotation",{page:t.getFirstPdfPage(),commentActivity:o})):void 0},j=function(e){var t,n,o;return o=h.state.activity,t=_.getActivityUser(h.state.actorId),h.state.viewing.file&&o&&e&&ie(o.latest_revision,e.latest_revision)&&(n=oe(h.state.viewing.file,e.latest_revision),S.fastForwardRevision(n)),a.receiveFileActivity(e),t.is_signed_in&&null==o&&null!=e&&c.replayActionCreators({actionCreators:te,fileActivityKey:e.activity_key}),h.state.isPreviewReady&&null==o?L.emit("preview-and-comments-ready"):void 0},Y=function(){var e,n;return e=h.state.actorId,n=t.createElement(E,{onOpen:function(){return a.setShouldShowOnboarding(!1),m.markCommentingOnboardingSeen({actorId:e}).catch(function(){})}}),B.showInstance(n)},fe=function(){var e,t,n,o,r,i;if(e=h.state.actorId,i=h.state.shouldShowOnboarding,r=h.state.viewing,t=r.context,n=r.file,o=_.getPreviewType(t,null!=n?n.preview_type:void 0),null!=e&&null!=o){if(null==i)return m.shouldShowCommentingOnboarding({actorId:e}).then(function(e){return a.setShouldShowOnboarding(e),e?Y():void 0}).catch(function(){});if(i===!0)return Y()}},me=function(){return M.log("show-comments-attempt"),h.areCommentsHidden()?(z(!0),a.showComments(),M.log("show-comments-success")):void 0},re=function(){return M.log("hide-comments-attempt"),h.areCommentsHidden()?void 0:(z(!1),a.hideComments(),M.log("hide-comments-success"))},z=function(e){return null!=h.state.actorId?m.setCommentingPaneVisibility({actorId:h.state.actorId,shouldShow:e}):m.setSessionCommentingPaneVisibility({shouldShow:e})},se=function(){return m.setShowCommentsTutorial({actorId:h.state.actorId,shouldShow:!1})},ne=function(e){var t,n;return t=new O(e,h.state.actorId),n=t.next(),n.done(function(e){return a.receiveRevisions(e.revisions)})},L.on("file-activity-updated",j),te=e.extend({},a,{addReply:$,addFileComment:X,addInlineAnnotation:J,retryPostingComment:ce,deleteComment:ee,setCommentResolved:pe,setCommentSubscribed:he,setCommentsEnabled:_e,markConversationSeen:ae,showOnboardingIfNecessary:fe,revealCommentInPane:de,revealAnnotationInPreview:ue,markCommentsTutorialAsDone:se,showComments:me,hideComments:re,fetchRevisions:ne})}),define("modules/clean/comments/action_creators_helpers",["require","exports","modules/clean/comments/models/comment","modules/clean/comments/store"],function(e,t,n,o){"use strict";function r(e,t){if(e.stickerId||t){var r=t?o.state.activity.latest_revision:null,i=t?t.toMetadataDict():null;return new n.CommentMetadata({revision:r,annotation:i,sticker_id:e.stickerId})}return null}t.buildCommentMetadata=r}),define("modules/clean/comments/actions",["external/underscore","external/reflux"],function(e,t){return t.createActions(e.object(e.map(["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"],function(e){return[e,{sync:!0}]})))}),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/constants",["require","exports","modules/constants/legacy"],function(e,t,n){"use strict";t.FileActivityLogEventType=n.FILE_ACTIVITY_LOG_EVENT_TYPE,t.FileActivityLogClientOriginType=n.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE;var o;!function(e){e[e.MARKER=0]="MARKER",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.REGION=2]="REGION"}(o=t.AnnotationTypes||(t.AnnotationTypes={})),t.AnnotationSubtypes={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}}}),define("modules/clean/comments/demo_action_creators",["require","exports","external/immutable","external/underscore","modules/clean/activity/activity_user","modules/clean/comments/action_creators","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/contacts/demo_contacts","modules/clean/immutability_helper","modules/core/notify","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m){"use strict";function f(e){var t=v(e);a.receiveFileActivity(t)}function g(e){for(var t,n=/@\[(dbid:demo\-data\-[0-9]+):.+?\]/g,o=[];null!=(t=n.exec(e));)o.push(t[1]);return o}function v(e){if(0===Object.keys(L).length)for(var t=0,o=p.demoContacts;t<o.length;t++){var i=o[t];L[i.dbx_account_id]=r.ActivityUser.fromDict({id:parseInt(i.dbx_account_id.split("-").slice(-1)[0],10),fname:i.fname,lname:i.lname,display_name:i.name,email:i.email})}for(var s=n.Set(),a=0,l=e.comment_activities;a<l.length;a++){var c=l[a],u=c.comment.raw_comment_text;s=s.union(g(u))}var _=[];return s.forEach(function(e){return _.push(L[String(e)])}),_.push(d.getActivityUser(-1)),h.set(e,"users_to_notify",_)}function y(e,t,n){var r=t.text,i=u.state.activity,p=s.buildCommentMetadata(t,n),h=new l.Comment({comment_gid:o.uniqueId("demo-data-"),commenter:d.getActivityUser(-1),comment_text:r,raw_comment_text:r,when_mses:1e3*Date.now(),resolved:!1,comment_metadata:p}),_=new c.CommentActivityPermissions({user_ids_who_can_delete:[-1]}),m=new c.CommentActivity({activity_key:o.uniqueId("demo-data-"),comment_activities:[],users_to_notify:[],is_seen:!0,highlight_as_unread:!1,comment:h,permissions:_,status:"POSTED"}),g=i.appendComment(e,m);return a.addedComment(),f(g),m}function E(e){y(u.state.activity.activity_key,e,null)}function b(e){o.defer(function(){O(e.activity_key,!1)})}function S(e){var t=y(e.targetActivityKey,e.body,null);b(t)}function w(e){var t=u.state.createAnnotation.annotation;if(t){var n=y(u.state.activity.activity_key,e,t);b(n)}}function T(e){}function C(e){f(u.state.activity.purgeCommentByKey(e.commentActivityKey))}function I(e){var t,n=u.state.activity,o=e.commentActivityKey,r=e.resolved;t=r?n.resolveCommentByKey(o):n.unresolveCommentByKey(o),f(t)}function P(e){var t=u.state.activity,n=t.users_to_notify,o=[],r=d.getActivityUser(-1);if(e.subscribed)o=h.push(n,r),_.success(m._("You have been subscribed."));else{for(var s=0,a=0,l=n;a<l.length;a++){var c=l[a];s=c.id!==r.id?s++:s}o=h.splice(n,s,1),_.success(m._("You have been unsubscribed."))}var p=h.set(t,"users_to_notify",o);i.receiveFileActivity(p)}function A(e){}function N(){}function O(e,t){i.revealCommentInPane({activityKey:e,expandConversation:t})}function R(e){i.revealAnnotationInPreview(e)}function k(){}function D(){}var L={};return o.extend({},a,{addFileComment:E,addReply:S,addInlineAnnotation:w,retryPostingComment:T,deleteComment:C,setCommentResolved:I,setCommentSubscribed:P,markConversationSeen:A,showOnboardingIfNecessary:N,revealCommentInPane:O,revealAnnotationInPreview:R,markCommentsTutorialAsDone:k,fetchRevisions:D})}),define("modules/clean/comments/demo_file_activity",["require","exports","external/underscore","modules/core/i18n"],function(e,t,n,o){"use strict";var r=-1,i=Date.now(),s={dbx_account_id:"dbid:demo_user",initials_url:"",id:r,photo_url:null,display_name:"Demo User",lname:"User",role:"personal",photo_circle_url:null,fname:"Demo",email:"",unique_id:"dbid:demo_user"};t.demoFileActivity={activity_key:n.uniqueId("demo-data-"),feedback_off:!1,can_edit_feedback:!0,users_to_notify:[s],latest_revision:{direct_blockserver_link:"//block-dbdev.dev.corp.dropbox.com/get/sample%27%60~%24%25%26%E5%8F%89%E7%87%92.docx?_subject_uid=1&cached=False&generate_preview=True&sjid=3&w=AABUizp6_6TII8-KN2rtsYW-2K5nhkGsEru5G06jfc5sgA&get_preview=True&revision_id=AADPqDXmAC_HT_jbF5QOIC2JkAnqkcMedYLMvB8IL_DAa4Om1dCo2-GyFIkc9ampdt5eNvg8yJG84ocUW1MiUMFScACtdFgtxIqWx9NXrrxsxg",rev_owner:null,preview_link:null,when:i,revision_id:"demo_revision_id"},comment_activity_dicts:[{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[s],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:s,comment_text:o._("Hi there! This sample doc is a space for you to try out Dropbox’s commenting feature."),raw_comment_text:o._("Hi there! This sample doc is a space for you to try out Dropbox’s commenting feature."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[r]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[s],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:s,comment_text:o._("Keep discussions and feedback all in one place, right next to the file you’re working on."),raw_comment_text:o._("Keep discussions and feedback all in one place, right next to the file you’re working on."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[r]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[s],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:s,comment_text:o._("You can comment on the entire file by typing in the box at the top of the comment pane."),raw_comment_text:o._("You can comment on the entire file by typing in the box at the top of the comment pane."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[r]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[s],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:s,comment_text:o._("You can also add comments to anywhere on the file, like this one."),raw_comment_text:o._("You can also add comments to anywhere on the file, like this one."),
when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:{annotation:{type:2,subtype:0,thumbnail_url:"",pdf_coordinates:[{coordinates:[{x:279.1885714285714,y:755.8628571428573},{x:279.1885714285714,y:720.8914285714286},{x:314.16,y:720.8914285714286},{x:314.16,y:755.8628571428573}],page:1,page_size:{height:792,width:612}}]},revision:{revision_id:"demo_revision_id",when:i}}},permissions:{user_ids_who_can_delete:[r]}}]}}),define("modules/clean/comments/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";t.CommentsEvents=new n,t.CommentsEventsMixin={onCommentsEvent:function(e,n,o){this.__commentsEvents.push([e,n,o]),t.CommentsEvents.on(e,n,o)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],o=e[1],r=e[2];t.CommentsEvents.off(n,o,r)}),this.__commentsEvents=null}}}),define("modules/clean/comments/flux",["external/underscore","external/reflux","external/react"],function(e,t,n){var o,r,i,s;return o=t.ListenerMethods,r=t.ListenerMixin,s=function(t){return{getInitialState:function(){return t.state},componentWillMount:function(){return e.extend(this,o),this.replaceState(t.state),this.listenTo(t,this.replaceState)},componentWillUnmount:r.componentWillUnmount}},i=function(t,o,r){return null==r&&(r=function(t,n){return e.extend({},t,n)}),function(e){var i;return n.createClass({displayName:"Connect("+(null!=(i=e.displayName)?i:"?")+")",getInitialState:function(){return t.state},componentWillMount:function(){return this.unsubscribeStore=t.listen(function(e){return function(t){return e.replaceState(t)}}(this)),this.replaceState(t.state)},componentWillUnmount:function(){return this.unsubscribeStore()},render:function(){var t,i;return i=o(this.state),t=r(i,this.props),n.createElement(e,t)}})}},{sync:s,connect:i}}),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,o,r){r.value=n.takes.apply(void 0,e.concat([r.value]))}}function r(e){return function(t,o,r){r.value=n.returns(e,r.value)}}t.takes=o,t.returns=r}),define("modules/clean/comments/logged_out_utils",["modules/clean/react/file_comments/logger","modules/clean/storage","modules/constants/legacy"],function(e,t,n){var o,r,i,s,a,l,c,u;return a=t.SessionStorage,o=n.FILE_ACTIVITY_LOG_EVENT_TYPE,r="commenting_actions",s="v1",i=r+":"+s,l=function(t){var n,r,i,s;return r=t.fileActivityKey,n=null!=(s=t.commentActivityKey)?s:null,i=t.originType,e.log_event(o.CLIENT_SIGN_UP_MODAL,r,n,i)},u=function(e){var t,n,o,r,s,l,c,u;l=e.name,s=e.fileActivityKey,n=e.args;try{return u=i+":"+s,t=null!=(c=a.get(u))?c:[],t.push({name:l,args:n}),a.set(u,t)}catch(e){o=e,console.error(o)}},c=function(e){var t,n,o,r,s,l,c;t=e.actionCreators,s=e.fileActivityKey;try{return c=i+":"+s,n=null!=(l=a.get(c))?l:[],a.set(c,null),n.forEach(function(e){var n,o;return o=e.name,n=e.args,t[o].apply(t,n)})}catch(e){o=e,console.error(o)}},{logSignUpModal:l,saveActionCreator:u,replayActionCreators:c}}),define("modules/clean/comments/logging",["require","exports","modules/clean/comments/store","modules/clean/react/file_comments/logger"],function(e,t,n,o){"use strict";function r(e,t){var r=n.state,i=r.actorId,s=r.activity,a=r.viewing.context;try{o.log_event(e,s.activity_key,null,t,i,a)}catch(e){console.warn("logEvent failed",e)}}function i(e,t){var r=n.state,i=r.actorId,s=r.activity,a=r.viewing.context,l=s.findCommentByKey(t);try{o.log_annotation_event(e,s.activity_key,t,i,a,l.comment.comment_metadata.annotation)}catch(e){console.warn("logAnnotationEvent failed",e)}}t.logEvent=r,t.logAnnotationEvent=i}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/underscore","external/deep-freeze","modules/core/types","modules/clean/immutability_helper","modules/clean/comments/lib/type_check","modules/clean/activity/activity_user"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=function(){function e(e){var t=void 0===e?{}:e,n=t.revision,o=void 0===n?null:n,i=t.annotation,s=void 0===i?null:i,a=t.sticker_id,l=void 0===a?null:a,c=t.thumbnail_url,u=void 0===c?null:c;this.revision=o,this.annotation=s,this.sticker_id=l,this.thumbnail_url=u,r(this)}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return o.pick({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},e}();n.__decorate([a.takes({revision:i.Any,annotation:i.Any,stickers:i.Maybe({id:Number}),thumbnail_url:i.Maybe(String)})],c,"fromDict",null),t.CommentMetadata=c;var u=function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,o=void 0===n?"":n,i=t.commenter,s=void 0===i?l.ActivityUser.anonymous:i,a=t.comment_text,c=void 0===a?"":a,u=t.raw_comment_text,d=void 0===u?"":u,p=t.when_mses,h=void 0===p?0:p,_=t.resolved,m=void 0===_?!1:_,f=t.comment_metadata,g=void 0===f?null:f;this.comment_gid=o,this.commenter=s,this.comment_text=c,this.raw_comment_text=d,this.when_mses=h,this.resolved=m,this.comment_metadata=g,r(this)}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:l.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?c.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return s.set(this,"resolved",!0)},e.prototype.unresolve=function(){return s.set(this,"resolved",!1)},e}();n.__decorate([a.takes({comment_gid:String,commenter_dict:i.Any,comment_text:String,raw_comment_text:String,when_mses:Number,resolved:Boolean,comment_meta_json:i.Maybe(Object)})],u,"fromDict",null),t.Comment=u}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n,o(this)}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!r.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},e}();n.__decorate([l.takes({user_ids_who_can_delete:Array})],u,"fromDict",null),t.CommentActivityPermissions=u;var d=function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,r=void 0===n?"":n,i=t.comment_activities,s=void 0===i?[]:i,a=t.users_to_notify,l=void 0===a?[]:a,d=t.is_seen,p=void 0===d?!1:d,h=t.highlight_as_unread,_=void 0===h?!1:h,m=t.comment,f=void 0===m?new c.Comment:m,g=t.permissions,v=void 0===g?new u:g,y=t.status,E=void 0===y?"POSTED":y;this.activity_key=r,this.comment_activities=s,this.users_to_notify=l,this.is_seen=p,this.highlight_as_unread=_,this.comment=f,this.permissions=v,this.status=E,o(this)}return e.createLocalInstance=function(t){var n=t.activityKey,o=void 0===n?r.uniqueId("local-comment-activity-"):n,i=t.commenter,s=t.rawCommentText,a=t.metadata,l=void 0===a?null:a,u=t.status,d=void 0===u?"POSTING":u;return new e({activity_key:o,comment:new c.Comment({comment_gid:r.uniqueId("pending-comment-gid-"),commenter:i,comment_text:s,raw_comment_text:s,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:l}),is_seen:!0,highlight_as_unread:!1,status:d})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:c.Comment.fromDict(t.comment),permissions:u.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return this.highlight_as_unread?!0:this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return s.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return s.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return s.set(this,"status",e)},e.prototype.markSeen=function(){return s.merge(this,{is_seen:!0,highlight_as_unread:!1})},e}();n.__decorate([l.takes({activity_key:String,comment_activity_dicts:Array,users_to_notify:i.Maybe(Array),is_seen:Boolean,highlight_as_unread:Boolean,comment:Object,permissions:Object})],d,"fromDict",null),t.CommentActivity=d}),define("modules/clean/comments/models/loading_spinner",[],function(){return function(e,t){return null==t||t.comment_activities.length>0?e:!1}}),define("modules/clean/comments/models/preview_types",[],function(){return{PDFJS:0,IMAGE:1}}),define("modules/clean/comments/revisions",["external/underscore"],function(e){var t,n,o,r,i;return n=function(t,n){return null!=t.set?t.merge({preview_url:n.preview_link,direct_blockserver_link:n.direct_blockserver_link}):e.extend({},t,{preview_url:n.preview_link,direct_blockserver_link:n.direct_blockserver_link})},t=function(e,t){return t.when-e.when},i=function(e,n){return t(e,n)>0},r=function(e,n){return t(e,n)<0},o=function(e,n){return 0===t(e,n)},{getFileWithRevision:n,compareRevision:t,isRevisionOlderThan:i,isRevisionNewerThan:r,isRevisionEqual:o}}),define("modules/clean/comments/store",["external/underscore","external/reflux","modules/constants/comments_panel","modules/constants/legacy","modules/core/exception","modules/core/i18n","modules/clean/annotations/annotation","external/es6-promise","modules/clean/annotations/annotation","modules/clean/comments/actions","modules/clean/comments/demo_file_activity","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/comments/components/ui_constants","modules/clean/file_activity/models/file_activity","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_comments/logger"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v){var y,E,b,S,w,T,C,I,P,A,N,O,R,k,assert,D;return assert=r.assert,k=i._,y=s.Annotation,T=a.Promise,E=l.AnnotationTypes,D=u.demoFileActivity,b=d.CommentsEvents,P=_.TUTORIAL_INITIATOR,O=_.TUTORIAL_REPLY,R=_.TUTORIAL_REPLY_SUCCESS,A=_.TUTORIAL_MENTION,N=_.TUTORIAL_MENTION_SUCCESS,C=_.TUTORIAL_CREATE_ANNOTATION,I=_.TUTORIAL_CREATE_ANNOTATION_SUCCESS,S=m.FileActivity,w=f.PermissionHelper,t.createStore({listenables:c,init:function(){return this.state=this.getInitialState()},getInitialState:function(){var e;return e={actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:n.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:P,showCommentsPref:n.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(t){return e.extend(this.state,t),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){var t,n,o,r,i;if(null!=(o=this.state.activity)?o.users_to_notify:void 0)for(r=this.state.activity.users_to_notify,t=0,n=r.length;n>t;t++)if(i=r[t],i.id===e)return!0;return!1},isCommentingEnabled:function(){return this.state.activity?!this.state.activity.feedback_off:null!=this.state.viewing.file?!this.state.viewing.file.feedback_off:!0},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){var e;return null!=(e=this.state.activity)?e.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){var e;return!!(null!=(e=this.state.activity)?e.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){var e,t;return null==this.state.activity?null:(e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)},this.state.activity.comment_activities.reduce(t,0))},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n,o,r,i,s,a,l,c;return t=e.actorId,n=e.context,o=e.contextData,i=e.oref,r=e.file,s=e.previewSelector,a=e.showCommentsOverride,c=e.showTutorialOverride,l=null!==this.state.contextData?p(this.state.showLoadingSpinner,this.state.activity):!0,this.setState({actorId:t,viewing:{context:n,contextData:o,file:r,revision:null,showCommentsOverride:a,showTutorialOverride:c},oref:i,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:l,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){return this.setState({isPreviewReady:!0}),null!=this.state.activity?b.emit("preview-and-comments-ready"):void 0},onUpdateAnnotationConversationHover:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{conversationHover:t}),this.setState({viewAnnotation:n})):void 0},onUpdateAnnotationUiHover:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{annotationHover:t}),this.setState({viewAnnotation:n})):void 0},onShowAnnotationConversation:function(e){var t,n;return n=e.annotation,t=e.activityKey,assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),assert(null!=n,"Invalid annotation to show"),assert(null!=this.state.activity.findConversationByKey(t),"Invalid inline comment to show: "+t),this.setState({viewAnnotation:{annotation:n,activityKey:t,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{replyFocused:t}),this.setState({viewAnnotation:n})):void 0},onStartAnnotationCreation:function(e){var t;return t=e.annotation,this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(t){var n,o,r,i;return n=t.activityKey,i=t.text,n in this.state.annotationReplyTextByKey&&!i?(o=e.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:o})):(o=e.extend({},this.state.annotationReplyTextByKey,(r={},r[""+n]=i,r)),this.setState({annotationReplyTextByKey:o}))},onShowAnnotationInput:function(){return null!=this.state.createAnnotation?this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}}):void 0},onHideAnnotationInput:function(){return null!=this.state.createAnnotation?this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}}):void 0},onSwitchRevision:function(t){var n,r,i,s,a;return a=t.revision,n=t.commentActivity,assert(null!=a,"Revision to switch to must not be null!"),assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),h.isRevisionEqual(a,this.state.viewing.revision)?void 0:(h.isRevisionEqual(a,this.state.activity.latest_revision)?(r=o.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,g.restoreRevision()):(r=o.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION,i=h.getFileWithRevision(this.state.viewing.file,a),g.switchRevision(i)),this.setState({viewing:e.extend({},this.state.viewing,{revision:a}),isPreviewReady:!1}),b.emit("revision-did-change"),v.log_annotation_event(r,this.state.activity.activity_key,null!=n?n.activity_key:void 0,this.state.actorId,this.state.viewing.context,null!=n&&null!=(s=n.comment.comment_metadata)?s.annotation:void 0))},onShowComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){var e;return null!=this.state.createAnnotation?(this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null)):null!=this.state.viewAnnotation?(e=this.state.viewAnnotation.activityKey,this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})):void 0},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!1})})},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(t){return n.SHOW_COMMENTS_TUTORIAL=t,this.setState({showTutorial:t,viewing:e.extend(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===C&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:I}):this.state.currentTutorialStep===O&&this.state.expandedComment?this.setState({currentTutorialStep:R}):this.state.currentTutorialStep===A&&this.state.mentionedContact?this.setState({currentTutorialStep:N}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})},demoLoadData:function(){return this.onReceiveFileActivity(S.fromDict(D))}})});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/utils",["modules/clean/annotations/annotation","modules/clean/activity/constants","modules/clean/activity/activity_user","modules/clean/comments/models/preview_types","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/previews/util","modules/clean/react/file_viewer/store","modules/clean/viewer","modules/constants/comments_panel","modules/core/exception","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d){var p,h,_,m,f,g,v,y,E,b,S,w,T,C;return _=e.Annotation,p=t.ActivityContext,h=n.ActivityUser,w=r.isRevisionEqual,m=s.PermissionHelper,f=d._,E=function(e){var t;return-1===e?new h({id:-1,fname:"Demo",lname:"User",display_name:"Demo User",email:"demo_user@example.com",initials:"DU",is_email_verified:!0,is_signed_in:!0}):(t=l.get_viewer(),null!=e?h.fromUser(t.get_user_by_id(e)):t.work_user||t.personal_user?h.fromUser(t.work_user||t.personal_user):t.is_signed_in?void 0:new h)},b=function(e,t){var n;if(n=[p.BROWSE_FILE_VIEWER,p.SHARED_LINK_VIEW,p.SHARED_CONTENT_LINK_VIEW],indexOf.call(n,e)>=0&&null!=t){if("photo"===t)return o.IMAGE;if("doc"===t||"adobecs"===t)return o.PDFJS}return null},v=function(e){return E(e.actorId).is_signed_in},g=function(){var e;return i.isFileActivityReady()?(e=i.isCommentingEnabled(),c.ALLOW_VIEW_ANNOTATE_MODES||(e=e&&!i.areCommentsHidden()),e):!1},y=function(e){var t;return i.isFileActivityReady()?(t=v(i.state),null==e&&(e=a.isFullscreen()),t&&g()&&!e&&w(i.state.viewing.revision,i.state.activity.latest_revision)):!1},S=function(){return y()?c.ALLOW_VIEW_ANNOTATE_MODES?i.state.regionCreationEnabled:!i.areCommentsHidden():!1},C=function(){return!i.areCommentsHidden()&&g()},T=function(){return this.keyCode||this.which||this.charCode},{normalizedKeyCode:T,canAnnotate:y,getActivityUser:E,getPreviewType:b,isRegionCreationEnabled:S,shouldShowExistingAnnotations:C}}),define("modules/clean/components/loading_indicator",["external/classnames","external/underscore","external/react","modules/core/accessible_announce","modules/core/i18n"],function(e,t,n,o,r){var i,s,a,l,c;return i=o.AccessibleAnnounce,l=r._,c=n.DOM,a={DOTS:"dots",SPINNER:"spinner",BLUE_SPINNER:"blue_spinner"},s=n.createClass({displayName:"LoadingIndicator",statics:{LoadingIndicatorStyle:a},propTypes:{style:n.PropTypes.oneOf(t.values(a)),className:n.PropTypes.string,startMessage:n.PropTypes.string,finishMessage:n.PropTypes.string,shouldAnnounceMessage:n.PropTypes.bool},getDefaultProps:function(){return{style:a.DOTS,className:"",startMessage:l("Loading…"),finishMessage:null,shouldAnnounceMessage:!0}},componentDidMount:function(){return this.props.shouldAnnounceMessage?i.polite(this.props.startMessage):void 0},componentWillUnmount:function(){return this.props.finishMessage&&this.props.shouldAnnounceMessage?i.polite(this.props.finishMessage):void 0},render:function(){var n;return n={},this.props.className&&(n=t.object(this.props.className.split(" ").map(function(e){return[e,!0]}))),n=t.extend(n,{"c-loader":!0,"c-loader--spinner":this.props.style===a.SPINNER,"c-loader--spinner--blue":this.props.style===a.BLUE_SPINNER}),c.div({className:e(n)},this.props.startMessage)}})}),define("modules/clean/components/scooter/badge",["external/classnames","external/react","external/underscore","modules/core/i18n"],function(e,t,n,o){var r,i,s,a,l,c;return l=o._,c=t.DOM,s={TOP_RIGHT:"TOP_RIGHT"},a=Object.freeze(["normal","loud"]),r=t.createClass({statics:{POSITIONS:s,VARIANTS:a},displayName:"Badge",mixins:[t.addons.PureRenderMixin],propTypes:{position:t.PropTypes.oneOf(n.values(s)),variant:t.PropTypes.oneOf(a),isMaestroDesign:t.PropTypes.bool},getDefaultProps:function(){return{variant:"normal",isMaestroDesign:!1}},_getClassNames:function(){return this.props.isMaestroDesign?"maestro-badge":e({"c-badge":!0,"c-badge--top-right":this.props.position===s.TOP_RIGHT,"c-badge--loud":"loud"===this.props.variant})},render:function(){return c.div({className:this._getClassNames(),"aria-hidden":!0},this.props.children)}}),i=t.createClass({statics:{POSITIONS:s,VARIANTS:a},displayName:"CounterBadge",mixins:[t.addons.PureRenderMixin],propTypes:{count:t.PropTypes.number,position:t.PropTypes.oneOf(n.values(s)),variant:t.PropTypes.oneOf(a),maxCount:t.PropTypes.number,isMaestroDesign:t.PropTypes.bool},render:function(){var e,n,o,i,s,a,u;return a=this.props,e=a.count,u=a.variant,s=a.position,i=a.maxCount,n=a.isMaestroDesign,e?(o=null!=i&&e>i?l("%(count)s+",{comment:"label text for a counter badge, for example: 99+"}).format({count:i}):String(e),t.createElement(r,{position:s,variant:u,isMaestroDesign:n},o)):c.div()}}),{Badge:r,CounterBadge:i}}),define("modules/clean/components/title_bubble",["jquery","external/classnames","external/react","external/react-dom","modules/clean/react/css"],function(e,t,n,o,r){var i,s;return s=n.DOM,i=n.createClass({displayName:"TitleBubble",propTypes:{text:n.PropTypes.string.isRequired,direction:n.PropTypes.oneOf(["north","south","east","west"]).isRequired,onMouseEnter:n.PropTypes.func,respectLineBreaks:n.PropTypes.bool,className:n.PropTypes.string},getInitialState:function(){return{isChildFocused:!1}},componentDidMount:function(){return e(o.findDOMNode(this)).on("focusin.title-bubble",function(e){return function(t){return e.setState({isChildFocused:!0})}}(this)).on("focusout.title-bubble",function(e){return function(t){return e.setState({isChildFocused:!1})}}(this)).on("mouseenter.title-bubble",function(e){return function(){var t;return"function"==typeof(t=e.props).onMouseEnter?t.onMouseEnter():void 0}}(this))},componentWillUnmount:function(){return e(o.findDOMNode(this)).off("focusin.title-bubble").off("focusout.title-bubble").off("mouseenter.title-bubble")},render:function(){var e;return e={"c-title-bubble":!0,"is-child-focused":this.state.isChildFocused,"c-title-bubble--respect-line-break":this.props.respectLineBreaks},e["c-title-bubble--"+this.props.direction.slice(0,1)]=!0,s.div({className:t([e,this.props.className]),"data-title":this.props.text,onClick:function(e){return function(t){return t.detail>0?e.setState({isChildFocused:!1}):void 0}}(this)},this.props.children)}}),i=r(i,["/static/css/scooter/scooter-scoped-vflebHNBy.css"])}),define("modules/clean/contacts/bloodhound_contacts_v2",["require","exports","external/bloodhound","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/profile_services/profile_services_link","modules/clean/viewer","modules/constants/request","modules/core/cookies"],function(e,t,n,o,r,i,s,a,l){"use strict";function c(e,t){var n=t.includeForUser(e.id).contacts;u(e,n)}function u(e,t){if(e.id in p){var n=p[e.id];t=t.filter(r.ContactCommon.is_valid),n.clearRemoteCache(),n.clear(),n.add(t)}}function d(e){var t=".dropbox.com",n=document.createElement("a");n.href=e;var o=n.hostname||window.location.hostname;if(-1===o.indexOf(t,o.length-t.length))throw new Error("Cannot send the CSRF token to "+o);return e}var p={};t.BloodhoundContactsV2={getOrCreateForUser:function(e){if(e.id in p)return p[e.id];var t,u=o.getSearchConfigForUser(e);if(u.remoteEndpoint){var h=String(e.id);t={url:d(u.remoteEndpoint),prepare:function(e,t){return t.type="POST",t.headers={"X-CSRF-Token":l.read(a.JS_CSRF_COOKIE),"X-Dropbox-Uid":h},t.data={query:JSON.stringify(e)},t.data._subject_uid=h,t},rateLimitBy:"debounce",rateLimitWait:u.remoteDebounceWait}}var _=new n({datumTokenizer:r.ContactCommon.get_index_tokens,queryTokenizer:n.tokenizers.whitespace,identify:r.ContactCommon.get_key,sufficient:u.sufficientResults,sorter:r.ContactCommon.sorter,local:[],remote:t});if(p[e.id]=_,s.get_viewer().is_user_signed_in(e)){var m=u.localCacheStore.getOrCreateForUser(e);m.load_contacts(!1,function(t){c(e,t),m.register_for_updates("bloodhound_contacts_v2",function(t){c(e,t)})})}var f=i.LinkedProfileServices.get_linked_profile_services_for_user(e.id);return f.register_for_service_changes("bloodhound_contacts_v2",function(e){_.clearRemoteCache()}),p[e.id]},search:function(e,n,r,i){var s=t.BloodhoundContactsV2.getOrCreateForUser(e),a=o.getSearchConfigForUser(e);if(!n)return r([]),void(i&&a.remoteEndpoint&&i([]));var l=a.localCacheStore.getOrCreateForUser(e);l.is_loaded()?s.search(n,r,i):l.load_contacts(!1,function(e){s.search(n,r,i)}),l.refresh_contacts(!1)}}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/contacts/cache",["jquery","modules/core/browser","modules/core/exception","modules/clean/ajax","modules/clean/bolt","modules/clean/contacts/cache_type","modules/clean/contacts/list","modules/clean/profile_services/profile_services_constants","modules/clean/user","modules/clean/viewer","modules/constants/contacts"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,assert;return assert=n.assert,p=i.CONTACT_CACHE_TYPE_TO_CONFIG,h=i.ContactCacheType,m=1e3,_=function(){function e(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[],this._config=null}return e.MAX_REQUEST_PERF_RECORDS=20,e.prototype.register_for_updates=function(e,t){return this.callbacks[e]=t},e.prototype.unregister_for_updates=function(e){return null!=this.callbacks[e]?delete this.callbacks[e]:void 0},e.prototype.get_contacts_count=function(){return null!=this.cached_contacts?this.cached_contacts.length():0},e.prototype.get_downloaded_time=function(){var e,n;return e=null!=(n=t.performance())&&"function"==typeof n.getEntriesByName?n.getEntriesByName(this._get_contacts_downloaded_mark_name()):void 0,e&&e.length?e[0].startTime:null},e.prototype.get_request_perf_records=function(){return this.request_perf_records},e.prototype._is_contact_get_or_check_ajax_request=function(e){var t,n;return t=e.initiatorType,n=e.name,"xmlhttprequest"===t&&n.endsWith(this._config.getUrl)},e.prototype._find_last_perf_entry=function(e){var n,o,r,i,s,a;if(null==e&&(e=500),a=null!=(i=t.performance())&&"function"==typeof i.getEntriesByType?i.getEntriesByType("resource"):void 0,null!=a?a.length:void 0)for(r=Math.min(a.length-1,e),n=o=s=r;o>=0;n=o+=-1)if(this._is_contact_get_or_check_ajax_request(a[n]))return a[n];return null},e.prototype._record_perf_stats=function(t){var n;return null==t&&(t={}),n=this._find_last_perf_entry(),n&&(t.ttfb=n.responseStart-n.requestStart,t.downloading_time=n.responseEnd-n.responseStart,t.duration=n.duration,this.request_perf_records.push(t),this.request_perf_records.length>e.MAX_REQUEST_PERF_RECORDS)?this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1):void 0},e.prototype._fetch_contacts=function(){return o.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:function(e){return function(t,n,o){var r;return r=JSON.parse(t),e._contacts_loaded_callback(r),e._schedule_fetch?e._schedule_fetch():void 0}}(this)})},e.prototype._get_versioned_params=function(e,t){var n;return null==t&&(t=!0),n={version:e},t&&(n.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(n.digest=this.digest),null!=this.limit&&(n.limit=this.limit),n},e.prototype._get_contacts_downloaded_mark_name=function(){return this._cache_download_name+"-"+this.instance},e.prototype._is_page_hidden=function(){return null!=window.document.visibilityState&&window.document.hidden},e.prototype._add_one_time_callback=function(e){return null!=e&&indexOf.call(this.one_time_callbacks,e)<0?this.one_time_callbacks.push(e):void 0},e.prototype._invoke_all_callbacks=function(e){
return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)},e.prototype._invoke_one_time_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)},e.prototype._invoke_callbacks=function(e,t,n){var o,r,i,s,a;for(s=Object.keys(e),a=[],o=0,i=s.length;i>o;o++)r=s[o],e[r](t),n?a.push(delete e[r]):a.push(void 0);return a},e}(),d=function(e){function n(e,t,o){this.cache_type=e,this.limit=null!=t?t:null,this.user_id=null!=o?o:null,this.bolt_refresh_callback=bind(this.bolt_refresh_callback,this),this.bolt_update_callback=bind(this.bolt_update_callback,this),n.__super__.constructor.call(this,"BoltContactsCache download"),this.instance=n.INSTANCE++,this.loading_state=n.BOLT_NEED_TO_SEND_REQUEST,this._config=p[h[this.cache_type]],this.current_bolt_states=null,this._notified_states={},this._bolt=null,this._last_refresh_ts=null}return extend(n,e),n.INSTANCE=0,n.BOLT_NEED_TO_SEND_REQUEST=0,n.BOLT_REQUEST_SENT=1,n.REFRESH_THRESHOLD=36e5,n.prototype.load_contacts=function(e,t){return c.get_viewer().is_signed_in?(this._add_one_time_callback(t),(this.loading_state===n.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=n.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts()),!this._should_update_contacts()&&this.is_loaded()?this._invoke_one_time_callbacks(this.cached_contacts):void 0):void 0},n.prototype.refresh_contacts=function(e){var r,i;return null==e&&(e=!1),r=null!=(i=t.performance())&&"function"==typeof i.now?i.now():void 0,this._last_refresh_ts||(e=!0),!e&&this._last_refresh_ts&&r-this._last_refresh_ts<n.REFRESH_THRESHOLD?void 0:(o.BackgroundRequest({url:this._get_refresh_url(),data:this._get_refresh_params({force_refresh:e})}),this._last_refresh_ts=r)},n.prototype.is_loaded=function(){return null!=this.cached_contacts},n.prototype.bolt_update_callback=function(e){var t,o,r,i;for(o=0,r=e.length;r>o;o++)t=e[o],i=t.unique_id,(indexOf.call(this._notified_states,i)<0||+this._notified_states[t.unique_id].revision<+t.revision)&&(this._notified_states[t.unique_id]=t);return this._should_update_contacts()&&(this.loading_state=n.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()},n.prototype.bolt_refresh_callback=function(e){var t;return null!=(t=this._bolt)&&t.unsubscribe(),this._bolt=null,this.loading_state=n.BOLT_NEED_TO_SEND_REQUEST,this._is_page_hidden()?void 0:this.load_contacts()},n.prototype._contacts_loaded_callback=function(e){var n,o,r,i;if(!this._is_old_contacts(e.bolt_info)&&(n=this._is_new_contacts(e.bolt_info),this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),n&&(null!=(o=e.contacts)?o.length:void 0)))return this._record_perf_stats(i={num_contacts:e.contacts.length}),this.digest=e.digest,this._create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),null!=(r=t.performance())&&"function"==typeof r.mark?r.mark(this._get_contacts_downloaded_mark_name()):void 0},n.prototype._create_contacts_list=function(e){return this.cached_contacts=s.create_contacts_list(e)},n.prototype._subscribe_to_bolt=function(){var e,t,n,o;t=[],n=this.current_bolt_states;for(o in n)e=n[o],t.push(new r.SignedChannelState(this._config.boltAppId,o.toString(),e.revision,e.token));return this._bolt=new r.BoltClient(t,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()},n.prototype._is_new_contacts=function(e){return this._first_contacts_are_newer(e,this.current_bolt_states)},n.prototype._is_old_contacts=function(e){return this._first_contacts_are_newer(this.current_bolt_states,e)},n.prototype._first_contacts_are_newer=function(e,t){var n,o,r,i;if(!t)return!0;for(r in t){i=t[r];for(n in e)if(o=e[n],n===r&&+i.revision<+o.revision)return!0}return!1},n.prototype._should_update_contacts=function(){return this._is_new_contacts(this._notified_states)},n.prototype._get_request_params=function(){var e;return e=this._get_versioned_params(1)},n.prototype._get_request_url=function(){return this._config.getUrl},n.prototype._get_refresh_params=function(e){return null==e&&(e={}),e},n.prototype._get_refresh_url=function(){return this._config.refreshUrl},n}(_),f=function(e){function t(e,n){this.cache_type=e,this.user=n,assert(null!=this.user.id),t.__super__.constructor.call(this,this.cache_type,null)}return extend(t,e),t.prototype._get_request_params=function(){var e;return e=this._get_versioned_params(1),e._subject_uid=this.user.id,e},t.prototype._get_refresh_params=function(e){return null==e&&(e={}),e._subject_uid=this.user.id,e},t.prototype._create_contacts_list=function(e){return this.cached_contacts=s.create_per_user_contacts_list(e,this.user.id)},t}(d),{BoltContactsCache:d,ContactsCacheProto:_,PerUserBoltContactsCache:f}}),define("modules/clean/contacts/cache_store",["require","exports","tslib","modules/clean/contacts/cache_type","modules/clean/contacts/cache","modules/constants/contacts","modules/clean/viewer"],function(e,t,n,o,r,i,s){"use strict";var a=function(){function e(e){this.cacheType=e}return e}();t.BoltContactsCacheStore=a;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){if(!s.get_viewer().is_uid_associated(e.id))throw new Error("Requested contacts cache for a user not associated with the current viewer.");return this.getOrCreateForViewer()},t.prototype.getOrCreateForViewer=function(){return null==this.contactsCache&&(this.contactsCache=new r.BoltContactsCache(this.cacheType)),this.contactsCache},t}(a);t.PerViewerBoltContactsCacheStore=l;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uidToContactsCache={},t}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){return e.id in this.uidToContactsCache||(this.uidToContactsCache[e.id]=new r.PerUserBoltContactsCache(this.cacheType,e)),this.uidToContactsCache[e.id]},t}(a);t.PerUserBoltContactsCacheStore=c,t.DefaultContactsCacheStore=new l(o.ContactCacheType.ALL);var u=t.DefaultContactsCacheStore;"OFF"!==i.LEGACY_CACHE_LIMIT&&(u=new l(o.ContactCacheType.ALL),u.contactsCache=new r.BoltContactsCache(o.ContactCacheType.ALL,+i.LEGACY_CACHE_LIMIT)),t.LegacyContactsCacheStore=u,t.IndividualContactsCacheStore=new c(o.ContactCacheType.INDIVIDUAL)}),define("modules/clean/contacts/cache_type",["require","exports"],function(e,t){"use strict";var n;!function(e){e[e.ALL=0]="ALL",e[e.INDIVIDUAL=1]="INDIVIDUAL"}(n=t.ContactCacheType||(t.ContactCacheType={})),t.CONTACT_CACHE_TYPE_TO_CONFIG={ALL:{getUrl:"/contacts/get",refreshUrl:"/contacts/refresh",boltAppId:"contacts_cache_notify"},INDIVIDUAL:{getUrl:"/contacts/get_individual_for_user",refreshUrl:"/contacts/refresh_individual_for_user",boltAppId:"individual_contacts_cache_notify"}}}),define("modules/clean/contacts/config",["require","exports","modules/constants/contacts","modules/clean/contacts/cache_store"],function(e,t,n,o){"use strict";function r(e){return n.MERGE_SEARCH_ALLOWED[e.id]?s.INDIVIDUAL_LOCAL_TEAM_REMOTE:s.ALL_LOCAL}function i(e){return t.CONTACTS_SEARCH_MODE_TO_CONFIG[s[r(e)]]}var s;!function(e){e[e.ALL_LOCAL=0]="ALL_LOCAL",e[e.INDIVIDUAL_LOCAL_TEAM_REMOTE=1]="INDIVIDUAL_LOCAL_TEAM_REMOTE"}(s=t.ContactsSearchMode||(t.ContactsSearchMode={})),t.LOCAL_ONLY_SEARCH_MODES=[s.ALL_LOCAL],t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=300,t.CONTACTS_SEARCH_DEBOUNCE_WAIT=10,t.CONTACTS_SEARCH_MODE_TO_CONFIG={ALL_LOCAL:{localCacheStore:o.DefaultContactsCacheStore,sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT},INDIVIDUAL_LOCAL_TEAM_REMOTE:{localCacheStore:o.IndividualContactsCacheStore,remoteEndpoint:"/team/search_contacts",remoteBatchEndpoint:"/team/search_contacts_batch",sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT}},t.getSearchModeForUser=r,t.getSearchConfigForUser=i}),define("modules/clean/contacts/contact",["require","exports","modules/clean/contacts/types","modules/core/exception"],function(e,t,n,o){"use strict";var r=function(){function e(){}return e.sorter=function(e,t){return e.sort_key||t.sort_key?e.sort_key?t.sort_key?e.sort_key>t.sort_key?-1:e.sort_key<t.sort_key?1:0:-1:1:0},e.is_valid=function(e){return e.dbx_account_id?e.type===n.DBX_ID||e.type===n.EMAIL:e.group_id?e.type===n.NEW_STYLE_GROUP:e.email?e.type===n.EMAIL:!1},e.get_key=function(t){return o.assert(e.is_valid(t),"invalid contact: type: "+t.type),t.dbx_account_id?"DBX_USER-"+t.dbx_account_id:t.group_id?"DBX_GROUP-"+t.group_id:"CONTACT-"+t.type+"-"+t.email},e.get_index_tokens=function(e){var t=[];return e.name&&t.push(e.name),e.email&&t.push(e.email),e.fname&&t.push(e.fname),e.lname&&t.push(e.lname),e.name_tokens&&(t=t.concat(e.name_tokens)),t},e}();t.ContactCommon=r;var i=function(){function e(e){var t=e.dbx_account_id,n=e.type,o=e.name,r=e.email,i=e.fb_id,s=e.group_id,a=e.group_size,l=e.photo_url,c=e.members,u=e.avatar_url,d=e.invalid,p=e.on_team,h=e.dbx_team_id,_=e.nameMatch,m=e.emailMatch,f=e.pending,g=e.query;this.dbx_account_id=t,this.type=n,this.name=o,this.email=r,this.fb_id=i,this.group_id=s,this.group_size=a,this.photo_url=l,this.members=c,this.avatar_url=u,this.invalid=d,this.on_team=p,this.dbx_team_id=h,this.nameMatch=_,this.emailMatch=m,this.pending=f,this.query=g,this.unique_key=this.name+"-"+this.getContactID()+"-"+this.dbx_account_id,this.team=this.on_team}return e.prototype.getKey=function(){return r.get_key(this)},e.prototype.getContactID=function(){switch(this.type){case n.FB:return this.fb_id;case n.NEW_STYLE_GROUP:return this.group_id;default:return this.email}},e}();t.Contact=i}),define("modules/clean/contacts/data_v2",["require","exports","modules/clean/ajax","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/fuzzy"],function(e,t,n,o,r,i,s,a){"use strict";var l=function(){function e(e,t){this.query=this.search,this.query_batch=this.searchBatch,this.user=e,this.filterFunc=t,this.searchConfig=r.getSearchConfigForUser(e),this.searchMode=r.getSearchModeForUser(e),this.searchModeName=r.ContactsSearchMode[this.searchMode],o.BloodhoundContactsV2.getOrCreateForUser(this.user)}return e.prototype.search=function(e,t,n){var r=this;if(e=this.normalizeQuery(e),""===e)return t([]),void(n&&n([]));var i=function(n){return r.processMatches(n,t,e)},s=function(t){return r.processMatches(t,n,e)};o.BloodhoundContactsV2.search(this.user,e,i,s)},e.prototype.searchBatch=function(e,t,n){var o=this,r=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return r.is_loaded()?this.searchBatchInternal(e,t,n):void r.load_contacts(!0,function(r){return o.searchBatchInternal(e,t,n)})},e.prototype.searchBatchInternal=function(e,t,n){for(var r=this,s=e.map(this.normalizeQuery).filter(function(e){return e.length>0}),a={},l=function(e){var t=function(t){a[e]=r.processMatches(t)};o.BloodhoundContactsV2.search(c.user,e,t)},c=this,u=0,d=s;u<d.length;u++){var p=d[u];l(p)}if(t(a),this.searchConfig.remoteBatchEndpoint){var h=function(e){if(n){var t={},o=function(n){if(e.hasOwnProperty(n)){var o=a[n].map(i.ContactCommon.get_key),s=e[n].filter(function(e){var t=i.ContactCommon.get_key(e);return o.every(function(e){return e!==t})});t[n]=r.processMatches(s)}};for(var s in e)o(s);n(t)}};this.searchRemoteBatch(s,h)}},e.prototype.normalizeQuery=function(e){return e.trim().toLowerCase()},e.prototype.isSearchLocalOnly=function(){return-1!==r.LOCAL_ONLY_SEARCH_MODES.indexOf(this.searchMode)},e.prototype.getStats=function(){var e=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return{numLocalContacts:e.get_contacts_count(),localContactsDownloadedTime:e.get_downloaded_time()}},e.prototype.searchRemoteBatch=function(e,t){n.WebRequest({url:this.searchConfig.remoteBatchEndpoint,type:"post",subject_user:this.user,dataType:"json",data:{queries:JSON.stringify(e)},success:t})},e.prototype.isTeamContact=function(e){return this.user.is_team&&null!=e.team&&e.team},e.prototype.processMatches=function(e,t,n){for(var o=[],r=0,l=e;r<l.length;r++){var c=l[r];n&&(c.nameMatch=a.match(n,c.name||""),c.emailMatch=a.match(n,c.email||"")),c.on_team=!(c.type===s.FB||!this.isTeamContact(c));var u=new i.Contact(c);u.pending=!1,this.filterFunc&&!this.filterFunc(u)||o.push(u)}return t&&t(o),o},e}();t.ContactsDataSourceV2=l}),define("modules/clean/contacts/demo_contacts",["require","exports","external/bloodhound","external/underscore","modules/clean/contacts/types","modules/clean/static_urls"],function(e,t,n,o,r,i){"use strict";function s(e,t){return{dbx_account_id:o.uniqueId("dbid:demo-data-"),fname:e,lname:t,name:e+" "+t,name_tokens:[e,t],email:e.toLowerCase()+"."+t.toLowerCase()+"@example.com",type:r.EMAIL,priority:1,photo_url:i.static_url("/static/images/commenting/demoavatars/"+e+"-"+t+".jpg")}}t.demoContacts=[s("Angela","Zhang"),s("Ann","Thompson"),s("Anthony","Abate"),s("Anthony","Davis"),s("Daniel","Smith"),s("David","Zheng"),s("Jay","Singh"),s("Jonathan","Costa"),s("Joshua","Miller"),s("Justin","Anderson"),s("Kimberly","Williams"),s("Michelle","Wallace"),s("Patricia","Johnson"),s("Robert","Anderson"),s("Robert","Haobyan"),s("Wendy","Jones"),s("William","Jackson")],t.demoBloodhound=new n({datumTokenizer:function(e){return[e.name,e.email,e.fname,e.lname].concat(e.name_tokens)},queryTokenizer:function(e){return[e]},local:[]}),t.demoBloodhound.add(t.demoContacts)});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/contacts/facebook_modal",["modules/clean/dbmodal"],function(e){var t,n;return t=e.DBUserModal,n=function(e){function t(e,n,o){this.show_hidden_modal=n,this.link_with_facebook=o,this.on_confirm_button_click=bind(this.on_confirm_button_click,this),this.on_hide=bind(this.on_hide,this),t.__super__.constructor.call(this,e,{element_id:"facebook-confirm-modal-user-"+e.id})}return extend(t,e),t.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},t.prototype.on_confirm_button_click=function(e){return this.hide(),this.link_with_facebook()},t}(t)}),define("modules/clean/contacts/facebook_oauth",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer"],function(e,t,n,o,r){var i,assert;return assert=t.assert,i={do_auth:function(e,t){var o;return assert(null!=t,"user_id must be specified"),o=window.open(n({path:"/fb/access_token"}).updateQuery("_subject_uid",t).toString(),"fb_auth","width=600,height=450"),e?i.onLoginSuccessCallback=e:void 0},post:function(e,t,s,a,l,c,u){return assert(null!=u,"user_id must be specified!"),r.get_viewer().is_signed_in?("function"==typeof i.custom_show_posting&&i.custom_show_posting(),new o.WebRequest({url:"/fb/post",data:{message:e,link:t,link_name:s,description:a,from_referrals:i.from_referrals,from_getspace:i.from_getspace,picture:l?l:""},success:function(n,o,r){var d;return d=r.responseText,0===d.indexOf("ok")?"function"==typeof i.custom_show_complete?i.custom_show_complete():void 0:0===d.indexOf("auth")?i.do_auth(function(){return i.post(e,t,s,a,l,c,u)},u):void 0},error:function(){return"function"==typeof c?c():void 0},subject_user:u})):void window.open(n.parse("http://www.facebook.com/sharer.php").setQuery({u:t,t:s}).toString())}}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(e,t,n){var o;return o=function(){function e(e,t){var n;this.contacts=e,this.owningUserId=t,this._lowercaseContact=bind(this._lowercaseContact,this),this._excludeType=bind(this._excludeType,this),this.sortByTeamFirst=bind(this.sortByTeamFirst,this),this.excludeSuspended=bind(this.excludeSuspended,this),this.excludeNonTeamActive=bind(this.excludeNonTeamActive,this),this.excludeNonTeam=bind(this.excludeNonTeam,this),this.excludePairedUserDuplicates=bind(this.excludePairedUserDuplicates,this),this.excludeTeamMembers=bind(this.excludeTeamMembers,this),this.excludeFacebook=bind(this.excludeFacebook,this),this.excludeNewStyleGroups=bind(this.excludeNewStyleGroups,this),this.excludeMe=bind(this.excludeMe,this),this.excludeByEmail=bind(this.excludeByEmail,this),this.includeForViewer=bind(this.includeForViewer,this),this.includeForUser=bind(this.includeForUser,this),this.slice=bind(this.slice,this),this.length=bind(this.length,this),this.filterContacts=bind(this.filterContacts,this),this.lcontacts=function(){var e,t,o,r;for(o=this.contacts,r=[],e=0,t=o.length;t>e;e++)n=o[e],r.push(this._lowercaseContact(n));return r}.call(this)}return e.create_contacts_list=function(t){return new e(t,null)},e.create_per_user_contacts_list=function(t,n){return new e(t,n)},e.prototype.filterContacts=function(t){var n;return n=this.contacts.filter(t),new e(n,this.owningUserId)},e.prototype.length=function(){return this.contacts.length},e.prototype.slice=function(t,n){return new e(this.contacts.slice(t,n),this.owningUserId)},e.prototype.includeForUser=function(t){return null!=this.owningUserId?this.owningUserId===t?this:new e([],t):(this.owningUserId=t,this.filterContacts(function(e){return e.owning_user_id===t}))},e.prototype.includeForViewer=function(e){var t;return t=e.get_user_ids(),this.filterContacts(function(e){var n;return n=e.owning_user_id,indexOf.call(t,n)>=0})},e.prototype.excludeByEmail=function(e){return e=e?e.toLowerCase():"",this.filterContacts(function(t){return!(e===t.email.toLowerCase())})},e.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},e.prototype.excludeNewStyleGroups=function(){return this._excludeType(n.NEW_STYLE_GROUP)},e.prototype.excludeFacebook=function(){return this._excludeType(n.FB)},e.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},e.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},e.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},e.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},e.prototype.excludeSuspended=function(){return this.filterContacts(function(e){return"suspended"!==e.join_state})},e.prototype.sortByTeamFirst=function(){return new e(e.sortContactsByTeamFirst(this.contacts),this.owningUserId)},e.sortContactsByTeamFirst=function(e){var t,n,o,r,i;for(i=[],r=[],n=0,o=e.length;o>n;n++)t=e[n],t.team?i.push(t):r.push(t);return i.concat(r)},e.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},e.prototype._lowercaseContact=function(e){var t,n,o;n={};for(t in e)o=e[t],("string"==typeof o||o instanceof String)&&(o=o.toLowerCase()),n[t]=o;return n},e}()});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/tokenizer",["external/classnames","external/react","external/underscore","modules/core/browser","modules/core/i18n","modules/clean/analytics","modules/clean/avatar/contact_avatar","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/data_v2","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/em_string","modules/clean/tokenizer","modules/clean/validators/validators","modules/constants/contacts","jquery"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f){var g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D;return A=r._,v=i.ContactSearchLogger,g=l.Contact,b=c.ContactsDataSourceV2,T=u.ContactsTypeaheadSelector,P=h.Tokenizer,N=t.createElement,O=t.DOM,I=16,C=100,D=_.check(_.create(["EmailValidator"])),y={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"},S=t.createClass({displayName:"ContactsToken",propTypes:{customClass:t.PropTypes.string,className:t.PropTypes.string,contact:t.PropTypes.object.isRequired,onRemove:t.PropTypes.func,tabIndex:t.PropTypes.number,tokenState:t.PropTypes.oneOf(function(){var e;e=[];for(R in y)k=y[R],e.push(k);return e}()).isRequired},render:function(){var t,n;return n={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===y.invalid,warned:this.props.tokenState===y.warn,pending:this.props.tokenState===y.pending},n[this.props.customClass]=null!=this.props.customClass,n[this.props.className]=null!=this.props.className,t=e(n),O.a(f.extend({tabIndex:-1},this.props,{className:t}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())},_getTokenName:function(){switch(this.props.contact.type){case d.FB:return"fb_ids";case d.EMAIL:return"emails";case d.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},_getTokenValue:function(){switch(this.props.contact.type){case d.FB:return this.props.contact.fb_id;case d.NEW_STYLE_GROUP:return this.props.contact.group_id;default:return this.props.contact.email}},_renderIcon:function(){return this.props.contact.type===d.FB?O.img({className:"token-icon",src:"/static/images/icons/fb_16-vflbiYTkC.png"}):this.props.contact.type===d.NEW_STYLE_GROUP||this.props.contact.dbx_account_id?N(s,{dimension:I,contact:this.props.contact,optionalClass:"token-icon"}):""},_renderInput:function(){return O.input({type:"hidden",name:this._getTokenName(),value:this._getTokenValue()})},_renderText:function(){var e,t;return e=22,t=this.props.contact.name||this.props.contact.email,p.em_snippet(t,e)},_makeCloseButton:function(){return this.props.onRemove?O.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(e.props.contact),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),E={basic:function(e){var t;return t=e.name&&!e.invalid&&e.email!==e.name,{state:e.invalid?y.invalid:y.ok,msg:t?e.email:null}},warn:function(e){return{state:e.pending?y.pending:e.on_team?y.ok:e.invalid?y.invalid:y.warn,msg:null}},forbid:function(e){return{state:e.pending?y.pending:e.on_team?y.ok:y.invalid,msg:null}}},w=t.createClass({displayName:"ContactsTokenizer",propTypes:{user:t.PropTypes.object.isRequired,context:t.PropTypes.string,customClass:t.PropTypes.string,customContactFilter:t.PropTypes.func,customContactValidator:t.PropTypes.func,focusOnMount:t.PropTypes.bool,id:t.PropTypes.string,onContentsChange:t.PropTypes.func,placeholder:t.PropTypes.string,populatedInputData:t.PropTypes.shape({tokens:t.PropTypes.array,value:t.PropTypes.string}),tabIndex:t.PropTypes.number,showContactImport:t.PropTypes.bool,shouldLogContactSearch:t.PropTypes.bool,teamGroupInfo:t.PropTypes.shape({id:t.PropTypes.string,name:t.PropTypes.string}),tokenSpacing:t.PropTypes.number},getDefaultProps:function(){return{customContactFilter:function(e){return!0},customContactValidator:E.basic,focusOnMount:!1,id:null,placeholder:A("Invite more people"),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,teamGroupInfo:null}},_initContactsDataSource:function(e,t){return new b(e,t)},componentWillReceiveProps:function(e){var t;e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=this._initContactsDataSource(e.user,e.customContactFilter)),this._validateTokens(null!=(t=e.populatedInputData)?t.tokens:void 0)},componentWillMount:function(){var e;this.contactsDataSource=this._initContactsDataSource(this.props.user,this.props.customContactFilter),this._validateTokens(null!=(e=this.props.populatedInputData)?e.tokens:void 0,!0)},componentDidMount:function(){var e,t,n,o,r,i;return this.props.shouldLogContactSearch&&(this.contact_search_logger=new v(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),(null!=(t=this.props.populatedInputData.tokens)?t.length:void 0)>0||(null!=(n=this.props.populatedInputData.value)?n.length:void 0)>0?(o=this.serializeInputData(),r=o.tokens,i=o.value,"function"==typeof(e=this.props).onContentsChange?e.onContentsChange(r,i):void 0):void 0},_validateTokens:function(e,t){var n,o,r,i;if(null==t&&(t=!1),(null!=e?e.length:void 0)>0){for(r=[],n=0,o=e.length;o>n;n++)i=e[n],i.type===d.EMAIL&&(i.invalid=!D(i.email)),t?(i.query=i.query||i.email||i.name,r.push(i.pending=!0)):r.push(void 0);return r}},finishLogging:function(e){var t;return t=this.contactsDataSource.getStats().numLocalContacts,this._flush_unfinished_queries_cache(),this.props.shouldLogContactSearch?this.contact_search_logger.log_records(this.props.user.id,e,t):void 0},_logTokenChangeEvent:function(e,t,n){var r,i;if(null==t&&(t=!1),null==n&&(n={}),this.contact_search_logger){if(t)return this.contact_search_logger.flag_record_as_removed(e.getContactID());r={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:null!=(i=o.performance())&&"function"==typeof i.now?i.now():void 0};for(R in n)k=n[R],r[R]=k;return this.contact_search_logger.add_record(r)}},_logSearchComplete:function(e,t,n){var r,i,s,a;return null==n&&(n=!0),this._shouldLogSearch()&&e&&(s=o.performance().now(),a=this.unfinished_contact_search_queries[e])?(r=a.begin_time,!("ttfr"in a)&&t>0&&(a.ttfr=Math.floor(s-r)),n?(a.local_duration=Math.floor(s-r),a.num_local_results=t):(a.remote_duration=Math.floor(s-r),a.num_additional_remote_results=t),a.num_results+=t,i=function(e){return function(){return e.contactsDataSource.isSearchLocalOnly()&&n||!n}}(this),i()?(a=this._prepareSearchStatsForLogging(a,e,s,!0),this.contact_search_logger.add_timing_record(a),this.contact_search_logger.count_search(a.is_slow),delete this.unfinished_contact_search_queries[e]):void 0):void 0},_logSearchBegin:function(e){var t;if(this._shouldLogSearch()&&e)return t=o.performance().now(),this._flush_unfinished_queries_cache(t),this.unfinished_contact_search_queries[e]={begin_time:t,num_results:0}},_shouldLogSearch:function(){var e;return this.props.shouldLogContactSearch&&null!=this.contact_search_logger&&null!=(null!=(e=o.performance())?e.now:void 0)},_flush_unfinished_queries_cache:function(e){var t,n,r;if(this._shouldLogSearch()){null==e&&(e=o.performance().now()),n=this.unfinished_contact_search_queries;for(t in n)r=n[t],e-r.begin_time<a.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(r.is_preempted=!0),r=this._prepareSearchStatsForLogging(r,t,e,!1),this.contact_search_logger.add_timing_record(r),this.contact_search_logger.count_search(r.is_slow);return this.unfinished_contact_search_queries={}}},_prepareSearchStatsForLogging:function(e,t,n,o){var r,i;return r=e.begin_time,e.duration=Math.floor(n-r),"ttfr"in e?e.is_slow=e.ttfr>C:o&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>C,i=this.contactsDataSource.getStats().localContactsDownloadedTime,e.started_before_download=null!=i?i>r:!0,"is_preempted"in e||(e.is_preempted=!1),e.context=this._getLoggingContext(),e.query_length=t.length,e.is_finished=o,e},_getLoggingContext:function(){var e;return e="react_tokenizer",null!=this.props.context&&(e+="_"+this.props.context),e},addExternalContacts:function(e){return this.refs.tokenizer.addExternalTokens(e)},render:function(){return N(P,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:function(e){return function(){return N(T,{showContactImport:e.props.showContactImport,teamGroupInfo:e.props.teamGroupInfo,user:e.props.user})}}(this),renderInput:function(e){return function(){return O.textarea({className:"contacts-tokenizer-input",id:e.props.id,rows:1})}}(this),renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._queryTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logSearchBegin:this._logSearchBegin,logSearchComplete:this._logSearchComplete,logTokenChangeEvent:this._logTokenChangeEvent},this.props.children)},_renderToken:function(e){return N(S,{contact:e,tokenState:this.props.customContactValidator(e).state})},_renderTokenHover:function(e){return this.props.customContactValidator(e).msg},_autoSelectMatch:function(e,t){var n,o,r,i,s,a,l,c,u,d;if(!t||!e)return null;for(e=this.contactsDataSource.normalizeQuery(e),r={email:[],name:[]},i=0,a=t.length;a>i;i++)c=t[i],n=c.email?this.contactsDataSource.normalizeQuery(c.email):null,u=c.name?this.contactsDataSource.normalizeQuery(c.name):null,e===n?r.email.push(c):e===u&&r.name.push(c);for(d=["email","name"],s=0,l=d.length;l>s;s++)if(o=d[s],1===r[o].length)return r[o][0];return null},_queryTokens:function(e,t){var n,o,r,i,s,a;return r=e.filter(function(e){return e.pending&&e.query}),r.length?(i=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)a=r[e],n.push(a.query);return n}(),o=function(n){return function(o){var r,i,s,a,l,c,u,d;for(i=[],e=[],r=n.serializeInputData(t).tokens,s=0,a=r.length;a>s;s++)c=r[s],l=c,c.pending&&c.query&&(u=n.contactsDataSource.normalizeQuery(c.query),d=n._autoSelectMatch(u,o[u]),d&&(l=d)),R=l.getKey(),indexOf.call(i,R)>=0||(i.push(R),e.push(l));return t.replaceTokens(e)}}(this),s=o,n=o,this.contactsDataSource.searchBatch(i,s,n)):void 0},tokenizeEmails:function(e,t){var n,o,r,i,s,a,l,c,u,p;for(null==t&&(t=!1),n=/[,|;\n]+/,o=/[,|;\n ]+/,a=e.split(o),c=2===a.length&&D(a[0])&&""===a[1]?a:e.split(n),p="",t||(p=c.pop()),u=[],r=0,i=c.length;i>r;r++)l=c[r],s=l.trim(),""!==s&&u.push(new g({name:s,email:s,type:d.EMAIL,invalid:!D(s),on_team:!1,pending:!0,query:s}));return{tokens:u,value:p}},serializeInputData:function(e){return e=e||this.refs.tokenizer,e.serializeInputData()},getContacts:function(){var e,t,n,o;return e=this.serializeInputData(),n=e.tokens,o=e.value,t=this.tokenizeEmails(o,!0),n.concat(t.tokens)},tokenizeAll:function(){return this.refs.tokenizer.tokenizeAll()}}),{ContactsTokenizer:w,ContactTokenValidator:E,ContactTokenState:y,SLOW_CONTACT_SEARCH_THRESHOLD:C}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/typeahead",["jquery","external/classnames","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/avatar/contact_avatar","modules/clean/contacts/util","modules/clean/css","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/contacts/types","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/paging_list","modules/clean/static_urls","modules/clean/typeahead","modules/clean/em_string"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y){var E,b,S,w,T,C,I,P,A,N,O,R,k,assert,D,L,M,F,x;return assert=r.assert,R=i._,k=u.addAuthCompleteListener,F=u.removeAuthCompleteListener,C=p.LinkedProfileServices,I=p.ProfileServicesLinkingHandler,x=g.static_url,O=v.TypeaheadSelectorMixin,L=n.DOM,D=n.createElement,M=function(e,t){return o.extend({},e,t)},P=32,b=M(O,{getOptions:function(){var e,t,n;return null==this.props.queryOptions?[]:this.state.importsExpanded?function(){var e,n,o,r;for(o=d.importable_contact_services(),r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push(new A({provider:t,connected:this.profile_services.service_is_connected(t)}));return r}.call(this):(e=this.props.queryOptions.slice(0),this.props.teamGroupInfo?e.push(l.teamGroupInfoToContact(this.props.teamGroupInfo)):(null!=(n=this.profile_services)?n.has_unconnected_services(!0):void 0)&&e.push(new w),e)},renderOption:function(e){return e instanceof w?D(T):e instanceof A?D(N,{import:e}):this.props.renderQueryOption(e);
},onSelect:function(e){var t,n;return e instanceof w?(this._changeSelectionIndex(0),this.setState({importsExpanded:!0})):e instanceof A?(assert((n=e.provider,indexOf.call(d.importable_contact_services(),n)>=0),"invalid party contact provider "+e.provider),this.profile_services.service_is_connected(e.provider)?(t=R("You're already connected to %(service_name)s").format({service_name:d.to_name(e.provider)}),void s.success(t)):this.link_handler.auth_service_with_user(e.provider,this.props.user.id,function(e){return function(e){return I.show_import_notifications(e)}}(this))):this.props.onSelect(e)},reset:function(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),E=n.createClass({displayName:"ContactsTypeaheadSelector",mixins:[b],propTypes:{customClass:n.PropTypes.string,onSelect:n.PropTypes.func.isRequired,queryOptions:n.PropTypes.array,renderQueryOption:n.PropTypes.func.isRequired,showContactImport:n.PropTypes.bool,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),user:n.PropTypes.object.isRequired},componentWillMount:function(){return this.link_handler=new I,this.profile_services=null,null===this.props.teamGroupInfo&&this.props.showContactImport&&null!=this.props.user?this.profile_services=C.get_linked_profile_services_for_user(this.props.user.id):void 0},componentWillReceiveProps:function(e){var t,n;return 0===(null!=(t=e.queryOptions)?t.length:void 0)?this._changeSelectionIndex(-1):(null!=(n=e.queryOptions)?n.length:void 0)>0&&-1===this.state.selectionIndex?this._changeSelectionIndex(0):void 0},shouldComponentUpdate:function(e,t){return!o.isEqual(e,this.props)||!o.isEqual(t,this.state)},getDefaultProps:function(){return{showContactImport:!1,teamGroupInfo:null,onSelect:function(e){},renderQueryOption:function(e){return D(S,{contact:e})}}},onSelectionIndexChange:function(e){var t;return null!=(t=this.refs.pagingList)?t.scrollAround(e):void 0},render:function(){var e;return c.require_css("/static/css/react/contacts_typeahead-vflRzfV9H.css"),this.getOptions().length?(e={"typeahead-selector":!0,"contacts-selector":!0},e[this.props.customClass]=null!=this.props.customClass,D(f,{customClass:t(e),pageSize:4,itemSize:54,ref:"pagingList"},this.renderOptions())):L.div({})}}),S=n.createClass({displayName:"ContactsTypeaheadSelectorOption",propTypes:{contact:n.PropTypes.object.isRequired,customClass:n.PropTypes.string},render:function(){var e,n,r,i,s;return e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0),r={primary:this._renderPrimary(),secondary:this._renderSecondary()},r=o.pick(r,function(e){return""!==e}),L.li(M(this.props,{className:t(e)}),D(_.Flag,{leftAttachment:this._renderIcon()},function(){var a;a=[];for(i in r)s=r[i],e={"option-only":1===o.size(r)},e["option-"+i]=!0,a.push(n=L.div({className:t(e),key:"option-"+i},s));return a}()))},_renderPrimary:function(){return this._renderMatch(this.props.contact.name,this.props.contact.nameMatch)},_renderSecondary:function(){switch(this.props.contact.type){case h.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case h.FB:return R("Facebook message");case h.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},_renderMatch:function(e,t){var n,o,r,i,s,a,l,c,u,d,p,h;if(n=22,e&&(e=y.em_snippet(e,n)),!t)return e;for(d=e.indexOf("…"),a=0,u=[],p=t.highlighted,i=0,l=p.length;l>i;i++)h=p[i],s=h[0],c=h[1],s>a&&u.push(e.slice(a,s)),o=s+c,o>d&&-1!==d&&(o=d),r=e.slice(s,o),u.push(L.strong({key:"highlight-"+r+"-"+s},r)),a=o;return a<e.length&&u.push(e.slice(a)),u},_renderIcon:function(){return L.div({className:"u-pad-right-xs"},D(a,{dimension:P,contact:this.props.contact,optionalClass:"contact-icon"}))}}),w=function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e}(),T=n.createClass({displayName:"ExpandImportOption",render:function(){var e;return e={"expand-imports-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),L.li(M(this.props,{className:t(e)}),D(_.Flag,{leftAttachment:D(m,{className:"u-pad-right-xs",src:x("/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:x("/static/images/icons/icon-import@2x-vfluE8TBO.png")})},L.div({className:"option-primary option-only"},R("Import contacts"))))}}),A=function(){function e(e){this.provider=e.provider,this.connected=e.connected}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e}(),N=n.createClass({displayName:"ThirdPartyImportOption",getInitialState:function(){return{showSpinner:!1}},propTypes:{import:n.PropTypes.object.isRequired},componentDidMount:function(){return this.authCompleteListenerToken=k(this.show_contact_import_spinner)},componentWillUnmount:function(){return F(this.authCompleteListenerToken)},show_contact_import_spinner:function(e){return this.props.import.provider===e.provider?this.setState({showSpinner:!0}):void 0},render:function(){var e,n,o,r,i,s;return s=this.props.import,r=s.provider,n=s.connected,i=d.to_name(r),!n&&this.state.showSpinner&&(i=R("Importing %(service_name)s Contacts").format({service_name:i})),o=n?R("Connected"):"",e={"third-party-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),L.li(M(this.props,{className:t(e)}),!n&&this.state.showSpinner?L.div({className:"option-spinner"},L.img({src:"/static/images/icons/ajax-loading-small-blue-vflm7vRcz.gif"})):void 0,D(_.Flag,{spacing:"xs",leftAttachment:D(m,{alt:"",src:x(d.to_img(r)[0]),srcHiRes:x(d.to_img(r)[1])})},L.div({className:t({"option-primary":!0,"option-only":!n})},i,n?L.div({className:"option-secondary u-font-meta"},o):void 0)))}}),{ContactsTypeaheadSelector:E,ContactsTypeaheadSelectorOption:S,ExpandImportOption:T,ThirdPartyImportOption:N}}),define("modules/clean/contacts/types",["require","exports"],function(e,t){"use strict";var n;return function(e){e[e.EMAIL=0]="EMAIL",e[e.FB=1]="FB",e[e.INVALID_ID=2]="INVALID_ID",e[e.NEW_STYLE_GROUP=4]="NEW_STYLE_GROUP",e[e.DBX_ID=5]="DBX_ID"}(n||(n={})),n}),define("modules/clean/contacts/util",["modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t){var n,o;return n=e.Contact,o=function(){function e(){}return e.activityUserToContact=function(e,n){return null==n&&(n=0),{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:t.DBX_ID,priority:n,photo_url:e.photo_circle_url}},e.teamGroupInfoToContact=function(e){return new n({group_id:e.id,group_size:e.group_size,type:t.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})},e}()});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/deprecated/dbmodal_loading",["modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(e,t){var n;return n=function(e){function n(e){n.__super__.constructor.call(this,e)}return extend(n,e),n.prototype.on_show=function(){return this.fetch()},n.prototype.fetch=function(){return new t(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:function(e){return function(t,n,o){return e.hide()}}(this)})},n.prototype.on_confirm_button_click=null,n.prototype.on_cancel_button_click=null,n}(e.DBModal)}),define("modules/clean/display_format",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";function o(e,t,o,r){void 0===t&&(t=2),void 0===o&&(o=!0),void 0===r&&(r=!0),e=parseFloat(e);var i,s,a=Math.abs(e);1024>a?(t=0,i=e,s=n.ungettext("byte","bytes",e),o=!0):921600>a?(i=e/1024,s=n._("KB")):943718400>a?(i=e/1048576,s=n._("MB")):966367641600>a||0===t&&1099511627776>e?(i=e/1073741824,s=n._("GB")):(i=e/1099511627776,s=n._("TB")),i=Math.round(i*Math.pow(10,t))/parseFloat(Math.pow(10,t));var l=i.toFixed(t);r&&t>0&&(l=parseFloat(l).toString());var c=o?" ":"";return""+l+c+s}function r(e,t,n,r){return void 0===t&&(t=2),void 0===n&&(n=!0),void 0===r&&(r=!0),e=parseFloat(e),o(1073741824*e)}t.format_bytes=o,t.formatGigabytes=r});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/downloads",["jquery","modules/clean/filepath","modules/constants/env","modules/constants/python","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,assert;return assert=i.assert,p=s._,d=[n.BLOCK_CLUSTER,n.PUBSERVER],c=p("There was an error downloading your file."),u=function(){function i(){}return i.get=function(t){var n,s,u,p,h,_,m,f,g;return g=t.url,h=t.error,n=t.__do_not_use_expected_domain,p=l.parse(g),s=n||p.authority,assert(indexOf.call(d,s)>=0),r.iOS?(assert((f=p.authority,indexOf.call(["",window.location.host].concat(d),f)>=0)),void r.unsafeRedirect(g)):(i.initialized||i.init(),u=i._create_download_id(),m={},m[o.DOWNLOAD_ID_PARAM_NAME]=u,m[o.DOWNLOADS_NOTIFY_DOMAIN_PARAM_NAME]=window.location.host,p.updateQuery(m),_=e("<iframe />",{src:String(p)}).css("display","none"),_.on("load",function(){var e;return e=function(){var e;return e=i.current_watches[u],null!=e?(r.chrome&&(a.error(c),"function"==typeof e.error&&e.error()),i._cleanup(u)):void 0},setTimeout(e,100)}),i.current_watches[u]={origin:s,error:h,iframe:_},e("body").append(_),window.setTimeout(function(){return i._cleanup(u)},9e4),!1)},i.get_blockserver_link=function(e){var t,o,r,i,s;return s=e.url,o=e.ns_id,r=e.ns_path,t=e.error,i=l.parse(s),i.setScheme("https"),i.updateQuery({dl:1}),null!=o&&(assert("string"==typeof r,"Namespace ID was passed with invalid path, got: "+r),i.updateQuery({nsid:o}),i.updateQuery({path:r})),assert(i.authority===n.BLOCK_CLUSTER,"download_blockserver_url expects a blockserver resource, got: "+s),this.get({url:i.toString(),error:t})},i.zip_batch_by_ns_id=function(o){var r,i,s,a,c,u,d,p,h,_,m,f,g;for(m=o.parent_ns_id,f=o.parent_ns_path,a=o.files,g=o.subject_uid,r=o.block_hash,u=l({scheme:"https",authority:n.BLOCK_CLUSTER,path:"/zip_batch_by_ns_id"}).updateQuery("_subject_uid",g),u.updateQuery({parent_ns_id:m,parent_ns_path:f||"/"}),u=u.toString(),c=e("<form>",{action:u,method:"post"}),p=0,h=a.length;h>p;p++)i=a[p],s=t.filename(i.fq_path),_=f+"/"+s,d=e("<input>",{name:"ns_paths",value:_}),d.appendTo(c);return d=e("<input>",{name:"w",value:r}),d.appendTo(c),e(document.body).append(c),c.submit(),c.remove()},i.get_zip=function(t){var o,r,i,s,a,c,u,d,p,h;for(i=t.fq_paths,h=t.subject_uid,o=t.block_hash,d=t.parent_path,s=l({scheme:"https",authority:n.BLOCK_CLUSTER,path:"/zip_batch"}).updateQuery("_subject_uid",h).toString(),p=e("<form>",{action:s,method:"post"}),c=0,u=i.length;u>c;c++)r=i[c],a=e("<input>",{name:"files",value:r}),a.appendTo(p);return a=e("<input>",{name:"parent_path",value:d||"/"}),a.appendTo(p),a=e("<input>",{name:"w",value:o}),a.appendTo(p),e(document.body).append(p),p.submit(),p.remove()},i.init=function(){return i.initialized=!0,i.current_watches={},e(window).on("message",i._post_handler)},i._post_handler=function(e){var t,n,o,r;if(t=l.parse(e.originalEvent.origin),"https"===t.scheme&&(o=t.authority,!(indexOf.call(d,o)<0))){try{n=JSON.parse(e.originalEvent.data)}catch(e){return}if(null!=(null!=n?n.download_id:void 0)&&(r=i.current_watches[n.download_id],null!=r&&t.authority===r.origin&&e.originalEvent.source===r.iframe[0].contentWindow))return"failed"===n.status&&(a.error(n.message||c),"function"==typeof r.error&&r.error()),i._cleanup(n.download_id)}},i._cleanup=function(e){var t;return t=this.current_watches[e],null!=t?(t.iframe.remove(),delete this.current_watches[e]):void 0},i._create_download_id=function(){var e,t,n;for(n="",e=t=1;4>=t;e=++t)n+=String(Math.random()).split(".")[1];return n},i}()}),define("modules/clean/event_handler",["require","exports","jquery"],function(e,t,n){"use strict";function o(e){var n=e.prototype.componentWillMount,o=e.prototype.componentWillUnmount;e.prototype.componentWillMount=function(){t.EventHandlerMixin.componentWillMount.apply(this),n&&"function"==typeof n&&n.apply(this)},e.prototype.componentWillUnmount=function(){o&&"function"==typeof o&&o.apply(this),t.EventHandlerMixin.componentWillUnmount.apply(this)}}t.eventHandler=o,t.EventHandlerMixin={componentWillMount:function(){this.events=new r},componentWillUnmount:function(){this.events.removeAll()}};var r=function(){function e(){}return e.prototype.on=function(e,t,o,r,i){"string"!=typeof o&&(i=r,r=o,o=void 0),i&&(r=n.proxy(r,i)),this.handlers||(this.handlers=[]),e=n(e),o?e.on(t,o,r):e.on(t,r),this.handlers.push({element:e,event:t,selector:o,callback:r})},e.prototype.removeAll=function(){this.handlers&&(this.handlers.forEach(function(e){e.selector?e.element.off(e.event,e.selector,e.callback):e.element.off(e.event,e.callback)}),this.handlers=null)},e}();t.EventHandler=r}),define("modules/clean/events/rollback",["jquery","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/react/modal","modules/clean/ajax"],function(e,t,n,o,r,i,s,a,l){var c,u,d;return d=o._,u=s.SupportExperimentsWebLogger,c={configureAllLinks:function(t,n,o,r,i){return null==o&&(o=null),null==r&&(r=void 0),null==i&&(i=void 0),e(t).on("click",n,function(t){var n,s,l,p,h,_;return null!=o&&u.log_file_restore(o),n=e(t.target),_=n.data("user-id"),l=n.data("ns-id"),s=n.data("cs-id"),p=n.data("redirect"),null==p&&(p=!0),h=r?n.data("sjids"):null,a.SimpleModal.show({title_text:d("Undo this deletion"),body_html:d("Are you sure you want to undo this deletion?"),confirm_text:d("Undo deletion"),confirm_callback:function(){return c.rollback(_,l,s,p,i,h,r)},cancel_text:d("Cancel")}),!1})},configureLink:function(t,o,r,i,s,l){return e(t).on("click",function(e){return e.stopPropagation(),a.SimpleModal.show({title_text:o,body_html:n.escape(r).toHTML(),confirm_text:d("Restore"),confirm_callback:function(){return c.rollback(i,s,l)},cancel_text:d("Cancel")}),!1})},rollback:function(e,n,o,s,a,c,u,p){var h;return null==a&&(a=void 0),null==c&&(c=null),null==u&&(u=!1),null==p&&(p=null),h={},u?(h[n]=c,l.WebProgressRequest({url:"/cmd/restore_sjids",data:{ns_to_sjids:JSON.stringify(h)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){return r.success(d("Finished restoring files.")),"function"==typeof a&&a(),s?p?t.replace_location(p):t.redirect(i({path:"/browse_cs/"+e+"/"+n+"/"+o})):void 0}})):(h[n]=o,l.WebProgressRequest({url:"/cmd/restore_changesets",data:{ns_to_cs:JSON.stringify(h)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){return r.success(d("Finished restoring files.")),"function"==typeof a&&a(),s?p?t.replace_location(p):t.redirect(i({path:"/browse_cs/"+e+"/"+n+"/"+o})):void 0}}))}}}),define("modules/clean/file_activity/api",["external/underscore","modules/core/types","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity","external/es6-promise"],function(e,t,n,o,r,i){var s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j;return V=t.takes,F=t.returns,m=t.Maybe,c=t.Either,a=o.CommentActivity,h=r.FileActivity,f=i.Promise,S={actorId:m(Number),oref:m(String),isBackgroundRequest:m(Boolean)},P=function(t){var o,r,i,s,a,l,c,u;return u=t.url,c=t.type,r=t.data,o=t.actorId,s=t.oref,i=t.isBackgroundRequest,l=i?n.SilentBackgroundRequestOref:n.WebRequestOref,a=new f(function(t,n){return l({url:u,type:c,data:e.extend({oref:s},r),subject_user:o,success:t,error:function(e,t,o){return n(Error(o))}})}),a.then(JSON.parse)},T=function(e){var t,n,o;if("error"===e.status)throw n=null!=(o=e.payload)?o.error_text:void 0,t=Error(n),t.payload=e.payload,t.error_text=n,t;return e.payload},C=function(e){var t,n;return n=T(e),t=e.bolt_data,[n,t]},w=function(e){return h.fromDict(e)},s=e.extend({commentActivityKey:m(String),context:Number,contextData:String,text:String,metadata:m(Object)},S),A=V(s,F(f,function(e){var t,n,o,r,i,s,l,c;return t=e.actorId,n=e.commentActivityKey,o=e.context,r=e.contextData,c=e.text,s=e.metadata,l=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:o,activity_context_data:r,comment_text:c,comment_metadata_json:JSON.stringify(s),target_comment_activity_key:n},oref:l,isBackgroundRequest:i}).then(T).then(a.fromDict)})),l=e.extend({commentActivityKey:String,context:Number,contextData:String},S),N=V(l,F(f,function(e){var t,n,o,r,i,s;return t=e.actorId,n=e.commentActivityKey,o=e.context,r=e.contextData,s=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:n,activity_context:o,activity_context_data:r},oref:s,isBackgroundRequest:i}).then(T)})),y=e.extend({liked:Boolean,commentActivityKey:String,context:Number,contextData:String},S),K=V(y,F(f,function(e){var t,n,o,r,i,s,a;return t=e.actorId,s=e.liked,n=e.commentActivityKey,o=e.context,r=e.contextData,a=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/like",type:"POST",data:{activity_key:n,activity_context:o,activity_context_data:r,liked:s},oref:a,isBackgroundRequest:i}).then(T)})),v=e.extend({enableComment:Boolean,context:Number,contextData:String},S),W=V(v,F(f,function(e){var t,n,o,r,i,s;return t=e.actorId,r=e.enableComment,n=e.context,o=e.contextData,s=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:n,activity_context_data:o,feedback_off:!r},oref:s,isBackgroundRequest:i}).then(T)})),E=e.extend({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},S),j=V(E,F(f,function(e){var t,n,o,r,i,s,a;return t=e.actorId,a=e.resolved,n=e.commentActivityKey,o=e.context,r=e.contextData,s=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:n,activity_context:o,activity_context_data:r,resolved:a},oref:s,isBackgroundRequest:i}).then(T)})),_=e.extend({commentActivityKeys:Array,context:Number,contextData:String},S),L=V(_,F(f,function(e){var t,n,o,r,i,s;return t=e.actorId,n=e.commentActivityKeys,o=e.context,r=e.contextData,s=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:o,activity_context_data:r},oref:s,isBackgroundRequest:i}).then(T)})),p=e.extend({context:Number,contextData:String},S),I=function(e){var t,n,o,r,i;return t=e.actorId,n=e.context,o=e.contextData,i=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/file_activity",type:"GET",data:{activity_context:n,activity_context_data:o},oref:i,isBackgroundRequest:r})},k=V(p,F(f,function(e){return I(e).then(T).then(w)})),D=V(p,F(f,function(e){return I(e).then(C).then(function(e){var t,n;return t=e[0],n=e[1],[w(t),n]})})),d=e.extend({context:Number,contextDataList:Array},S),R=V(d,F(f,function(t){var n,o,r,i,s;return n=t.actorId,o=t.context,r=t.contextDataList,s=t.oref,i=t.isBackgroundRequest,P({actorId:n,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:o,activity_context_data_batch:JSON.stringify(r)},oref:s,isBackgroundRequest:i}).then(function(t){return e.mapObject(t,w)})})),b=e.extend({targetUserEmail:m(String),subscribed:Boolean,context:Number,contextData:String},S),G=V(b,F(f,function(e){var t,n,o,r,i,s,a;return t=e.actorId,a=e.targetUserEmail,s=e.subscribed,n=e.context,o=e.contextData,i=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:n,activity_context_data:o,subscribed:s,target_user_identifier:a},oref:i,isBackgroundRequest:r}).then(T)})),u=e.extend({context:Number,contextDataList:Array},S),O=V(u,F(f,function(t){var n,o,r,i,s;return n=t.actorId,o=t.context,r=t.contextDataList,s=t.oref,i=t.isBackgroundRequest,P({actorId:n,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:o,activity_context_data_batch:JSON.stringify(r)},oref:s,isBackgroundRequest:i}).then(T).then(function(t){return e.mapObject(t,function(e){var t,n,o;return n=e.feedback_off,t=e.comment_count,o=e.unresolved_comment_count,{feedback_off:n,comment_count:t,unresolved_comment_count:o}})})})),g=e.extend({feedbackText:String,context:Number,contextData:String},S),q=V(g,F(f,function(e){var t,n,o,r,i,s;return t=e.actorId,r=e.feedbackText,n=e.context,o=e.contextData,s=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:n,activity_context_data:o,feedback_text:r},oref:s,isBackgroundRequest:i}).then(T)})),M=V({actorId:Number},F(f,function(e){var t,o;return t=e.actorId,o=new f(function(e,o){return n.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:o,subject_user:t})}),o.then(JSON.parse).then(T)})),H=V({actorId:Number},F(f,function(e){var t,o;return t=e.actorId,o=new f(function(e,o){return n.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:o,subject_user:t})}),o.then(JSON.parse).then(T)})),x=V({actorId:Number,shouldShow:Boolean},F(f,function(e){var t,n;return t=e.actorId,n=e.shouldShow,P({actorId:t,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:n}}).then(T)})),U=V({shouldShow:Boolean},F(f,function(e){var t;return t=e.shouldShow,P({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:t}}).then(T)})),B=V({actorId:Number,shouldShow:Boolean},F(f,function(e){var t,n;return t=e.actorId,n=e.shouldShow,P({actorId:t,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:n}}).then(T)})),{markCommentingOnboardingSeen:M,shouldShowCommentingOnboarding:H,setCommentingPaneVisibility:x,setSessionCommentingPaneVisibility:U,setShowCommentsTutorial:B,addComment:A,deleteComment:N,updateLikeComment:K,updateResolveComment:j,updateCommentSetting:W,markCommentSeenBatch:L,fetchCommentStatusBatch:O,fetchFileActivity:k,fetchFileActivityWithBoltData:D,fetchFileActivities:R,updateFileActivitySubscription:G,submitProductFeedback:q}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/file_activity/clients/file_activity_bolt_client",["external/underscore","modules/core/exception","modules/core/types","modules/clean/analytics","modules/clean/bolt","external/eventemitter3","modules/clean/file_activity/api","modules/clean/optimistic_update","external/es6-promise","modules/clean/storage"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_,m,f,g,v;return v=n.takes,p=n.Maybe,u=o.CommentsVortexLogger,h=a.Optimist,_=l.Promise,m=c.SessionStorage,f=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},g=function(e){var t,n;return t=e.revision,n=e.token,{revision:t,token:n}},d=function(e){function n(){return this._onBoltRefresh=bind(this._onBoltRefresh,this),this._onBoltUpdate=bind(this._onBoltUpdate,this),o.apply(this,arguments)}var o;return extend(n,e),o=v({actorId:p(Number),context:Number,contextData:String,oref:p(String)},function(e){var t,n,o,r;return t=e.actorId,n=e.context,o=e.contextData,r=e.oref,this.__requestOptions={actorId:t,context:n,contextData:o,oref:r,isBackgroundRequest:!0},this.__optimist=new h(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0}),n.prototype.getFileActivity=function(){return this.__optimist.getValue()},n.prototype.isReady=function(){return this.__isReady},n.prototype.isLive=function(){return this.__isLive},n.prototype.rebase=function(e){var n;return t.assert(this.__isReady,"Cannot rebase when server data is not ready"),n=this.getFileActivity(),this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),n)},n.prototype.commitOptimisticUpdate=function(e){var n,o;return t.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready"),o=this.getFileActivity(),n=this.__optimist.commit(e),this.emit("updated",this.getFileActivity(),o),n},n.prototype.rollbackOptimisticUpdate=function(e){var n,o;return t.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready"),n=this.getFileActivity(),o=this.__optimist.rollback(e),o?this.emit("updated",this.getFileActivity(),n):void 0},n.prototype.init=function(){t.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(e){return function(){return u.log("load-comments-success"),e.__isLive?e._doStartLiveUpdate():void 0}}(this)).catch(function(e){return function(){return e.__canInit=!0}}(this))},n.prototype.startLiveUpdate=function(){return t.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},n.prototype.stopLiveUpdate=function(){var e;return this.__isLive=!1,null!=(e=this.__boltClient)?e.unsubscribe():void 0},n.prototype._doStartLiveUpdate=function(){var e;return e=f(this.getFileActivity(),this.__boltData),this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},n.prototype._pullFromServer=function(){var e;return m.set("reload-timestamp",(new Date).getTime()),e=s.fetchFileActivityWithBoltData(this.__requestOptions),e.then(function(e){return function(t){var n,o,r;return o=t[0],n=t[1],e.__boltData=n,r=e.__optimist.getValue(),e.__optimist.rebase(function(){return o}),o=e.__optimist.getValue(),e.__isReady?e.emit("updated",o,r):(e.__isReady=!0,e.emit("ready",o))}}(this)),e.catch(function(e){return function(t){return e.emit("error",t)}}(this)),e},n.prototype._onBoltUpdate=function(e){var t;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key)return t=e[0],this.__boltData=g(t),this._pullFromServer().then(function(e){return function(){return e.__isLive?(t=f(e.getFileActivity(),e.__boltData),e.__boltClient.update_states([t])):void 0}}(this))},n.prototype._onBoltRefresh=function(e){return this._pullFromServer().then(function(e){return function(){return e.__isLive?(e.stopLiveUpdate(),e.startLiveUpdate()):void 0}}(this))},n}(i)});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/file_activity/clients/file_activity_data_source",["external/underscore","external/lru","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception","external/es6-promise"],function(e,t,n,o,r,i,s){var a,l,c,assert,u;return a=n.CommentsEvents,assert=i.assert,c=s.Promise,u=function(e,t,n,o){return null==o&&(o=""),e=null!=e?e:"",e+":"+t+":"+n+":"+o},l=function(){function n(e){this._cache=e._cache,this._unsubscribeStore=e._unsubscribeStore,this._sendFileActivity=e._sendFileActivity,this._state=e._state,this.onClientUpdated=bind(this.onClientUpdated,this),this.onStoreUpdate=bind(this.onStoreUpdate,this)}return n.initInstance=function(){var e;return e=n,null==e.__instance?e.__instance=e.create(o,function(e){return a.emit("file-activity-updated",e)}):void 0},n.getInstance=function(){var e;return e=n,assert(null!=e.__instance),e.__instance},n.create=function(e,o,r){var i,s;return null==r&&(r=10),i=new t(r),i.shift=function(){var e,n;return n=t.prototype.shift.call(this),e=n.value,null!=e&&e.removeAllListeners(),null!=e&&e.stopLiveUpdate(),n},s=new n({_cache:i,_state:{},_sendFileActivity:o}),s._unsubscribeStore=e.listen(s.onStoreUpdate),s.onStoreUpdate(e.state),s},n.prototype.dispose=function(){return this._unsubscribeStore()},n.prototype.resetCache=function(){return this._cache.removeAll()},n.prototype.replaceState=function(e){var t;return this.shouldUpdate(e)?(this.willUpdate(e),t=this._state,this._state=e,this.didUpdate(t)):void 0},n.prototype.getState=function(){return this._state},n.prototype.onStoreUpdate=function(e){var t,n,o,r,i,s;return t=e.actorId,i=e.oref,s=e.viewing,n=s.context,o=s.contextData,r={oref:i,actorId:t,context:n,contextData:o},this.replaceState(r)},n.prototype.shouldUpdate=function(t){return!e.isEqual(this._state,t)},n.prototype.willUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?this.deactivateClient(t):void 0},n.prototype.didUpdate=function(e){var t;return t=this.getCurrentFetchKey(),this.isFetching(t)||(this.sendActivity(null),this.isNullState(this._state))?void 0:this.fetchAndSend(this._state)},n.prototype.getFetchKey=function(e){var t,n,o,r;return t=e.actorId,n=e.context,o=e.contextData,r=e.oref,u(t,n,o,r)},n.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},n.prototype.getCurrentClient=function(){var e;return e=this.getCurrentFetchKey(),this._cache.get(e)},n.prototype.isFetching=function(e){var t;return t=this._cache.find(this.getFetchKey(e)),null!=t&&!t.isReady()},n.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},n.prototype.activateClient=function(e){return e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady()?this.onClientUpdated(e.getFileActivity()):void 0},n.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},n.prototype.deactivateCurrentClient=function(){var e;return e=this.getCurrentClient(),null!=e?this.deactivateClient(e):void 0},n.prototype.fetchAndSend=function(e){var t,n,o,r,i,s,a;return t=e.actorId,r=e.context,i=e.contextData,a=e.oref,s=u(t,r,i,a),n=this._cache.get(s),null!=n?this.activateClient(n):(o=this.createFileActivityBoltClient({actorId:t,context:r,contextData:i,oref:a}),o.init(),this._cache.set(s,o),this.activateClient(o))},n.prototype.onClientUpdated=function(e){return this.sendActivity(e)},n.prototype.onClientError=function(e){throw e},n.prototype.sendActivity=function(e){return this._sendFileActivity(e)},n.prototype.createFileActivityBoltClient=function(e){return new r(e)},n.prototype.rebase=function(e){var t;return t=this.getCurrentClient(),null!=t?t.rebase(e):!1},n.prototype.commitOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?t.commitOptimisticUpdate(e):null},n.prototype.rollbackOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?t.rollbackOptimisticUpdate(e):!1},n}()}),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,o,r,i,s,a,l,c,u){"use strict";var d=function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,r=void 0===n?"":n,i=t.feedback_off,s=void 0===i?!1:i,a=t.can_edit_feedback,l=void 0===a?!0:a,c=t.comment_activities,u=void 0===c?[]:c,d=t.users_to_notify,p=void 0===d?[]:d,h=t.latest_revision,_=void 0===h?null:h;this.activity_key=r,this.feedback_off=s,this.can_edit_feedback=l,this.comment_activities=u,this.users_to_notify=p,this.latest_revision=_,o(this)}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(c.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),latest_revision:t.latest_revision
})},e.prototype.enableCommenting=function(){return s.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return s.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=s.thaw(this),n=this.comment_activities.map(s.thaw);return t.comment_activities=n,t.comment_activities.forEach(function(e){e.comment_activities=e.comment_activities.map(s.thaw)}),e(t),o(t)},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=r.matches({activity_key:e}),o=0;o<this.comment_activities.length;o++){var i=this.comment_activities[o];if(n(i))return["comment_activities",o];if(!t)for(var s=0;s<i.comment_activities.length;s++)if(n(i.comment_activities[s]))return["comment_activities",o,"comment_activities",s]}return null},e.prototype._updateComment=function(e,t){return e?s.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return s.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),s.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=r.matches({activity_key:e}),n=0;n<this.comment_activities.length;n++){var o=this.comment_activities[n];if(t(o))return o;for(var i=0;i<o.comment_activities.length;i++){var s=o.comment_activities[i];if(t(s))return s}}return null},e.prototype.findConversationByKey=function(e){return r.findWhere(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return s.updateIn(this,t,function(e){return s.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return s.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){var n=t._reapComments(function(t){return r.contains(e,t.activity_key)});n.forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},e}();n.__decorate([l.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:i.Maybe(Array),latest_revision:u.RevisionShape})],d,"fromDict",null),t.FileActivity=d}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),define("modules/clean/file_events",[],function(){var e;return e={DELETE:"db:bulk_delete",COPY:"db:bulk_copy",MOVE:"db:bulk_move",RENAME:"db:bulk_rename",PURGE:"db:bulk_purge",RESTORE:"db:bulk_restore",UPLOAD:"db:upload",COMPRESS:"db:compress",SF_NEW:"db:sf_new",SF_LEAVE:"db:sf_leave",SF_UNSHARE:"db:sf_unshare",SF_ADD_TO_DROPBOX:"db:sf_add_to_dropbox",SF_INVITE:"db:sf_invite",SF_IGNORE:"db:sf_ignore",LINKS_REMOVE:"db:link_remove",LINKS_ADD:"db:link_add",FILE_ACTIVITY_UPDATE:"db:file_activity_update"}}),define("modules/clean/file_operations/notifications",["external/underscore","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h,_,m,f,g,v,y;return c=a._,y=a.ungettext,v=function(e,t,n,o,s){var a;return a=function(){return r.rollbackChangeSets({changesets:n,userId:t.id,progressText:c("Undoing…"),rollbackHints:o,onSuccess:function(){return l.success(c("Undo complete.")),"function"==typeof s?s():void 0}})},i.notifyWithUndo(e,n,a)},u=function(r,i){var s,a,l;return a=t.browse_uri_for_fq_path(i,r),l=40,s=n.em_snippet(o.filename(r),l),{href:a,text:e.escape(s)}},d=function(e,t,n,o,r,i){var a,l,c;return null==o&&(o=null),o?(a=u(o,t),c=y('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),l=c.format({num_items:e,dest_href:a.href,dest_name:a.text}),l=new s(l)):(l=y("Copied %(num_items)d item.","Copied %(num_items)d items.",e),l=l.format({num_items:e})),v(l,t,n,r,i)},_=function(e,t,n,o,r,i){var a,l,c;return l=null,o?(a=u(o,t),c=y('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),l=c.format({num_items:e,dest_href:a.href,dest_name:a.text}),l=new s(l)):(c=y("Moved %(num_items)d item.","Moved %(num_items)d items.",e),l=c.format({num_items:e})),v(l,t,n,r,i)},p=function(e,t,n,o,r){var i,a;return a=y("Deleted %(num_items)d item","Deleted %(num_items)d items",e),i=a.format({num_items:e}),i=new s(i),v(i,t,n,o,r)},f=function(e,t,n,o){var r;return r=c("Rename complete."),r=new s(r),v(r,e,t,n,o)},h=function(e,t,n){var o,r;return r=c("Created folder %(folder_name)s"),o=r.format({folder_name:e}),o=new s(o),v(o,t,n)},m=function(e){var t,n;return n=y("Permanently deleted %(num)s item","Permanently deleted %(num)s items",e),t=n.format({num:e}),l.success(t)},g=function(t){var n,r,i,a;return n=t.length,1===n?(r=o.filename(t[0].fq_path),r=e.escape(r),a=c("Restored <strong>%(filename)s</strong>."),i=a.format({filename:r}),i=new s(i)):(a=y("Restored %(num)s file.","Restored %(num)s files.",n),i=a.format({num:n})),l.success(i)},{notifyCopySuccess:d,notifyMoveSuccess:_,notifyDeleteSuccess:p,notifyRestoreSuccess:g,notifyPurgeSuccess:m,notifyFolderCreationSuccess:h,notifyRenameSuccess:f}});var hasProp={}.hasOwnProperty;define("modules/clean/flux/action_type",[],function(){var e;return e=function(e,t){var n,o,r,i;r={},i={};for(n in t)if(hasProp.call(t,n)){if(o=t[n],r[n]=e+"__"+o,null!=i[o])throw new Error("Duplicate action value '"+o+"'!");i[o]=!0}return r},{withActionNamespace:e}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/flux/base_store",["modules/core/exception","modules/clean/flux/dispatcher"],function(e,t){var n,assert,o;return assert=e.assert,o=function(){var e,n;return n=!1,e=[],t.dispatch_begin=function(){return n=!0},t.dispatch_end=function(){var t,o,r,i;n=!1;try{for(i=[],o=0,r=e.length;r>o;o++)t=e[o],i.push(t());return i}finally{e.length=0}},function(t){return n?indexOf.call(e,t)<0?e.push(t):void 0:t()}}(),n=function(){function e(e){null==e&&(e=null),"function"==typeof this._init&&this._init(),this._change_listeners=[],this._dispatcher=e||t,this.dispatchToken=this._dispatcher.register(this._new_payload_wrapper.bind(this))}return e.WIPE_TYPE="WIPE_ALL",e.prototype.destructor=function(){return this._dispatcher.unregister(this.dispatchToken),this.remove_all_change_listeners()},e.prototype.emit_change=function(){var e,t,n,r,i;for(r=this._change_listeners,i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(o(e));return i},e.prototype.add_change_listener=function(e){return assert(!(indexOf.call(this._change_listeners,e)>=0)),this._change_listeners.push(e)},e.prototype.remove_change_listener=function(e){var t;return this._change_listeners=function(){var n,o,r,i;for(r=this._change_listeners,i=[],n=0,o=r.length;o>n;n++)t=r[n],t!==e&&i.push(t);return i}.call(this)},e.prototype.remove_all_change_listeners=function(){return this._change_listeners.length=0},e.prototype._new_payload_wrapper=function(e){var t;return(null!=e&&null!=(t=e.action)?t.type:void 0)===this.constructor.WIPE_TYPE&&"function"==typeof this._init&&this._init(),this._new_payload(e)},e.prototype._new_payload=function(e){throw new Error("Abstract method - must be implemented")},e}()}),define("modules/clean/flux/flux_store",function(){var e;return e=function(){function e(e){this._listeners=[],this._dispatcher=e,this._dispatchToken=this._dispatcher.register(this.__invokeOnDispatch.bind(this)),this.__hasChanged=!1}return e.prototype.teardown=function(){return this._dispatcher.unregister(this._dispatchToken)},e.prototype.getDispatcher=function(){return this._dispatcher},e.prototype.getDispatchToken=function(){return this._dispatchToken},e.prototype.addListener=function(e){return this._listeners.push(e),function(t){return function(){var n;return t._listeners=function(){var t,o,r,i;for(r=this._listeners,i=[],t=0,o=r.length;o>t;t++)n=r[t],n!==e&&i.push(n);return i}.call(t)}}(this)},e.prototype.hasChanged=function(){return this.__hasChanged},e.prototype.__emitChange=function(){return this.__hasChanged=!0},e.prototype.__onDispatch=function(){throw new Error("__onDispatch should be overridden by subclass")},e.prototype.__invokeOnDispatch=function(e){var t,n,o,r,i;if(this.__hasChanged=!1,this.__onDispatch(e),this.__hasChanged){for(r=this._listeners,i=[],n=0,o=r.length;o>n;n++)t=r[n],i.push(t());return i}},e}()});var hasProp={}.hasOwnProperty;define("modules/clean/flux/store_listener",["external/react"],function(e){var t;return t=function(t,n,o){var r;return e.createClass({displayName:"StoreListener("+(null!=(r=t.displayName)?r:"Unknown")+")",getInitialState:function(){return{childProps:o(this.props,n)}},componentDidMount:function(){var e,t;for(t in n)hasProp.call(n,t)&&(e=n[t],e.add_change_listener(this._handleStoreChanged));return this.setState({childProps:o(this.props,n)})},componentWillUnmount:function(){var e,t,o;e=[];for(o in n)hasProp.call(n,o)&&(t=n[o],e.push(t.remove_change_listener(this._handleStoreChanged)));return e},render:function(){var n,o,r,i;n={ref:"wrapped"},r=this.state.childProps;for(o in r)hasProp.call(r,o)&&(i=r[o],n[o]=i);return e.createElement(t,n,this.props.children)},getWrappedComponent:function(){return this.refs.wrapped},getStores:function(){return n},_handleStoreChanged:function(){var e;return this.isMounted()&&(e=o(this.props,n),null!=e)?this.setState({childProps:e}):void 0}})},{listenToStores:t}});var slice=[].slice;define("modules/clean/flux/store_mixin",[],function(){var e;return e=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],{getInitialState:function(){return this._get_state_from_stores(this.props)},componentDidMount:function(){var t,n,o;for(t=0,n=e.length;n>t;t++)o=e[t],o.add_change_listener(this._handle_store_changed);return this.setState(this._get_state_from_stores(this.props))},componentWillUnmount:function(){var t,n,o,r;for(o=[],t=0,n=e.length;n>t;t++)r=e[t],o.push(r.remove_change_listener(this._handle_store_changed));return o},_handle_store_changed:function(){var e;return this.isMounted()&&(e=this._get_state_from_stores(this.props),null!=e)?this.setState(e):void 0}}}});var hasProp={}.hasOwnProperty;define("modules/clean/form",["jquery","external/purify","modules/core/exception","modules/core/notify","modules/clean/ajax","modules/core/cookies","modules/core/i18n","modules/constants/request"],function(e,t,n,o,r,i,s,a){var l,c,u,assert;return assert=n.assert,u=s._,l=u("There was a problem completing this request."),c={submit:function(e,t,n,o){return r.FormWebRequest({url:e.attr("action"),data:this.collect_data(e),skipErrorHandling:!0,success:function(e,o,r){var i,s,a;return s=c.parse_response(r.responseText),a=s[0],i=s[1],a?t(i):n(i)},error:function(e,t,o){return n(l)},complete:o})},collect_data:function(t){var n,o,r,i,s,a,l;for(n={},a=t.find("input, select, textarea"),o=0,i=a.length;i>o;o++)if(r=a[o],s=e(r).attr("name")){if("checkbox"===e(r).attr("type"))l=e(r).prop("checked")?"True":"";else if("radio"===e(r).attr("type")){if(!e(r).prop("checked"))continue;l=e(r).val()}else l=e(r).val();s in n?("string"==typeof n[s]&&(n[s]=[n[s]]),n[s].push(l)):n[s]=l}return n},parse_response:function(e){var t,n,o,r;if(0!==e.indexOf("err:"))return[!0,e];n=e.substr(4);try{return r=JSON.parse(n),[!1,r]}catch(e){return t=e,[!1,n||l]}},parse_error:function(e){var t,n;if("string"==typeof e)return[!0,e];if("object"==typeof e)for(n in e)if(t=e[n],"message_text"in t)return[!0,t.message_text];return[!1,l]},add_vars:function(n,o,r){var i,s,a,l;null==r&&(r=!1),a=[];for(s in o)hasProp.call(o,s)&&(i=e("<input>",{type:"hidden",name:s}),i.val(o[s]),l=t.sanitize(i.prop("outerHTML")),r===!0&&e("input[name='"+s+"']").remove(),a.push(n.append(l)));return a},post_request:function(n,o,r){var s,l;return null==o&&(o={}),null==r&&(r={}),assert(null!=n,"post_request missing action"),s=e("<form>",{action:n,method:"POST",target:r.target?r.target:void 0}),o.t=i.read(a.JS_CSRF_COOKIE),this.add_vars(s,o),l=e(t.sanitize(s.prop("outerHTML"))),e("body").append(l),l.submit()}}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/frame_messenger",[],function(){var e;return e=function(){function e(){this.handleUntrustedMessage=bind(this.handleUntrustedMessage,this),Object.defineProperty(this,"trustedParentOriginForPosting",{get:function(){return this._trustedParentOriginForPosting}}),Object.defineProperty(this,"trustedChildOriginForPosting",{get:function(){var e,t,n,o,r;if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(e=document.querySelectorAll(this._childIframeQuery),t=0,r=e.length;r>t&&(n=e[t],o=n.getAttribute("src"),!this._validateChildOriginForPosting(o));t++);return this._trustedChildOriginForPosting}})}return e._ALLOWED_CHILD_ORIGINS=["https://www.dropboxstatic.com","https://www.dropboxstatic.com:443","https://cf.dropboxstatic.com","https://cf.dropboxstatic.com:443","https://cfl.dropboxstatic.com","https://cfl.dropboxstatic.com:443","https://www.dropbox.com","https://www.dropbox.com:443","https://dl-doc.dropbox.com","https://dl-doc.dropbox.com:443","https://dl-web.dropbox.com","https://dl-web.dropbox.com:443","https://dl.dropboxusercontent.com","https://dl.dropboxusercontent.com:443","null"],e._ALLOWED_PARENT_ORIGINS=["https://www.dropbox.com","https://www.dropbox.com:443"],e._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,e.prototype._childIframeQuery=null,e.prototype._trustedChildOriginForPosting=null,e.prototype._trustedParentOriginForPosting=null,e.prototype._validActionsFromChild=[],e.prototype._validActionsFromParent=[],e.prototype._trustedMessageFromChildHandler=null,e.prototype._trustedMessageFromParentHandler=null,e.prototype._parentMessageQueue=[],e.prototype._requestParentOriginPollRetry=null,e.prototype._onParentReady=null,e.prototype.resetOriginsForPosting=function(){return this._trustedChildOriginForPosting=null,this._trustedParentOriginForPosting=null},e.prototype.configureChildMessaging=function(e,t,n){return this._childIframeQuery=e,this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},e.prototype.configureParentMessaging=function(e,t,n){return null==n&&(n=null),this._trustedParentOriginForPosting=null,this._validActionsFromParent=t,this._trustedMessageFromParentHandler=e,this._onParentReady=n},e.prototype.startListening=function(){return window.addEventListener("message",this.handleUntrustedMessage),null!=this._validActionsFromParent&&this._validActionsFromParent.length>0&&null!=this._trustedMessageFromParentHandler&&this._requestParentOrigin(),null!=this._validActionsFromChild&&this._validActionsFromChild.length>0&&null!=this._trustedMessageFromChildHandler?this.postMessageToChildren("parent-ready"):void 0},e.prototype.stopListening=function(){return window.removeEventListener("message",this.handleUntrustedMessage)},e.prototype._isNumber=function(e){return!isNaN(parseInt(e))},e.prototype._getOriginFromUrl=function(e){var t,n,o;return o=document.createElement("a"),o.href=e,t=this._isNumber(o.port)?":"+o.port:"",n="https://"+o.hostname+t},e.prototype._isChildOriginAllowed=function(e){return indexOf.call(this.constructor._ALLOWED_CHILD_ORIGINS,e)>=0||this._isDevVmOrigin(e)},e.prototype._isParentOriginAllowed=function(e){return indexOf.call(this.constructor._ALLOWED_PARENT_ORIGINS,e)>=0||this._isDevVmOrigin(e)},e.prototype._isDevVmOrigin=function(e){var t;return t=e.match(/\.dev\.corp\.dropbox(static|usercontent)?\.com($|:)/),(null!=t?t.length:void 0)>=1},e.prototype._validateChildOriginForPosting=function(e){var t;return t="null"===e?"*":this._getOriginFromUrl(e),"null"===e||this._isChildOriginAllowed(t)?(this._trustedChildOriginForPosting=t,!0):(console.warn("Untrusted message from child blocked: "+e),!1)},e.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},e.prototype._validateParentOriginForPosting=function(e){var t,n,o,r,i,s,a;if(s=this._trustedParentOriginForPosting,i=this._getOriginFromUrl(e),!this._isParentOriginAllowed(i))return console.warn("Untrusted message from parent blocked: "+e),!1;if(this._trustedParentOriginForPosting=i,this._parentMessageQueue.length>0){for(a=this._parentMessageQueue,t=0,n=a.length;n>t;t++)o=a[t],r=JSON.parse(o),this.postMessageToParent(r.action,r.parameters);this._parentMessageQueue=[]}return null!=this._trustedParentOriginForPosting&&null==s&&null!=this._onParentReady&&this._onParentReady(),!0},e.prototype.handleUntrustedMessage=function(e){var t,n,o,r,i;if(!this._isChildOriginAllowed(e.origin)&&!this._isParentOriginAllowed(e.origin))return void console.warn("Message received not in parent or child origin whitelist: "+e.origin);try{o=JSON.parse(e.data)}catch(e){return void(t=e)}if(null!=o.action)return"child-requesting-parent-origin"===o.action?void(this._validateChildOriginForPosting(e.origin)&&this.postMessageToChildren("parent-ready")):"parent-ready"===o.action?void this._validateParentOriginForPosting(e.origin):(r=o.action,indexOf.call(this._validActionsFromChild,r)>=0&&this._validateChildOriginForPosting(e.origin)&&null!=this._trustedMessageFromChildHandler?void this._trustedMessageFromChildHandler(o):(i=o.action,void(indexOf.call(this._validActionsFromParent,i)>=0&&this._validateParentOriginForPosting(e.origin)&&null!=this._trustedMessageFromParentHandler&&this._trustedMessageFromParentHandler(o))))},e.prototype._packagePostMessage=function(e,t){var n,o;return o=this.trustedChildOriginForPosting,n={action:e,parameters:t},JSON.stringify(n)},e.prototype.postMessageToChildElements=function(e,t,n){var o,r,i,s,a;if(null==n&&(n={}),null!=this.trustedChildOriginForPosting){for(s=this._packagePostMessage(t,n),a=[],o=0,i=e.length;i>o;o++)r=e[o],a.push(r.contentWindow.postMessage(s,this.trustedChildOriginForPosting));return a}},e.prototype.postMessageToChildren=function(e,t,n){var o;return null==t&&(t={}),null==n&&(n=null),null==n&&(n=this._childIframeQuery),o=document.querySelectorAll(n),this.postMessageToChildElements(o,e,t)},e.prototype.postMessageToParent=function(e,t){var n;return null==t&&(t={}),n=this._packagePostMessage(e,t),null==this.trustedParentOriginForPosting?void this._parentMessageQueue.push(n):window.parent.postMessage(n,this.trustedParentOriginForPosting)},e.prototype._requestParentOrigin=function(){var e;return window.parent.postMessage('{"action": "child-requesting-parent-origin"}',"*"),e=function(){return this._requestParentOriginPollRetry=null,null==this._trustedParentOriginForPosting?this._requestParentOrigin():void 0},setTimeout(e.bind(this),this._REQUEST_PARENT_ORIGIN_POLL_DELAY)},e}()}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";var n=function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,o=t;n<o.length;n++){var r=o[n];if(r instanceof RegExp&&e.match(r))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e}();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function r(e,t){return t.indexOf(e)>=0}var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var o=e;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(o),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var o=n[t],r=""+o.getAttribute("src"),i=this.getOriginFromUrl(r);if(this.isOriginAllowed(i)){this.updateChildOrigin(i);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var o=this._isNumber(t.port)?":"+t.port:"",r=t.protocol+"//"+t.hostname+o;return r},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),r(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var o=this.getTrustedChildOriginForPosting();if(null!==o){var r=this.packagePostMessage(t,n);e.forEach(function(e){return e.contentWindow.postMessage(r,o)})}},t}(o.FrameMessengerBase);t.FrameMessengerHost=i}),define("modules/clean/fuzzy",[],function(){var e;return e={simpleFilter:function(t,n){return n.filter(function(n){return e.test(t,n)})},test:function(t,n){return null!==e.match(t,n)},match:function(e,t,n){var o,r,i,s,a,l,c,u,d,p,h,_,m,f;for(n=n||{},d=0,m=[],u=t.length,f=0,l=0,h=n.pre||"",p=n.post||"",i=n.caseSensitive&&t||t.toLowerCase(),o=void 0,r=void 0,e=n.caseSensitive&&e||e.toLowerCase(),c=0,_=[],s=0,a=0;u>c;)o=t[c],i[c]===e[d]?(o=h+o+p,a?a+=1:(s=c,a=1),d+=1,l+=1+l):(l=0,a&&(_.push([s,a]),a=0)),f+=l,m[m.length]=o,c++;return a&&_.push([s,a]),d===e.length?{highlighted:_,rendered:m.join(""),score:f}:null},filter:function(e,t,n){var o,r;return null==n&&(n={}),r=[],o=this._reduce.bind(this,e,n),t.reduce(o,r).sort(this._sort)},_reduce:function(t,n,o,r,i){var s,a;return a=r,n.extract&&(a=n.extract(r)),s=e.match(t,a,n),null!=s&&o.push({string:s.rendered,score:s.score,index:i,original:r}),o},_sort:function(e,t){var n;return n=t.score-e.score,n?n:e.index-t.index}}}),define("modules/clean/gandalf_util",["modules/constants/gandalf"],function(e){var t;return new(t=function(){function t(){}return t.prototype.getGandalfRule=function(t){return e.gandalf[t]},t.prototype.isGandalfInVariant=function(e,t){return null==t&&(t="CONTROL"),this.getGandalfRule(e)===t},t}())}),define("modules/clean/groups/api",["jquery","modules/clean/ajax","modules/clean/contacts/cache_store","modules/clean/viewer"],function(e,t,n,o){var r,i,s;return r=n.DefaultContactsCacheStore,s={},i="/groups_ajax",s.ready=function(){},s.get_groups_for_user=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_groups_for_user",data:e,success:t})},s.get_group_info=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_group_info",data:e,success:t})},s.get_groups_for_team=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_groups_for_team",data:{},success:t})},s.get_users_for_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_users_in_group",data:e,success:t})},s.create_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_new_group",data:e,success:t,reload_contacts:!0})},s.create_group_with_users=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_new_group_with_users",data:e,success:t,reload_contacts:!0})},s.remove_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"remove_group",data:e,success:t,reload_contacts:!0})},s.rename_group=function(e,t,n){return null==n&&(n=function(){return{}}),s.metaserver_ajax({method:"rename_group",data:e,success:t,error:n,reload_contacts:!0})},s.add_users_to_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"add_users_to_group",data:e,success:t,reload_contacts:!0})},s.remove_user_from_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"remove_user_from_group",data:e,success:t,reload_contacts:!0})},s.change_group_member_type=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"change_group_member_type",data:e,success:t})},s.remove_namespace_from_group=function(e,t){return s.metaserver_ajax({method:"remove_namespace_from_group",data:e,success:t})},s.change_group_access_type=function(e,n){var r;return r=function(e,t,o){return n(o)},t.WebRequest({url:i+"/change_group_access_type",type:"post",data:e,subject_user:o.get_viewer().work_user,success:r})},s.make_group_join_request=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_group_join_request",data:e,success:t})},s.metaserver_ajax=function(n){var s,a,l,c;return c=i+"/"+n.method,a=n.reload_contacts||!1,l=function(t){var o,i,s;i=JSON.parse(t),i.ok&&(n.success(i.data),e(".error_msg").hide()),a&&(o=r.getOrCreateForViewer(),o.load_contacts(s=!0))},s=function(t){var o;o=t.responseText,n.error&&(n.error(o.slice(4)),e(".error_msg").hide())},t.WebRequest({url:c,type:"post",data:n.data,subject_user:o.get_viewer().work_user,success:l,error:s})},s}),define("modules/clean/growth/experiments/logger",["modules/clean/ajax"],function(e){var t;return t=function(){function t(){}var n,o;return t.start_times={},t.DEFAULT_TIMER_NAME="view_time",t.get_timer_name=function(e){return null==e||"boolean"==typeof e?t.DEFAULT_TIMER_NAME:e},t.set_start_time=function(e){var n;return n=t.get_timer_name(e),t.start_times[n]=Date.now()},t.do_log_view_time=function(e,n){var o;return o=t.get_timer_name(n),e[o]=Math.round((Date.now()-t.start_times[o])/1e3)},o={},n=[5,15,60,120,300],t.start_counter=function(e,t){var r,i,s,a;for(s=[],r=0,i=n.length;i>r;r++)a=n[r],s.push(function(n){return o[e+n]=setTimeout(function(){return t(e,{time_since_first_view:n})},1e3*n)}(a));return s},t.stop_counter=function(e){var t,r,i,s;for(i=[],t=0,r=n.length;r>t;t++)s=n[t],i.push(clearTimeout(o[e+s]));return i},t.log=function(n,o,r,i){switch(null==i&&(i=!1),r=r||{},n){case"paywall_device_limit":return i&&t.do_log_view_time(r,i),e.SilentBackgroundRequest({url:"/growth_paywall_device_limit_log",data:{evt:o,extra:JSON.stringify(r)}});case"paywall_shared_folder":return i&&t.do_log_view_time(r,i),e.SilentBackgroundRequest({url:"/growth_paywall_shared_folder_log",data:{evt:o,extra:JSON.stringify(r)}});case"onboarding":return i&&t.do_log_view_time(r,i),e.SilentBackgroundRequest({url:"/growth_onboarding_log",data:{evt:o,extra:JSON.stringify(r)}});case"sharing":return t.do_log_view_time(r),e.SilentBackgroundRequest({url:"/growth_sharing_log",data:{evt:o,extra:JSON.stringify(r)}});case"post_client_install_tab":return i&&t.do_log_view_time(r,i),e.SilentBackgroundRequest({url:"/growth_post_client_install_tab_log",data:{evt:o,extra:JSON.stringify(r)}});case"secondary_client_link":return i&&t.do_log_view_time(r,i),e.SilentBackgroundRequest({url:"/secondary_client_link_upsell_log",data:{evt:o,extra:JSON.stringify(r)}});default:throw new Error("Invalid series name")}},t}()}),define("modules/clean/growth/experiments/manage_shared_folders_modal",["external/classnames","external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/list","modules/clean/avatar/size","modules/clean/datetime","modules/clean/flux/store_mixin","modules/clean/growth/experiments/sharing_paywall_actions_store","modules/clean/react/css","modules/clean/react_format","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/clean/sharing/member_avatars","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g){var v,y,E,b,S,w,T,C,I,P,A,N,O;return v=s.AVATAR_DIMENSION_BY_SIZE,b=c.ManageSharedFoldersStore,y=c.ManageSharedFoldersActionHandler,w=c.PAGES,A=d.reactFormat,S=p.Modal,N=f.i18n_default_project("growth-exps"),T=N._,O=N.ungettext,I=t.createElement,P=t.DOM,C=t.createClass({displayName:"ManageSharedFoldersModal",propTypes:{maxOwned:t.PropTypes.number.isRequired,numOwned:t.PropTypes.number.isRequired,user:t.PropTypes.object.isRequired,onUnshare:t.PropTypes.func.isRequired},mixins:[l(b)],_get_state_from_stores:function(){return{areFoldersLoaded:b.areFoldersLoaded(),currentPage:b.currentPage(),keepACopy:b.keepACopy(),ownedFolders:b.ownedFolders(),selectedFolderIds:b.selectedFolderIds(),isMembershipLoaded:b.membershipLoaded(),membershipInfoById:b.membershipInfo()}},componentWillMount:function(){return y.initFromProps(this.props),y.fetchOwnedSharedFolders(),y.fetchMembershipData(this.props.user),y.changePage(w.MANAGE_SHARED_FOLDERS)},_handleSelectFolder:function(e){return this.state.currentPage===w.MANAGE_SHARED_FOLDERS?this.state.selectedFolderIds.contains(e)?y.unselectFolder(e):y.selectFolder(e):void 0},_handleContinueClick:function(){return y.changePage(w.CONFIRM_UNSHARE)},_handleKeepACopyClick:function(){var e;return e=Boolean(!this.state.keepACopy),y.keepACopy(e)},_handleCancelClick:function(){return y.resetAndCloseModal()},_handleUnshareClick:function(){return y.unshareFoldersSelected(this.state.selectedFolderIds),this.props.onUnshare(this.state.selectedFolderIds,this.state.keepACopy)},_handleUpgradeClick:function(){return y.clickUpgrade()},_renderKeepACopy:function(){var n,o;return o=this.state.keepACopy,n=e({manage_shared_folders_modal__table_checkbox:!0,checked:o}),t.createElement("tr",null,t.createElement("td",{className:"manage_shared_folders_modal__table_keep",colSpan:"2"},t.createElement("button",{role:"checkbox",className:n,onClick:this._handleKeepACopyClick,
"aria-checked":o}),t.createElement("div",null,T("Let members keep a copy"))))},_renderFolderTable:function(){var e,o,r;return this.state.areFoldersLoaded?(this.state.currentPage===w.MANAGE_SHARED_FOLDERS?e=this.state.ownedFolders:(e=n.filter(this.state.ownedFolders,function(e){return function(t){return e.state.selectedFolderIds.contains(t.id)}}(this)),r=this._renderKeepACopy()),e.sort(function(e){return function(e,t){return e.last_active<t.last_active}}(this)),o=e.map(function(e){return function(t){return e._renderFolderRow(t)}}(this))):o=t.createElement("tr",{className:"manage_shared_folders_modal__table_row"},t.createElement("th",{className:"manage_shared_folders_modal__table_loader"},t.createElement("div",{className:"c-loader"},"Loading..."))),t.createElement("table",{className:"manage_shared_folders_modal__table"},t.createElement("tbody",null,t.createElement("thead",null,t.createElement("tr",{className:"manage_shared_folders_modal__table_header"},t.createElement("th",{className:"manage_shared_folders_modal__table_header_item"},T("Shared folders you own")),t.createElement("th",{className:"manage_shared_folders_modal__table_header_item"},T("Shared with")))),t.createElement("tbody",{className:"manage_shared_folders_modal__table_rows"},o),t.createElement("tfoot",null,r)))},_renderFolderRow:function(n){var o,r,s,l,c,u,d,p,_,m,f;return o=null,p=null,f=e({manage_shared_folders_modal__table_row:!0}),this.state.currentPage===w.MANAGE_SHARED_FOLDERS&&(u=this.state.selectedFolderIds.contains(n.id),f=e({manage_shared_folders_modal__table_row:!0,"manage_shared_folders_modal__table_row--selected":u}),r=e({manage_shared_folders_modal__table_checkbox:!0,"manage_shared_folders_modal__folders_row--selected":u,checked:u}),o=t.createElement("button",{role:"checkbox",className:r,"aria-checked":u}),p=a.ago(new Date(n.last_active))),m=e({remove_icon:!0,hidden:!u&&this.state.currentPage!==w.CONFIRM_UNSHARE}),l=t.createElement("div",{className:"manage_shared_folders_modal__table_info"},t.createElement("div",{className:"manage_shared_folders_modal__table_name"},n.name),t.createElement("div",{className:"manage_shared_folders_modal__table_date"},p)),s="--",this.state.isMembershipLoaded&&this.state.membershipInfoById[n.id]&&(_=this.state.membershipInfoById[n.id],d=_.joinedMembers.map(function(e){return function(t){return e._renderAvatar(t.display_name,t.initials,t.photo_url)}}(this)),c=_.invitations.map(function(e){return function(t){return e._renderAvatar(t.email_or_fbname,g.getInitials(t.email_or_fbname))}}(this)),s=I(i,{avatars:d.concat(c),avatarDimension:v.SMALL,maxVisible:7,undisplayableCount:_.numUndisplayableUsersAndInvites})),t.createElement("tr",{className:f,onClick:function(e){return function(){return e._handleSelectFolder(n.id)}}(this)},t.createElement("td",{className:"manage_shared_folders_modal__table_options"},o,t.createElement("div",{className:"manage_shared_folders_modal__table_icon"},t.createElement(h,{alt:"",group:"web",name:"folder_user_32"}),t.createElement("img",{className:m,width:"16",height:"16",src:"/static/images/growth/experiments/icon-remove-lrg-vflSBVc6s.svg"})),l),t.createElement("td",{className:"manage_shared_folders_modal__table_shared"},s))},_renderAvatar:function(e,t,n){var i,s;return i=T("Shared with %(name)s").format({name:e}),s={alt:i,dimension:v.SMALL,photoUrl:n,defaultAvatar:I(r,{dimension:v.SMALL,alt:i,name:e,initials:t,shape:"CIRCLE"})},this._renderTitleBubble(I(o,s),i)},_renderTitleBubble:function(e,t){return I(_,{content:t,position:_.POSITIONS.BOTTOM,isTargetPositionFixed:!0},e)},_renderUpgradeText:function(){return t.createElement("div",{className:"manage_shared_folders_modal__footer"},A(T("To keep sharing all these folders, <button>upgrade your plan</button>."),{button:t.createElement("button",{className:"button-as-link",onClick:this._handleUpgradeClick})}))},render:function(){var e,t,n,o,r;switch(this.state.currentPage){case w.MANAGE_SHARED_FOLDERS:o=this.props.numOwned-this.props.maxOwned+1,r=O("Unshare at least %(num)s folder","Unshare at least %(num)s folders",o).format({num:o}),n="Next",e=this._handleContinueClick,t=Boolean(o-this.state.selectedFolderIds.size>0);break;case w.CONFIRM_UNSHARE:o=this.state.selectedFolderIds.size,r=O("Unshare this folder?","Unshare these %(num)s folders?",o).format({num:o}),n="Unshare",e=this._handleUnshareClick,t=!1}return I(S,{autoClose:!1,className:"manage_shared_folders_modal",title:r,acceptButtonText:n,onAccept:e,acceptButtonDisabled:t,dismissButtonText:"Cancel",onDismiss:this._handleCancelClick,clickOutToClose:!1,showX:!0},P.div({className:"manage_shared_folders_modal__header"},T("Unshared folders will stay in your Dropbox, but all members will be removed.")),P.div({className:"manage_shared_folders_modal__content"},this._renderFolderTable(),this._renderUpgradeText()))}}),E=u(C,["/static/css/growth/experiments/sharing_paywall_modals-vfl5S3mYn.css"]),{ManageSharedFoldersModal:E}}),define("modules/clean/growth/experiments/shared_folder_paywall_view",["external/react","modules/clean/react_format","modules/clean/react/image","modules/clean/sharing/actions/share_modal","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,r,i){var s,a,l,c,u,d;return u=t.reactFormat,d=r.static_url,a=i.i18n_default_project("growth-exps")._,l=e.createElement,c=e.DOM,s=e.createClass({displayName:"SharedFolderPaywall",propTypes:{actionHandler:e.PropTypes.instanceOf(o).isRequired,maxOwned:e.PropTypes.number.isRequired,numOwned:e.PropTypes.number.isRequired,onLearnMoreClick:e.PropTypes.func.isRequired,onUpgradeClick:e.PropTypes.func.isRequired,onManageClick:e.PropTypes.func.isRequired},_handleAndLogManageSharedFoldersClick:function(){return this.props.actionHandler.logPaywallEvent("click_manage_shared_folders_from_paywall"),this.props.onManageClick()},_handleAndLogUpgradeClick:function(){return this.props.actionHandler.logPaywallEvent("click_upgrade_from_paywall"),this.props.onUpgradeClick()},render:function(){return e.createElement("div",{className:"paywall-blocker unified-share-modal__no-permission u-pad-l u-pad-bottom-l"},e.createElement(n,{className:"paywall-blocker__image u-mar-bottom-s",src:d("/static/images/sharing/db_shared_folder-vflK0RLgD.png"),srcHiRes:d("/static/images/sharing/db_shared_folder@2x-vflEd6s7Z.png")}),e.createElement("div",{className:"paywall-blocker__infotext"},a("You own %(folder_count)s shared folders (max is %(max)s).").format({folder_count:this.props.numOwned,max:this.props.maxOwned})),e.createElement("button",{className:"c-btn c-btn--primary u-mar-bottom-s",onClick:this._handleAndLogUpgradeClick},a("Upgrade for unlimited sharing")),e.createElement("div",null,u(a("<manage>Manage your shared folders</manage> or <learn>learn more</learn>"),{manage:e.createElement("button",{className:"paywall-blocker__link button-as-link",onClick:this._handleAndLogManageSharedFoldersClick}),learn:e.createElement("button",{className:"paywall-blocker__link button-as-link",onClick:this.props.onLearnMoreClick})})))}})});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/growth/experiments/sharing_paywall_actions_store",["external/immutable","external/react","external/underscore","modules/clean/api_v2/root_aware_client","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/growth/experiments/logger","modules/clean/sharing/api/client","modules/clean/ajax","modules/core/browser"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_,m,f,g,v,y;return f=e.OrderedSet,y=e.Set,u=o.ApiV2RootAwareClient,d=a.FolderShareApiClient,g={MANAGE_SHARED_FOLDERS:"MANAGE_SHARED_FOLDERS",CONFIRM_UNSHARE:"CONFIRM_UNSHARE"},p=7,_={FETCH_OWNED_SF_REQUEST:"FETCH_OWNED_SF_REQUEST",FETCH_OWNED_SF_SUCCESS:"FETCH_OWNED_SF_SUCCESS",CHANGE_PAGE:"CHANGE_PAGE",SELECT_FOLDER:"SELECT_FOLDER",FETCH_MEMBERSHIP_REQUEST:"FETCH_MEMBERSHIP_REQUEST",FETCH_MEMBERSHIP_SUCCESS:"FETCH_MEMBERSHIP_SUCCESS",UNSELECT_FOLDER:"UNSELECT_FOLDER",UNSHARE_FOLDERS:"UNSHARE_FOLDERS",CLICK_UPGRADE:"CLICK_UPGRADE",TOGGLE_KEEP_A_COPY:"TOGGLE_KEEP_A_COPY",CLOSE_MODAL:"CLOSE_MODAL"},v="paywall_shared_folder",h=function(){function e(){}return e.initFromProps=function(e){return this._client=new d({userId:e.user.id,client:new u})},e.fetchOwnedSharedFolders=function(){return i.dispatch({type:_.FETCH_OWNED_SF_REQUEST}),this._client.getOwnedSharedFolders().then(function(e){return i.dispatch({type:_.FETCH_OWNED_SF_SUCCESS,data:e})})},e.fetchMembershipData=function(e){return i.dispatch({type:_.FETCH_MEMBERSHIP_REQUEST}),l.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:e,data:{max_results:p,fq_path_prefix:"",include_inherited:!1},success:function(e){return i.dispatch({type:_.FETCH_MEMBERSHIP_SUCCESS,data:e})}})},e.changePage=function(e){return i.dispatch({type:_.CHANGE_PAGE,data:e})},e.selectFolder=function(e){return i.dispatch({type:_.SELECT_FOLDER,data:e})},e.unselectFolder=function(e){return i.dispatch({type:_.UNSELECT_FOLDER,data:e})},e.unshareFoldersSelected=function(e){return i.dispatch({type:_.UNSHARE_FOLDERS,data:e})},e.clickUpgrade=function(){return i.dispatch({type:_.CLICK_UPGRADE})},e.keepACopy=function(e){return i.dispatch({type:_.TOGGLE_KEEP_A_COPY,data:e})},e.resetAndCloseModal=function(){return i.dispatch({type:_.CLOSE_MODAL})},e}(),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype._init=function(){return this._selectedFolderIds=y(),this._keepACopy=!0,this._currentPage=g.MANAGE_SHARED_FOLDERS},t.prototype._clear=function(){return this._selectedFolderIds=y(),this._keepACopy=!0,this._currentPage=g.MANAGE_SHARED_FOLDERS},t.prototype._setOwnedSharedFolders=function(e){return this._ownedFolders=e,this.emit_change()},t.prototype._setFoldersLoaded=function(e){return this._areFoldersLoaded=e,this.emit_change()},t.prototype._setCurrentPage=function(e){return this._currentPage=e,this.emit_change()},t.prototype._setMembershipList=function(e){var t,n,o,r,i,s,a;for(o=this._ownedFolders.map(function(e){return e.id}),a={},t=0,n=e.length;n>t;t++)s=e[t],i=s.ns_id,indexOf.call(o,i)>=0&&(r={numUndisplayableUsersAndInvites:s.num_avatars_not_shown,groups:s.groups,invitations:s.invitations,joinedMembers:s.joined_members,audienceDescription:s.audience_description},a[s.ns_id]=r);return this._membershipInfoById=a,this.emit_change()},t.prototype._setMembershipLoaded=function(e){return this._membershipLoaded=e,this.emit_change()},t.prototype._selectFolderId=function(e){return this._selectedFolderIds=this._selectedFolderIds.add(e),this.emit_change()},t.prototype._unselectFolderId=function(e){return this._selectedFolderIds=this._selectedFolderIds.delete(e),this.emit_change()},t.prototype._setKeepACopy=function(e){return this._keepACopy=e,this.emit_change()},t.prototype._logPaywallEvent=function(e,t){return t=t||{},t.num_folders_owned=this._ownedFolders.length,s.log(v,e,t)},t.prototype._logUnshareAction=function(){return this._logPaywallEvent("click_unshare",{num_folders_to_unshare:this._selectedFolderIds.size})},t.prototype._logUpgradeClick=function(){this._currentPage===g.MANAGE_SHARED_FOLDERS?this._logPaywallEvent("click_upgrade_from_manage_folders"):this._logPaywallEvent("click_upgrade_from_confirm_unshare")},t.prototype.ownedFolders=function(){return this._ownedFolders},t.prototype.areFoldersLoaded=function(){return this._areFoldersLoaded},t.prototype.currentPage=function(){return this._currentPage},t.prototype.membershipInfo=function(){return this._membershipInfoById},t.prototype.membershipLoaded=function(){return this._membershipLoaded},t.prototype.selectedFolderIds=function(){return this._selectedFolderIds},t.prototype.keepACopy=function(){return this._keepACopy},t.prototype._new_payload=function(e){var t;switch(t=e.action.data,e.action.type){case _.CHANGE_PAGE:return t===g.CONFIRM_UNSHARE&&this._logPaywallEvent("view_confirm_unshare_modal"),this._setCurrentPage(t);case _.CLICK_UPGRADE:return this._logUpgradeClick(),c.redirect("/upgrade?oqa=spw");case _.CLOSE_MODAL:return this._clear();case _.FETCH_MEMBERSHIP_REQUEST:return this._setMembershipLoaded(!1);case _.FETCH_MEMBERSHIP_SUCCESS:return this._setMembershipList(t),this._setMembershipLoaded(!0);case _.FETCH_OWNED_SF_REQUEST:return this._setFoldersLoaded(!1);case _.FETCH_OWNED_SF_SUCCESS:return this._setOwnedSharedFolders(t.entries),this._setFoldersLoaded(!0);case _.SELECT_FOLDER:return this._selectFolderId(t);case _.TOGGLE_KEEP_A_COPY:return this._setKeepACopy(t);case _.UNSELECT_FOLDER:return this._unselectFolderId(t);case _.UNSHARE_FOLDERS:return this._logUnshareAction(),this._clear()}},t}(r),{ManageSharedFoldersStore:new m,ManageSharedFoldersActionHandler:h,PAGES:g,PAYWALL_SERIES_LOGGING_NAME:v}}),define("modules/clean/growth/experiments/sharing_paywall_info_modal",["external/classnames","external/react","modules/clean/react_format","modules/clean/react/button","modules/clean/react/css","modules/clean/react/modal","modules/clean/sharing/actions/share_modal","modules/clean/viewer","modules/core/browser","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_,m,f,g,v;return g=n.reactFormat,u=o.Button,d=i.Modal,h=c._,m=t.createElement,f=t.DOM,v=a.get_viewer(),_=t.createClass({displayName:"SharingPaywallInfoModal",propTypes:function(){return{actionHandler:t.PropTypes.instanceOf(s).isRequired,sharedFolderCount:t.PropTypes.number,grandfather:t.PropTypes.boolean,onDismiss:t.PropTypes.func,onManage:t.PropTypes.func}},_handleAndLogLearnMoreClick:function(){return this.props.actionHandler.logPaywallEvent("click_learn_more_from_grandfathered_notice"),this.navigateToHelpCenterArticle()},_handleAndLogNotNowClick:function(){return this.props.actionHandler.logPaywallEvent("click_not_now_from_grandfathered_notice"),this.props.onDismiss()},_handleAndLogManageSharedFoldersClick:function(){return this.props.actionHandler.logPaywallEvent("click_manage_shared_folders_from_grandfathered_notice"),this.props.onManage()},_handleAndLogUpgradeClick:function(){return this.props.grandfather?this.props.actionHandler.logPaywallEvent("click_upgrade_from_grandfathered_notice"):this.props.actionHandler.logPaywallEvent("click_upgrade_from_learn_more"),this.navigateToUpgradePage()},render:function(){var n;return n=e({"sharing-paywall-info-modal":!0,"sharing-paywall-grandfather":this.props.grandfather}),t.createElement(d,{className:n,buttonComponent:this.renderButtons(),style:"clean"},f.div({className:"sharing-paywall-info-modal__content"},f.img({src:"/static/images/sharing/db_shared_folder-vflK0RLgD.png",className:"sharing-paywall-info-modal__content_image"}),f.div({className:"sharing-paywall-info-modal__content_header"},this.getHeader()),f.div({className:"sharing-paywall-info-modal__content_subheader"},this.getSubheader())))},renderButtons:function(){return this.props.grandfather?f.div({className:"db-modal-buttons"},f.div({},m(u,{key:"primary",className:"dbmodal-button",importance:"primary",disabled:!1,onClick:this._handleAndLogUpgradeClick},h("Upgrade your Dropbox")),m(u,{key:"tertiary",className:"dbmodal-button",importance:"tertiary",disabled:!1,onClick:this._handleAndLogNotNowClick},h("Not now"))),f.div({},f.button({className:"button-as-link",onClick:this._handleAndLogManageSharedFoldersClick},h("Manage your shared folders")))):f.div({className:"db-modal-buttons"},m(u,{key:"primary",className:"dbmodal-button",importance:"primary",disabled:!1,onClick:this._handleAndLogUpgradeClick},h("Upgrade for unlimited sharing")))},getHeader:function(){return h(this.props.grandfather?"Shared folder limits have changed":"You can own 5 shared folders at a time")},getSubheader:function(){return this.props.grandfather?f.span({},f.div({},h("Now you can only own 5 shared folders with Dropbox Basic. Since you have  %(count)s, you’ll need to unshare some folders or upgrade.").format({count:this.props.sharedFolderCount}),g(h(" <learn>Learn more</learn>"),{learn:f.button({className:"button-as-link inline-link",onClick:this._handleAndLogLearnMoreClick})}))):f.span({},f.div({},h("Creating and sharing a folder makes you the owner, which gives you more  control over who can access it. Folders people have shared with you don’t  count towards your 5-folder limit.")))},navigateToHelpCenterArticle:function(){return l.open_tab("/help/9264")},navigateToUpgradePage:function(){return l.redirect("/upgrade?oqa=spw")}}),p=r(_,["/static/css/scooter/scooter-scoped-vflebHNBy.css","/static/css/growth/experiments/sharing_paywall_info_modal-vflke5gnX.css"]),{SharingPaywallInfoModal:p}}),define("modules/clean/history",["external/underscore","modules/core/exception","modules/core/uri"],function(e,t,n){var o,assert;return assert=t.assert,o=function(){var t,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v;return t=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$"),_=function(){var e,o,r;return r=void 0,e=window.location.pathname,o=window.location.search,-1!==e.search(t)&&(e=String(n({path:e}))),e+o},s=function(e,t){return String(n.parse(e).setQuery(t))},a=function(e){var t;return null==e&&(e=_()),t=e.split("?"),{url:e,path:t[0],qargs:n.parse(e).getQuery()}},l={},c={},m=_(),v=null,o="",h=function(e){var t;return t=o+"/"+e.substring(o.length).split("/")[1]},g=function(e){return o=e},u=function(e){var t,n,o,r,i,s,l,c,u;if(u=m,c=a(u),i=h(c.path),i in e){for(r=c.path.substr(i.length+1),s=e[i],l=[],n=0,o=s.length;o>n;n++)t=s[n],l.push(t(r,c.qargs));return l}},d=function(){return u(l)},p=function(){return u(c)},f=function(e,t,n){var o;return n[e]?(o=n[e].indexOf(t),n[e].splice(o,1)):void 0},r=function(e,t){var n,o;return o=h(e),n=h(t),o!==n?p():void 0},i=function(){var e;return e=_(),e!==m?(r(m,e),m=e,d()):void 0},{init:function(){return v?void 0:(m=_(),v=setInterval(i,50))},_add_callback:function(e,t,n){return this.init(),assert("string"==typeof e,"DBHistory prefix is not a string"),assert(0===e.indexOf("/"),"DBHistory prefix must be absolute"),assert(-1===e.substring(o.length).indexOf("/",1),"multi-component prefixes arent supported"),n[e]||(n[e]=[]),n[e].push(t)},add_callback:function(e,t,n){return null==n&&(n=!1),this._add_callback(e,t,l),n?void 0:d()},remove_callback:function(e,t){return f(e,t,l)},remove_exit_callback:function(e,t){return f(e,t,c)},add_exit_callback:function(e,t){return this._add_callback(e,t,c)},fire_callbacks:function(){return d()},fire_exit_callbacks:function(){return p()},_build_url_for_state_change:function(e,t){var n;return assert("string"==typeof e,"DBHistory path is not a string"),assert(0===e.indexOf("/"),"DBHistory path must be absolute"),assert(-1===e.indexOf("//"),"DBHistory path contains //"),n=s(e,t)},_pre_state_change:function(e){return e===m?!1:(r(m,e),!0)},_post_state_change:function(e){return null==e&&(e=!0),m=_(),e?d():void 0},replace_state:function(e,t){var n;return n=this._build_url_for_state_change(e,t),this._pre_state_change(n)&&window.history.replaceState?(window.history.replaceState(null,null,n),this._post_state_change()):void 0},push_state:function(t,n,o){var r;return null==o&&(o={}),o=e.defaults(o,{immediatelyRestoreState:!0}),assert(-1===t.indexOf("?"),"DBHistory path contains ?"),assert(-1===t.indexOf("#"),"DBHistory path contains #"),r=this._build_url_for_state_change(t,n),this._pre_state_change(r)?(window.history.pushState(null,null,r),this._post_state_change(o.immediatelyRestoreState)):void 0},update_query_param:function(e,t){var n;return n=this.deconstruct_url(),n.qargs[e]=t,this.replace_state(n.path,n.qargs)},remove_query_param:function(e){var t;return t=this.deconstruct_url(),delete t.qargs[e],this.replace_state(t.path,t.qargs)},get_url:_,construct_url:s,deconstruct_url:a,set_base_prefix:g,URL_ESCAPE_REGEX:t}}()});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_annotations",["jquery","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer","modules/clean/image_preview_util"],function(e,t,n,o){var r;return r=function(){function r(){this.onResize=bind(this.onResize,this),this._onScroll=bind(this._onScroll,this),this._handleMessage=bind(this._handleMessage,this)}return r.prototype.onImageLoad=function(e){return null==e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},r.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new n,window.addEventListener("resize",this.onResize),o.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("message",this._handleMessage),this._postPageRendered()},r.prototype._prepareAnnotationInterface=function(){var n,r;return 0===o.getAnnotationContainer().length&&(n=o.getPreviewImageWrapper(),r=e("<div class='"+o.ANNOTATION_CONTAINER+"' />"),this.$annotationContainer=r.appendTo(n)),this._resizeAnnotationContainer(),this.annotationInterface=new t,o.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(function(e){return function(){var t;return e._resizeAnnotationContainer(),null!=(t=e.annotationInterface)?t.onScaleChangeCallback():void 0}}(this),0)},r.prototype._handleMessage=function(e){var t,n,o,r,i,s,a,l,c,u,d,p,h;try{r=JSON.parse(e.data)}catch(e){return void(n=e)}switch(r.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=(i=this.annotationInterface)&&i._updateOffset(),null!=(s=this.annotationRenderer)?s.updateAnnotations(r.parameters):void 0;case"remove-annotation":return t=r.parameters.commentActivity,null!=(a=this.annotationRenderer)?a.removeAnnotation(t):void 0;case"remove-all-annotations":return null!=(l=this.annotationRenderer)&&l.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=(c=this.annotationInterface)?c._updateOffset():void 0;case"enable-annotation-creation":return null!=(u=this.annotationInterface)?u.enableAnnotationCreation():void 0;case"disable-annotation-creation":return null!=(d=this.annotationInterface)?d.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=(p=this.annotationInterface)?p.onHideAnnotation():void 0;case"scroll-to-annotation":return t=r.parameters.commentActivity,null!=(h=this.annotationRenderer)?h.highlightAnnotation(t):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},r.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},r.prototype._postMessage=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},r.prototype._setRegionCreationEnabled=function(e){var t,n,o;return e?null!=(t=this.annotationInterface)&&t.enableRegionCreation():null!=(n=this.annotationInterface)&&n.disableRegionCreation(),this._resizeAnnotationContainer(),null!=(o=this.annotationInterface)?o._updateOffset():void 0},r.prototype._onScroll=function(){var e;return null!=(e=this.annotationInterface)?e.onScrollCallback():void 0},r.prototype.onResize=function(e){var t,n;return null==e&&(e=!0),null!=(t=this.annotationRenderer)&&t.removeAllAnnotations(),this._postMessage("scale-change"),n=function(e){return function(){var t;return e._resizeAnnotationContainer(),e._postPageRendered(),null!=(t=e.annotationInterface)&&t.onScaleChangeCallback(),"function"==typeof e.resizeImageCallback?e.resizeImageCallback():void 0}}(this),clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},r.prototype._resizeAnnotationContainer=function(){var e,t,n,r,i,s,a,l,c,u,d,p,h;return e=o.getPreviewImage(),null!=e&&null!=e.offset()&&null!=(null!=(r=e.offsetParent())?r.offset():void 0)?(n=e.offset().top-e.offsetParent().offset().top,t=e.offset().left-e.offsetParent().offset().left,0>n&&(n=0),0>t&&(t=0),null!=(i=this.$annotationContainer)&&i.css("margin-top",n),null!=(s=this.$annotationContainer)&&s.css("margin-bottom",n),null!=(a=this.$annotationContainer)&&a.css("margin-left",t),null!=(l=this.$annotationContainer)&&l.css("margin-right",t),(null!=(c=this.annotationInterface)?c.isAnnotationRegionEnabled:void 0)?(null!=(u=this.$annotationContainer)&&u.height(e.height()),null!=(d=this.$annotationContainer)?d.width(e.width()):void 0):(null!=(p=this.$annotationContainer)&&p.height(0),null!=(h=this.$annotationContainer)?h.width(0):void 0)):void 0},r.prototype.removeAnnotations=function(){var e;return null!=(e=this.annotationRenderer)?e.removeAllAnnotations():void 0},r.prototype.reset=function(){var e,t;return null!=(e=this.annotationRenderer)&&e.reset(),null!=(t=this.annotationInterface)&&t.reset(),o.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),o.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),this._postMessage("reset-file-feedback-ui")},r}()}),define("modules/clean/image_preview_util",["jquery","modules/clean/annotations/annotation"],function(e,t){var n,o,r,i;return n=t.Annotation,r=t.AnnotationTypes,o=t.AnnotationSubtypes,i={PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return e("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return e("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return e("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return e("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return e("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){var t,n,o,r,i,s,a,l,c,u,d,p,h,_,m;for(u=[],t=this.getPreviewImageElement(),s=t.clientWidth,i=t.clientHeight,_=e.image_coordinates,r=0,l=_.length;l>r;r++){for(n=_[r],o=[],m=n.coordinates,a=0,c=m.length;c>a;a++)h=m[a],d=h.x*s,p=h.y*i,o.push({x:d,y:p});u.push(o)}return u},convertAnnotationViewportCoordinatesToImagePoints:function(e){var t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g;for(d=[],t=this.getPreviewImageElement(),i=t.getBoundingClientRect(),_=i.left,m=i.top,a=t.clientWidth,s=t.clientHeight,g=e.viewportCoordinates,r=0,c=g.length;c>r;r++){for(n=g[r],o=[],l=0,u=n.length;u>l;l++)f=n[l],p=(f.x-_)/a,h=(f.y-m)/s,o.push({x:p,y:h});d.push({coordinates:o})}return d}}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_interface",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util","modules/constants/comments_panel"],function(e,t,n,o,r,i){var s;return s=function(){function s(){this.onAnnotationLeaveCallback=bind(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=bind(this.onAnnotationEnterCallback,this),this.onAnnotationScaleChangeCallback=bind(this.onAnnotationScaleChangeCallback,this),this.onAnnotationScrollCallback=bind(this.onAnnotationScrollCallback,this),this.onAnnotationEndDragCallback=bind(this.onAnnotationEndDragCallback,this),this.onAnnotationStartDragCallback=bind(this.onAnnotationStartDragCallback,this),this.onAnnotationPlacedCallback=bind(this.onAnnotationPlacedCallback,this),this.onAnnotationHiddenCallback=bind(this.onAnnotationHiddenCallback,this),this.onScaleChangeCallback=bind(this.onScaleChangeCallback,this),this.onScrollCallback=bind(this.onScrollCallback,this),this.onKeyDownCallback=bind(this.onKeyDownCallback,this),this.onMouseUpCallback=bind(this.onMouseUpCallback,this),this.onMouseMoveCallback=bind(this.onMouseMoveCallback,this),this.onMouseDownCallback=bind(this.onMouseDownCallback,this),this.onHideAnnotation=bind(this.onHideAnnotation,this),this._prepareAnnotationCoords=bind(this._prepareAnnotationCoords,this),this._refreshAnnotationController=bind(this._refreshAnnotationController,this),this._prepareAnnotationController=bind(this._prepareAnnotationController,this),this.controllerEventHandlers={onMouseMoveCallback:e.noop,onMouseDownCallback:e.noop,onMouseUpCallback:e.noop,onHideAnnotation:e.noop,onScrollCallback:e.noop,onScaleChangeCallback:e.noop,onKeyDownCallback:e.noop},this.isAnnotationMarkerEnabled=i.ALLOW_ANNOTATION_MARKER,this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return s.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},s.prototype._isOnAnnotationUI=function(t){return e(t.target).parents(".db-annotation-layer").length>0},s.prototype._isOnAnnotationOverlay=function(t){return e(t.target).parents("#annotation-overlay").length>0},s.prototype._destroyAnnotationController=function(){var e;return e=r.getAnnotationLCanvasLayer(),(null!=e?e.length:void 0)>0?(n.unmountComponentAtNode(e[0]),e.remove()):void 0},s.prototype._prepareAnnotationController=function(){var t,n;return t=r.getAnnotationContainer(),0===t.find("."+r.ANNOTATION_CANVAS_LAYER_CSS).length?(n=e("<div class='"+r.ANNOTATION_CANVAS_LAYER_CSS+"' />"),this.$parentContainerEl=n.appendTo(t),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()):void 0},s.prototype._refreshAnnotationController=function(e){var r;if(null!=(r=this.$parentContainerEl)?r.get(0):void 0)return this.annotationController=n.render(t.createElement(o,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:this.isAnnotationMarkerEnabled,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},s.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},s.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=r.convertAnnotationViewportCoordinatesToImagePoints(e),e},s.prototype._updateOffset=function(e){return this.$parentContainerEl?(this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)):void 0},s.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},s.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},s.prototype.enableRegionCreation=function(){return e("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},s.prototype.disableRegionCreation=function(){return e("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},s.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),r.getAnnotationContainer().remove()},s.prototype.onHideAnnotation=function(){
var e;return null!=(e=this.controllerEventHandlers)?e.onHideAnnotation():void 0},s.prototype.onMouseDownCallback=function(e){var t;return this._isOnAnnotationUI(e)||this._isOnAnnotationOverlay(e)?void 0:null!=(t=this.controllerEventHandlers)?t.onMouseDownCallback(e):void 0},s.prototype.onMouseMoveCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseMoveCallback(e):void 0},s.prototype.onMouseUpCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseUpCallback(e):void 0},s.prototype.onKeyDownCallback=function(e){var t;return t=e.keyCode||e.which||e.charCode,this._sendToParent("on-keydown",{keyCode:t})},s.prototype.onScrollCallback=function(e){var t,n;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onScrollCallback():void 0),(null!=(n=this.annotationController)?n.hasVisibleActiveAnnotation():void 0)?void 0:this._sendToParent("scroll")},s.prototype.onScaleChangeCallback=function(e){var t;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},s.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},s.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},s.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},s.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},s}()});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_renderer",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util"],function(e,t,n,o,r,i,s,a){var l,c;return c=new s,l=function(){function o(){this.onAnnotationLeaveCallback=bind(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=bind(this.onAnnotationEnterCallback,this),this.onAnnotationClickCallback=bind(this.onAnnotationClickCallback,this),this._renderAnnotation=bind(this._renderAnnotation,this),this.updateAnnotations=bind(this.updateAnnotations,this),this.removeAnnotation=bind(this.removeAnnotation,this),this._annotationsByActivityKey={}}return o.prototype._isAnnotationAlreadyRendered=function(t){return e("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+t+"']").length>0},o.prototype.removeAnnotation=function(t){var o;return this._isAnnotationAlreadyRendered(t.activity_key)?(o=e("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+t.activity_key+"']").get(0),n.unmountComponentAtNode(o),o.remove()):void 0},o.prototype.removeAllAnnotations=function(){return this.reset()},o.prototype.reset=function(){var e,t,o,r;for(t=a.getAnnotationLayers(),o=0,r=t.length;r>o;o++)e=t[o],n.unmountComponentAtNode(e);return t.remove(),this._annotationsByActivityKey={}},o.prototype.highlightAnnotation=function(t){var n;return this._isAnnotationAlreadyRendered(t.activity_key)?(n=e("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+t.activity_key+"']"),n.removeClass("start-highlight-animation"),n.width(n.width()),n.addClass("start-highlight-animation")):void 0},o.prototype.updateAnnotations=function(e){var t,n,o,r,i,s;if(c.shouldUpdateAnnotations(e,this._annotationsByActivityKey)){for(this.removeAllAnnotations(),i=e.annotations,s=[],o=0,r=i.length;r>o;o++)n=i[o],c.renderAnnotation(n,this._isAnnotationAlreadyRendered,this._renderAnnotation),t=n.commentActivity.activity_key,s.push(this._annotationsByActivityKey[t]=n);return s}},o.prototype._renderAnnotation=function(o,r,i,s){var l,c,u;return c=a.getAnnotationContainer(),(null!=c?c.length:void 0)>0?(r.viewportCoordinates=a.convertAnnotationImagePointsToViewportCoordinates(r),u=e("<div class='"+a.ANNOTATION_LAYER_CSS+"' />"),u.attr({"data-comment-activity-key":i.activity_key}),l=u.appendTo(c).get(0),n.render(t.createElement(o,{annotation:r,commentActivity:i,options:s,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),l)):void 0},o.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},o.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},o.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},o.prototype.onAnnotationOverCallback=function(e){return{}},o.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},o}()}),define("modules/clean/immutability_helper",["require","exports","external/deep-freeze"],function(e,t,n){"use strict";function o(e){if(null==e)throw new TypeError("Cannot thaw null/undefined object");if(Array.isArray(e))return Array.prototype.slice.call(e);for(var t=Object.create(Object.getPrototypeOf(e)),n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var r=n[o],i=Object.getOwnPropertyDescriptor(e,r);i.get||i.set?(i.configurable=!0,Object.defineProperty(t,r,i)):t[r]=e[r]}return t}function r(e,t){var r=o(e);return t(r),n(r)}function i(e,t){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));return t.reduce(function(e,t){return null==e?null:e[t]},e)}function s(e,t,r){if(null==e)throw new TypeError("Object to `set` cannot be null");if(e[t]===r)return e;var i=o(e);return i[t]=r,n(i)}function a(e,t,n){return s(e,t,n(e[t]))}function l(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var o=t[0];return 1===t.length?a(e,o,n):s(e,o,l(e[o],t.slice(1),n))}function c(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var o=t[0];switch(t.length){case 1:return s(e,o,n);default:return s(e,o,c(e[o]||{},t.slice(1),n))}}function u(e,t){if(null==e||null==t)throw new TypeError("Both target and source cannot be null");var r=Object.keys(t).reduce(function(n,o){return t[o]!==e[o]&&n.push(o),n},[]);if(r.length){for(var i=o(e),s=0;s<r.length;s++){var a=r[s];Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(t,a))}return n(i)}return e}function d(e,t,n){if(null==e||null==n)throw new TypeError("Both target and source cannot be null");return l(e,t,function(e){return u(e,n)})}function p(e,t,o){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var s=m.call(e);return s.splice.apply(s,[t,o].concat(r)),n(s)}function h(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r=m.call(e);return r.unshift.apply(r,t),n(r)}function _(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r=m.call(e);return r.push.apply(r,t),n(r)}var m=Array.prototype.slice;t.thaw=o,t.withMutations=r,t.getIn=i,t.set=s,t.update=a,t.updateIn=l,t.setIn=c,t.merge=u,t.mergeIn=d,t.splice=p,t.unshift=h,t.push=_});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/legacy_pyxl_controllers/bubble_picker",["jquery","modules/clean/keycode"],function(e,t){var n;return n=function(){function n(e){this.$bubble_picker=e,this._on_button_keydown=bind(this._on_button_keydown,this),this._on_option_keydown=bind(this._on_option_keydown,this),this._on_option_mouseenter=bind(this._on_option_mouseenter,this),this.enable_option=bind(this.enable_option,this),this.disable_option=bind(this.disable_option,this),this.show_dropdown=bind(this.show_dropdown,this),this.hide_dropdown=bind(this.hide_dropdown,this),this.set_value=bind(this.set_value,this),this._listen=bind(this._listen,this),this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label_wrapper.on("keydown",this._on_button_keydown),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this.$options=this.$bubble_picker.find("*[role='option']"),this.$options.on("mouseenter",this._on_option_mouseenter),this.$options.on("keydown",this._on_option_keydown),this._dropdown_shown=!1,this._listen()}return n.CHANGED="db:bubblepicker:changed",n.prototype._listen=function(){return e(document).click(function(t){return function(n){var o,r;return r=e(n.target).closest(t.$label_wrapper).length>0,o=e(n.target).closest(t.$dropdown).length>0,t._dropdown_shown&&!o?t.hide_dropdown():r?t.show_dropdown():void 0}}(this)),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(t){return function(o){var r,i;return o.preventDefault(),r=e(o.currentTarget),r.hasClass("disabled")?void 0:(i=t.get_value(),t.set_value(r.data("value")),t.$bubble_picker.trigger(n.CHANGED,{clicked_val:r.data("value"),old_val:i}),t.hide_dropdown(),t.$label_wrapper.focus())}}(this))},n.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},n.prototype.set_value=function(e){var t;return this.$bubble_picker.attr("data-selected-value",e),this.$label.empty(),this.$bubble_picker.find(".bubble-picker-option--selected").removeClass("bubble-picker-option--selected"),t=this.$bubble_picker.find("[data-value='"+e+"']").addClass("bubble-picker-option--selected"),this.$label.html(t.clone().html())},n.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this.$label_wrapper.attr("aria-expanded",!1),this._dropdown_shown=!1},n.prototype.show_dropdown=function(){var t,n;return this.$dropdown.show(),this.$label_wrapper.attr("aria-expanded",!0),this._dropdown_shown=!0,this.$options.attr({tabindex:-1,"aria-selected":!1}),n=this.$bubble_picker.attr("data-selected-value"),t=n?this.$bubble_picker.find(".bubble-picker-option[data-value='"+n+"']")[0]:this.$bubble_picker.find(".bubble-picker-option")[0],e(t).attr({tabindex:0,"aria-selected":!0}).focus()},n.prototype.disable_option=function(t,n){var o,r;return r=this.$bubble_picker.find(".bubble-picker-option[data-value="+t+"]:not('.disabled')"),r.length>0&&(o=e(r.find(".role-option")),o.attr("saved-title",o.attr("title")),o.attr("title",n),o.attr("aria-disabled",!0)),r.addClass("disabled")},n.prototype.enable_option=function(t){var n,o;return o=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+t+"]"),n=e(o.find(".role-option")),n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),n.attr("aria-disabled",!1),o.removeClass("disabled")},n.prototype._change_focus=function(t,n){return e(t).attr({tabindex:-1,"aria-selected":!1}),e(n).attr({tabindex:0,"aria-selected":!0}).focus()},n.prototype._focus_previous=function(e){var t;return t=this.$options.index(e),t>0?this._change_focus(e,this.$options.get(t-1)):void 0},n.prototype._focus_next=function(e){var t;return t=this.$options.index(e),t<this.$options.length-1?this._change_focus(e,this.$options.get(t+1)):void 0},n.prototype._on_option_mouseenter=function(e){return this.$dropdown.removeClass("bubble-picker-dropdown--keyboard")},n.prototype._on_option_keydown=function(e){this.$dropdown.addClass("bubble-picker-dropdown--keyboard"),e.keyCode===t.ESC?(this.hide_dropdown(),this.$label_wrapper.focus()):e.keyCode===t.DOWN?(this._focus_next(e.target),e.preventDefault()):e.keyCode===t.UP?(this._focus_previous(e.target),e.preventDefault()):e.keyCode!==t.TAB||e.shiftKey||this.hide_dropdown()},n.prototype._on_button_keydown=function(e){e.keyCode===t.ENTER?this.$dropdown.addClass("bubble-picker-dropdown--keyboard"):e.keyCode===t.TAB&&e.shiftKey&&this.hide_dropdown()},n}()});var bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/legacy_pyxl_controllers/role_picker",["external/underscore","modules/core/controller_helpers","modules/core/exception","modules/clean/multiaccount_login","modules/clean/page_role_observer","modules/clean/viewer"],function(e,t,n,o,r,i){var s,a,l,c,assert;return assert=n.assert,l={ALL:"all",PERSONAL:"personal",WORK:"work"},a=function(){function t(t){var n,o,r,s,a,c;null==t&&(t={}),this._actually_set_state=bind(this._actually_set_state,this),this._do_login=bind(this._do_login,this),this.is_user_visible=bind(this.is_user_visible,this),this.is_role_visible=bind(this.is_role_visible,this),this.ensure_role_is_visible=bind(this.ensure_role_is_visible,this),this.set_state=bind(this.set_state,this),this.get_state=bind(this.get_state,this),this._allow_merged_state=null!=t.allow_merged_state?t.allow_merged_state:!0,this._limit_to_role=null!=t.limit_to_role?t.limit_to_role:null,c=i.get_viewer(),o=c.is_role_signed_in(l.PERSONAL)&&c.is_role_signed_in(l.WORK),t.initial_state?(s=e.values(l),assert((r=t.initial_state,indexOf.call(s,r)>=0),"RolePicker requires initial_state to be one of: "+s),this.set_state(t.initial_state)):this._allow_merged_state&&o?this.set_state(l.ALL):(n=c.get_users(),assert(n.length,"tried to use RolePicker on a page with no users"),a=n[0],this.set_state(a.role))}return t.prototype.get_state=function(){return this._state},t.prototype.set_state=function(e){var t,n,o,r;if(assert(this._allow_merged_state||e!==l.ALL,"tried to set merged state in non-merged picker"),null!=this._limit_to_role&&assert(e===l.ALL||e===this._limit_to_role),e===l.ALL){for(o=["personal","work","photos"],t=0,n=o.length;n>t;t++)if(r=o[t],!i.get_viewer().is_role_signed_in(r))return void this._do_login(r,e)}else if(r=e,!i.get_viewer().is_role_signed_in(r))return void this._do_login(r,e);return this._actually_set_state(e)},t.prototype.update_picker_ui=function(){},t.prototype.ensure_role_is_visible=function(e){return this.is_role_visible(e)?void 0:this._allow_merged_state?this.set_state(l.ALL):this.set_state(e)},t.prototype.is_role_visible=function(e){return this._state===l.ALL||this._state===e},t.prototype.is_user_visible=function(e){return this.is_role_visible(e.role)},t.prototype._do_login=function(e,t){return o.show_modal({role:e,on_success:function(e){return function(){return e._actually_set_state(t)}}(this)})},t.prototype._actually_set_state=function(e){return e!==this._state?(this._state=e,this.update_picker_ui(),"function"==typeof this.on_state_change?this.on_state_change(e):void 0):void 0},t}(),c=function(e){function n(e,t){this.$container=e,null==t&&(t={}),this.limit_to_role=bind(this.limit_to_role,this),this.update_picker_ui=bind(this.update_picker_ui,this),this.on_ui_change=bind(this.on_ui_change,this),this.$bubble_picker=this.$container.find(".bubble-picker"),this.$bubble_picker.on("db:bubblepicker:changed",this.on_ui_change),n.__super__.constructor.call(this,t)}return extend(n,e),n.prototype.on_ui_change=function(e,n){var o;return o=n.clicked_val,o!==this._state?(t.get_controller(this.$bubble_picker).set_value(this._state),this.set_state(o)):void 0},n.prototype.update_picker_ui=function(){return t.get_controller(this.$bubble_picker).set_value(this._state)},n.prototype.limit_to_role=function(e,n){var o,r;if(null!=e){this.ensure_role_is_visible(e);for(o in l)r=l[o],r!==e&&r!==l.ALL&&t.get_controller(this.$bubble_picker).disable_option(r,n)}else for(o in l)r=l[o],t.get_controller(this.$bubble_picker).enable_option(r);return this._limit_to_role=e},n}(a),s=function(e){function t(e,n){null==n&&(n={}),n.allow_merged_state=!1,t.__super__.constructor.call(this,e,n)}return extend(t,e),t.prototype.on_state_change=function(e){var t;return t=function(){switch(e){case l.PERSONAL:return"personal";case l.WORK:return"work"}}(),r.emit(t)},t}(c),{RolePickerState:l,RolePicker:a,RoleSelect:c,PageRoleSelect:s}}),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","external/underscore","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/pass/constants","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,o,r,i,s,a,l,c,u,d){"use strict";var p={};p[i.EventTypes.FILE_PREVIEW_SESSION_ENDED]="preview_session_ended",p[i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED]="preview_attempted",p[i.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED]="support_confirmed",p[i.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]="support_denied",p[i.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]="download_attempted",p[i.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]="download_succeeded",p[i.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]="download_failed",p[i.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]="render_succeeded",p[i.EventTypes.FILE_PREVIEW_RENDER_FAILED]="render_failed",p[i.EventTypes.FILE_PREVIEW_VIDEO_STALLED]="video_stalled",p[i.EventTypes.FILE_PREVIEW_PASS_SHOWN]="pass_shown",p[i.EventTypes.FILE_PREVIEW_PASS_HOVER]="pass_hover",p[i.EventTypes.FILE_PREVIEW_PASS_CLICK]="pass_click",p[i.EventTypes.BROWSE_PASS_SHOWN]="browse_pass_shown",p[i.EventTypes.BROWSE_PASS_HOVER]="browse_pass_hover",p[i.EventTypes.BROWSE_PASS_CLICK]="browse_pass_click",p[i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED]="quality_popup_asked",p[i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED]="quality_popup_answered",p[i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED]="quality_popup_dismissed",p[i.EventTypes.FILE_PREVIEW_USER_ACTION]="user_action",p[i.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED]="file_downloaded",p[i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED]="show_contents_attempted",p[i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED]="show_contents_failed",p[i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED]="show_contents_succeeded";var h={};h[i.SourceContext.BROWSE]="browse",h[i.SourceContext.SHARED_LINK_FILE]="sl_file",h[i.SourceContext.SHARED_LINK_FOLDER]="sl_folder",h[i.SourceContext.SHARED_LINK_COLLECTION]="sl_collection",h[i.SourceContext.VERSION_HISTORY]="version_history";var _=function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=e;n<o.length;n++){var r=o[n],i=r[0],s=r[1];this._eventHandlers[i]=s}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var o=this._getSerializedTimeline(t),i={event_name:p[e],file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:o?JSON.stringify(o):null,file_preview_size:t.previewSize,extra:JSON.stringify(n)};r.SilentBackgroundRequest({url:"/log/file_preview",data:i})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e}(),m=function(e){function t(){var t=e.call(this)||this;return t._logAnswers=function(e,n,r){void 0===r&&(r={}),o.each(n,function(e,t){return r[l.getQuestionLoggerKey(t)]=e}),t._log(i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,e,r)},t._logQuestion=function(e,n){for(var o={},r=0,s=n;r<s.length;r++){var a=s[r];o[l.getQuestionLoggerKey(a)]="1"}t._log(i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,e,o)},t._logDismissed=function(e,n){var o={stage:a.getPopupStageLoggerKey(n)};t._log(i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,e,o)},t.addEventHandlers([i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,t._logQuestion],[i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,t._logAnswers],[i.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,o){void 0===o&&(o={}),o._client_time=+Date.now();var r=n.fileViewerSession,i=r.sourceContext,s=r.isSharedLink;i&&(o._source_context=h[i]),s&&(o._is_shared_link="1"),e.prototype._log.call(this,t,n,o)},t}(_);t.FilePreviewQualityPopupLogger=m;var f=function(e){function t(){var t=e.call(this)||this;return t._handleFilePreviewPassShown=function(e,n,o){t._log(i.EventTypes.FILE_PREVIEW_PASS_SHOWN,e,t._convertEventDataToExtra(o))},t._handleFilePreviewPassHover=function(e,n,o){t._log(i.EventTypes.FILE_PREVIEW_PASS_HOVER,e,t._convertEventDataToExtra(o))},t._handleFilePreviewPassClick=function(e,n,o){t._log(i.EventTypes.FILE_PREVIEW_PASS_CLICK,e,t._convertEventDataToExtra(o))},t._handleBrowsePassShown=function(e,n,o){t._logPassBrowse(i.EventTypes.BROWSE_PASS_SHOWN,n,t._convertEventDataToExtra(o))},t._handleBrowsePassHover=function(e,n,o){t._logPassBrowse(i.EventTypes.BROWSE_PASS_HOVER,n,t._convertEventDataToExtra(o))},t._handleBrowsePassClick=function(e,n,o){t._logPassBrowse(i.EventTypes.BROWSE_PASS_CLICK,n,t._convertEventDataToExtra(o))},t.addEventHandlers([i.EventTypes.FILE_PREVIEW_PASS_SHOWN,t._handleFilePreviewPassShown],[i.EventTypes.FILE_PREVIEW_PASS_HOVER,t._handleFilePreviewPassHover],[i.EventTypes.FILE_PREVIEW_PASS_CLICK,t._handleFilePreviewPassClick],[i.EventTypes.BROWSE_PASS_SHOWN,t._handleBrowsePassShown],[i.EventTypes.BROWSE_PASS_HOVER,t._handleBrowsePassHover],[i.EventTypes.BROWSE_PASS_CLICK,t._handleBrowsePassClick]),t}return n.__extends(t,e),t.prototype._logPassBrowse=function(e,t,n){void 0===n&&(n={});var o={event_name:p[e],file_viewer_session_id:s.BROWSE_PASS_SESSION_ID,file_preview_session_id:s.BROWSE_PASS_SESSION_ID,file_ns_id:t.ns_id,file_sjid:t.sjid,file_preview_timeline:null,file_preview_size:null,extra:JSON.stringify(n)};r.SilentBackgroundRequest({url:"/log/file_preview",data:o})},t.prototype._convertEventDataToExtra=function(e){return{num_accessors:e.numAccessors,num_current_viewers:e.numCurrentViewers,num_viewers:e.numViewers}},t}(_);t.FilePreviewPassLogger=f;var g=function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_RENDER_FAILED,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_SESSION_ENDED,e,t)},n._handleFilePreviewVideoStalled=function(e,t){n._handleEvent(i.EventTypes.FILE_PREVIEW_VIDEO_STALLED,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,n._handleFilePreviewAttemptStarted],[i.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,n._handleFilePreviewSupportConfirmed],[i.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,n._handleFilePreviewSupportDenied],[i.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,n._handleFilePreviewDownloadAttempted],[i.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,n._handleFilePreviewDownloadSucceeded],[i.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED,n._handleFilePreviewDownloadFailed],[i.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED,n._handleFilePreviewRenderSucceeded],[i.EventTypes.FILE_PREVIEW_RENDER_FAILED,n._handleFilePreviewRenderFailed],[i.EventTypes.FILE_PREVIEW_SESSION_ENDED,n._handleFilePreviewSessionEnded],[i.EventTypes.FILE_PREVIEW_VIDEO_STALLED,n._handleFilePreviewVideoStalled]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.file.preview_type,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=u.REQUEST_ID,null!=t.pageCount&&(n.page_count=t.pageCount),null!=t.firstPageRendered&&(n.first_page_rendered=t.firstPageRendered),null!=t.previewThumbnailSize&&(n.preview_thumbnail_size=t.previewThumbnailSize),null!=t.isLinearized&&(n.is_linearized=t.isLinearized);var o=t.fileViewerSession,r=o.sourceContext,s=o.isSharedLink;if(r&&(n.source_context=h[r]),null!=t.lastEvent&&(n.last_event=p[t.lastEvent]),s){n.is_shared_link="1";var a=c.time_since_start();if(null!=a&&(n.time_to_event=a),e===i.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED){var l=c.start_time();null!=c.time_to_view&&(n.time_to_render=c.time_to_view-l),null!=c.time_to_interactive&&(n.time_to_interactive=c.time_to_interactive-l);var _=d.performance();if(null!=_){var m=_.timing;null!=m&&(n.time_to_first_byte=m.responseStart-l)}window._timingData&&(window._timingData.pdfjs&&(n.pdfjs_timing_data=JSON.stringify(window._timingData.pdfjs)),window._timingData.img&&(n.img_timing_data=JSON.stringify(window._timingData.img)))}}e===i.EventTypes.FILE_PREVIEW_SESSION_ENDED&&(n.pages_rendered=JSON.stringify(t.pagesRendered),n.images_fetched=JSON.stringify(t.fileViewerSession.imagesFetched)),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var o=e.previewTimeline[n],r=this._timelineKey(n);t[r]=o.timestamp}return t},t.prototype._timelineKey=function(e){var t=p[e];return t+"_ts"},t}(_);t.FilePreviewTimelineLogger=g;var v=function(e){function t(){var t=e.call(this)||this;return t._logDownload=function(e,n){t._log(i.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED,e,n)},t._logShowContentsAttempted=function(e,n){t._log(i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED,e,n)},t._logShowContentsFailed=function(e,n){t._log(i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED,e,n)},t._logShowContentsSucceeded=function(e,n){t._log(i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED,e,n)},t.addEventHandlers([i.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED,t._logDownload],[i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED,t._logShowContentsAttempted],[i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED,t._logShowContentsFailed],[i.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED,t._logShowContentsSucceeded]),t}return n.__extends(t,e),t}(_);t.FilePreviewArchiveLogger=v;var y=function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,o,r){r.action=n,r.context=o,t._log(i.EventTypes.FILE_PREVIEW_USER_ACTION,e,r)},t.addEventHandlers([i.EventTypes.FILE_PREVIEW_USER_ACTION,t._logUserAction]),t}return n.__extends(t,e),t}(_);t.FilePreviewUserActionLogger=y}),define("modules/clean/loggers/file_viewer_logger",["jquery","modules/constants/python","modules/clean/analytics","modules/clean/previews/util"],function(e,t,n,o){var r,i,s,a;return r=t.FileViewPlatformType,i=t.FileViewTargetType,a=o.PreviewHelper,s=function(){function t(){}return t.start=function(){return n.UserActivityLogger.start("web","file_view_first_page_rendered"),n.PreviewActivityLogger.start("file_view_first_page_rendered"),n.FileViewLogger.start()},t.logPageRendered=function(t,o){var r,i,s,l,c,u,d;for(t=t,r=a.get_extension(t),l=e.extend(o.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=t.bytes?t.bytes:0,docPreviewStatus:t.doc_preview_status}),u=o.stats,i=0,s=u.length;s>i;i++)d=u[i],c=function(){switch(d.name){case"Page Request":return"viewer_page_request_time";case"Rendering":return"viewer_rendering_time";case"Overall":return"viewer_overall_time"}}(),l[c]=d.end-d.start;return n.UserActivityLogger.stop("web","file_view_first_page_rendered",l),n.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(l)})},t.logView=function(e,t,o,i,s,l,c,u,d){var p;return null==c&&(c=1),null==u&&(u=!1),null==d&&(d=!1),p={user_id:null!=t?t.id:void 0,target:o,platform:r.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:i,action:s,shared_link_url:l,extra:{file_ext:a.get_extension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,preview_status:e.doc_preview_status,time_taken:-1,in_progress:u,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),file_view_attempts:c,is_ndsl:d}},n.FileViewLogger.stop(p)},t}()});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/loggers/folder_invite_impression_logger",["modules/clean/analytics","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/models"],function(e,t,n){var o,r,i,s,a,l,c,u,d;return a=e.ProEventsLogger,o=t.EventTypes,c=n.SharedFolderInviteData,u=n.UserNotification,d={},s=c.OVER_QUOTA_STATUSES,i=3,l={},l[s.ALREADY_OVER]="view_shared_folder_notification_already_oq",l[s.WILL_BE_OVER]="view_shared_folder_notification_near_oq",r=function(){function e(){this._handleRenderedNotifications=bind(this._handleRenderedNotifications,this)}return e.prototype.listenTo=function(e){return e.addListener(o.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},e.prototype.unlistenTo=function(e){return e.removeListener(o.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},e.prototype._handleRenderedNotifications=function(e){var t;return t=e.notifications,this._hasLoggedOverQuotaImpressions?void 0:(this._hasLoggedOverQuotaImpressions=!0,this._logOverQuotaImpressions(t))},e.prototype._logOverQuotaImpressions=function(e){var t,n,o,r,s,c,d;for(c=e.slice(0,i),d=[],n=0,o=c.length;o>n;n++)if(r=c[n],r.type===u.TYPES.SHARED_FOLDER_INVITE){if(s=r.typeData.overQuotaStatus,t=l[s]){a.log(t);break}d.push(void 0)}else d.push(void 0);return d},e}(),d.FolderInviteImpressionLogger=r,d}),define("modules/clean/loggers/notification_logger",["modules/clean/ajax","modules/clean/react/user_notifications/models"],function(e,t){var n,o;return o=t.UserNotification,n={logReceive:function(e){var t,o;return o=function(){var o,r,i;for(i=[],o=0,r=e.length;r>o;o++)t=e[o],i.push(n._getCommonEventData("receive",t));return i}(),n._log(o)},logRender:function(e,t){var o,r,i,s,a,l;for(l=[],r=o=0,i=e.length;i>o;r=++o)s=e[r],a=n._getCommonEventData("render",s),a.location="home",a.location_index=t+r,l.push(a);return n._log(l)},logAction:function(e,t){var o;return o=n._getCommonEventData("action",e),o.action_taken=t,n._log([o])},_log:function(t){return 0!==t.length?e.SilentBackgroundRequest({url:"/log/notif_events",data:{event_list:JSON.stringify(t)}}):void 0},_getCommonEventData:function(e,t){var n;return n={event_name:e,type_id:t.typeId,campaign_id:t.campaignId,campaign_version:t.campaignVersion,instance_id:parseInt(t.id),status:o.STATUS_STRINGS[t.status],target_object_key:t.targetObjectKey}}},{NotificationLogger:n}}),define("modules/clean/loggers/notification_tray_logger",["require","exports","modules/clean/ajax"],function(e,t,n){"use strict";function o(e){var t={event_name:"tray_popup_shown",badge_count:e};r(t)}function r(e){n.SilentBackgroundRequest({url:"/log/notif_tray_events",data:{event_dict:JSON.stringify(e)
}})}t.logTrayOpen=o}),define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/controller_helpers","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/dbmodal","modules/clean/teams/team_assume_user_personal_locked_modal"],function(e,t,n,o,r,i,s,a,l){var c,u,d,assert;return assert=o.assert,d=r._,c=a.DBModal,u=function(){function o(){}return o.$element=function(){return e("#db-modal-multiaccount-login-modal")},o.set_during_login_callback=function(e){return assert(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},o.show_modal=function(o){var r,a,l,u,p;return null==o&&(o={}),s.get_viewer().is_team_assume_user_session?this.show_personal_account_disabled_modal():(this.$element=e.isFunction(this.$element)?this.$element():this.$element,assert(null!=(a=this.$element)?a.length:void 0,"MultiaccountLogin needs its @$element to be set"),assert(!(null!=o.on_success&&null!=o.success_href),"on_success and success_href are mutually exclusive"),null!=o.user?p=o.user:null!=o.user_id?p=s.get_viewer().get_user_by_id(o.user_id,!0):null!=o.role&&(p=s.get_viewer().get_user_by_role(o.role,!0)),assert(null!=p,"invalid user"),l=p.role,assert(!s.get_viewer().is_user_signed_in(p),"called MultiaccountLogin for a user that's already signed in"),u="personal"===l?d("Sign in to your personal Dropbox"):d("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),r=this.$element.find("form"),n.get_controller(r).reset(),n.get_controller(r).set_input_value("login_email",p.email),this.auth_success_callback=function(e){return function(){var n;return s.get_viewer()._sign_in_all_users(),n=function(n){return null!=n?(i.error(n),s.get_viewer()._sign_out_user_by_id(p.id),void e.modal.hide()):null!=o.success_href?t.get_uri().toString()!==o.success_href?t.redirect(o.success_href):t.reload():(e.modal.hide(),"function"==typeof o.on_success?o.on_success():void 0)},null!=e._during_login_callback&&null==o.success_href?e._during_login_callback(p,n):n(),!1}}(this),e(document).off("db:multilogin:success"),e(document).on("db:multilogin:success",this.auth_success_callback),this.modal=new c({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(u),this.$element.find('input[name="login_password"]').focus())},o.show_page_login_modal=function(e){var t,n,o,r,i,a,l;for(l=s.get_viewer(),o=null,i=l.get_users(!0),t=0,n=i.length;n>t;t++)if(a=i[t],!l.is_user_signed_in(a)){o=a;break}return o?(r={user:o},"string"==typeof e?r.success_href=e:"function"==typeof e&&(r.on_success=e),this.show_modal(r),!1):void 0},o.show_personal_account_disabled_modal=function(){var e;return e=s.get_viewer(),l.AssumePersonalLockedModal.show({displayName:e.display_name,teamName:e.team_name}),!1},o}(),INLINE_JS.MultiaccountLogin=u,u});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/open_with",["external/underscore","modules/clean/browse_interface","modules/clean/filepath","modules/clean/gandalf_util","modules/core/uri"],function(e,t,n,o,r){var i;return i=function(){function i(){}var s,a,l;return i.PRELOAD_URLS={},i.MAX_SUPPORTED_FILE_SIZE_B=157286400,s=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],a=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],l=function(t){var o,r;return r=n.filename(t),o=n.file_extension(r),e.find(a,function(e){return indexOf.call(e.ext,o)>=0})},i.get_open_handler_for=function(e,n){var o,s;return s=l(e.fq_path),s&&i.is_app_supported(s.id)?(o=r.encode_parts(e.fq_path),{icon:s.icon,name:s.name,uri:"/ow/msft/edit"+t.get_browse_root(n)+o}):null},i.file_supported=function(e){return!!l(e.fq_path)},i.is_adobe_app=function(e){return indexOf.call(s,e)>=0},i.is_app_supported=function(e){switch(e){case"word":return!0;case"excel":return!0;case"powerpoint":return!0;case"wopitest":return o.getGandalfRule("wopi_view_wopitest");default:return!1}},i}()}),define("modules/clean/optimistic_update",["require","exports","external/underscore"],function(e,t,n){"use strict";function o(e){return n.isString(e)}var r={},i=function(){function e(e){this._base=e,this._journal=[],this._head=r}return e.prototype.getValue=function(){return this._head===r&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=n.uniqueId("optimist-patch-");return this._head=r,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(o(e)){var t=this._removeJournalEntry(e);return t?(this._head=r,this._base=t.patch(this._base,e),!0):!1}return this._head=r,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=n.findIndex(this._journal,function(t){return t.id===e});return 0>t?null:(this._head=r,this._journal.splice(t,1)[0])},e}();t.Optimist=i}),define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var t,assert;return assert=e.assert,new(t=function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return assert("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return assert("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,o,r,i;for(r=this._listeners,i=[],n=0,o=r.length;o>n;n++)t=r[n],t!==e&&i.push(t);return i}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,o,r,i;for(r=this._listeners.slice(),i=[],n=0,o=r.length;o>n;n++)t=r[n],i.push(t(e));return i},e}())}),define("modules/clean/pagelet_logger",["require","exports","modules/core/browser","modules/clean/js_client_stopwatch","modules/clean/web_timing_logger"],function(e,t,n,o,r){"use strict";var i=function(){function e(e,t,r){void 0===t&&(t=[]),void 0===r&&(r=!1);var i=this;if(this.pageletName=e,r){var s=n.performance();s&&s.now&&(this.performance=s,this.stopwatchName=this.pageletName+"_client_logging",o.JSStopwatch.create_stopwatch_if_not_exist(this.stopwatchName))}else this.stopwatchName=void 0;this.ttiComponents=[],t.map(function(e){i.ttiComponents.push({name:e,isReady:!1})}),this.ttiMarked=!1}return e.prototype.stopwatchStart=function(e){void 0!==this.stopwatchName&&o.JSStopwatch.startSpan(e,{stopwatchName:this.stopwatchName})},e.prototype.stopwatchEnd=function(e){void 0!==this.stopwatchName&&o.JSStopwatch.endSpan(e,{stopwatchName:this.stopwatchName})},e.prototype.componentReady=function(e){if(!this.ttiMarked){for(var t=!1,n=0;n<this.ttiComponents.length;++n)this.ttiComponents[n].name===e?(this.ttiComponents[n].isReady=!0,o.JSStopwatch.recordTrace(e+"_since_start",{stopwatchName:this.stopwatchName})):this.ttiComponents[n].isReady||(t=!0);t||(r.mark_time_to_interactive(),this.ttiMarked=!0)}},Object.defineProperty(e.prototype,"ttiLogged",{get:function(){return this.ttiMarked},enumerable:!0,configurable:!0}),e}();t.PageletLogger=i}),define("modules/clean/pagination_manager",["modules/clean/ajax","modules/core/notify","modules/core/i18n"],function(e,t,n){var o,r;return r=n._,o=function(){function n(){}var o,i;return o=function(){function e(e,t){this.userRole=e,this.hasMoreItems=t}return e.prototype.areAllItemsReady=function(e){return null==e&&(e=this.userRole),"both"===e?!(this.hasMoreItems.personal||this.hasMoreItems.work):!this.hasMoreItems[e]},e.prototype.invalidateHasMore=function(){var e,t;e=[];for(t in this.hasMoreItems)e.push(this.hasMoreItems[t]=!0);return e},e.prototype.addDataToAjax=function(e){return e.role=this.areAllItemsReady()?"both":this.userRole},e}(),i=function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){return this.hasMoreItems=!0},e.prototype.addDataToAjax=function(){},e}(),n.prototype.initialize=function(e,t,n,o,r){return this.ajaxURL=n,this.newDataCallback=r,this.autoFetching=!1,this.mode=new i(e.has_more_items),this.keyName=t,this.items={},this.pages=[],this.nextRequestVoucher=e.next_request_voucher,this.userID=o,this._addPage(e.items)},n.prototype.areAllItemsReady=function(e){return this.mode.areAllItemsReady(e)},n.prototype._addPage=function(e){var n,o,i,s,a,l;for(l=[],a=[],n=0,s=e.length;s>n;n++){if(o=e[n],i=o[this.keyName],null==i)return void t.warning(r("Invalid server response"));null==this.items[i]&&(this.items[i]=o,a.push(o),l.push(i))}return this.pages.push(l),this.newDataCallback(this,a)},n.prototype.startAutoFetching=function(){return this.autoFetching=!0,this.fetchNext()},n.prototype.stopAutoFetching=function(){return this.autoFetching=!1},n.prototype.setUserRole=function(e){return this.mode=new o(e,this.mode.hasMoreItems)},n.prototype.reSync=function(e){var t;return null==e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]),t=this.autoFetching&&this.mode.areAllItemsReady("both"),this.mode.invalidateHasMore(),t?this.startAutoFetching():void 0},n.prototype.fetchNext=function(){var n;if(!this.mode.areAllItemsReady("both"))return n={},this.nextRequestVoucher&&(n.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(n),e.WebRequest({url:this.ajaxURL,data:n,subject_user:this.userID,success:function(e){return function(t){return t=JSON.parse(t),e.nextRequestVoucher=t.next_request_voucher,e.mode.hasMoreItems=t.has_more_items,e.autoFetching&&e.fetchNext(),e._addPage(t.items)}}(this),error:function(){return t.error(r("There was a problem completing this request."))}})},n.prototype.loadedPageCount=function(){return this.pages.length},n.prototype.getLoadedPage=function(e){var t,n,o,r,i;if(r=[],i=this.pages[e],null==i)return null;for(t=0,o=i.length;o>t;t++)n=i[t],r.push(this.items[n]);return r},n.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},n}()}),define("modules/clean/payments/cash",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";var o=function(){function e(){}return e.set_locale_number_format=function(t,n,o){void 0===t&&(t=","),void 0===n&&(n="."),void 0===o&&(o="-"),e.groupSymbol=t,e.decimalSymbol=n,e.minusSignSymbol=o},e.set_currency_format_map=function(t){e.currencyFormatMap=t},e.formatAmountThousandsHelper=function(t){var n=Math.abs(parseInt(t,10)).toFixed(0).toString();if(n.length<=3)return n;var o=n.substr(0,n.length-3),r=e.formatAmountThousandsHelper(o);return r+e.groupSymbol+n.substr(n.length-3)},e.roundCurrency=function(t,n,o){return void 0===n&&(n="USD"),void 0===o&&(o=2),o=t%1===0?0:o,e.formatCurrency(t,n,o)},e.formatCurrency=function(t,n,o){void 0===n&&(n="USD"),void 0===o&&(o=2);var r=parseFloat(t);"JPY"===n&&(o=0);var i=e.formatNumber(r,o);return e.currencyFormatMap[n]?e.currencyFormatMap[n].replace("%v",i):i+" "+n},e.splitFormatCurrency=function(t,n,o){void 0===n&&(n="USD"),void 0===o&&(o=2);var r=e.formatCurrency(t,n,o),i=r.indexOf(e.decimalSymbol);return-1===i?[r,""]:[r.slice(0,i+1),r.slice(i+1)]},e.formatNumber=function(t,n){void 0===n&&(n=2);var o=0>t?e.minusSignSymbol:"",r="";return n>0&&(r=e.decimalSymbol+t.toFixed(n).split(".")[1]),o+e.formatAmountThousandsHelper(t)+r},e}();o.groupSymbol=",",o.decimalSymbol=".",o.minusSignSymbol="-",o.currencyFormatMap={USD:"$%v"},t.CashUtil=o;var r=function(){function e(e,t){this.cash1=e,this.cash2=t}return e}();t.CashCurrenciesDoNotMatch=r;var i=function(){function e(){}return e}();t.CashNeedsAmountAndCurrency=i;var s=function(){function e(e,t){if(this.currency=t,this.amount=parseFloat(e),isNaN(this.amount)||!this.currency)throw new i}return e.fromObject=function(t){return new e(parseFloat(t.amount),t.currency)},e.prototype.add=function(t){if(this.currency!==t.currency)throw new r(this,t);return new e(this.amount+t.amount,this.currency)},e.prototype.subtract=function(t){return this.add(new e(-t.amount,t.currency))},e.prototype.multiply=function(t){return new e(this.amount*t,this.currency)},e.prototype.divide=function(t){return new e(this.amount/t,this.currency)},e.prototype.round=function(t){void 0===t&&(t=2);var n=Math.pow(10,t);return new e(Math.round(this.amount*n)/n,this.currency)},e.prototype.toString=function(e){return void 0===e&&(e=2),"JPY"===this.currency&&(e=0),o.roundCurrency(this.amount,this.currency,e)},e.prototype.formatCurrency=function(e){return void 0===e&&(e=2),o.formatCurrency(this.amount,this.currency,e)},e.formatWithTaxLabels=function(e,t){return t.doesTaxApply?n._("%(price)s, including applicable taxes").format({price:e.formatCurrency()}):e.formatCurrency()},e}();t.Cash=s});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/payments/dfb_util",["external/underscore","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(e,t,n,o,r){var i,s,a,l,assert;return i=n.Cash,assert=r.assert,l=function(){function t(e,t,n,o,r,i,s){this.plan_ids=e,this.schedule_ids=t,this.license_ids_and_counts=n,this.currencies=o,this.country_code=r,this.zip_code=i,this.vat_id=s,this.renew=!1,this.discount_ratio=0,this.discount_allow_monthly=!1}return t.prototype.set_only_license_count=function(e){var t;return t=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[t]=e},t.prototype.get_only_license_count=function(){var e;return e=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[e]},t.prototype.set_country_code=function(e){this.country_code=e},t.prototype.set_zip_code=function(e){this.zip_code=e},t.prototype.set_currencies=function(e){this.currencies=e},t.prototype.set_renew=function(e){this.renew=e},t.prototype.set_discount_ratio=function(e){this.discount_ratio=e},t.prototype.set_discount_allow_monthly=function(e){this.discount_allow_monthly=e},t.prototype.set_vat_id=function(e){return""!==e&&o.validateVat(this.country_code,e)?this.vat_id=e:this.vat_id=""},t.prototype.cache_key=function(e){var t;return null==e&&(e=!1),this.currencies&&!e&&(t=this.currencies.join(",")),[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),t,this.country_code,this.zip_code,this.vat_id,this.renew,this.discount_ratio].join(":")},t.prototype.to_json=function(){var t;return t=this.renew?{renew:1}:{},t=e.extend(t,{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:this.currencies?JSON.stringify(this.currencies):"",country_code:this.country_code,zip_code:this.zip_code,vat_id:this.vat_id,discount_percentage:JSON.stringify(100*this.discount_ratio),discount_allow_monthly:this.discount_allow_monthly})},t.from_transition_view_models=function(n){var o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I;for(h=[],w=[],i=[],p=!1,r=!1,C=!1,I=!1,s=0,c=n.length;c>s;s++)if(T=n[s],h.push(T.state.plan.id),w.push(T.state.schedule.id),i.push(T.state.currency),p===!1){for(p={},_=T.state.allocated_licenses,a=0,u=_.length;u>a;a++)o=_[a],p[o.license_id]=o.license_count;r=null!=(m=T.read_only_invoice)?m.tax_country_code:void 0,C=null!=(f=null!=(g=T.read_only_invoice)?g.tax_exclusion_id:void 0)?f:null,I=null!=(v=T.read_only_invoice)?v.tax_zip_code:void 0}else{for(assert(T.state.allocated_licenses.length===Object.keys(p).length,"License sets differ"),y=T.state.allocated_licenses,l=0,d=y.length;d>l;l++)o=y[l],assert(o.license_id in p,"License sets differ"),assert(p[o.license_id]===o.license_count,"License count must match");assert(r===(null!=(E=T.read_only_invoice)?E.tax_country_code:void 0),"country codes must match"),assert(I===(null!=(b=T.read_only_invoice)?b.tax_zip_code:void 0),"zip codes must match"),assert(C===(null!=(S=T.read_only_invoice)?S.tax_exclusion_id:void 0),"VAT IDs must match")}return new t(e.uniq(h),e.uniq(w),p,e.uniq(i),r,I,C)},t}(),s=function(){function e(e){var t,n;this.transition_view_model=e,this.transition_view_model.read_only_invoice?this.current_total=i.fromObject(this.transition_view_model.read_only_invoice.total):this.current_total=new i(0,this.transition_view_model.state.currency),this.price_token=this.transition_view_model.expected_price,this.transition_view_model.state.per_license_prices.length?this.per_license_price=i.fromObject(this.transition_view_model.state.per_license_prices[0].price):this.per_license_price=new i(0,this.transition_view_model.state.currency),this.recurring_total=i.fromObject(this.transition_view_model.state.total_recurring_price),this.transition_view_model.prices?this.tax=i.fromObject(this.transition_view_model.prices.tax):this.tax=new i(0,this.recurring_total.currency),this.transition_view_model.total_recurring_taxes?this.recurring_tax=i.fromObject(this.transition_view_model.total_recurring_taxes):this.recurring_tax=new i(0,this.recurring_total.currency),this.recurring_total_tax=this.recurring_total.add(this.recurring_tax),this.tax_percentage=0,this.transition_view_model.read_only_invoice&&(n=this.transition_view_model.read_only_invoice.line_items,t=n.length>0?n[0]:void 0,(null!=t?t.country_tax_percentage:void 0)?this.tax_percentage=t.country_tax_percentage:(null!=t?t.state_tax_percentage:void 0)&&(this.tax_percentage=t.state_tax_percentage))}return e}(),a=function(){function e(e){this.default_transition_view_models=e,this._get_transition_info_for=bind(this._get_transition_info_for,this),this._add_to_cache=bind(this._add_to_cache,this),this.has_inflight_request=bind(this.has_inflight_request,this),this.transition_view_model_requests={},this.transition_info_cache={},this._add_to_cache(this.default_transition_view_models)}return e.prototype.get=function(e,n,o){var r,i,s;return s=l.from_transition_view_models(this.default_transition_view_models),n.total_users&&s.set_only_license_count(n.total_users),n.country_code&&s.set_country_code(n.country_code),n.currency&&s.set_currencies([n.currency]),n.remove_currency&&s.set_currencies(),n.zip_code&&s.set_zip_code(n.zip_code),n.renew&&s.set_renew(n.renew),(n.vat_id||""===n.vat_id)&&s.set_vat_id(n.vat_id),n.discount_ratio&&s.set_discount_ratio(n.discount_ratio),null!=n.discount_allow_monthly&&s.set_discount_allow_monthly(n.discount_allow_monthly),r=s.cache_key(),(i=this._get_transition_info_for(r))?void e(i):this.transition_view_model_requests[r]?void 0:(this.transition_view_model_requests[r]=!0,t.SilentBackgroundRequest({url:"/business/transition-model",type:"GET",dataType:"json",data:s.to_json(),success:function(t){return function(o){var i;return delete t.transition_view_model_requests[r],i=t._add_to_cache(o,n.remove_currency),e(i)}}(this),error:function(e){return function(t){return"function"==typeof o&&o(t),delete e.transition_view_model_requests[r]}}(this)}))},e.prototype.has_inflight_request=function(){return Object.keys(this.transition_view_model_requests).length},e.prototype._add_to_cache=function(e,t){var n,o,r;return null==t&&(t=!1),n=l.from_transition_view_models(e).cache_key(t),o=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)r=e[t],o.push(new s(r));return o}(),this.transition_info_cache[n]=o,o},e.prototype._get_transition_info_for=function(e){return e in this.transition_info_cache?this.transition_info_cache[e]:null},e}(),{DfBTransitionInfo:s,DfBTransitionInfoFetcher:a}}),define("modules/clean/payments/validation",["require","exports"],function(e,t){"use strict";function n(e,t){return t.trim().length?s[e]?s[e].regex.test(t):!1:!0}function o(e){return s[e]?s[e].prefix:""}function r(e){return s[e]?s[e].examples:[]}function i(e){if(e=e.replace(/\s+/g,""),e.length<2)return!1;var t=e.substring(0,2);switch(t){case"AT":return/^AT[0-9]{18}$/.test(e);case"BE":return/^BE[0-9]{14}$/.test(e);case"CY":return/^CY[0-9]{10}[0-9a-zA-Z]{16}$/.test(e);case"CZ":return/^CZ[0-9]{22}$/.test(e);case"DE":return/^DE[0-9]{20}$/.test(e);case"EE":return/^EE[0-9]{18}$/.test(e);case"ES":return/^ES[0-9]{22}$/.test(e);case"FI":return/^FI[0-9]{16}$/.test(e);case"FR":return/^FR[0-9]{12}[0-9a-zA-Z]{11}[0-9]{2}$/.test(e);case"GR":return/^GR[0-9]{9}[0-9a-zA-Z]{16}$/.test(e);case"HU":return/^HU[0-9]{26}$/.test(e);case"HR":return/^HR[0-9]{19}$/.test(e);case"IE":return/^IE[0-9]{2}[0-9a-zA-Z]{4}[0-9]{14}$/.test(e);case"IT":return/^IT[0-9]{2}[A-Z]{1}[0-9]{10}[0-9a-zA-Z]{12}$/.test(e);case"LU":return/^LU[0-9]{5}[0-9a-zA-Z]{13}$/.test(e);case"NL":return/^NL[0-9]{2}[A-Z]{4}[0-9]{10}$/.test(e);case"PL":return/^PL[0-9]{26}$/.test(e);case"PT":return/^PT[0-9]{23}$/.test(e);case"SE":return/^SE[0-9]{22}$/.test(e)}return!1}var s={AT:{prefix:"AT",regex:/^ATU[0-9]{8}$/,examples:["ATU12345678"]},BE:{prefix:"BE",regex:/^BE(0?|1)[0-9]{9}$/,examples:["BE0123456789","BE1123456789","BE1234567890"]},BG:{prefix:"BG",regex:/^BG[0-9]{9,10}$/,examples:["BG123456789","BG1234567890"]},CH:{prefix:"CH",regex:/^CHE[0-9]{9}(TVA|MWST|IVA)$/,examples:["CHE123456789TVA","CHE123456789MWST","CHE123456789IVA"]},CY:{prefix:"CY",regex:/^CY[0-9]{8}[A-Z]$/,examples:["CY12345678X"]},CZ:{prefix:"CZ",regex:/^CZ[0-9]{8,10}$/,examples:["CZ12345678","CZ123456789","CZ1234567890"]},DE:{prefix:"DE",regex:/^DE[0-9]{9}$/,examples:["DE123456789"]},DK:{prefix:"DK",regex:/^DK[0-9]{8}$/,examples:["DK12345678"]},EE:{prefix:"EE",regex:/^EE[0-9]{9}$/,examples:["EE123456789"]},GR:{prefix:"EL",regex:/^EL[0-9]{9}$/,examples:["EL123456789"]},ES:{prefix:"ES",regex:/^ES([A-Z][0-9]{7}[0-9A-Z]|[0-9A-Z][0-9]{7}[A-Z])$/,examples:["ESX12345678","ES12345678X","ESX1234567X"]},FI:{prefix:"FI",regex:/^FI[0-9]{8}$/,examples:["FI12345678"]},FR:{prefix:"FR",regex:/^FR[0-9A-Z]{2}[0-9]{9}$/,examples:["FR12345678901","FRX1234567890","FR1X123456789","FRXX123456789"]},GB:{prefix:"GB",regex:/^GB([0-9]{9}|[0-9]{12}|GD[0-9]{3}|HA[0-9]{3})$/,examples:["GB123456789","GB123456789012","GBGD123","GBHA123"]},HR:{prefix:"HR",regex:/^HR[0-9]{11}$/,examples:["HR12345678901"]},HU:{prefix:"HU",regex:/^HU[0-9]{8}$/,examples:["HU12345678"]},IE:{prefix:"IE",regex:/^IE([0-9][0-9A-Z+*][0-9]{5}[A-Z]{1,2}|[0-9]{7}WI)$/,examples:["IE1X23456X","IE1X23456X","IE1234567XX"]},IT:{prefix:"IT",regex:/^IT[0-9]{11}$/,examples:["IT12345678901"]},LT:{prefix:"LT",regex:/^LT([0-9]{9}|[0-9]{12})$/,examples:["LT123456789","LT123456789012"]},LU:{prefix:"LU",regex:/^LU[0-9]{8}$/,examples:["LU12345678"]},LV:{prefix:"LV",regex:/^LV[0-9]{11}$/,examples:["LV12345678901"]},MT:{prefix:"MT",regex:/^MT[0-9]{8}$/,examples:["MT12345678"]},NL:{prefix:"NL",regex:/^NL[0-9]{9}B[0-9]{2}$/,examples:["NL123456789B01"]},NO:{prefix:"NO",regex:/^NO[0-9]{9}(MVA)?$/,examples:["NO123456789","NO123456789MVA"]},PL:{prefix:"PL",regex:/^PL[0-9]{10}$/,examples:["PL1234567890"]},PT:{prefix:"PT",regex:/^PT[0-9]{9}$/,examples:["PT123456789"]},RO:{prefix:"RO",regex:/^RO[0-9]{2,10}$/,examples:["RO12","RO1234567890"]},SE:{prefix:"SE",regex:/^SE[0-9]{12}$/,examples:["SE123456789012"]},SI:{prefix:"SI",regex:/^SI[0-9]{8}$/,examples:["SI12345678"]},SK:{prefix:"SK",regex:/^SK[0-9]{10}$/,examples:["SK1234567890"]}};t.validateVat=n,t.getVatPrefix=o,t.getVatExamples=r,t.validIBANForCountry=i}),define("modules/clean/photos/thumb_loading/batching_thumb_loader",["modules/clean/photos/batch_thumb_loader","modules/clean/photos/thumb_loading/utils"],function(e,t){var n,o;return o=t.load_individual_image,n=function(){function t(){this.batch_thumb_loader=new e({})}return t.prototype.get_request_id=function(){return this.batch_thumb_loader.vend_request_id()},t.prototype.load_image=function(e,t,n,o,r,i){return this.batch_thumb_loader.queue_thumb(e,this._thumb_loaded.bind(this,{url:e,request_id:t,success:o,error:r,should_retry:i}),{onrequest:n,request_id:t}),window.setTimeout(this.batch_thumb_loader.flush.bind(this.batch_thumb_loader,10))},t.prototype._thumb_loaded=function(e,t){var n,r,i,s,a;return a=e.url,r=e.request_id,s=e.success,n=e.error,i=e.should_retry,0===t.indexOf("data:")?s(t):o(a,0,s,n,i)},t.prototype.cancel_thumb=function(e){return this.batch_thumb_loader.cancel_thumb(e)},t}()}),define("modules/clean/photos/thumb_loading/generic_thumb_store",["modules/core/exception","modules/clean/photos/thumb_loading/http2_thumb_loader"],function(e,t){var n,assert;return assert=e.assert,n=function(){function e(e,n){this._loader_batches=null!=n?n:!1,this._thumb_url_to_data={},this._callbacks_by_request_id={},null!=e?this.thumb_loader=e:this.thumb_loader=new t}return e.prototype.is_batching=function(){return this._loader_batches},e.prototype.bind_url=function(e,t){var n,o,r,i,s,a,l,c;return r=t.onSuccess,n=t.onError,o=t.onRequest,assert(r,"missing onSuccess handler"),e in this._thumb_url_to_data?("function"==typeof o&&o(!0),r(!0),null):(l=this._get_request_id(),this._callbacks_by_request_id[l]={onSuccess:r,onError:n,onRequest:o},s=function(e){return function(){var t;return null!=(t=e._callbacks_by_request_id[l])&&"function"==typeof t.onRequest?t.onRequest(!1):void 0}}(this),a=function(t){return function(n){var o;return t._thumb_url_to_data[e]=n,null!=(o=t._callbacks_by_request_id[l])?o.onSuccess(!1):void 0}}(this),i=function(e){return function(){var t;return null!=(t=e._callbacks_by_request_id[l])&&"function"==typeof t.onError?t.onError():void 0}}(this),c=function(e){return function(){return l in e._callbacks_by_request_id}}(this),this.thumb_loader.load_image(e,l,s,a,i,c),l)},e.prototype._get_request_id=function(){return this.thumb_loader.get_request_id()},e.prototype.unbind_url=function(e){return null!=e?(delete this._callbacks_by_request_id[e],this.thumb_loader.cancel_thumb(e)):void 0},e.prototype.get_thumb=function(e){return e in this._thumb_url_to_data?this._thumb_url_to_data[e]:null},e}()}),define("modules/clean/photos/thumb_loading/http2_thumb_loader",["modules/clean/photos/thumb_loading/utils"],function(e){var t,n;return n=e.load_individual_image,t=function(){function e(){this._http2_request_id=0}return e.prototype.get_request_id=function(){var e;return e=this._http2_request_id,this._http2_request_id+=1,e},e.prototype.load_image=function(e,t,o,r,i,s){return o(),n(e,1,r,i,s)},e.prototype.cancel_thumb=function(e){},e}()}),define("modules/clean/photos/thumb_loading/utils",[],function(){var e;return e=function(e,t,n,o,r){var i;return i=new Image,i.onload=function(){return n(e)},i.onerror=function(){return t>0&&r()?(t-=1,i.src=e):o()},i.src=e},{load_individual_image:e}}),define("modules/clean/photos/thumb_store",["modules/constants/request","modules/clean/photos/thumb_loading/batching_thumb_loader","modules/clean/photos/thumb_loading/generic_thumb_store"],function(e,t,n){var o;return o=function(o){var r,i,s,a;return r=null!=(i=(null!=o?o:{}).allow_http2)?i:!1,s=void 0,a=e.IS_HTTP2&&r,a||(s=new t),new n(s,!a)}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/photos/thumbnail_url_util",["external/underscore","modules/constants/python","modules/core/exception","modules/core/uri"],function(e,t,n,o){var r,i,s,a;return r=t.THUMBNAIL_SIZE_MODE,i=t.THUMBNAIL_SIZES,a=function(t,s,a,l){var c,u;return n.assert(null!=s&&null!=a,"Width and height must both be specified or neither"),u=s+"x"+a,n.assert(indexOf.call(i,u)>=0,"Invalid thumbnail size ("+u+")"),c={size:u},null!=l&&(n.assert(indexOf.call(e.values(r),l)>=0,"Invalid thumbnail size mode ("+l+")"),c.size_mode=l),o.parse(t).updateQuery(c).toString()},s=function(e){return o.parse(e).updateQuery({size_mode:5}).toString()},{ThumbnailSizeMode:r,thumbnailUrlForSize:a,fullSizeUrl:s}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/previews/file_view_rams_common",["jquery","modules/constants/env","modules/core/browser","modules/core/uri"],function(e,t,n,o){var r;return r={RAMS_FULLSCREEN_TRANSITION_TIME_MSEC:1e3,_PDF_PREVIEW_DOMAINS:[t.DL_DOC_DOMAIN,t.BLOCK_CLUSTER,t.PUBSERVER,t.DL_DOC_USER_CONTENT_DOMAIN],enterRamsFullscreen:function(t){return t.addClass("rams-fullscreen").data("rams-fullscreen",!0),e(window).resize()},exitRamsFullscreen:function(t){return t.removeClass("rams-fullscreen").removeData("rams-fullscreen"),e(window).resize()},isRamsFullscreenActive:function(e){var t;return t=e.data("rams-fullscreen"),null!=t&&t},_isPdfPreviewDomain:function(e){return e=e.toLowerCase(),indexOf.call(this._PDF_PREVIEW_DOMAINS,e)>=0},_supportsNativePrinting:function(){return n.chrome||n.safari},getNativePrintUrl:function(e,t){var n,r;return this._supportsNativePrinting()?this._isPdfPreviewDomain(t)?(r=e.clone(),r.updateQuery({disable_range:1,from_native_print:1}),n=o.parse("https://"+t+"/nativeprint"),n.updateQuery({file:r}),n.toString()):(console.warn("Blocked attempt to load pdf native print for unexpected domain"),null):null}}}),define("modules/clean/previews/pdf_loader",["external/underscore","modules/clean/ajax","modules/clean/react/previews/frame_messenger_host","modules/clean/gandalf_util","modules/constants/file_viewer","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i,s){var a,l,c,u,d;return a=n.PreviewFrameMessengerHost,u=["exit-parent-fullscreen","failed","pagerendered","viewer-initialized","downloading","loaded","fully-loaded","viewer-ready","page-already-opened","page-rendered","page-repositioned","password-needed"],l="iframe.pdfjs",d=function(e){var t,n,o,r,i,s,a,l,c;t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{l=crypto.getRandomValues(new Uint8Array(e))}catch(e){o=e,l=[]}for(null==l&&(l=[]),s="",i=a=0,c=e;c>=0?c>a:a>c;i=c>=0?++a:--a)n=e===l.length?l[i]%t.length:Math.floor(Math.random()*t.length),s+=t[n];return s},c=function(){function n(){}return n.prototype._exitFullscreenCallback=null,n.prototype._frameMessenger=new a,n.prototype._fileUrl=null,n.prototype._isFullscreen=!1,n.prototype._options={},n.prototype._ducId=d(64),n.prototype.startListening=function(){return this._frameMessenger.configureChildMessaging(l,this.handleTrustedMesssageFromChild.bind(this),u),this._frameMessenger.startListening()},n.prototype.stopListening=function(){return this._frameMessenger.stopListening()},n.prototype.handleTrustedMesssageFromChild=function(e){switch(e.action){case"viewer-initialized":return this._onViewerInitialized();case"viewer-ready":if(this._isFullscreen)return this._sendEnterFullscreenAction();break;case"exit-parent-fullscreen":return this._isFullscreen=!1,"function"==typeof this._exitFullscreenCallback?this._exitFullscreenCallback():void 0;case"downloading":return this._onLoadAttempted();case"failed":return this._onFailed(e.parameters);case"pagerendered":return this._onFirstPageRendered(e.parameters);case"loaded":case"fully-loaded":return this._onLoaded(e.parameters);case"page-already-opened":return this._onPagePreloaded(e.parameters);case"page-rendered":return"function"==typeof this._onPageRendered?this._onPageRendered(e.parameters):void 0;case"page-repositioned":return this._onPageRepositioned(e.parameters);case"password-needed":return this._onPasswordNeeded()}},n.prototype.setExitFullscreenCallback=function(e){return this._exitFullscreenCallback=e},n.prototype.setIsFullscreen=function(e){return this._isFullscreen=e},n.prototype.setOnDownloadAttempted=function(e){return this._onDownloadAttempted=e},n.prototype.setOnDownloadSucceeded=function(e){return this._onDownloadSucceeded=e},n.prototype.setOnDownloadFailed=function(e){return this._onDownloadFailed=e},n.prototype.setOnFirstRenderSucceeded=function(e){return this._onFirstRenderSucceeded=e},n.prototype.setOnPageRendered=function(e){return this._onPageRendered=e},n.prototype.setOnRenderFailed=function(e){return this._onRenderFailed=e},n.prototype.setOnPageRepositioned=function(e){return this._onPageRepositioned=e},n.prototype.setOnPasswordNeeded=function(e){return this._onPasswordNeeded=e},n.prototype.repositionFile=function(e){
return null!=e?this._frameMessenger.postMessageToChildren("reposition-file",{scrollPosition:e}):void 0},n.prototype.openFile=function(n,a){var l,c,u,d,p;return null==a&&(a={}),this._hasDocumentDownloaded=!1,null!=n?(d=s.parse(n.toString()),p=d.getQuery(),e.defaults(a,{disableRange:!!i.safari_version_at_most(8),chunkSizeGandalf:"64000",minRangeSizeGandalf:r.DOCPREVIEW_DOC_RANGE_REQUEST,presentationMode:!1,dropboxDucId:"duc_id"in p?null:this._ducId,renderAtFirstPage:r.WEB_PDF_LOAD_FIRST_PAGE_ENABLED}),c=null,l=null,o.getGandalfRule("docpreview_debug_force_test_pdf")?c="test.pdf":o.getGandalfRule("docpreview_debug_force_test_deck_pdf")?c="test-deck.pdf":o.getGandalfRule("docpreview_debug_force_test_excel2_pdf")?c="test-excel2.pdf":"password_protected"===r.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION?l="riviera_exception_password":"too_big"===r.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION&&(l="riviera_exception_too_big"),null!=c?(p.canned_file_name=c,d.setQuery(p)):null!=l&&(p.canned_exception=l,d.setQuery(p)),0===d.getPath().toString().indexOf("/pri")?(u=d.getPath().toString().slice(8),d.setPath("/pri/get_content_url"),t.WebRequest({url:d.toString(),data:{path:u},success:function(e){return function(t){var n;return n=JSON.parse(t),e._finishOpenFile(n.url,a)}}(this)})):this._finishOpenFile(d,a)):void 0},n.prototype._finishOpenFile=function(e,t){return null==t&&(t={}),this._isNewFileUrl(e)?(this._fileUrl=e.toString(),this._options=t,this._sendOpenFileAction()):void 0},n.prototype._isNewFileUrl=function(e){return e.toString()!==this._fileUrl},n.prototype._sendOpenFileAction=function(){return this._frameMessenger.postMessageToChildren("open-file",{fileUrl:this._fileUrl,options:this._options})},n.prototype._sendEnterFullscreenAction=function(){return this._frameMessenger.postMessageToChildren("enter-fullscreen")},n.prototype._onViewerInitialized=function(){return this._sendOpenFileAction()},n.prototype._onLoadAttempted=function(){return this._onDownloadAttempted()},n.prototype._onLoaded=function(e){return"function"==typeof this._onDownloadSucceeded&&this._onDownloadSucceeded({size:e.size,pageCount:e.pageCount,isLinearized:e.isLinearized}),this._hasDocumentDownloaded=!0},n.prototype._onFirstPageRendered=function(e){var t;return null==e&&(e={}),"function"==typeof this._onFirstRenderSucceeded?this._onFirstRenderSucceeded({pageRendered:null!=(t=e.attributes)?t.page:void 0}):void 0},n.prototype._onFailed=function(e){var t;return this._hasDocumentDownloaded?"function"==typeof this._onRenderFailed?this._onRenderFailed():void 0:(t={rivieraStatus:null!=e?e.rivieraStatus:void 0},"function"==typeof this._onDownloadFailed?this._onDownloadFailed(t):void 0)},n.prototype._onPagePreloaded=function(e){var t;return this._onLoadAttempted(),e.isLoaded&&(this._onLoaded(e),e.isRendered&&(t={attributes:e},this._onFirstPageRendered(t))),e.isPasswordNeeded&&this._onPasswordNeeded(),e.hasFailed?this._onFailed(e.failureParameters):void 0},n}()}),define("modules/clean/previews/pending_upload_watcher",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/actions","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i){"use strict";var s=2e3,a=function(){function e(e,t,n){void 0===n&&(n=""),this.linkType=e,this.pollUrl=new i({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);return t.hasOwnProperty("upload_status")&&"complete"===t.upload_status?void o.pendingFileUploaded():void setTimeout(this.pollPending.bind(this),s)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():r.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),s)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e}();t.PendingUploadWatcher=a}),define("modules/clean/previews/preview_actions_helper",["jquery","modules/clean/previews/file_view_rams_common","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/store","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i,s,a){var l,c,u;return c=n.PreviewHelper,u=r.PreviewRenderStatuses,l=function(){function e(){}return e.getIframeQuery=function(){return".react-file-viewer__preview iframe"},e.tryNativePdfPrint=function(e,n){var o;return o=t.getNativePrintUrl(e,n),null==o?!1:(window.open(o,"_blank"),!0)},e.nativePdfPrintFromSharedLink=function(t,n){var o,r;return r=a.parse(t||s.get_href()),r.setQuery({preview:1}),o=a.parse(n).getAuthority(),e.tryNativePdfPrint(r,o)},e.nativePdfPrint=function(t){var n,o,r,i,s;return null!=t.preview_type?(o=t,(r="doc"!==(s=o.preview_type)&&"adobecs"!==s)?!1:(i=c.get_progressive_url("doc",o.href),n=a.parse(i).getAuthority(),e.tryNativePdfPrint(i,n))):!1},e.enterFullscreen=function(){return o.openFullscreen(),!1},e.exitFullscreen=function(){return o.closeFullscreen(),!1},e.isFullscreen=function(){return i.isFullscreen()},e.broadcastRenderSucceeded=function(){return o.broadcastPreviewRenderStatus(u.SUCCEEDED)},e}(),{PreviewActions:l}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/previews/preview_status_watcher",["modules/constants/legacy","modules/core/uri","modules/clean/ajax"],function(e,t,n){var o;return o=function(){function o(){this._onCheckError=bind(this._onCheckError,this),this._onCheckSuccess=bind(this._onCheckSuccess,this),this._check=bind(this._check,this)}return o.TIMEOUT=1e3,o.MAX_TRIES=5,o.prototype._statusRequest=null,o.prototype._statusTimeout=null,o.prototype._statusTries=0,o.prototype.onSuccess=null,o.prototype.onError=null,o.prototype.userId=0,o.prototype.start=function(e,n,o,r){return this.userId=e,this.onSuccess=o,this.onError=r,this.url=t({path:"/doc_preview_status"+n}).toString(),this._check()},o.prototype.stop=function(){return this.reset()},o.prototype.reset=function(){var e;return null!=(e=this._statusRequest)&&e.abort(),this._statusRequest=null,clearTimeout(this._statusTimeout),this._statusTimeout=null,this._statusTries=0},o.prototype._check=function(){return this._statusTries>=o.MAX_TRIES?void("function"==typeof this.onError&&this.onError()):(this._statusTries++,this._statusRequest=n.WebRequest({url:this.url,subject_user:this.userId,success:this._onCheckSuccess,error:this._onCheckError}))},o.prototype._onCheckSuccess=function(t,n,r){switch(parseInt(t,10)){case e.DOC_PREVIEW_AVAILABLE:return"function"==typeof this.onSuccess?this.onSuccess():void 0;case e.DOC_PREVIEW_IN_PROGRESS:return this._statusTimeout=setTimeout(this._check,o.TIMEOUT);default:return"function"==typeof this.onError?this.onError():void 0}},o.prototype._onCheckError=function(e,t,n){return"function"==typeof this.onError?this.onError():void 0},o}()});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/previews/util",["modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/gandalf_util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/constants/comments_panel","modules/constants/env","modules/constants/file_viewer","modules/constants/legacy","modules/constants/static","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E;return v=t.UserActivityLogger,E=n.getActingTime,g=i.SourceContext,h=s.ErrorTypes,f=s.RivieraPreviewResponseTypes,_={is_annotation_marker_enabled:function(){return a.ALLOW_ANNOTATION_MARKER},use_excel2_for_extension:function(e){return null==e&&(e=""),m.is_excel2_file(e)&&r.getGandalfRule("docpreview_excel2")},is_pass_enabled:function(e){return c.FILE_VIEWER_PASS_ENABLED&&!!(null!=e?e.is_team:void 0)},use_hls_video:function(){return c.FILE_VIEWER_VIDEO_USE_HLS}},m={get_extension:function(e){return o.file_extension(e.fq_path||e.filename)},get_filename:function(e){return o.filename(e.fq_path||e.filename)},normalize_extension:function(e){var t;if("indd"===e)return e;switch(t=e.substring(0,3)){case"rtf":case"odt":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}},is_excel2_file:function(e){var t;return"xls"===(t=e.substring(0,3))||"csv"===t||"ods"===t},get_progressive_url:function(e,t){var n,o,r;return n=m.normalize_extension(e),r=p.parse(t),"xls"!==n||_.use_excel2_for_extension(n)||(o="xls/preview"),null!=o&&(r.setPath(r.getPath().replace("/pri/get/","/get/")),r.setPath(r.getPath().replace("/get/","/"+o+"/"))),r=r.updateQuery({get_preview:1})},get_pdf_js_url:function(e,t){return e=_.use_excel2_for_extension(t)?p.parse(d.static_url_pdfjs_excel):p.parse(d.static_url_pdfjs_viewer)},getModifierString:function(e){return E(1e3*e.ts)},_getVersionHistoryUrl:function(e,t){var n;return n=p({path:"/history"+e.fq_path}),this.update_url_with_user_id(n,t.id)},redirectToVersionHistory:function(t,n){var o;return v.log("web","view_version_history"),o=m._getVersionHistoryUrl(t,n),e.redirect(o)},update_url_for_annotation:function(e){return _.is_annotation_marker_enabled()&&(e=e.updateQuery("annotation_marker","1")),e=e.updateQuery("annotation_highlight","1"),e=e.updateQuery("annotation_region","1")},update_url_with_user_id:function(e,t){return e.updateQuery("_subject_uid",t)},VALID_PREVIEW_TYPES:["photo","video","linkfile","adobecs","doc","excel","html","text","audio","archive"],extensionSupported:function(e){var t;return t=e.preview_type,indexOf.call(this.VALID_PREVIEW_TYPES,t)>=0},filesizeSupported:function(e){var t,n,o;return t=m.get_extension(e),n=e.bytes,o=Number.MAX_VALUE,"pdf"===t?o=u.MAX_PDF_FILE_SIZE_B:"text"===e.preview_type?o=u.MAX_TEXT_FILE_SIZE_B:"linkfile"===e.preview_type?o=u.MAX_LINKFILE_SIZE_B:n=0,o>n},isEmptyFile:function(e){return 0===e.bytes},isPreviewable:function(e){return m.extensionSupported(e)&&m.filesizeSupported(e)},canGeneratePreview:function(e){var t;return t=m.get_extension(e),m.isPreviewable(e)&&m.extCanGeneratePreview(t)},extCanGeneratePreview:function(e){var t;return t=m.normalize_extension(e),"doc"===t||"ppt"===t||"xls"===t||"key"===t||"eps"===t||"ai"===t||"indd"===t},usesFrameMessenger:function(e){return"excel"===e||"text"===e||"doc"===e},determineSourceContext:function(){var t;return t=e.get_uri().path,/^\/(home|work|personal|search)/.test(t)?g.BROWSE:/^\/(s|scl\/fi)\//.test(t)?g.SHARED_LINK_FILE:/^\/(sh|scl\/fo)\//.test(t)?g.SHARED_LINK_FOLDER:/^\/sc\//.test(t)?g.SHARED_LINK_COLLECTION:/^\/history/.test(t)?g.VERSION_HISTORY:null},mapRivieraStatusToErrorType:function(e){var t;return t=h.LOAD_ERROR,e===f.UNSUPPORTED_FORMAT?t=h.EXTENSION_ERROR:e===f.TOO_BIG?t=h.FILE_SIZE_ERROR:e===f.PASSWORD_PROTECTED&&(t=h.PASSWORD_PROTECTED_ERROR),t}},y=function(e){var t;return t=e.lastIndexOf("_"),t>=0?parseInt(e.substr(t+1),10)||null:null},{PermissionHelper:_,PreviewHelper:m,extractLastNumberFromVariant:y}}),define("modules/clean/raf_throttle",["require","exports"],function(e,t){"use strict";var n=function(){function e(e){var t=this;this.request=function(){t.ticking||(t.ticking=!0,t.currentRequestId=requestAnimationFrame(function(){t.thunk(),t.ticking=!1}))},this.cancelPending=function(){cancelAnimationFrame(t.currentRequestId)},this.thunk=e}return e}();t.RafThrottle=n}),define("modules/clean/react/account_menu/account_info",["external/components","external/react","modules/clean/react/account_menu/avatar","modules/core/i18n"],function(e,t,n,o){var r,i,s,a,l,c,u,d,p;return s=e.Button,i=n.AccountMenuAvatar,a=o._,p=t.DOM,l=p.a,c=p.button,d=p.div,u=t.createElement,r=t.createClass({displayName:"AccountInfo",propTypes:{accountPhotoUrl:t.PropTypes.string,userDisplayName:t.PropTypes.string.isRequired,isAccountPhotoEnabled:t.PropTypes.bool.isRequired,isMaestroDesign:t.PropTypes.bool,onClickChangeAvatar:t.PropTypes.func},getDefaultProps:function(){return{isMaestroDesign:!1}},render:function(){return this.props.isMaestroDesign?d({className:"account-info"},c({className:"account-info-change-avatar-button",onClick:this.props.onClickChangeAvatar},u(i,{photoUrl:this.props.accountPhotoUrl,dimension:32,alt:a("Account photo")})),d({className:"account-info-text"},d({className:"account-info-name"},this.props.userDisplayName),this.props.accountPhotoUrl?void 0:c({onClick:this.props.onClickChangeAvatar,className:"button-as-link account-info-add-avatar-prompt"},a("Add account photo")))):d({className:"account-info"},d({className:"o-flag"},d({className:"o-flag__fix"},this.props.isAccountPhotoEnabled?u(i,{photoUrl:this.props.accountPhotoUrl,dimension:24,alt:a("Account photo")}):void 0),d({className:"o-flag__flex"},d({className:"account-info-name"},this.props.userDisplayName))))}})}),define("modules/clean/react/account_menu/account_menu",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/event_handler","modules/clean/react/account_menu/account_menu_contents","modules/clean/react/account_menu/avatar","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/sprite","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){"use strict";var h=18,_=function(t){function i(){var n=null!==t&&t.apply(this,arguments)||this;return n.state={accountPhotoUrl:n.props.accountPhotoUrl||n.props.user.photo_circle_url,isDisabled:!0},n.handleChangeAvatar=function(){n.refs.dropdown.getWrappedComponent().hideDropdown(),e(["modules/clean/account_photo_modal/controller"],function(e){var t=e.show;return t()})},n.getTargetButtonText=function(){var e,t=n.props.user;return e=t.display_name.length<=h?t.display_name:t.familiar_name,r.em_snippet(e,h)},n}return n.__extends(i,t),i.prototype.componentDidMount=function(){var e=this;this.events.on(document,"db:account_photo:photo_set",function(t,n){var o=2*(e.props.isMaestroDesign?32:24),r=o+"x"+o,i=p.parse(n.saved_photo_url).updateQuery({size:r}).toString();e.setState({accountPhotoUrl:i})}),this.events.on(document,"db:account_photo:photo_deleted",function(){e.setState({accountPhotoUrl:null})}),this.setState({isDisabled:!1})},i.prototype.render=function(){var e,t,n=this.state,r=n.isDisabled,i=n.accountPhotoUrl,c=this.props,p=c.dropdownHorizontalDisplacement,h=c.isAccountPhotoEnabled,_=c.isMaestroDesign,m=c.isToolbarAccountPhotoEnabled,f=c.logoutContinuationPath,g=c.onClick,v=c.onSelectUser,y=c.openLinksInNewTab,E=c.position,b=c.shouldArrowDecrement,S=c.showAccountSwitcher,w=c.showBusinessUpgradeLink,T=c.showInstallLink,C=c.showNameOnButton,I=c.showProGiftingLink,P=c.showProUpgradeLink,A=c.showLimitedTeamUpgradeLink,N=c.showSettingsLink,O=c.user,R=c.viewer;h&&m&&(e=o.createElement(a.AccountMenuAvatar,{photoUrl:i,dimension:_?32:24})),C&&(t=o.createElement("span",null,o.createElement("span",{className:"account-menu__name u-mar-left-xs"},this.getTargetButtonText()),o.createElement(u,{alt:"",group:"web",name:"control_menu",className:"u-mar-left-xxs"})));var k=o.createElement("button",{className:"button-as-link account-menu-target notification-button",title:d._("Account menu"),onClick:g,disabled:r},e,t);return o.createElement(l,{ref:"dropdown",targetButton:k,targetFixed:!0,position:E,className:"account-menu",horizontalDisplacement:p,shouldArrowDecrement:b,isMaestroDesign:_},o.createElement(s,{accountPhotoUrl:i,isAccountPhotoEnabled:h,logoutContinuationPath:f,openLinksInNewTab:y,showBusinessUpgradeLink:w,showInstallLink:T,showProGiftingLink:I,showProUpgradeLink:P,showLimitedTeamUpgradeLink:A,showSettingsLink:N,showAccountSwitcher:S,onSelectUser:v,viewer:R,user:O,isMaestroDesign:_,onClickChangeAvatar:this.handleChangeAvatar}))},i}(o.Component);_.defaultProps={accountPhotoUrl:null,position:l.POSITIONS.BOTTOM,dropdownHorizontalDisplacement:0,isAccountPhotoEnabled:!0,isMaestroDesign:!1,isToolbarAccountPhotoEnabled:!0,openLinksInNewTab:!0,showNameOnButton:!0,showAccountSwitcher:!1,shouldArrowDecrement:!0},_=n.__decorate([i.eventHandler],_);var m=c(_,["/static/css/account_menu_common-vflylwKvy.css","/static/css/pagelet-vfloDlUgY.css"]);t.AccountMenu=m}),define("modules/clean/react/account_menu/account_menu_contents",["external/react","modules/clean/react/account_menu/business_upgrade_link","modules/clean/react/account_menu/avatar","modules/clean/react/account_menu/account_info","modules/clean/react/account_menu/account_switcher","modules/clean/react/account_menu/install_link","modules/clean/react/account_menu/logout_link","modules/clean/react/account_menu/pro_gifting_link","modules/clean/react/account_menu/pro_upgrade_link","modules/clean/react/account_menu/limited_team_plans_upgrade_link","modules/clean/react/account_menu/settings_link"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g,v,y,E,b,S,w,T;return d=e.createFactory(o),h=e.createFactory(r),_=e.createFactory(t),m=e.createFactory(i),g=e.createFactory(s),v=e.createFactory(a),y=e.createFactory(l),f=e.createFactory(c),E=e.createFactory(u),w=e.DOM,b=w.div,S=w.li,T=w.ul,p=e.createClass({displayName:"AccountMenuContents",propTypes:{accountPhotoUrl:e.PropTypes.string,isAccountPhotoEnabled:e.PropTypes.bool,logoutContinuationPath:e.PropTypes.string,openLinksInNewTab:e.PropTypes.bool,showBusinessUpgradeLink:e.PropTypes.bool,showInstallLink:e.PropTypes.bool,showProGiftingLink:e.PropTypes.bool,showProUpgradeLink:e.PropTypes.bool,showLimitedTeamUpgradeLink:e.PropTypes.bool,showSettingsLink:e.PropTypes.bool,showAccountSwitcher:e.PropTypes.bool,onSelectUser:e.PropTypes.func,viewer:e.PropTypes.object,user:e.PropTypes.object.isRequired,isMaestroDesign:e.PropTypes.bool,onClickChangeAvatar:e.PropTypes.func},getDefaultProps:function(){return{accountPhotoUrl:null,isAccountPhotoEnabled:!0,logoutContinuationPath:null,openLinksInNewTab:!1,showBusinessUpgradeLink:!1,showInstallLink:!0,showProGiftingLink:!1,showProUpgradeLink:!1,showLimitedTeamUpgradeLink:!1,showSettingsLink:!0,showAccountSwitcher:!1,isMaestroDesign:!1}},_renderAccountSwitcher:function(){return h({user:this.props.user,viewer:this.props.viewer,onSelectUser:this.props.onSelectUser})},_renderInstallLink:function(){return S({className:"link-item"},m({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderLogoutLink:function(){return S({className:"link-item"},g({continuationPath:this.props.logoutContinuationPath}))},_renderBusinessUpgradeLink:function(){return S({className:"link-item"},_({openLinksInNewTab:this.props.openLinksInNewTab,isLimitedTeam:this.props.viewer.team_is_limited}))},_renderProUpgradeLink:function(){return S({className:"link-item"},y({openLinksInNewTab:this.props.openLinksInNewTab,isLimitedTeam:this.props.viewer.team_is_limited}))},_renderLimitedTeamUpgradeLink:function(){return S({className:"link-item"},f({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderProGiftingLink:function(){return S({className:"link-item"},v({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderSettingsLink:function(){return S({className:"link-item"},E({openLinksInNewTab:this.props.openLinksInNewTab}))},render:function(){return b({className:"dropdown-content-wrapper"},d({userDisplayName:this.props.user.display_name,isAccountPhotoEnabled:this.props.isAccountPhotoEnabled,accountPhotoUrl:this.props.accountPhotoUrl,isMaestroDesign:this.props.isMaestroDesign,onClickChangeAvatar:this.props.onClickChangeAvatar}),this.props.showAccountSwitcher?this._renderAccountSwitcher():void 0,T({className:"links"},this.props.showSettingsLink?this._renderSettingsLink():void 0,this.props.showInstallLink?this._renderInstallLink():void 0,this.props.showProUpgradeLink?this._renderProUpgradeLink():void 0,this.props.showLimitedTeamUpgradeLink?this._renderLimitedTeamUpgradeLink():void 0,this.props.showBusinessUpgradeLink?this._renderBusinessUpgradeLink():void 0,this.props.showProGiftingLink?this._renderProGiftingLink():void 0),T({className:"links"},this._renderLogoutLink()))}})}),define("modules/clean/react/account_menu/account_switcher",["external/react","modules/constants/env","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r){var i,s,a,l,c;return s=o._,c=e.DOM,l=c.div,a=c.button,i=e.createClass({displayName:"AccountSwitcher",propTypes:{viewer:e.PropTypes.object,user:e.PropTypes.object,onSelectUser:e.PropTypes.func},_renderEntry:function(e){return a({className:e.is_active?"user-entry active":"user-entry inactive",onClick:e.select_fn?function(t){return e.select_fn(t,e.id)}:void 0,key:e.id,role:"menuitemradio","aria-checked":e.is_active},l({className:"user-entry-name u-ellip"},e.title),l({className:"user-entry-email u-ellip"},e.text))},renderUserEntry:function(e){var t;return t=this.props.user.id===e.id,this._renderEntry({id:e.id,text:e.email,title:s("personal"===e.role?"Personal":"Work"),is_active:t,select_fn:t?null:this.props.onSelectUser})},renderUnpairedUserEntry:function(e){var t;return t="personal"===e,this._renderEntry({id:t?"/personal":"/team",text:s(t?"Add a personal Dropbox":"Add a work Dropbox"),title:s(t?"Personal":"Work"),is_active:!1,select_fn:function(e,t){return n.redirect(r({path:t}))}})},render:function(){var e,t;return l({className:"account-switcher"},function(){var n,o,r,i;for(r=["work","personal"],i=[],n=0,o=r.length;o>n;n++)e=r[n],t=this.props.viewer.get_user_by_role(e,!0),t?i.push(this.renderUserEntry(t)):i.push(this.renderUnpairedUserEntry(e));return i}.call(this))}})}),define("modules/clean/react/account_menu/avatar",["require","exports","tslib","external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/faceholder"],function(e,t,n,o,r,i){"use strict";var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.alt,n=e.photoUrl,s=e.dimension;return n?o.createElement(r,{alt:t,dimension:s,photoUrl:n}):o.createElement(i,{dimension:s,alt:t})},t}(o.PureComponent);t.AccountMenuAvatar=s}),define("modules/clean/react/account_menu/business_upgrade_link",["external/react","modules/core/i18n","modules/core/uri","modules/constants/python"],function(e,t,n,o){var r,i,s,a;return s=t._,i=o.TRADEMARK_BUSINESS,a=e.DOM.a,r=e.createClass({displayName:"BusinessUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool,isLimitedTeam:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1,isLimitedTeam:!1}},_getUpgradeUrl:function(){var e,t;return this.props.isLimitedTeam?(e="/team/upgrade",t={tk:"teams",oqa:"drop_down_menu"}):(e="/business",t={}),new n({scheme:"https",authority:"www.dropbox.com",path:e,query:t})},render:function(){return a({href:this._getUpgradeUrl(),className:"link",tabIndex:0,target:this.props.openLinksInNewTab?"_blank":"",rel:"noopener"},s("Try %(trademark_business)s").format({trademark_business:i}))}})}),define("modules/clean/react/account_menu/install_link",["external/react","modules/core/i18n","modules/core/uri"],function(e,t,n){var o,r,i;return r=t._,i=e.DOM.a,o=e.createClass({displayName:"InstallLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getInstallUrl:function(){return new n({scheme:"https",authority:"www.dropbox.com",path:"/install"})},render:function(){return i({href:this._getInstallUrl(),className:"link",tabIndex:0,target:this.props.openLinksInNewTab?"_blank":"",rel:"noopener"},r("Install"))}})}),define("modules/clean/react/account_menu/limited_team_plans_upgrade_link",["external/react","modules/core/i18n","modules/core/uri"],function(e,t,n){var o,r,i;return r=t._,i=e.DOM.a,o=e.createClass({displayName:"LimitedTeamPlansUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getUpgradeUrl:function(){return new n({scheme:"https",authority:"www.dropbox.com",path:"/plans",query:{tk:"teams",oqa:"drop_down_menu"}})},render:function(){return i({href:this._getUpgradeUrl(),className:"link",tabIndex:0,target:this.props.openLinksInNewTab?"_blank":"",rel:"noopener"},r("Upgrade"))}})}),define("modules/clean/react/account_menu/logout_link",["external/react","modules/core/i18n","modules/core/uri"],function(e,t,n){var o,r,i;return r=t._,i=e.DOM.a,o=e.createClass({displayName:"LogoutLink",propTypes:{continuationPath:e.PropTypes.string},_getLogoutUrl:function(){var e;return e=new n({scheme:"https",authority:"www.dropbox.com",path:"/logout",query:{cont:this.props.continuationPath}})},render:function(){return i({href:this._getLogoutUrl(),tabIndex:0,className:"link"},r("Sign out"))}})}),define("modules/clean/react/account_menu/pro_gifting_link",["external/react","modules/core/i18n","modules/core/uri","modules/constants/python"],function(e,t,n,o){var r,i,s,a;return s=t._,i=o.TRADEMARK_PLUS,a=e.DOM.a,r=e.createClass({displayName:"ProGiftingLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getGiftingUrl:function(){return new n({scheme:"https",authority:"www.dropbox.com",path:"/gift",query:{trigger:"dropdown"}})},render:function(){return a({href:this._getGiftingUrl(),tabIndex:0,className:"link",target:this.props.openLinksInNewTab?"_blank":"",rel:"noopener"},s("Gift Dropbox %(trademark_plus)s").format({trademark_plus:i}))}})}),define("modules/clean/react/account_menu/pro_upgrade_link",["external/react","modules/core/i18n","modules/core/uri"],function(e,t,n){var o,r,i;return r=t._,i=e.DOM.a,o=e.createClass({displayName:"ProUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool,isLimitedTeam:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1,isLimitedTeam:!1}},_getUpgradeUrl:function(){var e,t;return this.props.isLimitedTeam?(e="/upgrade",t={tk:"teams",oqa:"drop_down_menu"}):(e="/pro/buy",t={trigger:"direct"}),new n({scheme:"https",authority:"www.dropbox.com",path:e,query:t})},render:function(){return i({href:this._getUpgradeUrl(),className:"link",tabIndex:0,target:this.props.openLinksInNewTab?"_blank":"",rel:"noopener"},r("Upgrade"))}})}),define("modules/clean/react/account_menu/settings_link",["external/react","modules/core/i18n","modules/core/uri"],function(e,t,n){var o,r,i;return r=t._,i=e.DOM.a,o=e.createClass({displayName:"SettingsLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getSettingsUrl:function(){return new n({scheme:"https",authority:"www.dropbox.com",path:"/account"})},render:function(){return i({href:this._getSettingsUrl(),className:"link",tabIndex:0,target:this.props.openLinksInNewTab?"_blank":"",rel:"noopener"},r("Settings"))}})}),define("modules/clean/react/browse/action_logger",["modules/clean/web_user_action_logger","modules/clean/react/browse/store"],function(e,t){var n,o,r,i,s;return i=e.WebUserActionLog,s=e.WebUserActionLogEvents,r=t.BrowseStore,n={MAESTRO_RIGHT_SIDEBAR:"MAESTRO_RIGHT_SIDEBAR",LEGACY_CONTEXT_MENU:"LEGACY_CONTEXT_MENU",LEGACY_HEADER_ACTIONS:"LEGACY_HEADER_ACTIONS",DRAG:"DRAG"},o=function(){function e(){}return e.prototype._countFilesAndFolders=function(){var e,t,n;return n=r.selectedFiles().toArray(),e=n.filter(function(e){return e.is_dir}).length,t=n.filter(function(e){return!e.is_dir}).length,{num_files:t,num_dirs:e}},e.prototype._logGeneralAction=function(e,t,n,o,r){var s,a,l;return l=this._countFilesAndFolders(),a=l.num_files,s=l.num_dirs,i.log(e,r,{num_files_selected:a,num_folders_selected:s,source:o})},e.prototype.logSelectRow=function(e){var t,n;return n=e.uid,t=e.entity_type,i.log(n,s.SELECT_ROW,{entity_type:t})},e.prototype.logOpenRow=function(e){var t,n;return n=e.uid,t=e.entity_type,i.log(n,s.OPEN_ROW,{entity_type:t})},e.prototype.logUploadFile=function(e){var t,n,o,r,a;return o=e.uid,n=e.num_files,t=e.num_dirs,a=e.uploader_type,r=e.upload_method,i.log(o,s.UPLOAD_FILE,{num_files:n,num_dirs:t,uploader_type:a,upload_method:r})},e.prototype.logCreateFolder=function(e){var t;return t=e.uid,i.log(t,s.CREATE_FOLDER,{})},e.prototype.logViewShareModel=function(e){var t,n;return n=e.uid,t=e.modal_session_id,i.log(n,s.VIEW_SHARE_MODEL,{modal_session_id:t})},e.prototype.logToggleDeletedFiles=function(e){var t,n;return n=e.uid,t=e.show_deleted_files,i.log(n,s.TOGGLE_DELETED_FILES,{show_deleted_files:t})},e.prototype.logSortRecords=function(e){var t,n,o;return o=e.uid,t=e.sort_by,n=e.sort_direction,i.log(o,s.SORT_RECORDS,{sort_by:t,sort_direction:n})},e.prototype.logVersions=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.VERSIONS)},e.prototype.logOpenMoveModal=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.OPEN_MOVE_MODAL)},e.prototype.logMoveFiles=function(e){var t,n,o,r,i;return i=e.uid,o=e.path,t=e.files,n=e.newPath,r=e.source,this._logGeneralAction(i,o,t,r,s.MOVE)},e.prototype.logRenameFiles=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.RENAME)},e.prototype.logAddComment=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.ADD_COMMENT)},e.prototype.logDownload=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.DOWNLOAD)},e.prototype.logOpenCopyModal=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.OPEN_COPY_MODAL)},e.prototype.logCopyFiles=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.COPY)},e.prototype.logDeleteFiles=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.DELETE)},e.prototype.logPermanentDeleteFiles=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.PERMANENT_DELETE)},e.prototype.logViewInPhotos=function(e){var t,n,o,r;return r=e.uid,n=e.path,t=e.files,o=e.source,this._logGeneralAction(r,n,t,o,s.VIEW_IN_PHOTOS)},e}(),{BrowseLogger:new o,BrowseLogEventSources:n}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/browse/actions",["jquery","external/underscore","modules/clean/browse_interface","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/file_modal_controller","modules/clean/react/file_viewer/controller","modules/clean/react/selectable_list","modules/clean/sharing/ui_util","modules/constants/python","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T){var C,I,P,A,N,O,R,k,D,L,M,F,x,U,B;return C=u.BrowseActionTypes,k=u.LoadingStates,D=u.REACT_FILE_VIEWER_ELEMENT_ID,L=u.SEARCH_PREFIX,P=d.BrowseContext,N=d.File,A=p.BrowseStore,O=h.FileModalController,U=m.createSelection,R=f.GoldenGate,M=S._,B=S.ungettext,F=[".maestro-chrome","#maestro-nav","#page-footer","#page-header","#page-sidebar","#browse-box",".growth-onboarding-progress-bar__container",".team-progress-bar-experience","#flash-upload-container"].join(),x=function(t){var n,o,r,i,s,a,l,c,u,d,p,h;return o=t.files,r=t.indexOfPreviewFile,h=t.user,d=t.shouldFocusComment,p=null!=(a=t.updateBrowserLocation)?a:!0,i=null!=(l=t.onCloseViewer)?l:function(){return{}},s=null!=(c=t.onViewerUnmount)?c:function(){return{}},n=null!=(u=t.fileViewAction)?u:g.FileViewActionType.CLICK,_.open(o,r,h,D,{fileViewTarget:g.FileViewTargetType.PRIVATE,fileViewOrigin:g.FileViewOriginType.BROWSE,fileViewAction:n,shouldFocusCommentInput:d,disableRouting:!p,onCloseViewer:i,onComponentDidMount:function(){return e(F).hide()},onComponentWillUnmount:function(){return e(F).show(),s()}})},new(I=function(){function u(){this.computeAndApplyDeltasFromNotServer=bind(this.computeAndApplyDeltasFromNotServer,this),
this.pasteClipboardFilesToCurrentPath=bind(this.pasteClipboardFilesToCurrentPath,this)}return u.prototype.initializeEverything=function(e){var t,n,o,r,i,a,l,c,u,d;return d=e.user,a=e.path,n=e.files,u=e.urlPrefix,t=e.context,i=e.mountPoints,l=e.shouldShowDeletedFiles,o=e.fqPathsToSelect,r=e.loadingState,c=e.teamFolders,s.dispatch({type:C.INITIALIZE_EVERYTHING,data:{user:d,path:a,files:n,urlPrefix:u,context:t,mountPoints:i,shouldShowDeletedFiles:l,fqPathsToSelect:o,loadingState:r,teamFolders:c}})},u.prototype._dataApi=c,u.prototype.load=function(e){var t,n,o;return o=e.path,n=e.files,t=e.context,s.dispatch({type:C.LOAD_PATH,data:{path:o,files:n,context:t}})},u.prototype.add=function(e){var t,n;return n=e.path,t=e.files,s.dispatch({type:C.ADD_FILES,data:{path:n,files:t}})},u.prototype.setContextFile=function(e){var t;return t=e.file,s.dispatch({type:C.SET_CONTEXT_FILE,data:{file:t}})},u.prototype.setLoadingState=function(e){var t,n;return t=e.loadingState,n=e.path,s.dispatch({type:C.SET_LOADING_STATE,data:{loadingState:t,path:n}})},u.prototype.setMountPoints=function(e){var t;return t=e.mountPoints,s.dispatch({type:C.SET_MOUNT_POINTS,data:{mountPoints:t}})},u.prototype.setTeamFolders=function(e){var t;return t=e.teamFolders,s.dispatch({type:C.SET_TEAM_FOLDERS,data:{teamFolders:t}})},u.prototype.setPath=function(e){var t,n,o,r,i;return r=e.path,o=e.onPathLoaded,n=e.nsId,s.dispatch({type:C.SET_PATH,data:{path:r}}),this.setLoadingState({loadingState:k.LOADING_FIRST_PAGE,path:r}),i=A.user().id,t=function(e){return function(t){var n,s,a,c,u,d;return a=t.path,s=t.data,e.setMountPoints({mountPoints:s.ns_id_to_mount_point}),e.setTeamFolders({teamFolders:s.team_folders_js_info}),n=P.fromServerObject(s),s.paginated?(e.setLoadingState({loadingState:k.LOADING_REMAINING_PAGES,path:r}),e.load({path:a,files:[],context:n}),c=function(t,n){return e.add({path:a,files:n}),t.areAllItemsReady()?(e.setLoadingState({loadingState:k.LOADED,path:r}),t.stopAutoFetching()):void 0},u=new l,u.initialize(s.first_page,"sjid","/browse_get_next",i,c),u.startAutoFetching()):(d=s.file_info,e.load({path:a,files:d,context:n}),e.setLoadingState({loadingState:k.LOADED,path:r})),"function"==typeof o?o():void 0}}(this),this._dataApi.loadPath({path:r,userId:i,sortFoldersFirst:!y.mac,includeDeletedFiles:A.shouldShowDeletedFiles(),nsId:n,onSuccess:t,onError:function(e){return function(){return"/"!==r?e.setPath({path:"/",onPathLoaded:o}):void 0}}(this)})},u.prototype.reloadCurrentPath=function(){return this.setPath({path:A.path()})},u.prototype.setUser=function(e){var t;return t=e.user,s.dispatch({type:C.SET_USER,data:{user:t}})},u.prototype.updatePreview=function(e){var t;return t=e.files,_.updateFiles(t)},u.prototype.closeFileViewer=function(){return _.close()},u.prototype.setUrlPrefix=function(e){var t;return t=e.prefix,s.dispatch({type:C.SET_URL_PREFIX,data:{prefix:t}})},u.prototype.setUrl=function(e){var t,o,r,i,l,c;t=e.path,o=e.prefix,r=e.qargs,o===L?(c=A.user(),l="work"===c.role?n.WORK_ROOT:n.PERSONAL_ROOT,o+=l,a.push_state(o,r)):(i={},"1"===a.deconstruct_url().qargs.d&&(i.d="1"),a.push_state(A.urlPrefix()+T.encode_parts(t),i),s.dispatch({type:C.SET_SELECTION,data:{selection:U()}}))},u.prototype.copySelectedFilesToClipboard=function(){var e,t,n;return t=A.selectedFiles(),t&&t.size?t.some(function(e){return e.isDeleted})?(w.error(M("Deleted files cannot be added to the clipboard")),!1):R.canDeepNest(A.user().id)&&(e=t.some(function(e){return N.isTeamSharedFolder(e)}))?void w.error(M("Team Folders can’t be copied.")):(n=B("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",t.size).format({num_items:t.size}),w.success(n),s.dispatch({type:C.COPY_SELECTED_FILES_TO_CLIPBOARD})):void 0},u.prototype.pasteClipboardFilesToCurrentPath=function(){return this.copyFiles({files:A.clipboardFiles().toArray(),newPath:A.path()})},u.prototype.selectRowsFromNotServer=function(e){return null==e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},u.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t;return t=e.fqPathsToSelect,s.dispatch({type:C.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},u.prototype.copyFiles=function(e){var t,n,o;return t=e.files,n=e.newPath,o=A.user(),this._dataApi.copyFiles({files:t,newPath:n,userId:o.id,onSuccess:function(e){return function(i){var s,a;return a=i.files,s=i.changesets,r.notifyCopySuccess(t.length,o,s,n,function(){return e.selectRowsFromNotServer(t)}),e.selectRowsFromNotServer(a)}}(this)})},u.prototype.moveFiles=function(e){var t,n,o,i;return o=e.path,t=e.files,n=e.newPath,i=A.user(),this._dataApi.moveFiles({path:o,files:t,newPath:n,userId:i.id,onSuccess:function(e){return function(o){var s,a,l;return l=o.path,a=o.fileDeltas,s=o.changesets,r.notifyMoveSuccess(t.length,i,s,n,function(){return e.selectRowsFromNotServer(t)})}}(this)})},u.prototype.showFileRename=function(e){var t;return t=e.file,s.dispatch({type:C.REQUEST_NEW_FILE_NAME,data:{file:t}})},u.prototype.cancelFileRename=function(e){var t;return t=e.file,s.dispatch({type:C.CANCEL_FILE_RENAME,data:{file:t}})},u.prototype.renameFile=function(e){var t,n,o;return t=e.file,n=e.newName,s.dispatch({type:C.SET_FILE_RENAME_PENDING,data:{file:t}}),o=A.user(),this._dataApi.renameFile({file:t,newName:n,userId:o.id,onSuccess:function(e){return function(n){var i,s,a;return s=n.renamedFile,i=n.changesets,a=n.rollbackHints,r.notifyRenameSuccess(o,i,a,function(){return e.selectRowsFromNotServer([t])}),e.selectRowsFromNotServer([s])}}(this),onError:function(e){return function(n,o,r){return e.cancelFileRename({file:t})}}(this)})},u.prototype.applyFileDeltas=function(e){var t,n;return n=e.path,t=e.fileDeltas,s.dispatch({type:C.CHANGE_FILES,data:{path:n,fileDeltas:t}})},u.prototype._getMountPointUpdateForCurrentPath=function(e){var n,o,r,i,s,a,l,c;return r=A.path(),n=(null!=(c=A.mountPoints())?c.toJS():void 0)||{},i=function(e){return function(e){return e===r}}(this),o=parseInt(t.findKey(n,i),10),o?(a=e[o]||null,l=n[o]||null):(l=null,s=Boolean(t.findKey(e,i)),a=s?r:null),[l,a]},u.prototype._getPathForNewMountPoint=function(e,t){return e&&!t?A.path():e&&t?i.paths_are_equal(e,t)?null:t:!e&&t?A.path():null},u.prototype._showUserNotificationForPathChange=function(e,o){var r,s,a,l,c,u,d,p,h;return u=o.old_fq_path,h=n.get_browse_root(e)+o.new_fq_path,r=function(e){return t.escape(i.filename(e))},a=function(e){return w.success(new b(e))},s=function(e){return w.error(new b(e))},c=!o.is_changing_view,l=null!=(p=o.change_type)?p.toLowerCase():void 0,"moved"===l?c?a(M("This folder has been moved")):(d=M('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>'),d=d.format({folder_name:r(u),href:t.escape(h)}),s(d)):"renamed"===l?c?(d=M("This folder has been renamed to ‘%(folder_name)s’"),d=d.format({folder_name:r(o.change_to_fq_path)}),a(d)):(d=M('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>'),d=d.format({folder_name:r(u),href:t.escape(h)}),s(d)):"deleted"===l?(d=M("The folder ‘%(folder_name)s’ has been deleted"),d=d.format({folder_name:r(u)}),s(d)):void 0},u.prototype.computeAndApplyDeltasFromNotServer=function(e){var t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,T,C,I,P,O,R;if(E=e.path,b=e.payload,i=e.currentNSId,t=b.added,f=b.moved,P=b.removed,m=b.mount_points,y=b.parent_changes,null!=(null!=y?y.change_to_fq_path:void 0))return R=A.user(),this._showUserNotificationForPathChange(R,y),void this.setUrl({path:y.change_to_fq_path});if(T=this._getMountPointUpdateForCurrentPath(m),r=T[0],g=T[1],r&&!g&&w.success(M("The folder was unshared.")),O=this._getPathForNewMountPoint(r,g))return void this.setPath({path:O,nsId:i});for(this.setMountPoints({mountPoints:m}),s=A.filesMap(),a=[],c=0,p=t.length;p>c;c++)v=t[c],o=null,n=N.fromServerObject(v),a.push({before:o,after:n});for(u=0,h=f.length;h>u;u++)C=f[u],S=C[0],v=C[1],o=s.get(S,null),n=N.fromServerObject(v),a.push({before:o,after:n});for(d=0,_=P.length;_>d;d++)l=P[d],o=s.get(l,null),n=null,a.push({before:o,after:n});return a&&null!=(I=A.browseLogger())&&I.registerNotServerUpdate(),this.applyFileDeltas({path:E,fileDeltas:a})},u.prototype.setSelection=function(e){var t;return t=e.selection,s.dispatch({type:C.SET_SELECTION,data:{selection:t}})},u.prototype.selectFilesByFqPath=function(e){var t;return t=e.fqPathsToSelect,s.dispatch({type:C.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},u.prototype.setActiveTab=function(e){var t;return t=e.tabName,s.dispatch({type:C.SET_ACTIVE_TAB,data:{tabName:t}})},u.prototype.navigateToFileOrFolder=function(e){var t,n,o,r,i,s,a,l,c;return t=e.file,c=null!=(s=e.shouldFocusComment)?s:!1,i=e.onFileViewerUnmount,o=null!=(a=e.fileViewAction)?a:g.FileViewActionType.CLICK,!A.context().isNonUserRelativeContext||t.is_dir?t.is_dir?N.isNoAccessSharedFolder(t)?O.showNoAccess(t):this.setUrl({path:t.fq_path}):(n=A.getIndexOfFile(t),n>-1?r=null!=(l=A.files())?l.toJS():void 0:(n=0,r=[t]),t.isDeleted?O.showRestore(A.user(),[t]):"download"===t.preview_type?y.unsafe_open_tab(t.href):x({files:r,indexOfPreviewFile:n,shouldFocusComment:c,user:A.user(),onViewerUnmount:i,fileViewAction:o})):void 0},u.prototype.openPreviewForFile=function(e){var t,n;return t=e.file,n=e.onCloseViewer,x({files:[t],indexOfPreviewFile:0,user:A.user(),updateBrowserLocation:!1,onCloseViewer:function(){return"function"==typeof n?n():void 0}})},u.prototype.navigateToParentFolder=function(){var e;return e=i.parent_dir(A.path()),this.setUrl({path:e})},u.prototype.setShouldShowDeletedFiles=function(e){var t,n,o;return o=e.shouldShowDeletedFiles,n=null!=(t=e.shouldReloadFolder)?t:!0,o?a.update_query_param("d","1"):a.remove_query_param("d"),s.dispatch({type:C.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:o}}),n?A.context().isNonUserRelativeContext?this.setPath({path:A.path(),nsId:A.context().rootNSID}):this.reloadCurrentPath():void 0},u.prototype.sortFiles=function(e){var t,n;return n=e.sortField,t=e.direction,s.dispatch({type:C.SORT_FILES,data:{sortField:n,direction:t}})},u.prototype.setCopyMode=function(e){var t;return t=e.copyMode,s.dispatch({type:C.SET_COPY_MODE,data:{copyMode:t}})},u.prototype.downloadFiles=function(e){var t,n,r,s,a,l,c,u,d,p;return a=e.files,n=e.context,p=e.user,1!==a.count()||a.first().is_dir?n.blockHash?n.isNonUserRelativeContext?o.zip_batch_by_ns_id({parent_ns_id:n.rootNSID,parent_ns_path:n.currentFQPath,files:a.toArray(),subject_uid:p.id,block_hash:n.blockHash}):(d=n.currentFQPath,l=function(){var e,t,n,o;for(n=a.toArray(),o=[],e=0,t=n.length;t>e;e++)r=n[e],o.push(r.fq_path);return o}(),o.get_zip({fq_paths:l,subject_uid:p.id,block_hash:n.blockHash,parent_path:d})):!1:void(n.isNonUserRelativeContext?(r=a.first(),t=r.direct_blockserver_link,c=n.rootNSID,s=i.filename(r.fq_path),u=n.currentFQPath+"/"+s,o.get_blockserver_link({url:t,ns_id:c,ns_path:u})):o.get_blockserver_link({url:a.first().direct_blockserver_link}))},u.prototype.nameNewFolder=function(){return s.dispatch({type:C.REQUEST_FOLDER_NAME})},u.prototype.createFolder=function(e){var t,n,o,i,a;return o=e.pathName,t=e.folderName,n=null!=(i=e.nsId)?i:null,s.dispatch({type:C.CREATE_FOLDER_PENDING}),a=A.user(),this._dataApi.createNewFolder({pathName:o,folderName:t,nsId:n,userId:a.id,onSuccess:function(e){return function(n){var o,i;return o=n.changesets,i=n.createdFolder,s.dispatch({type:C.CREATE_FOLDER_COMPLETE}),r.notifyFolderCreationSuccess(t,a,o),e.selectRowsFromNotServer([i])}}(this),onError:function(){return s.dispatch({type:C.CANCEL_CREATE_FOLDER})}})},u.prototype.cancelCreateFolder=function(){return s.dispatch({type:C.CANCEL_CREATE_FOLDER})},u.prototype.addCommentStatusBatch=function(e){var t;return t=e.commentStatusByFqPath,s.dispatch({type:C.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},u.prototype.viewInPhotos=function(t){var n,o,r,i,s,a,l,c,u,d;return s=t.files,d=t.user,s=s.toArray(),a=T({scheme:"https",authority:"www.dropbox.com",path:"/app/view_in_timeline"}).updateQuery("_subject_uid",d.id).toString(),u=e("<form>",{action:a,method:"post"}),o=e("<input>",{name:"t",value:E.read(v.JS_CSRF_COOKIE)}),o.appendTo(u),l=JSON.stringify(function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)i=s[e],n.push(i.ns_id);return n}()),n=e("<input>",{name:"ns_ids",value:l}),n.appendTo(u),c=JSON.stringify(function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)i=s[e],n.push(i.ns_path);return n}()),r=e("<input>",{name:"ns_paths",value:c}),r.appendTo(u),e(document.body).append(u),u.submit(),u.remove()},u.prototype.setDropTarget=function(e){var t;return t=e.target,s.dispatch({type:C.SET_DROP_TARGET,data:{target:t}})},u.prototype.setDataApi=function(e){return this._dataApi=e},u}())});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/api",["external/underscore","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){var _,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R;return g=n.LoadingStates,f=s.File,_=s.BrowseContext,m=a.BrowseStore,v=u._,R=function(e){var t,n;try{return JSON.parse(e)}catch(e){if(n=e,!(n instanceof SyntaxError))throw n}return null},C=function(n){var o,r,i,s,a,l,c,u,d;return s=n.path,d=n.userId,i=n.onSuccess,o=null!=(a=n.includeDeletedFiles)?a:!1,u=null!=(l=n.sortFoldersFirst)?l:!0,r=null!=(c=n.onError)?c:e.noop,t.WebRequest({data:{show_deleted:o||"",sort_folders_first:u,path2:s},url:p({path:"/browse"}),subject_user:d,success:function(e){var t;return t=R(e),t?i({path:s,data:t}):void 0},error:function(e,t,n){return"function"==typeof r?r(e,t,n):void 0}})},y=function(n){var o,r,i,s,a,l;return r=n.files,s=n.newPath,l=n.userId,a=n.onSuccess,i=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)o=r[e],n.push(o.fq_path);return n}(),indexOf.call(i,s)>=0?(d.error(v("You can’t copy a folder into itself.")),null):t.WebProgressRequest({url:p({path:"/cmd/copy"}),data:{files:i,to_path:s},subject_user:l,progress_text:v("Copying files..."),success:function(t){try{return e.isString(t)&&(t=JSON.parse(t)),r=function(){var e,n,r,i;for(r=t.new_browse_files,i=[],e=0,n=r.length;n>e;e++)o=r[e],i.push(f.fromServerObject(o));return i}(),a({files:r,destinationPath:s,changesets:t.changesets,rollbackHints:t.rollback_hints})}catch(e){}}})},b=function(n){var o,r,i,s,a;return r=n.files,a=n.userId,s=n.onSuccess,i=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)o=r[e],n.push(o.fq_path);return n}(),t.WebProgressRequest({url:p({path:"/cmd/delete"}),data:{files:i},subject_user:a,progress_text:v("Deleting files..."),success:function(t){var n,o;try{return e.isString(t)&&(t=JSON.parse(t)),o=function(){var e,t,o;for(o=[],e=0,t=r.length;t>e;e++)n=r[e],o.push({before:n,after:null});return o}(),s({fileDeltas:o,changesets:t.changesets,rollbackHints:t.rollback_hints})}catch(e){}}})},I=function(n){var r,i,s,a,l,c,u;return c=n.path,i=n.files,a=n.newPath,u=n.userId,l=n.onSuccess,c===a?(d.error(v("Those files already exist in that folder.")),null):(s=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)r=i[e],n.push(r.fq_path);return n}(),indexOf.call(s,a)>=0?(d.error(v("You can’t move a folder into itself.")),null):t.WebProgressRequest({url:p({path:"/cmd/move"}),data:{files:s,to_path:a},subject_user:u,progress_text:v("Moving files..."),success:function(t){var n;try{return e.isString(t)&&(t=JSON.parse(t)),i=m.filesMap(),n=function(){var n,a,l,c;for(l=t.new_browse_files,c=[],n=0,a=l.length;a>n;n++)r=l[n],c.push({before:i.get(e.find(s,function(e){return o.filename(e)===o.filename(r.fq_path)}),null),after:f.fromServerObject(r)});return c}(),l({path:c,destinationPath:a,fileDeltas:n,changesets:t.changesets,rollbackHints:t.rollback_hints})}catch(e){}}}))},A=function(e){var n,o,r,i,s;return n=e.file,o=e.newName,s=e.userId,i=e.onSuccess,r=e.onError,t.WebRequest({url:p({path:"/cmd/rename"+n.fq_path}).toString(),subject_user:s,data:{to_path:o},success:function(e,t,n){var o,s,a,l;l=null;try{l=JSON.parse(e)}catch(e){if(o=e,!(o instanceof SyntaxError))throw o}return l?(a=f.fromServerObject(l.new_browse_files[0]),i({changesets:l.changesets,renamedFile:a,rollbackHints:l.rollback_hints})):r?r():void 0},error:r?r:void 0})},T=function(e){var t,n,o,i;return t=e.fqPath,i=e.userId,n={prev:p.parse(r.get_url()).setFragment("").toString()},n._subject_uid=i,t=t.replace(/^[\/]/,""),o=p({path:"/restore/"+t}).updateQuery(n),o.toString()},w=function(e,t){var n,o,r,i;return n=e.fqPath,i=e.userId,null==t&&(t=null),r=null===t?{}:t,r.undelete=1,r._subject_uid=i,n=n.replace(/^[\/]/,""),o="/history",p({path:o+"/"+n}).updateQuery(r).toString()},N=function(n){var o,r,i;return o=n.files,i=n.userId,r=n.onSuccess,t.WebProgressRequest({url:"/cmd/restore",data:{files:e.pluck(o,"fq_path")},subject_user:i,dataType:"json",progress_text:v("Restoring…"),success:function(e){return r()}})},P=function(n){var o,r,i,s,a;return o=n.files,a=n.userId,r=n.onSuccess,i=null!=(s=n.progressText)?s:v("Deleting…"),t.WebProgressRequest({url:"/cmd/purge",data:{files:e.pluck(o,"fq_path")},subject_user:a,dataType:"text",progress_text:i,success:function(e){var t;return t=R(e),t&&"success"===t.status?r():void 0}})},O=function(e){var n,o,r,i,s,a;return a=e.userId,n=e.changesets,r=e.progressText,s=null!=(i=e.rollbackHints)?i:{},o=e.onSuccess,t.WebProgressRequest({url:p({path:"/cmd/rollback"}),data:{ns_to_cs:JSON.stringify(n),rollback_hints:JSON.stringify(s)},subject_user:a,progress_text:r,success:function(){return o()}})},E=function(e){var n,o,r,i,s;return i=e.pathName,n=e.folderName,s=e.userId,r=e.onSuccess,o=e.onError,t.WebProgressRequest({url:p({path:"/cmd/new"+i}),data:{to_path:n,folder:"yes"},subject_user:s,success:function(e){var t,n;return t=R(e),t?(n=f.fromServerObject(t.new_browse_files[0]),r({changesets:t.changesets,createdFolder:n})):void 0},error:function(){return o()}})},S=function(e){var n,o,r,i,s,a,l,c,u;return a=e.path,u=e.userId,o=e.namespaceToJournalIdMap,n=e.includeDeletedFiles,i=e.onSuccess,l="/"===a?"":a,s={fq_dir:l,ns_map:function(){var e;e=[];for(r in o)c=o[r],e.push(r+"_"+c);return e}().join(","),show_deleted:Boolean(n)},t.WebRequest({url:p({path:"/update/list_dir"}),subject_user:u,data:s,dataType:"text",success:function(e){var t;return t=R(e),t?i(t):void 0}})},{loadPath:C,copyFiles:y,moveFiles:I,deleteFiles:b,renameFile:A,getFileHistoryUrl:w,getRestoreFileUrl:T,restoreFiles:N,purgeFiles:P,rollbackChangeSets:O,getChangesForDirectory:S,createNewFolder:E}}),define("modules/clean/react/browse/browse_logger",["require","exports","tslib","modules/clean/ajax","modules/clean/pagelet_logger","modules/constants/request","modules/clean/web_timing_logger"],function(e,t,n,o,r,i,s){"use strict";var a=function(e){function t(n,o){void 0===o&&(o=[]);var r=e.call(this,"browse",o,!0)||this;return r.logged=!1,r.data={requestId:i.REQUEST_ID,hitCacheTime:t.getCacheHitTime(),notServerUpdateTime:null,directoryDepth:t.getDirectoryDepth(n)},r.data.hitCacheTime&&s.set_subtypes_value("ensemblecache","true"),r}return n.__extends(t,e),t.getCacheHitTime=function(){if(window.ensemble&&window.ensemble.getCacheInfo){var e=window.ensemble.getCacheInfo();for(var t in e)if(e[t].isCacheHit&&-1!==t.indexOf("browse"))return e[t].startTime}return null},t.getDirectoryDepth=function(e){if(0===e.length||"/"!==e[0])return 0;for(var t=0,n=0;n<e.length;++n)"/"===e[n]&&++t;return Math.max(0,t-1)},t.prototype.logBrowseCacheData=function(){this.logged||(this.logged=!0,o.SilentBackgroundRequest({url:"/log/browse_cache_log",data:{request_id:this.data.requestId,cache_hit_time:this.data.hitCacheTime,stale_data_update_time:this.data.notServerUpdateTime,dir_level:this.data.directoryDepth}}))},t.prototype.registerNotServerUpdate=function(){this.performance&&(this.data.notServerUpdateTime=this.performance.now(),this.logBrowseCacheData())},t}(r.PageletLogger);t.BrowseLogger=a}),define("modules/clean/react/browse/constants",["modules/core/i18n"],function(e){var t,n,o,r,i,s,a,l;t=e._,r={},r.BrowseActionTypes={INITIALIZE_EVERYTHING:"INITIALIZE_EVERYTHING",LOAD_PATH:"LOAD_PATH",ADD_FILES:"ADD_FILES",SET_PATH:"SET_PATH",SET_USER:"SET_USER",SET_URL_PREFIX:"SET_URL_PREFIX",SET_LOADING_STATE:"SET_LOADING_STATE",SET_MOUNT_POINTS:"SET_MOUNT_POINTS",SET_TEAM_FOLDERS:"SET_TEAM_FOLDERS",CHANGE_FILES:"CHANGE_FILES",SET_SELECTION:"SET_SELECTION",SELECT_FILES_BY_FQ_PATH:"SELECT_FILES_BY_FQ_PATH",SET_SHOULD_SHOW_DELETED_FILES:"SET_SHOULD_SHOW_DELETED_FILES",START_INTERNAL_DRAG:"START_INTERNAL_DRAG",STOP_INTERNAL_DRAG:"STOP_INTERNAL_DRAG",SET_DROP_TARGET:"SET_DROP_TARGET",SORT_FILES:"SORT_FILES",SET_COPY_MODE:"SET_COPY_MODE",COPY_SELECTED_FILES_TO_CLIPBOARD:"COPY_SELECTED_FILES_TO_CLIPBOARD",REQUEST_NEW_FILE_NAME:"REQUEST_NEW_FILE_NAME",CANCEL_FILE_RENAME:"CANCEL_FILE_RENAME",SET_FILE_RENAME_PENDING:"SET_FILE_RENAME_PENDING",SET_FILE_RENAME_COMPLETE:"SET_FILE_RENAME_COMPLETE",REQUEST_FOLDER_NAME:"REQUEST_FOLDER_NAME",CREATE_FOLDER_PENDING:"CREATE_FOLDER_PENDING",CREATE_FOLDER_COMPLETE:"CREATE_FOLDER_COMPLETE",CANCEL_CREATE_FOLDER:"CANCEL_CREATE_FOLDER",SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:"SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE",TEAM_FOLDER_DOWNGRADE:"TEAM_FOLDER_DOWNGRADE",ADD_COMMENT_STATUS_BATCH:"ADD_COMMENT_STATUS_BATCH",ADD_FILE_JUMP_KEY_CODE:"ADD_FILE_JUMP_KEY_CODE",RESET_FILE_JUMP:"RESET_FILE_JUMP",SET_ACTIVE_TAB:"SET_ACTIVE_TAB",SET_CONTEXT_FILE:"SET_CONTEXT_FILE"},r.NewFolderCreationState={CREATE_FOLDER_INACTIVE:"CREATE_FOLDER_INACTIVE",PENDING_INPUT:"PENDING_INPUT",SAVING_INPUT:"SAVING_INPUT"},r.LoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_REMAINING_PAGES:"LOADING_REMAINING_PAGES"},r.Direction={UP:"UP",DOWN:"DOWN"},r.FileTypes={FILE:1,FOLDER:2,PACKAGE:3,SHARED_FOLDER:4,SANDBOX:5,TEAM_SHARED_FOLDER:6,TEAM_MEMBER_FOLDER:7},r.NameSpaceAccess={ACCESS_NO_ACCESS:0,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},r.REACT_FILE_VIEWER_ELEMENT_ID="browse-react-file-viewer-container",r.BrowseSortField={FILENAME:"FILENAME",MODIFIED:"MODIFIED",CATEGORY:"CATEGORY",EXTENSION:"EXTENSION",SIZE:"SIZE",SHARED_WITH:"SHARED_WITH"},r.DropTargetHighlightMode={NONE:"NONE",ALL_FOLDERS:"ALL_FOLDERS",NONSELECTED_FOLDERS:"NONSELECTED_FOLDERS",NONSELECTED_NONSHARED_FOLDERS:"NONSELECTED_NONSHARED_FOLDERS",NONSELECTED_NONSHARED_NONTEAM_FOLDERS:"NONSELECTED_NONSHARED_NONTEAM_FOLDERS"},n={IMAGE:["bmp","cr2","gif","ico","jpeg","jpg","nef","png","psd","tif","tiff","svg","svgz"],VIDEO:["3gp","3gpp","3gpp2","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpeg","mpg","mts","ts","vob","wmv"],AUDIO:["aif","flac","m4a","m4p","mp3","ogg","wav","wma"],DOCUMENT:["ai","cdr","csv","doc","docx","docm","eps","fla","indd","keynote","numbers","otf","pages","pdf","ppt","pptx","pptm","pps","ppsx","ppsm","ps","rtf","swf","txt","wpd","xls","xlsx","xlsm"],COMPRESSED_FILE:["7z","bz2","gz","gzip","rar","tar","zip"],CODE:["as","as3","c","coffee","cpp","cs","css","cxx","h","html","java","js","less","php","py","rb","sass","scss","sh","sql","vb","xhtml","xml"],DISK_IMAGE:["dmg","iso"],EXECUTABLE:["exe"],SHORTCUT:["lnk"],LINK:["url","webloc"],FONT:["ttf"]},r.CulledListConstants={ITEM_ROW_HEIGHT_PX:46,MAESTRO_ITEM_ROW_HEIGHT_PX:57,SEARCH_ROW_HEIGHT_PX:53,MAESTRO_SEARCH_ROW_HEIGHT_PX:66,DEFAULT_HEADER_HEIGHT_PX:142,ITEM_BUFFER_SIZE:5},r.ItemTypes={CREATE_FOLDER_UI:"CreateFolderUI",LOADING_INDICATOR:"LoadingIndicator"},r.FileTypeCategoryTranslations={FILE:t("file"),FOLDER:t("folder"),SHARED_FOLDER:t("shared folder"),TEAM_SHARED_FOLDER:t("team folder"),TEAM_MEMBER_FOLDER:t("member folder"),PUBLIC_FOLDER:t("folder"),IMAGE:t("image"),VIDEO:t("video"),AUDIO:t("audio"),DOCUMENT:t("document"),COMPRESSED_FILE:t("archive"),CODE:t("code"),DISK_IMAGE:t("disk image"),EXECUTABLE:t("executable"),SHORTCUT:t("shortcut"),LINK:t("link"),FONT:t("font"),SANDBOX:t("app folder")},r.DeletedFileTypeCategoryTranslations={FILE:t("deleted file"),FOLDER:t("deleted folder"),SHARED_FOLDER:t("deleted shared folder"),TEAM_SHARED_FOLDER:t("deleted team folder"),PUBLIC_FOLDER:t("deleted folder"),IMAGE:t("deleted image"),VIDEO:t("deleted video"),AUDIO:t("deleted audio"),DOCUMENT:t("deleted document"),COMPRESSED_FILE:t("deleted archive"),CODE:t("deleted code"),DISK_IMAGE:t("deleted disk image"),EXECUTABLE:t("deleted executable"),SHORTCUT:t("deleted shortcut"),LINK:t("deleted link"),FONT:t("deleted font"),SANDBOX:t("deleted app folder")},r.ExtensionCategories={};for(o in n)for(s=n[o],a=0,l=s.length;l>a;a++)i=s[a],r.ExtensionCategories[i]=o;return r.RenameStates={PENDING_INPUT:"pending-input",SAVING_INPUT:"saving-input"},r.MouseEventButton={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2},r.ShareFolderModalTypes={ShareExisting:1,EditShared:2,EditSharedSubFolder:3},r.SharedWithActionTypes={SET_SHARED_FOLDER_DATA:"SET_SHARED_FOLDER_DATA",SET_MEMBER_COUNTS_FOR_NS:"SET_MEMBER_COUNTS_FOR_NS",SET_SHARED_LINK_DATA:"SET_SHARED_LINK_DATA",SET_SHARED_FILE_DATA:"SET_SHARED_FILE_DATA",SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:"SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE",SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:"SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE",SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:"SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE",CLEAR_SHARED_FOLDER_DATA_FOR_NS:"CLEAR_SHARED_FOLDER_DATA_FOR_NS",REMOVE_SHARED_LINK_DATA:"REMOVE_SHARED_LINK_DATA"},r.SEARCH_PREFIX="/search",r.ViewTypes={Grid:1,List:2},r});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/models",["external/underscore","external/react","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/react/browse/constants","modules/constants/legacy"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m,f,g,v,y,E;return g=t.PropTypes,m=i.NameSpaceAccess,h=i.FileTypeCategoryTranslations,c=i.DeletedFileTypeCategoryTranslations,u=i.ExtensionCategories,_=i.FileTypes,y=i.RenameStates,E=function(e,t,n){var o,r,i;i=[];for(o in e)n.hasOwnProperty(o)&&(r=n[o],i.push(t[r]=e[o]));return i},d=n.Record({ago:void 0,beacon_context:void 0,bytes:void 0,comment_count:null,default_sync_setting:null,direct_blockserver_link:void 0,doc_preview_status:void 0,feedback_off:null,file_id:void 0,filename_highlights:void 0,fq_path:void 0,href:void 0,htmlified_link:void 0,icon:void 0,in_root_coll:void 0,is_dir:!1,is_in_team_folder_tree:!1,is_unmounted:!1,last_modified_fname:null,latest_rev:null,linkfile_data:void 0,match_type:void 0,_mount_access_perms:void 0,ns_id:0,ns_path:void 0,preview_type:void 0,preview_url:void 0,preview_thumbnail_url:void 0,request_id:0,size:-1,sjid:0,sort_key:[""],sort_rank:0,target_ns:0,team_folder_status:null,thumbnail_url_tmpl:void 0,ts:0,type:null,unresolved_comment_count:null,video_transcode_url:void 0,isDeleted:!1}),d.SERVER_PROP_TO_CLIENT_PROP_MAP={ago:"ago",beacon_context:"beacon_context",bytes:"bytes",comment_count:"comment_count",default_sync_setting:"default_sync_setting",direct_blockserver_link:"direct_blockserver_link",doc_preview_status:"doc_preview_status",feedback_off:"feedback_off",file_id:"file_id",filename_highlights:"filename_highlights",fq_path:"fq_path",href:"href",htmlified_link:"htmlified_link",icon:"icon",in_root_coll:"in_root_coll",is_dir:"is_dir",is_in_team_folder_tree:"is_in_team_folder_tree",is_unmounted:"is_unmounted",last_modified_fname:"last_modified_fname",latest_rev:"latest_rev",linkfile_data:"linkfile_data",match_type:"match_type",mount_access_perms:"_mount_access_perms",ns_id:"ns_id",ns_path:"ns_path",preview_type:"preview_type",preview_url:"preview_url",preview_thumbnail_url:"preview_thumbnail_url",request_id:"request_id",size:"size",sjid:"sjid",sort_rank:"sort_rank",sort_key:"sort_key",target_ns:"target_ns",team_folder_status:"team_folder_status",thumbnail_url_tmpl:"thumbnail_url_tmpl",ts:"ts",type:"type",unresolved_comment_count:"unresolved_comment_count",video_transcode_url:"video_transcode_url"},d.fromServerObject=function(e){var t;return"object"!=typeof e?(o.raiseAndReport({msg:"File.fromServerObject called with an unexpected argument: "+e}),new d):(t={},E(e,t,d.SERVER_PROP_TO_CLIENT_PROP_MAP),e.hasOwnProperty("bytes")&&(t.isDeleted=-1===e.bytes),new d(t))},d.getExtension=function(e){return r.file_extension(e.fq_path)},d.getCategoryDescription=function(e){var t;if(e.is_dir){switch(t="FOLDER",e.type){case _.TEAM_SHARED_FOLDER:t="TEAM_SHARED_FOLDER";break;case _.SHARED_FOLDER:t="SHARED_FOLDER";break;case _.SANDBOX:t="SANDBOX";break;case _.TEAM_MEMBER_FOLDER:t="TEAM_MEMBER_FOLDER";break;default:e.target_ns&&(t="SHARED_FOLDER")}return e.isDeleted?c[t]:h[t]}return t=u[d.getExtension(e)]||"FILE",e.isDeleted?c[t]:h[t]},d.isTeamSharedFolder=function(e){return e.type===_.TEAM_SHARED_FOLDER},d.isTeamMemberFolder=function(e){return e.type===_.TEAM_MEMBER_FOLDER},d.isReadOnlySharedFolder=function(e){return null!=e._mount_access_perms&&indexOf.call(e._mount_access_perms,"can_edit")<0},d.isNoAccessSharedFolder=function(e){return null!=e._mount_access_perms&&indexOf.call(e._mount_access_perms,"can_view")<0},d.canViewFileMembers=function(e,t){return null==t&&(t=null),null!=e._mount_access_perms&&indexOf.call(e._mount_access_perms,"can_view_members")<0?!1:t&&!t.canViewContainingNSMembers?null!=e._mount_access_perms&&indexOf.call(e._mount_access_perms,"can_view_members")>=0:!0},d.areEqual=function(e,t){return e.ns_id===t.ns_id&&e.sjid===t.sjid},l=n.Record({isPublicFolderEnabled:!1,publicFolderFqPath:null,publicAppToken:null}),l.SERVER_PROP_TO_CLIENT_PROP_MAP={simple_sharing_enabled:"isSimpleSharingEnabled",public_folder_enabled:"isPublicFolderEnabled",public_folder_fq_path:"publicFolderFqPath",public_app_token:"publicAppToken"},l.fromServerObject=function(e){var t;return t={},E(e,t,l.SERVER_PROP_TO_CLIENT_PROP_MAP),new l(t)},a=n.Record({canViewContainingNSMembers:!0,cdmMveQuotaStats:null,currentNSID:s.root_ns_id,currentFQPath:null,currentMountPoint:null,currentNSPath:null,currentSharedFolderPermissionRole:m.ACCESS_NO_ACCESS,currentNSAllowsNesting:!1,inactiveNSIDByFQPath:n.Map(),permanentDeletionDisabledStateByNSID:n.Map(),isInFolderMode:!0,isCurrentlyInRoot:!1,isInsideSharedFolder:!1,isInsideAutoTeamFolder:!1,isInsideArchivedTeamFolder:!1,isInsideTeamFolderTree:!1,isInsideDeletedFolder:!1,isInsideDeletedSharedFolder:!1,isInsideDeletedNestedSharedFolder:!1,isNonUserRelativeContext:!1,pathRoot:null,rootNSID:null,showSharedFolderCreateTeamPromo:!1,showPinnedTeamFolder:!1,blockHash:null,config:new l}),v=n.Record({quotaRawBytesUsed:0,quotaRawBytes:0,formattedQuota:""}),v.SERVER_PROP_TO_CLIENT_PROP_MAP={quota_raw_bytes_used:"quotaRawBytesUsed",quota_raw_bytes:"quotaRawBytes",formatted_quota:"formattedQuota"},v.fromServerObject=function(e){var t;return t={},E(e,t,v.SERVER_PROP_TO_CLIENT_PROP_MAP),new v(t)},a.SERVER_PROP_TO_CLIENT_PROP_MAP={root_ns_id:"rootNSID",path_root:"pathRoot",containing_ns_id:"currentNSID",fqPath:"currentFQPath",containing_mount_point:"currentMountPoint",containing_ns_path:"currentNSPath",old_path_to_ns_id:"inactiveNSIDByFQPath",permanent_delete_is_disabled_by_ns_id:"permanentDeletionDisabledStateByNSID",in_root_dir:"isCurrentlyInRoot",inside_dir:"isInFolderMode",inside_shared_folder:"isInsideSharedFolder",inside_auto_team_folder:"isInsideAutoTeamFolder",inside_archived_team_folder:"isInsideArchivedTeamFolder",inside_team_folder_tree:"isInsideTeamFolderTree",inside_deleted_dir:"isInsideDeletedFolder",inside_deleted_nested_shared_folder:"isInsideDeletedNestedSharedFolder",is_non_user_relative_context:"isNonUserRelativeContext",show_shared_folder_create_team_promo:"showSharedFolderCreateTeamPromo",show_pinned_team_folder:"showPinnedTeamFolder",block_hash:"blockHash"},a.fromServerObject=function(e){var t,n,o;return o={},e.hasOwnProperty("containing_fq_path")&&(n=e.containing_fq_path||"",0!==n.indexOf("/")&&(n="/"+n),o.currentFQPath=n),e.inside_shared_folder&&(o.currentSharedFolderPermissionRole=m.ACCESS_READER),
e.cdm_mve_quota_stats&&(o.cdmMveQuotaStats=v.fromServerObject(e.cdm_mve_quota_stats)),e.hasOwnProperty("containing_ns_permissions")&&(t=e.containing_ns_permissions||[],o.currentNSAllowsNesting=indexOf.call(t,"mount_shared_folders")>=0,e.inside_shared_folder&&(indexOf.call(t,"edit_contents")>=0&&(o.currentSharedFolderPermissionRole=m.ACCESS_WRITER),indexOf.call(t,"change_folder_options")>=0&&(o.currentSharedFolderPermissionRole=m.ACCESS_OWNER),indexOf.call(t,"view_members")<0&&(o.canViewContainingNSMembers=!1))),e.hasOwnProperty("inside_deleted_shared_folder")&&(o.isInsideDeletedSharedFolder=Boolean(e.inside_deleted_shared_folder)),E(e,o,a.SERVER_PROP_TO_CLIENT_PROP_MAP),o.config=l.fromServerObject(e),new a(o)},a.prototype.isCurrentPathWriteable=function(){var e;return!this.isInsideSharedFolder||(e=this.currentSharedFolderPermissionRole)===m.ACCESS_WRITER||e===m.ACCESS_OWNER},a.prototype.getNameOfTargetFolder=function(){return r.filename(this.currentFQPath)},p=n.Record({file:null,state:null}),p.propTypes=g.shape({file:g.instanceOf(d),state:g.oneOf(e.values(y))}),f=n.Record({title:"",pad_id:void 0,url:void 0,title_highlights:[],creator_name:"",last_modified_date:void 0},"Paper"),f.SERVER_PROP_TO_CLIENT_PROP_MAP={title:"title",pad_id:"pad_id",url:"url",title_highlights:"title_highlights",creator_name:"creator_name",last_modified_date:"last_modified_date"},f.fromServerObject=function(e){var t;return"object"!=typeof e?(o.raiseAndReport({msg:"Paper.fromServerObject called with an unexpected argument: "+e}),new f):(t={},E(e,t,f.SERVER_PROP_TO_CLIENT_PROP_MAP),new f(t))},{File:d,Config:l,BrowseContext:a,FileRename:p,Paper:f,QuotaStats:v}}),define("modules/clean/react/browse/render_partials",["external/react","modules/clean/react/sprite","modules/clean/react/browse/models"],function(e,t,n){var o,r,i,s;return o=n.File,s=e.DOM,i=e.createElement,r=e.createClass({displayName:"FileIconView",propTypes:{file:e.PropTypes.instanceOf(o).isRequired,onClick:e.PropTypes.func,onMouseDown:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{onClick:function(){},onMouseDown:function(){},onDragStart:function(){},className:""}},getInitialState:function(){return{hasThumbFailed:!1}},render:function(){return this.props.file.thumbnail_url_tmpl&&!this.state.hasThumbFailed?s.img({src:this.props.file.thumbnail_url_tmpl,className:"browse-file-row__accessory "+this.props.className,alt:"",onError:function(e){return function(){return e.setState({hasThumbFailed:!0})}}(this),onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown}):i(t,{group:"web",name:this.props.file.icon,className:"browse-file-row__accessory "+this.props.className,alt:"",onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown})}}),{FileIcon:r}}),define("modules/clean/react/browse/sort_helpers",[],function(){var e,t;return e=function(e,t,n){var o,r,i,s,a,l,c,u;for(o="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=c=0,u=Math.max(e.length,t.length);u>=0?u>c:c>u;s=u>=0?++c:--c){if(r=e.charAt(s),i=t.charAt(s),!r)return-n;if(!i)return n;if(a=o.indexOf(r),l=o.indexOf(i),l>a)return-n;if(a>l)return n}return 0},t=function(t,n,o){var r,i,s,a,l,c;if(Array.isArray(t)&&Array.isArray(n)){for(a=l=0,c=Math.max(t.length,n.length);c>=0?c>l:l>c;a=c>=0?++l:--l){if(i=t[a],s=n[a],null==i)return-o;if(null==s)return o;if("number"==typeof i&&"string"==typeof s)return-o;if("number"==typeof s&&"string"==typeof i)return o;if("string"==typeof i&&"string"==typeof s){if(r=e(i,s,o),0!==r)return r}else{if(s>i)return-o;if(i>s)return o}}return 0}return t===n?0:n>t?-o:o},{compare:t}});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/store",["external/immutable","modules/core/browser","modules/core/exception","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/browse_logger","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/columnheader","modules/clean/react/selectable_list"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g,v,y,E,b,S,assert,w,T,raiseAndReport;return assert=n.assert,raiseAndReport=n.raiseAndReport,h=i.BrowseLogger,d=s.BrowseActionTypes,_=s.BrowseSortField,v=s.FileTypes,y=s.LoadingStates,E=s.NewFolderCreationState,b=s.RenameStates,p=a.BrowseContext,f=a.File,g=a.FileRename,w=l.compare,S=c.SortDirections,T=u.createSelection,m=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return extend(r,n),r.prototype._init=function(){return this._unsortedFiles=e.Map(),this._sortedFiles=e.List(),this._teamFolders=e.List(),this._path="",this._user=null,this._urlPrefix="",this._selection=T(),this._loadingState=y.LOADING_FIRST_PAGE,this._context=new p,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._activeDropTarget=null,this._inCopyMode=!1,this._clipboardFiles=e.Set(),this._currentSort={sortField:_.FILENAME,direction:S.ASCENDING},this._fileRename=null,this._newFolderCreationState=E.CREATE_FOLDER_INACTIVE,this._filePathsToSelectOnNextUpdate=e.Set(),this._activeFileJumpFilter="",this._fileJumpIndex=[],this._activeTab=void 0,this._browseLogger=null,this._contextFile=null},r.prototype.contextFile=function(){return this._contextFile},r.prototype.files=function(){return this._sortedFiles},r.prototype.filesMap=function(){return this._unsortedFiles},r.prototype.filesWithoutTeamFolders=function(){return this._sortedFiles.filter(function(e){return e.type!==v.TEAM_SHARED_FOLDER})},r.prototype.teamFolders=function(){return this._teamFolders},r.prototype.path=function(){return this._path},r.prototype.user=function(){return this._user},r.prototype.urlPrefix=function(){return this._urlPrefix},r.prototype.selection=function(){return this._selection},r.prototype.selectedFiles=function(){return this._sortedFiles.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},r.prototype.activeTab=function(){return this._activeTab},r.prototype.loadingState=function(){return this._loadingState},r.prototype.context=function(){return this._context},r.prototype.mountPoints=function(){return this._mountPoints},r.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},r.prototype.activeDropTarget=function(){return this._activeDropTarget},r.prototype.currentSort=function(){return this._currentSort},r.prototype.getIndexOfFile=function(e){return this._sortedFiles.findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})},r.prototype.getFileByFilename=function(e){return this._sortedFiles.find(function(t){return o.filename(t.fq_path)===e})||null},r.prototype.getFileByFullPath=function(e){return this._sortedFiles.find(function(t){return t.fq_path===e})||null},r.prototype.inCopyMode=function(){return this._inCopyMode},r.prototype.clipboardFiles=function(){return this._clipboardFiles},r.prototype.fileRename=function(){return this._fileRename},r.prototype.newFolderCreationState=function(){return this._newFolderCreationState},r.prototype.isFileJumping=function(){return this._activeFileJumpFilter.length>0},r.prototype.browseLogger=function(){return null!=this._browseLogger?this._browseLogger:void 0},r.prototype._initializeEverything=function(t){var n,o,r,i,s,a,l,c,u,d;return d=t.user,a=t.path,o=t.files,u=t.urlPrefix,n=t.context,s=t.mountPoints,r=t.fqPathsToSelect,i=t.loadingState,l=t.shouldShowDeletedFiles,c=t.teamFolders,this._user=d,this._path=a,this._urlPrefix=u,this._appendFiles({path:a,files:o},!1),this._context=n,this._mountPoints=e.Map(s),this._loadingState=i,this._setTeamFolders({teamFolders:c}),i===y.LOADED?this.selectFqPaths({fqPathsToSelect:r},!1):this._filePathsToSelectOnNextUpdate=e.Set(r),this._shouldShowDeletedFiles=Boolean(l),this.emit_change()},r.prototype._setUser=function(e){var t;return t=e.user,null==this.user()?this._user=t:void 0},r.prototype.initBrowseLogger=function(e){return null==this._browseLogger?this._browseLogger=new h(this._path,e):void 0},r.prototype.componentReadyForTTI=function(e){return null!=this._browseLogger?this._browseLogger.componentReady(e):void 0},r.prototype._setPathData=function(e){var t,n,r;return r=e.path,n=e.files,t=e.context,o.paths_are_equal(r,this._path)?(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=T(),this._appendFiles({path:r,files:n},!1),this._context=t,this.emit_change()):void 0},r.prototype._appendFiles=function(t,n){var r,i,s,a,l,c,u,d,p;if(u=t.path,i=t.files,null==n&&(n=!0),o.paths_are_equal(u,this._path)){for(s=[],a=[],l=0,c=i.length;c>l;l++)r=i[l],r instanceof f||(r=f.fromServerObject(r)),s.push([r.fq_path,r]),this._sortedFiles.has(r)||a.push(r);return p=this._unsortedFiles,this._unsortedFiles=this._unsortedFiles.merge(s),d=this._sortedFiles,this._sortedFiles=this._sortedFiles.concat(e.List(a)),this._unsortedFiles.size!==this._sortedFiles.size?void raiseAndReport("unsortedFiles size does not match sortedFiles size",{exc_extra:{newFiles:i.map(function(e){return e.fq_path}),prevSortedFiles:d.map(function(e){return e.fq_path}).toJS(),sortedFiles:this._sortedFiles.map(function(e){return e.fq_path}).toJS(),prevUnsortedFiles:p.map(function(e){return e.fq_path}).toJS(),unsortedFiles:this._unsortedFiles.map(function(e){return e.fq_path}).toJS()}}):(this._sortFiles(this._currentSort,!1),this._filePathsToSelectOnNextUpdate.count()&&this.selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),this._buildFileJumpIndex(),n?this.emit_change():void 0)}},r.prototype._applyFileDeltas=function(t){var n,r,i,s,a,l,c,u;if(l=t.path,i=t.fileDeltas,o.paths_are_equal(l,this._path)){for(s=0,a=i.length;a>s;s++)u=i[s],r=u.before,n=u.after,this._applyFileDelta({before:r,after:n,pathForDelta:l});return this._filePathsToSelectOnNextUpdate.size&&(c=this.selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),c.size===this._filePathsToSelectOnNextUpdate.size&&(this._filePathsToSelectOnNextUpdate=e.Set())),assert(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched file collections (map vs. sorted list)"),this._sortFiles(this._currentSort,!1),this._buildFileJumpIndex(),this.emit_change()}},r.prototype._applyTeamFolderDowngrade=function(e){var t,n,o;return o=this.mountPoints().get(e),n=this.filesMap().get(o),null!=n&&(t=n.merge({icon:"folder_user_32",type:v.SHARED_FOLDER}),this._replaceFile({existingFile:n,newFile:t})),this.emit_change()},r.prototype._setPath=function(e){var t;return t=e.path,this._path=t,this.emit_change()},r.prototype._setUrlPrefix=function(e){var t;return t=e.prefix,this._urlPrefix=t,this.emit_change()},r.prototype._setLoadingState=function(t){var n,r;return r=t.path,n=t.loadingState,o.paths_are_equal(r,this._path)?(this._loadingState=n,n===y.LOADED&&(this._filePathsToSelectOnNextUpdate=e.Set()),this.emit_change()):void 0},r.prototype._setMountPoints=function(t){var n;return n=t.mountPoints,this._mountPoints=e.Map(n)},r.prototype._setTeamFolders=function(t){var n,o;return o=t.teamFolders,this._teamFolders=e.List(function(){var e,t,r,i;for(r=o||[],i=[],e=0,t=r.length;t>e;e++)n=r[e],i.push(f.fromServerObject(n));return i}())},r.prototype._setSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},r.prototype.selectFqPaths=function(t,n){var o,r,i,s,a,l;return i=t.fqPathsToSelect,null==n&&(n=!0),s=i.map(function(e){return e.toLowerCase()}),r=this._sortedFiles.filter(function(e){var t;return t=e.fq_path.toLowerCase(),indexOf.call(s,t)>=0}),a=r.map(function(e){return e.fq_path}),l=this._selection.set("selected",e.OrderedSet(a)),o=a.size?a.get(0):null,l=l.set("anchor",o),this._selection=l,n&&this.emit_change(),a},r.prototype._setActiveTab=function(e){var t;return t=e.tabName,this._activeTab=t,this.emit_change()},r.prototype._setShouldShowDeletedFiles=function(e){var t;return t=e.shouldShowDeletedFiles,this._shouldShowDeletedFiles=Boolean(t),this.emit_change()},r.prototype._setDropTarget=function(e){var t;return t=e.target,this._activeDropTarget=t,this.emit_change()},r.prototype._setCopyMode=function(e){var t;return t=e.copyMode,this._inCopyMode=t,this.emit_change()},r.prototype._sortFiles=function(e,n){var o,r,i,s,a,l,c,u,d,p;return p=e.sortField,l=e.direction,null==n&&(n=!0),d=l===S.ASCENDING?1:-1,c=!this._context.isNonUserRelativeContext,s=function(e,t){var n,r,i,s,a;return n=e.value,r=e.isTMF,i=t.value,s=t.isTMF,a=o(r,s),a||w(n,i,d)},i=function(e,t){var n,r,i,s,a,l,c;return r=e.isFolder,n=e.value,i=e.isTMF,a=t.isFolder,s=t.value,l=t.isTMF,c=o(i,l),c?c:r&&a?w(n,s,d):r?-d:a?d:w(n,s,d)},r=function(e,t){var n,r,i,s,a,l,c;return r=e.isFolder,n=e.value,i=e.isTMF,a=t.isFolder,s=t.value,l=t.isTMF,c=o(i,l),c?c:r&&a?w(n,s,d):r?1:a?-1:""===n?1:""===s?-1:w(n,s,d)},o=function(e,t){if(c){if(e)return-1;if(t)return 1}},u=p===_.FILENAME||p===_.SHARED_WITH,u?(a=t.mac?s:i,this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.sort_key,isTMF:f.isTeamMemberFolder(e)}},a)):p===_.MODIFIED?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.ts,isTMF:f.isTeamMemberFolder(e)}},r):p===_.CATEGORY?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:f.getCategoryDescription(e),isTMF:f.isTeamMemberFolder(e)}},r):p===_.EXTENSION?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:f.getExtension(e),isTMF:f.isTeamMemberFolder(e)}},r):p===_.SIZE&&(this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:-e.bytes,isTMF:f.isTeamMemberFolder(e)}},r)),this._currentSort={sortField:p,direction:l},n?this.emit_change():void 0},r.prototype._setClipboardToSelectedFiles=function(){return this._clipboardFiles=this.selectedFiles(),this.emit_change()},r.prototype._updateContextFile=function(e){return this._contextFile=e,this.emit_change()},r.prototype._updateRenameState=function(e,t){var n;return t?(n=Object.keys(b).map(function(e){return b[e]}),assert(indexOf.call(n,t)>=0,"_updateRenameState received: "+t+", but expected one of: "+n),this._fileRename=new g({file:e,state:t})):this._fileRename=null,this.emit_change()},r.prototype._setNewFolderCreationState=function(e){return this._newFolderCreationState=e,this.emit_change()},r.prototype.setFilePathsToSelectOnNextUpdate=function(t){var n,o;return n=null!=(o=t.fqPathsToSelect)?o:[],this._filePathsToSelectOnNextUpdate=e.Set(n)},r.prototype._addCommentStatusBatch=function(e){var t;return t=e.commentStatusByFqPath,Object.keys(t).map(function(e){return function(n){var o,r;return o=e._unsortedFiles.get(n),null!=o?(r=o.merge(t[n]),e._insertOrUpdateFile({file:r,forceUpdate:!0})):void 0}}(this)),this.emit_change()},r.prototype._addFileJumpKeyCode=function(e){var t,n,o,r,i,s,a,l;for(i=e.keyChar,this._activeFileJumpFilter+=i.toLowerCase(),o=null,a=this._fileJumpIndex,r=0,s=a.length;s>r;r++)if(l=a[r],n=l.fqPath,t=l.filename,t>=this._activeFileJumpFilter){o=n;break}return null!=o?this.selectFqPaths({fqPathsToSelect:[o]}):void 0},r.prototype._resetFileJump=function(){return this._activeFileJumpFilter=""},r.prototype._buildFileJumpIndex=function(){return this._fileJumpIndex=this._unsortedFiles.keySeq().toArray().map(function(e){var t;return t=o.filename(e).toLowerCase(),{filename:t,fqPath:e}}),this._fileJumpIndex.sort(function(e,t){var n,o;return n=e.filename,o=t.filename,o>n?-1:n>o?1:0})},r.prototype._applyFileDelta=function(e){var t,n,r,i;return n=e.before,t=e.after,i=e.pathForDelta,t&&!o.paths_are_equal(o.parent_dir(t.fq_path),i)&&(t=null),t===n||(r=t&&this._unsortedFiles.get(t.fq_path),r&&r.sjid>=t.sjid)?void 0:(t&&n?this._replaceFile({existingFile:n,newFile:t}):t&&!n?this._insertOrUpdateFile({file:t}):n&&!t&&this._removeFile({file:n}),this._updateQuotaStats({before:n,after:t}))},r.prototype._updateQuotaStats=function(e){var t,n,o,r,i;return n=e.before,t=e.after,this._context.cdmMveQuotaStats?(o=(null!=t?t.bytes:void 0)||0,i=(null!=n?n.bytes:void 0)||0,r=this._context.cdmMveQuotaStats.update("quotaRawBytesUsed",function(e){return e+o-i}),this._context=this._context.set("cdmMveQuotaStats",r)):void 0},r.prototype._insertOrUpdateFile=function(e){var t,n,o,r,i,s,a,l;return r=e.file,i=null!=(a=e.forceUpdate)?a:!1,this._unsortedFiles=this._unsortedFiles.set(r.fq_path,r),s=r.fq_path.toLowerCase(),t=function(e){return e.fq_path.toLowerCase()===s},l=this._sortedFiles.findEntry(t)||[null,null],o=l[0],n=l[1],n?i||r.sjid>n.sjid?this._sortedFiles=this._sortedFiles.set(o,r):void 0:this._sortedFiles=this._sortedFiles.push(r)},r.prototype._removeFile=function(e){var t,n;return t=e.file,assert(this._unsortedFiles.has(t.fq_path),"trying to remove a file that doesn't exist in the file map"),n=this._sortedFiles.indexOf(t),assert(-1!==n,"tried to remove file that doesn't exist in the sorted file list"),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._sortedFiles=this._sortedFiles.delete(n)},r.prototype._replaceFile=function(e){var t,n,o,r;return t=e.existingFile,o=e.newFile,assert(this._unsortedFiles.has(t.fq_path),"tried to replace file, but previous file doesn't exist in map"),n=this._sortedFiles.indexOf(t),assert(-1!==n,"tried to update file, but previous file doesn't exist in sorted list"),t.fq_path===o.fq_path?(this._sortedFiles=this._sortedFiles.set(n,o),this._unsortedFiles=this._unsortedFiles.set(t.fq_path,o)):(this._sortedFiles=this._sortedFiles.delete(n),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._unsortedFiles=this._unsortedFiles.set(o.fq_path,o),this._sortedFiles=this._sortedFiles.push(o),(null!=(r=this._fileRename)?r.state:void 0)===b.SAVING_INPUT?(this._updateRenameState(t,null),this.selectFqPaths({fqPathsToSelect:[o.fq_path]})):void 0)},r.prototype._new_payload=function(e){switch(e.action.type){case d.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case d.LOAD_PATH:return this._setPathData(e.action.data);case d.ADD_FILES:return this._appendFiles(e.action.data);case d.SET_PATH:return this._setPath(e.action.data);case d.SET_USER:return this._setUser(e.action.data);case d.SET_URL_PREFIX:return this._setUrlPrefix(e.action.data);case d.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case d.OPEN_PREVIEW:return this._setPreviewFile(e.action.data);case d.CLOSE_PREVIEW:return this._setPreviewFile(e.action.data);case d.SET_ACTIVE_TAB:return this._setActiveTab(e.action.data);case d.SET_SELECTION:return this._setSelection(e.action.data);case d.SELECT_FILES_BY_FQ_PATH:return this.selectFqPaths(e.action.data);case d.SET_LOADING_STATE:return this._setLoadingState(e.action.data);case d.SET_SEARCH_ACTIVE:return this._setSearchActive(e.action.data);case d.SET_MOUNT_POINTS:return this._setMountPoints(e.action.data);case d.SET_TEAM_FOLDERS:return this._setTeamFolders(e.action.data);case d.SET_SHOULD_SHOW_DELETED_FILES:return this._setShouldShowDeletedFiles(e.action.data);case d.SET_DROP_TARGET:return this._setDropTarget(e.action.data);case d.SET_COPY_MODE:return this._setCopyMode(e.action.data);case d.COPY_SELECTED_FILES_TO_CLIPBOARD:return this._setClipboardToSelectedFiles();case d.SORT_FILES:return this._sortFiles(e.action.data);case d.REQUEST_NEW_FILE_NAME:return this._updateRenameState(e.action.data.file,b.PENDING_INPUT);case d.SET_FILE_RENAME_PENDING:return this._updateRenameState(e.action.data.file,b.SAVING_INPUT);case d.SET_FILE_RENAME_COMPLETE:case d.CANCEL_FILE_RENAME:return this._updateRenameState(e.action.data.file,null);case d.REQUEST_FOLDER_NAME:return this._setNewFolderCreationState(E.PENDING_INPUT);case d.CREATE_FOLDER_PENDING:return this._setNewFolderCreationState(E.SAVING_INPUT);case d.CREATE_FOLDER_COMPLETE:case d.CANCEL_CREATE_FOLDER:return this._setNewFolderCreationState(E.CREATE_FOLDER_INACTIVE);case d.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return this.setFilePathsToSelectOnNextUpdate(e.action.data);case d.TEAM_FOLDER_DOWNGRADE:return this._applyTeamFolderDowngrade(e.action.data.nsId);case d.ADD_COMMENT_STATUS_BATCH:return this._addCommentStatusBatch(e.action.data);case d.ADD_FILE_JUMP_KEY_CODE:return this._addFileJumpKeyCode(e.action.data);case d.RESET_FILE_JUMP:return this._resetFileJump();case d.SET_CONTEXT_FILE:return this._updateContextFile(e.action.data.file)}},r}(r),{BrowseStore:new m}}),define("modules/clean/react/bubble",["external/react","external/underscore","modules/clean/css"],function(e,t,n){var o,r,i;return i=e.DOM,o={TOP:"top",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",RIGHT:"right",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom",LEFT:"left",LEFT_TOP:"left-top",LEFT_BOTTOM:"left-bottom"},r=e.createClass({displayName:"Bubble",statics:{ARROW:o},propTypes:{arrow:e.PropTypes.oneOf(t.values(o)),className:e.PropTypes.string},getDefaultProps:function(){return{arrow:null,className:""}},componentWillMount:function(){return"undefined"!=typeof window&&null!==window?n.require_css("/static/css/react/bubble_box-vflhusCtq.css"):void 0},render:function(){var e,n;return e=["react-bubble-box","react-bubble-box--arrow-"+this.props.arrow,this.props.className],n=t.extend({},t.omit(this.props,["arrow","className"]),{className:e.join(" ")}),i.div(n,this._renderArrow(),this.props.children)},_renderArrow:function(){return null!=this.props.arrow?[i.div({className:"react-bubble-box__arrow-border",key:"arrow-border"}),i.div({className:"react-bubble-box__arrow",key:"arrow"})]:[]}})}),define("modules/clean/react/bubble_dropdown",["jquery","external/classnames","external/jquery_ui","external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/core/dom"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h,_;return _=l.getFocusableElementsIn,h=r.DOM,d="react-bubble-dropdown-root",p=function(){var t;return t=e("#"+d),t.length||(t=e('<div tabindex="-1"/>').attr({id:d}).prependTo("body")),t[0]},u=r.createClass({displayName:"BubbleDropdownContents",propTypes:{target_node:r.PropTypes.instanceOf(HTMLElement).isRequired,targetFixed:r.PropTypes.bool.isRequired,label_id:r.PropTypes.string,arrow_position:r.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:r.PropTypes.number,horizontal_displacement:r.PropTypes.number,anchor_bottom:r.PropTypes.bool,show_arrow:r.PropTypes.bool,className:r.PropTypes.string,extra_css_class:r.PropTypes.string,justify:r.PropTypes.bool},componentDidMount:function(){var t,n,o,r,s,a,l,c,u,p,h,_,m,f,g,v;if(null!=this.refs.dropdown){switch(r=this._arrow_direction(),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[r],o=e(this.props.target_node),n=e(i.findDOMNode(this.refs.dropdown)),t=e(i.findDOMNode(this.refs.arrow)),h=e("#"+d).position().top,v=t.outerWidth(),l=t.outerHeight(),_=t.position().top,c=this.props.horizontal_displacement||0,u=t.position().left+c,g=this.props.vertical_displacement||0,m=l+h,this._arrow_direction()){case"left":s=0>m?"left+"+v+"px top+"+-m+"px":"left+"+v+"px top-"+m+"px";break;case"right":s=0>m?"right-"+v+"px top+"+-m+"px":"right-"+v+"px top-"+m+"px";break;case"top":m=l-h-g,s=0>m?"left-"+u+"px top-"+-m+"px":"left-"+u+"px top+"+m+"px";break;case"bottom":a=l+h-g,s=0>a?"left-"+u+"px bottom+"+-a+"px":"left-"+u+"px bottom-"+a+"px"}return f=function(e){return function(t){var n,r,i;return i=t.top,r=t.left,e.props.anchor_bottom?(n=e.props.targetFixed?document.documentElement.clientHeight-o[0].getBoundingClientRect().top-g:document.documentElement.clientHeight-o.offset().top-g,e.setState({dropdown_style:{bottom:n,left:r}})):e.setState({dropdown_style:{top:i,left:r}})}}(this),p={my:s,at:this.target_position,of:o,collision:"none",using:f},n.position(p),e("#"+d).attr("aria-labelledby",this.props.label_id),this.props.show_arrow?void 0:(t.css("visibility","hidden"),e(".bubble-arrow-border").css("visibility","hidden"))}},render:function(){return h.div({className:t("bubble-dropdown",this.props.extra_css_class,this.props.className,this.props.arrow_position,{justify:this.props.justify}),style:this.state.dropdown_style,ref:"dropdown"},this.props.children,h.div({className:"bubble-arrow-border"}),h.div({className:"bubble-arrow",ref:"arrow"}))},_arrow_direction:function(){var e;return"top"===this.props.arrow_position.substring(0,3)?e="top":"bottom"===this.props.arrow_position.substring(0,6)?e="bottom":"left"===this.props.arrow_position.substring(0,4)?e="left":"right"===this.props.arrow_position.substring(0,5)&&(e="right"),e},getInitialState:function(){return{dropdown_style:{}}}}),c=r.createClass({displayName:"BubbleDropdown",statics:{DROPDOWN_ROOT_ID:d},propTypes:{targetButton:function(e,t,n){return null==e.targetButton||"button"!==e.targetButton.type?new Error("BubbleDropdown's targetButton must be a `<button>`"):void 0},targetFixed:r.PropTypes.bool,arrow_position:r.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:r.PropTypes.number,horizontal_displacement:r.PropTypes.number,show_arrow:r.PropTypes.bool,anchor_bottom:r.PropTypes.bool,className:r.PropTypes.string,extra_css_class:r.PropTypes.string,container_css_class:r.PropTypes.string,bubbleDropdownShown:r.PropTypes.func,bubbleDropdownHidden:r.PropTypes.func,autofocus:r.PropTypes.bool,position:r.PropTypes.oneOf(["static","relative","fixed","absolute"]),bubbleDropdownScrollable:r.PropTypes.bool,closeBubbleDropdownOnWindowScroll:r.PropTypes.bool,shouldDisableBubbleDropdownHideOnResize:r.PropTypes.bool,justify:r.PropTypes.bool,disabled:r.PropTypes.bool},getDefaultProps:function(){return{vertical_displacement:0,horizontal_displacement:0,anchor_bottom:!1,show_arrow:!0,className:null,extra_css_class:"",container_css_class:"",position:"fixed",autofocus:!1,targetFixed:!1,bubbleDropdownScrollable:!1,closeBubbleDropdownOnWindowScroll:!0,justify:!1,disabled:!1}},render:function(){return h.div({className:t("bubble-dropdown-container",this.props.container_css_class),onMouseDown:this.preventSelection,onMouseUp:this.toggle,onKeyDown:this.targetKeyDown,ref:"target",id:this.containerId},this.props.targetButton)},render_tooltip:function(){var t,n;return n=p(),this.shown?(e("#"+d).css("position",this.props.position),this.props.anchor_bottom?(e("#"+d).css("bottom","0"),e("#"+d).css("top","auto")):(e("#"+d).css("top","0"),e("#"+d).css("bottom","auto")),t=r.createElement(u,{target_node:this.getTargetButton(),targetFixed:this.props.targetFixed,label_id:this.containerId,arrow_position:this.props.arrow_position,vertical_displacement:this.props.vertical_displacement,horizontal_displacement:this.props.horizontal_displacement,anchor_bottom:this.props.anchor_bottom,show_arrow:this.props.show_arrow,extra_css_class:this.props.extra_css_class,className:this.props.className,justify:this.props.justify},this.props.children),i.render(t,n)):i.unmountComponentAtNode(n)},preventSelection:function(e){return e.preventDefault()},targetKeyUp:function(e){return e.preventDefault()},componentWillMount:function(){return this.eventId=s.uniqueId(),this.containerId="bubbleDropdownTarget"+this.eventId},componentDidMount:function(){return this.shown=!1,this.$target=e(i.findDOMNode(this.refs.target)),e(this.getTargetButton()).addClass("bubble-dropdown-target").attr("aria-expanded",this.shown),this.props.disabled&&(e(this.getTargetButton()).addClass("disabled"),this.$target.addClass("disabled")),this.bodyClickHandler=function(t){return function(n){var o,r;if(t.shown)return o=e(n.target),o.is("select")?!0:(r=o.closest(t.$target).length||o.closest(e("#"+d)).length,r||t.hide(),!0)}}(this),e("body").on("mouseup."+this.eventId,this.bodyClickHandler)},componentDidUpdate:function(){return e(this.getTargetButton()).addClass("bubble-dropdown-target").attr("aria-expanded",this.shown),this.shown?this.render_tooltip():void 0},bindDocHandlers:function(){return this.hasBindedDocHandlers?void 0:(key("esc",this.hideIfShown),this.props.bubbleDropdownScrollable?e("*").not("#"+d+" *").on("scroll."+this.eventId,this.hideIfShown):e("*").on("scroll."+this.eventId,this.hideIfShown),this.props.closeBubbleDropdownOnWindowScroll&&e(window).on("scroll."+this.eventId,this.hideIfShown),this.props.shouldDisableBubbleDropdownHideOnResize||e(window).on("resize."+this.eventId,this.hideIfShown),e("#"+d).on("keydown",this.dropdownKeyDown),this.hasBindedDocHandlers=!0)},unbindDocHandlers:function(){return this.hasBindedDocHandlers?(e("body").off("mouseup."+this.eventId),e("*").off("scroll."+this.eventId),e(window).off("scroll."+this.eventId),this.props.shouldDisableBubbleDropdownHideOnResize||e(window).off("resize."+this.eventId),e("#"+d).off("keydown",this.dropdownKeyDown),this.hideIfShown()):void 0},targetKeyDown:function(e){var t;(t=e.keyCode)!==a.ENTER&&t!==a.SPACE||(this.toggle(),e.preventDefault()),e.keyCode===a.TAB&&(e.shiftKey?this.hide():this.shown&&(this.focusInDropdown(),e.preventDefault()))},dropdownKeyDown:function(t){var n,o,r;if(t.keyCode===a.TAB){if(n=e("#"+d)[0],o=this.getFocusableDropdownElements(),t.shiftKey){if((r=t.target)===n||r===o[0])return this.getTargetButton().focus(),t.preventDefault()}else if(t.target===o[o.length-1]||t.target===n&&0===o.length)return this.hide(),this.getTargetButton().focus()}else if(t.keyCode===a.ESC)return this.hide(),this.getTargetButton().focus(),t.stopPropagation()},focusInDropdown:function(){var t;return this.props.autofocus&&(t=this.getFocusableDropdownElements()[0]),t||(t=e("#"+d)[0]),t.focus()},getTargetButton:function(){var e;return null!=(e=i.findDOMNode(this.refs.target))?e.firstChild:void 0},getFocusableDropdownElements:function(){return _("#"+d+" .bubble-dropdown")},hideIfShown:function(){return this.shown?this.hide():void 0},componentWillUnmount:function(){return this.unbindDocHandlers(),e("body").off("mouseup."+this.eventId,this.bodyClickHandler)},toggle:function(){this.shown?this.hide():this.show()},show:function(){var t;if(!this.props.disabled)return this.shown=!0,e(this.getTargetButton()).addClass("bubble-dropdown-target--active").attr("aria-expanded",!0),this.render_tooltip(),this.focusInDropdown(),"function"==typeof(t=this.props).bubbleDropdownShown&&t.bubbleDropdownShown(),this.bindDocHandlers()},hide:function(){var t;return this.shown=!1,e(this.getTargetButton()).removeClass("bubble-dropdown-target--active").attr("aria-expanded",!1),this.render_tooltip(),"function"==typeof(t=this.props).bubbleDropdownHidden?t.bubbleDropdownHidden():void 0},isShown:function(){return this.shown}})}),define("modules/clean/react/bubble_dropdown_v2",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/overlay"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_;return d=a.PositionedOverlay,_=n.DOM,h=n.createElement,u=d.POSITIONS,c=n.createClass({displayName:"BubbleDropdownContents",propTypes:{targetNode:n.PropTypes.instanceOf(HTMLElement).isRequired,position:n.PropTypes.oneOf(r.values(u)).isRequired,verticalArrowOffset:n.PropTypes.number,horizontalArrowOffset:n.PropTypes.number,shouldShowArrow:n.PropTypes.bool,shouldArrowDecrement:n.PropTypes.bool,className:n.PropTypes.string,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{verticalArrowOffset:0,horizontalArrowOffset:0,shouldShowArrow:!0,shouldArrowDecrement:!0,className:null,isMaestroDesign:!1}},componentDidMount:function(){return this._adjustArrowPosition()},componentDidUpdate:function(){return this._adjustArrowPosition(!0)},_getArrowStyleFromPosition:function(){
var e,t;return t={},t[""+u.TOP_LEFT]="top-left",t[""+u.TOP]="top",t[""+u.TOP_RIGHT]="top-right",t[""+u.LEFT_TOP]="left-top",t[""+u.LEFT]="left",t[""+u.LEFT_BOTTOM]="left-bottom",t[""+u.RIGHT_TOP]="right-top",t[""+u.RIGHT]="right",t[""+u.RIGHT_BOTTOM]="right-bottom",t[""+u.BOTTOM_LEFT]="bottom-left",t[""+u.BOTTOM]="bottom",t[""+u.BOTTOM_RIGHT]="bottom-right",t[""+u.TOP_ALIGN_LEFT]="top-align-left",t[""+u.TOP_ALIGN_RIGHT]="top-align-right",t[""+u.LEFT_ALIGN_TOP]="left-align-top",t[""+u.LEFT_ALIGN_BOTTOM]="left-align-bottom",t[""+u.RIGHT_ALIGN_TOP]="right-align-top",t[""+u.RIGHT_ALIGN_BOTTOM]="right-align-bottom",t[""+u.BOTTOM_ALIGN_LEFT]="bottom-align-left",t[""+u.BOTTOM_ALIGN_RIGHT]="bottom-align-right",e=t,e[this.props.position]},_adjustArrowPosition:function(t){var n;if(null==t&&(t=!1),this.props.shouldShowArrow){switch(n=e(o.findDOMNode(this.refs.bubbleArrowContainer)),this.props.position){case u.TOP_ALIGN_LEFT:case u.BOTTOM_ALIGN_LEFT:n.css("left",this.props.targetNode.offsetWidth/2);break;case u.TOP_ALIGN_RIGHT:case u.BOTTOM_ALIGN_RIGHT:n.css("right",this.props.targetNode.offsetWidth/2);break;case u.LEFT_ALIGN_TOP:case u.RIGHT_ALIGN_TOP:n.css("top",this.props.targetNode.offsetHeight/2);break;case u.LEFT_ALIGN_BOTTOM:case u.RIGHT_ALIGN_BOTTOM:n.css("bottom",this.props.targetNode.offsetHeight/2)}return(!t||t&&this.props.shouldArrowDecrement)&&(this.props.verticalArrowOffset||this.props.horizontalArrowOffset)&&(this._getArrowStyleFromPosition().match(/^(top|bottom)/)&&n.css("left","-="+this.props.horizontalArrowOffset),this._getArrowStyleFromPosition().match(/^(left|right)/))?n.css("top","-="+this.props.verticalArrowOffset):void 0}},render:function(){return _.div({className:this.props.isMaestroDesign?"maestro":""},_.div({ref:"dropdown",className:t("bubble-dropdown-v2","bubble-dropdown-v2--"+this._getArrowStyleFromPosition(),this.props.className),"aria-labelledby":this.props.targetNode.id},this.props.children,this.props.shouldShowArrow?_.div({ref:"bubbleArrowContainer",className:"bubble-arrow-container"},_.div({className:"bubble-arrow-border"}),_.div({className:"bubble-arrow"})):null))}}),p=n.createClass({displayName:"BubbleDropdown",propTypes:{targetButton:function(e,t,n){return null==e.targetButton||"button"!==e.targetButton.type?new Error("BubbleDropdown's targetButton must be a `<button>`"):void 0},position:n.PropTypes.oneOf(r.values(u)).isRequired,targetFixed:n.PropTypes.bool,verticalDisplacement:n.PropTypes.number,horizontalDisplacement:n.PropTypes.number,className:n.PropTypes.string,disabled:n.PropTypes.bool,shouldShowArrow:n.PropTypes.bool,shouldTrapKeyboardFocus:n.PropTypes.bool,onShowDropdown:n.PropTypes.func,onHideDropdown:n.PropTypes.func,shouldArrowDecrement:n.PropTypes.bool,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{targetFixed:!1,verticalDisplacement:0,horizontalDisplacement:0,className:null,disabled:!1,shouldShowArrow:!0,shouldTrapKeyboardFocus:!1,onShowDropdown:r.noop,onHideDropdown:r.noop,shouldArrowDecrement:!0,isMaestroDesign:!1}},getInitialState:function(){return{isVisible:!1,targetNode:null,shouldAutoFocusDropdownContent:!1}},componentWillMount:function(){return this.hasOnShowNotBeenCalledSinceLastOpened=!1},updateTargetNode:function(){var e;return e=o.findDOMNode(this.refs.bubbleDropdownContainer).childNodes[0],e&&!e.hasAttribute("id")&&e.setAttribute("id","bubbleDropdownTarget-"+r.uniqueId()),this.setState({targetNode:e})},componentDidMount:function(){return this.updateTargetNode()},componentWillUpdate:function(e,t){return this.state.isVisible&&!this.props.disabled||!t.isVisible||e.disabled?void 0:this.hasOnShowNotBeenCalledSinceLastOpened=!0},componentDidUpdate:function(e,t){var n;return t.isVisible!==this.state.isVisible&&(this.state.isVisible||this._hasHidden()),n=o.findDOMNode(this.refs.bubbleDropdownContainer).childNodes[0],n!==this.state.targetNode?this.updateTargetNode():void 0},showDropdown:function(){return this.props.disabled?void 0:this.setState({isVisible:!0})},hideDropdown:function(){return this.props.disabled?void 0:this.setState({isVisible:!1})},_handleClick:function(e){var t;return t=!(e.clientX>0&&e.clientY>0),this.setState({shouldAutoFocusDropdownContent:t},this._toggle)},_toggle:function(){return this.props.disabled?void 0:this.setState({isVisible:!this.state.isVisible})},_hasShown:function(){return this.state.targetNode.setAttribute("aria-expanded",!0),this.hasOnShowNotBeenCalledSinceLastOpened?(this.props.onShowDropdown(),this.hasOnShowNotBeenCalledSinceLastOpened=!1):void 0},_hasHidden:function(){return this.state.targetNode.setAttribute("aria-expanded",!1),this.props.onHideDropdown()},render:function(){return _.div({className:"bubble-dropdown-v2-container",onClick:this._handleClick,ref:"bubbleDropdownContainer"},this.props.targetButton,this.state.isVisible&&!this.props.disabled?h(d,{targetNode:this.state.targetNode,isTargetPositionFixed:this.props.targetFixed,shouldTrapKeyboardFocus:this.props.shouldTrapKeyboardFocus,shouldAutoFocusOverlayContent:this.state.shouldAutoFocusDropdownContent,position:this.props.position,positionOffset:{horizontal:this.props.horizontalDisplacement,vertical:this.props.verticalDisplacement},onRendered:function(e){return function(){return e._hasShown()}}(this),onBlur:function(e){return function(){return e.hideDropdown()}}(this)},h(c,{ref:"bubbleDropdownContents",targetNode:this.state.targetNode,position:this.props.position,verticalArrowOffset:this.props.verticalDisplacement,horizontalArrowOffset:this.props.horizontalDisplacement,shouldShowArrow:this.props.shouldShowArrow,className:this.props.className,shouldArrowDecrement:this.props.shouldArrowDecrement,isMaestroDesign:this.props.isMaestroDesign},this.props.children)):void 0)}}),l=s(p,["/static/css/components/bubble_dropdown_v2-vflhhYVBe.css"]),l.POSITIONS=u,l}),define("modules/clean/react/bubble_menu",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/bubble_dropdown_v2"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_;return _=n.DOM,h=n.createElement,p=function(e,t,n){var o,r;return o=e[t].type,o!==l&&o!==d&&o!==c?(r=(null!=o?o.displayName:void 0)||e[t],new Error("Expected menu items to be instances of BubbleMenuItem, not "+r+".")):void 0},u={DEFAULT:1,CHECKBOX:2,RADIO:3},l=n.createClass({displayName:"BubbleMenuItem",propTypes:{onClick:n.PropTypes.func,href:n.PropTypes.string,target:n.PropTypes.string,disabled:n.PropTypes.bool,closeOnClick:n.PropTypes.bool,closeFunc:n.PropTypes.func,className:n.PropTypes.string,onMouseEnter:n.PropTypes.func,onMouseLeave:n.PropTypes.func,itemType:n.PropTypes.oneOf(r.values(u)),checked:n.PropTypes.bool},getDefaultProps:function(){return{onClick:r.noop,href:"#",target:null,disabled:!1,closeOnClick:!0,closeFunc:r.noop,className:null,onMouseEnter:r.noop,onMouseLeave:r.noop,itemType:u.DEFAULT,checked:null}},_handleMouseEnter:function(t){return null!=this.refs.item?(e(o.findDOMNode(this.refs.item)).closest(".bubble-menu").removeClass("bubble-menu--keyboard"),this.props.onMouseEnter(t)):void 0},_handleClick:function(e){return this.props.disabled?(e.preventDefault(),e.stopPropagation()):"#"===this.props.href&&(e.preventDefault(),this.props.onClick(e),this.props.closeOnClick)?this.props.closeFunc():void 0},_getRole:function(){switch(this.props.itemType){case u.CHECKBOX:return"menuitemcheckbox";case u.RADIO:return"menuitemradio";default:return"menuitem"}},_getAriaChecked:function(){switch(this.props.itemType){case u.CHECKBOX:case u.RADIO:return this.props.checked||!1;default:return null}},renderContents:function(){var e;return e={"bubble-menu-item":!0,"bubble-menu-item--disabled":this.props.disabled,"bubble-menu-item--checked":this.props.checked},_.a({ref:"item",role:this._getRole(),className:t(e),href:this.props.href,target:this.props.target,onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,onMouseLeave:this.props.onMouseLeave,"aria-disabled":this.props.disabled,"aria-checked":this._getAriaChecked()},this.props.children)},render:function(){return _.li({role:"presentation",className:t("bubble-menu-item-wrapper",this.props.className)},this.renderContents())}}),l.TYPES=u,d=n.createClass({displayName:"BubbleMenuSeparator",propTypes:{className:n.PropTypes.string},getDefaultProps:function(){return{className:"bubble-menu-item-separator"}},render:function(){return _.li({role:"separator",className:this.props.className},this.props.children)}}),c=n.createClass({displayName:"BubbleMenuItemGroup",props:{items:n.PropTypes.arrayOf(p).isRequired,closeFunc:n.PropTypes.func},render:function(){var e,t;return 0===this.props.items.length?null:_.li({className:"bubble-menu-item-group",role:"presentation"},_.ul({className:"bubble-menu-item-group u-unlist u-trim-padding",role:"group"},function(){var o,r,i,s,a;for(i=this.props.items,a=[],e=o=0,r=i.length;r>o;e=++o)t=i[e],a.push(n.cloneElement(t,{closeFunc:this.props.closeFunc,key:null!=(s=t.key)?s:e}));return a}.call(this)))}}),a=n.createClass({displayName:"BubbleMenu",propTypes:r.extend({},s.propTypes,{headerContent:n.PropTypes.element,items:n.PropTypes.arrayOf(p).isRequired,onShowDropdown:n.PropTypes.func,targetButton:function(e,t,n){var o;return"button"!==(null!=(o=e.targetButton)?o.type:void 0)?new Error("BubbleDropdown's targetButton must be a `<button>`, found: "+e[t].type):void 0}}),showMenu:function(){var e,t;return null!=(e=this.refs.bubble)&&null!=(t=e.getWrappedComponent())?t.showDropdown():void 0},hideMenu:function(){var e,t;return null!=(e=this.refs.bubble)&&null!=(t=e.getWrappedComponent())?t.hideDropdown():void 0},_onShowBubbleMenu:function(){var t;if(null!=this.refs.menu&&null!=this.refs.bubble)return this.$menu=e(o.findDOMNode(this.refs.menu)),this.$menuitems=this.$menu.find('*[role="menuitem"],*[role="menuitemcheckbox"],*[role="menuitemradio"]'),this.$menu.addClass("bubble-menu--keyboard"),"function"==typeof(t=this.props).onShowDropdown?t.onShowDropdown():void 0},_onKeyDown:function(e){return this.$menu.addClass("bubble-menu--keyboard"),e.keyCode===i.DOWN?(this._focusNext(e.target),e.preventDefault(),e.stopPropagation()):e.keyCode===i.UP?(this._focusPrevious(e.target),e.preventDefault(),e.stopPropagation()):void 0},_onKeyPress:function(e){var t,n,o,r,i,s,a,l,c,u,d,p;for(this.$menu.addClass("bubble-menu--keyboard"),i=null!=(l=e.which)?l:e.keyCode,r=String.fromCharCode(i).toLowerCase(),c=this.$menuitems,p=[],n=o=0,s=c.length;s>o;n=++o){if(a=c[n],t=null!=(u=a.textContent)&&null!=(d=u[0])?d.toLowerCase():void 0,t===r&&n>this.$menuitems.index(e.target)){a.focus(),e.stopPropagation();break}p.push(void 0)}return p},_focusPrevious:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},_focusNext:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},render:function(){var e,t,o;return this.props.targetButton&&(o=n.cloneElement(this.props.targetButton,{ref:"targetButton","aria-haspopup":!0})),h(s,r.extend({},this.props,{ref:"bubble",shouldTrapKeyboardFocus:!0,onShowDropdown:this._onShowBubbleMenu,targetButton:o}),_.div({},this.props.headerContent),_.ul({role:"menu",ref:"menu",className:"bubble-menu",onKeyDown:this._onKeyDown,onKeyPress:this._onKeyPress},function(){var o,r,i,s,a;for(i=this.props.items,a=[],e=o=0,r=i.length;r>o;e=++o)t=i[e],a.push(n.cloneElement(t,{closeFunc:this.hideMenu,key:null!=(s=t.key)?s:e}));return a}.call(this)))}}),a.POSITIONS=s.POSITIONS,{BubbleMenuItem:l,BubbleMenuSeparator:d,BubbleMenuItemGroup:c,BubbleMenu:a}}),define("modules/clean/react/calendar",["require","exports","tslib","external/classnames","external/components","external/react","external/react-dom","modules/clean/datetime","modules/clean/react/css","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u){"use strict";function d(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}var p=9,h=27,_=37,m=38,f=39,g=40,v=function(){},y=0,E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={currentDate:t.props.initDate,calendarIsVisible:t.props.calendarIsInitiallyVisible},t.setCalendarDateViewRef=function(e){t.refCalendarDateView=s.findDOMNode(e)},t.setCalendarViewRef=function(e){t.refCalendarView=s.findDOMNode(e)},t._handleDocumentClick=function(e){if(t.refCalendarView&&t.refCalendarDateView){var n=e.target;!t.state.calendarIsVisible||t.refCalendarView.contains(n)||t.refCalendarDateView.contains(n)||(e.preventDefault(),e.stopPropagation(),t.closeCalendar())}},t.toggleCalendarView=function(){t.setState({calendarIsVisible:!t.state.calendarIsVisible})},t.handleDateSelected=function(e){t.setState({currentDate:e}),t.props.onDateChange(e),t.closeCalendar()},t.closeCalendar=function(){t.setState({calendarIsVisible:!1}),t.refCalendarDateView&&t.refCalendarDateView.focus()},t._startOfDay=function(e){var t=new Date(e.getTime());return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){document.addEventListener("click",this._handleDocumentClick)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this._handleDocumentClick)},t.prototype.render=function(){var e,t={"c-datepicker":!0,"scooter-css u-l-fl clearfix":!this.props.isMaestroDesign};return this.state.calendarIsVisible&&(e=i.createElement(S,{ref:this.setCalendarViewRef,alignAtLeft:this.props.alignAtLeft,firstDay:this._startOfDay(this.props.firstDay),lastDay:this._startOfDay(this.props.lastDay),initDate:this.state.currentDate,onDateChange:this.handleDateSelected,onEscapePressed:this.closeCalendar})),i.createElement("div",{className:o(t)},i.createElement(b,{date:this.state.currentDate,ref:this.setCalendarDateViewRef,calendarVisible:this.state.calendarIsVisible,disabled:this.props.disabled,isMaestroDesign:this.props.isMaestroDesign,onClick:this.toggleCalendarView}),e)},t}(i.Component);E.displayName="Calendar",E.defaultProps=function(){var e=new Date,t=new Date(e.getTime());t.setFullYear(t.getFullYear()-1);var n=new Date(e.getTime());return n.setFullYear(n.getFullYear()+1),{disabled:!1,initDate:e,isMaestroDesign:!1,firstDay:t,lastDay:n,alignAtLeft:!0,onDateChange:v,calendarIsInitiallyVisible:!1}}();var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._date_to_string=function(e){return a.format_date(e,a.localized_date_format)},t.renderLegacyCaret=function(){return i.createElement(c,{group:"web",name:"calendar_view_month",className:"u-l-fr",alt:t.props.description})},t}return n.__extends(t,e),t.prototype.render=function(){var e={"is-active":this.props.calendarVisible,"c-input":!this.props.isMaestroDesign,"filter-item__filter-input":this.props.isMaestroDesign};if(this.props.isMaestroDesign)return i.createElement(r.DropdownButton,{disabled:this.props.disabled,onClick:this.props.onClick,"aria-expanded":this.props.calendarVisible},this._date_to_string(this.props.date));var t=i.createElement("span",{className:"c-calendar__date-text"},this._date_to_string(this.props.date));return i.createElement("button",{className:o(e),disabled:this.props.disabled,onClick:this.props.onClick,"aria-expanded":this.props.calendarVisible},this.renderLegacyCaret(),t)},t}(i.Component);b.displayName="CalendarDateView",b.defaultProps={isMaestroDesign:!1,calendarVisible:!0,onClick:function(){},disabled:!1,description:u._("Change deadline")};var S=function(e){function t(t){var n=e.call(this,t)||this;return n.state={viewDate:n.props.initDate,currentlyActiveDate:n.props.initDate},n.clampToFirstLastDate=function(e){e<n.props.firstDay?e.setTime(n.props.firstDay.getTime()):e>n.props.lastDay&&e.setTime(n.props.lastDay.getTime())},n.getDaysInMonth=function(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},n.setPrevMonthButtonRef=function(e){n.refPrevButton=e},n.setNextMonthButtonRef=function(e){n.refNextButton=e},n.setCurrentDayButtonRefAndMaintainFocus=function(e){var t=document.activeElement&&document.activeElement.getAttribute("data-day-in-month");n.refCurrentDayButton=e,n.refCurrentDayButton&&t&&n.refCurrentDayButton.focus()},n.handleDayClicked=function(e){var t=e.target,o=parseInt(t.getAttribute("data-day-in-month")||"",10),r=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),o);n.setState({currentlyActiveDate:r}),n.props.onDateChange(r)},n.handleKeyDownOnDay=function(e){if(e.which===h)return n.props.onEscapePressed(),void e.preventDefault();if(e.which===p){var t=void 0,o=n.refNextButton.classList.contains("u-l-dn")?null:n.refNextButton,r=n.refPrevButton.classList.contains("u-l-dn")?null:n.refPrevButton;return t=e.shiftKey?o||r:r||o,t&&t.focus(),void e.preventDefault()}var i=-1!==[m,f,g,_].indexOf(e.which);if(i){var s=1,a=n.getDaysInMonth(n.props.initDate),l=(n.state.currentlyActiveDate||n.props.initDate).getDate(),c=null;switch(e.which){case m:c=Math.max(s,l-7);break;case f:c=Math.min(a,l+1);break;case g:c=Math.min(a,l+7);break;case _:c=Math.max(s,l-1)}if(null!=c){var u=new Date(n.state.viewDate.getTime());u.setDate(c),n.clampToFirstLastDate(u),n.setState({currentlyActiveDate:u})}e.preventDefault()}},n.renderDay=function(e,t){var r=!t;n.props.lastDay&&(t=t||e>n.props.lastDay),n.props.firstDay&&(t=t||e<n.props.firstDay);var s=d(n.state.currentlyActiveDate,e),l=d(n.props.initDate,e),c={"button-as-link":!t,"c-calendar__date":!0,"c-calendar__date--disabled":t,"current-month":r,"c-calendar__date--was-initially-active":l,"c-calendar__date--is-active":s},u=v;d(n.state.currentlyActiveDate,e)&&(u=n.setCurrentDayButtonRefAndMaintainFocus);var p="day"+e.getDate()+"-"+e.getMonth(),h=a.nice_date_with_month_name(e,!0,!0,!0);return i.createElement("td",{key:p},i.createElement("button",{className:o(c),disabled:t,onClick:t?void 0:n.handleDayClicked,onKeyDown:n.handleKeyDownOnDay,"data-day-in-month":e.getDate(),"aria-label":h,ref:u},e.getDate()))},n.renderDays=function(){for(var e=[],t=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),1),o=t.getDay(),r=o;r>0;r--){var s=new Date(t.getFullYear(),t.getMonth(),t.getDate());s.setDate(s.getDate()-r),e.push(n.renderDay(s,!0))}for(var a=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),1);a.getMonth()===n.state.viewDate.getMonth();)e.push(n.renderDay(a)),a=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),a.getDate()+1);for(var l=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth()+1,0);6!==l.getDay();)l=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1),e.push(n.renderDay(l,!0));var c=[],u=[];return e.forEach(function(e,t){u.push(e),(t+1)%7===0&&(c.push(i.createElement("tr",{key:"week-"+t},u)),u=[])}),c},n.offsetViewDateByMonth=function(e){n.setState({viewDate:new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth()+e,1)})},n.handleClickNextMonth=function(){n.offsetViewDateByMonth(1)},n.handleClickPrevMonth=function(){n.offsetViewDateByMonth(-1)},n.handleKeyDownMonthButton=function(e){if(e.which===h)return n.props.onEscapePressed(),void e.preventDefault();if(e.which===p){var t=!e.shiftKey,o=void 0,r=n.refNextButton.classList.contains("u-l-dn")?void 0:n.refNextButton,i=n.refPrevButton.classList.contains("u-l-dn")?void 0:n.refPrevButton,s=n.refCurrentDayButton;o=e.target===n.refPrevButton?t?r||s:s||r:t?s||i:i||s,o&&o.focus(),e.preventDefault()}},n.renderMonthChangers=function(){var e=[],t=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),1),r=new Date(n.state.viewDate.getFullYear(),n.state.viewDate.getMonth(),n.getDaysInMonth(n.state.viewDate)),s={"arrow-select":!0,"u-l-dn":t<=n.props.firstDay,"ax-focusable":!0,"u-l-fl":!0};e.push(i.createElement("button",{className:o(s),onClick:n.handleClickPrevMonth,ref:n.setPrevMonthButtonRef,onKeyDown:n.handleKeyDownMonthButton},i.createElement("span",{className:"c-arrow c-arrow--left u-thide"},u._("Previous month"))));var a={"arrow-select":!0,"u-l-dn":r>=n.props.lastDay,"ax-focusable":!0,"u-l-fr":!0};return e.push(i.createElement("button",{className:o(a),onClick:n.handleClickNextMonth,ref:n.setNextMonthButtonRef,onKeyDown:n.handleKeyDownMonthButton},i.createElement("span",{className:"c-arrow c-arrow--right u-thide"},u._("Next month")))),e},n.renderWeekdayRows=function(){var e=[u._("Sunday"),u._("Monday"),u._("Tuesday"),u._("Wednesday"),u._("Thursday"),u._("Friday"),u._("Saturday")];return e.map(function(e){return i.createElement("th",{key:e},i.createElement("abbr",{title:e},e.slice(0,3)))})},n.calendarId=++y,n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.refCurrentDayButton&&this.refCurrentDayButton.focus()},t.prototype.componentWillUpdate=function(e,t){if(t.viewDate&&t.viewDate.getMonth()!==this.state.viewDate.getMonth()){var n=new Date(t.viewDate.getTime()),o=this.getDaysInMonth(t.viewDate);n.setDate(Math.min(o,this.state.currentlyActiveDate.getDate())),this.clampToFirstLastDate(n),this.setState({currentlyActiveDate:n})}},t.prototype.render=function(){var e={"c-calendar":!0,"c-card":!0,"u-pad-xs":!0,"u-left":this.props.alignAtLeft,"u-right":!this.props.alignAtLeft},t="calendar-header-"+ ++this.calendarId,n=this.renderMonthChangers(),r=n[0],s=n[1],l=i.createElement("strong",{id:t,"aria-live":"assertive","aria-atomic":"true"},u._("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:a.month_name(this.state.viewDate.getMonth()),year:this.state.viewDate.getFullYear()}));return i.createElement("div",{className:o(e)},i.createElement("div",{className:"c-calendar__nav u-mar-bottom-s u-font-center u-cf"},r,s,l),i.createElement("table",{className:"c-calendar__picker"},i.createElement("thead",{className:"ax-visually-hidden"},i.createElement("tr",null,this.renderWeekdayRows())),i.createElement("tbody",null,this.renderDays())))},t}(i.Component);S.displayName="CalendarView",S.defaultProps={onDateChange:v,onEscapePressed:v,alignAtLeft:!1},t.CalendarView=S,t.Calendar=l(E,["/static/css/scooter/scooter-scoped-vflebHNBy.css","/static/css/components/calendar-vflO2TC4l.css"])}),define("modules/clean/react/columnheader",["jquery","external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n","modules/clean/css","modules/clean/react/css"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_,m,f,g,v,y;return h=i._,y=n.DOM,v=n.createElement,d={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},u={STATIC:"STATIC",SINGLE:"SINGLE",MULTI:"MULTI"},p=n.PropTypes.shape({label:n.PropTypes.string.isRequired,sortField:n.PropTypes.string,headerClassName:n.PropTypes.string}),c=n.PropTypes.shape({type:n.PropTypes.oneOf([u.STATIC,u.SINGLE,u.MULTI]).isRequired,label:n.PropTypes.string,headerClassName:n.PropTypes.string,sortField:n.PropTypes.string,content:n.PropTypes.node,columns:n.PropTypes.arrayOf(p)}).isRequired,g=function(e,t){var n,o,r,i;for(r=0,i=t.length;i>r;r++){if(n=t[r],n.sortField===e)return n;if(n.type===u.MULTI&&(o=g(e,n.columns)))return o}return null},l=n.createClass({displayName:"ColumnHeader",propTypes:{columns:n.PropTypes.arrayOf(c).isRequired,className:n.PropTypes.string,css:n.PropTypes.string,tabbable:n.PropTypes.bool,disabled:n.PropTypes.bool,activeSortField:n.PropTypes.string,activeSortDirection:n.PropTypes.oneOf([d.ASCENDING,d.DESCENDING]),initialMultiColumnSortField:n.PropTypes.string,onSortChange:n.PropTypes.func,onMultiColumnChange:n.PropTypes.func,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{tabbable:!0,disabled:!1,activeSortField:void 0,activeSortDirection:d.ASCENDING,onSortChange:o.noop,onMultiColumnChange:o.noop,isMaestroDesign:!1}},getInitialState:function(){return{cssLoaded:!1}},componentWillMount:function(){return this.props.css?s.require_css(this.props.css,function(e){return function(){return e.setState({cssLoaded:!0})}}(this)):this.setState({cssLoaded:!0})},_didChangeSort:function(e,t){var n,o;return o=e!==this.props.activeSortField,n=t!==this.props.activeSortDirection,o||n},handleSingleColumnClick:function(e){var t,n,o;return o=e.sortField,t=this.props.activeSortField===e.sortField,n=t?this.props.activeSortDirection===d.ASCENDING?d.DESCENDING:d.ASCENDING:this.props.activeSortDirection,this._didChangeSort(o,n)?this.props.onSortChange(o,n):void 0},handleSubColumnChange:function(e){var t,n;return n=e.sortField,t=d.ASCENDING,this._didChangeSort(n,t)&&this.props.onSortChange(n,t),this.props.onMultiColumnChange(e)},renderStaticColumnHeader:function(e){return v(f,{key:e.label,label:e.label,className:e.headerClassName||"",content:e.content})},renderSingleColumnHeader:function(e){return v(_,{key:e.label,label:e.label,isActive:this.props.activeSortField===e.sortField,onClick:function(t){return function(){return t.handleSingleColumnClick(e)}}(this),sortDirection:this.props.activeSortDirection,canTriggerSortDirection:!0,className:e.headerClassName||"",tabbable:this.props.tabbable,disabled:this.props.disabled,isMaestroDesign:this.props.isMaestroDesign})},renderMultiColumnHeader:function(e){return v(m,{key:e.columns[0].label,columns:e.columns,activeSortField:this.props.activeSortField,initialSortField:this.props.initialMultiColumnSortField,onSubColumnChange:this.handleSubColumnChange,tabbable:this.props.tabbable,disabled:this.props.disabled,isMaestroDesign:this.props.isMaestroDesign})},render:function(){var e,t,n,o,r,i;if(this.state.cssLoaded){for(t=[],i=this.props.columns,n=0,r=i.length;r>n;n++)o=i[n],o.type===u.STATIC?t.push(this.renderStaticColumnHeader(o)):o.type===u.SINGLE?t.push(this.renderSingleColumnHeader(o)):o.type===u.MULTI&&t.push(this.renderMultiColumnHeader(o));return e="c-column-header "+this.props.className,y.ul({role:"row",className:e},t)}return y.ul(null)}}),f=n.createClass({displayName:"_StaticColumnHeader",propTypes:{label:n.PropTypes.string.isRequired,className:n.PropTypes.string.isRequired,content:n.PropTypes.node},render:function(){return y.li({role:"columnheader",className:"c-column-header__header u-pad-vertical-xs "+this.props.className},null!=this.props.content?this.props.content:void 0,y.span({className:"col-header-contents"},this.props.label))}}),_=n.createClass({displayName:"_ColumnHeaderView",propTypes:{label:n.PropTypes.string.isRequired,className:n.PropTypes.string,isActive:n.PropTypes.bool,canTriggerSortDirection:n.PropTypes.bool,nextColumnLabel:n.PropTypes.string,tabbable:n.PropTypes.bool,disabled:n.PropTypes.bool,sortDirection:n.PropTypes.oneOf([d.ASCENDING,d.DESCENDING]),onClick:n.PropTypes.func,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{className:null,isActive:!1,canTriggerSortDirection:!1,nextColumnLabel:void 0,tabbable:!0,disabled:!1,sortDirection:d.DESCENDING,onClick:o.noop}},renderColumnHeaderLabel:function(){var e,n,o,i;return this.props.isActive&&this.props.canTriggerSortDirection?(this.props.isMaestroDesign?(o=this.props.sortDirection===d.ASCENDING,n=y.span({key:"icon-element",className:t({"c-column-header__sort-arrow":!0,"c-column-header__sort-arrow--up":o,"c-column-header__sort-arrow--down":!o})})):(this.props.sortDirection===d.ASCENDING?(i="arrow-up-gray",e="ascending"):(i="arrow-down-gray",e="descending"),n=v(r,{group:"web",name:i,alt:"",key:"icon-element",className:"c-column-header__sort-icon u-mar-left-xxs u-l-ib--m"})),[y.span({key:"label"},this.props.label),n]):[y.span({key:"label"},this.props.label)]},getActionDescription:function(){var e;return this.props.nextColumnLabel?(e=h("Swap column to %(nextlabel)s",{comment:"nextlabel is the name of the column that the current column will be replaced with when this button is clicked."}),e.format({nextlabel:this.props.nextColumnLabel})):this.props.sortDirection===d.DESCENDING?h("Sort in ascending order"):this.props.sortDirection===d.ASCENDING?h(this.props.isActive?"Sort in descending order":"Sort in ascending order"):null},getAriaDirectionName:function(){if(this.props.isActive){if(this.props.sortDirection===d.ASCENDING)return"ascending";if(this.props.sortDirection===d.DESCENDING)return"descending"}return""},render:function(){var e;return e=t("c-column-header__button u-trim-margin u-trim-padding",{"u-font-strong":this.props.isActive}),y.li({role:"columnheader","aria-sort":this.getAriaDirectionName(),className:"c-column-header__header u-pad-vertical-xs "+this.props.className},y.button({className:e,onClick:this.props.onClick,ref:"columnButton",title:this.getActionDescription(),tabIndex:this.props.tabbable?0:-1,disabled:this.props.disabled},this.renderColumnHeaderLabel()))}}),m=n.createClass({displayName:"_MultiColumnHeader",propTypes:{columns:n.PropTypes.arrayOf(p).isRequired,tabbable:n.PropTypes.bool,disabled:n.PropTypes.bool,activeSortField:n.PropTypes.string,initialSortField:n.PropTypes.string,onSubColumnChange:n.PropTypes.func,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{tabbable:!0,disabled:!1,activeSortField:void 0,onSubColumnChange:o.noop}},getInitialState:function(){var e,t;return this.props.initialSortField&&(t=g(this.props.initialSortField,this.props.columns),t&&(e=this.props.columns.indexOf(t))),{currentColumnIndex:e||0}},componentWillMount:function(){return this.updateCurrentColumnIndex(this.props.activeSortField)},componentWillReceiveProps:function(e){return e.activeSortField!==this.props.activeSortField?this.updateCurrentColumnIndex(e.activeSortField):void 0},updateCurrentColumnIndex:function(e){var t,n;return n=g(e,this.props.columns),n?(t=this.props.columns.indexOf(n),t!==this.state.currentColumnIndex&&this.props.onSubColumnChange(n),this.setState({currentColumnIndex:t})):void 0},switchToColumn:function(e){return this.props.onSubColumnChange(e)},render:function(){var e,t,n,o;return e=this.props.columns[this.state.currentColumnIndex],n=this.props.activeSortField&&this.props.activeSortField===e.sortField,t=(this.state.currentColumnIndex+1)%this.props.columns.length,o=this.props.columns[t],v(_,{ref:"singleColumn",key:e.label,className:e.headerClassName||"",canTriggerSortDirection:!1,label:e.label,nextColumnLabel:o.label,tabbable:this.props.tabbable,disabled:this.props.disabled,isActive:n,onClick:function(e){return function(){return e.switchToColumn(o)}}(this),isMaestroDesign:this.props.isMaestroDesign})}}),{ColumnHeader:a(l,["/static/css/components/column-headers-vflwQf9xT.css","/static/css/scooter/scooter-scoped-vflebHNBy.css"]),SortDirections:d,ColumnTypes:u}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/content_manager/api",["jquery","external/underscore","modules/clean/analytics","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/browse/store","modules/clean/sharing/api/util/types","modules/clean/sharing/ui_util","modules/clean/teams/admin/api/admin_console_api_client","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse","modules/constants/viewer","require"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w){var T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de;return R=n.ContentManagerActionsLogger,B=r.LoadingStates,D=c.FileTypes,O=u.Config,A=u.BrowseContext,z=d.compare,N=p.BrowseStore,k=p.File,X=h.folderMetadataApiToRecord,L=_.GoldenGate,C=m.AdminConsoleApiClient,q=v._,le=v.ungettext,V=function(e){return{fq_path:"/"+e.name,href:"/work/"+e.name,is_dir:!0,bytes:0,target_ns:e.team_folder_id,icon:K[e.status[".tag"]],team_folder_status:e.status[".tag"],default_sync_setting:e.default_sync_setting[".tag"],type:D.TEAM_SHARED_FOLDER}},T="undefined"!=typeof window&&null!==window?e(window):null,P="/team/admin/content",I="/team/admin/team_folders",H=180,x=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|<|>|\\"|\\|)'),
M=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|\\"|\\|)'),U=new RegExp("[\\ufffe-\\uffff\\ud800-\\udfff]"),F=[".",".."],J=function(e){return L.hasContentManagerCdm(e)?P:I},ue=function(e){return""===e?"":e.length>255?q("The folder name should be under 255 characters"):indexOf.call(F,e)>=0?q("The names dot (.) and dot dot (..) are’t allowed"):x.test(e)?q("The following characters aren’t allowed: \\ / : ? * < > ” |"):U.test(e)?q("The folder name contains invalid characters"):null},ce=function(e){return""===e?"":e.length>255?q("The file name should be under 255 characters"):M.test(e)?q("The following characters aren’t allowed: \\ / : ? * ” |"):U.test(e)?q("The file name contains invalid characters"):null},W=function(e,t){var n,o,r,i;for(i=[],n=0,r=e.length;r>n;n++)o=e[n],i.push(o.fq_path="/"+t+o.fq_path);return i},G=function(){var e,t,n,o;return e=L.hasContentManagerCdmInTSD(N.user().id),t=new C(o=e,n=!1)},te=function(e){var n,r,i,s,a,l,c,u,d,p,h,_,m;return c=e.path,m=e.userId,h=e.sortFoldersFirst,i=e.includeDeletedFiles,s=e.nsId,l=e.onSuccess,a=e.onError,n=L.hasContentManagerCdmInTSD(m),r=G(),"/"!==c||n?(u=c.split("/"),d=u[1],p=n?1:2,_="/"+u.slice(p).join("/"),o.WebRequest({data:{show_deleted:i||"",admin_console:!0,ns_id:s,sortFoldersFirst:h},url:E({path:"/browse"+_}),subject_user:m,success:function(e){try{t.isString(e)&&(e=JSON.parse(e)),n||(e.paginated?W(e.first_page.items,d):W(e.file_info,d)),T.scrollTop(0),l({path:c,data:e})}catch(e){}},error:function(e,t,n){return"function"==typeof a?a(e,t,n):void 0}})):r.teamFoldersList().then(function(e){var t,n,o;return e.entries=e.entries.sort(function(e,t){return z(e.name.toUpperCase(),t.name.toUpperCase(),1)}),n=function(){var t,n,r,i;for(r=e.entries,i=[],t=0,n=r.length;n>t;t++)o=r[t],i.push(V(o));return i}(),t={file_info:n,paginated:!1,inside_auto_team_folder:!0,is_non_user_relative_context:!0},l({path:c,data:t})}).catch(function(e){if(!e.headers)throw e;return"function"==typeof a?a(e.headers,e.raw.status,e.raw.responseBody):void 0})},Y=function(e){var t,n,o,r,i,s,a,l;return r=e.files,i=e.newPath,l=e.userId,s=e.onSuccess,t=w("modules/clean/react/browse/actions"),n=G(),o=N.context(),a=o.rootNSID,y.info(q("Copying files...",H)),n.bulkFileCopy(a,r,i).then(function(e){var n;return y.success(q("Copy completed.")),t.setPath({path:N.path(),nsId:o.rootNSID}),n=1===r.length?"copy":"copyBatch",j(n)}).catch(function(e){var t;return"cant_copy_shared_folder"===(null!=(t=e.error)?t[".tag"]:void 0)?y.error(q("Copying a shared folder isn’t supported for beta.")):y.error(q("There was a problem completing this request."))})},Z=function(e){var t,n,o,r;return r=e.files,o=e.context,t=w("modules/clean/react/browse/actions"),n=G(),y.info(q("Deleting files...",H)),n.bulkFileDelete(r).then(function(e){var n;return n=le("Deleted %d item.","Deleted %d items.",r.length).format(r.length),y.success(n),t.setPath({path:N.path(),nsId:o.rootNSID}),j(1===r.length?r[0].is_dir?"deleteFolder":"deleteFile":"deleteBatch")}).catch(function(e){return y.error(q("There was a problem completing this request."))})},re=function(e){var t,n,o,r,i,s,a,l,c;return i=e.file,c=e.userId,l=e.onSuccess,a=e.onError,s=e.newName,t=w("modules/clean/react/browse/actions"),o=N.context(),(r=i.is_dir?ue(s):ce(s))?(y.error(r),void a()):(n=G(),n.fileRename(i.ns_id,i.ns_path,s).then(function(e){return i.is_dir?y.success(q("Folder renamed.")):y.success(q("File renamed.")),t.setPath({path:N.path(),nsId:o.rootNSID}),j("rename")}).catch(function(e){return y.error(q("There was a problem completing this request."))}))},ne=function(e){var t,n,o,r,i,s,a,l,c;return a=e.path,r=e.files,i=e.newPath,c=e.userId,s=e.onSuccess,t=w("modules/clean/react/browse/actions"),n=G(),o=N.context(),l=o.rootNSID,y.info(q("Moving files...",H)),n.bulkFileMove(l,r,i).then(function(e){var n;return y.success(q("Move completed.")),t.setPath({path:N.path(),nsId:o.rootNSID}),n=1===r.length?"move":"moveBatch",j(n)}).catch(function(e){var t;return"cant_move_folder_into_itself"===(null!=(t=e.error)?t[".tag"]:void 0)?y.error(q("Moving a folder into itself isn’t allowed.")):y.error(q("There was a problem completing this request."))})},$=function(e){var t,n,o,r,i;throw r=e.path,i=e.userId,n=e.namespaceToJournalIdMap,t=e.includeDeletedFiles,o=e.onSuccess,new Error("Not Implemented")},Q=function(e){var t,n,o,r,i,s,a,l,c;return l=e.pathName,r=e.folderName,i=e.nsId,c=e.userId,a=e.onSuccess,s=e.onError,t=w("modules/clean/react/browse/actions"),(o=ue(r))?(y.error(o),void s()):(n=G(),n.folderCreate(i,l,r).then(function(e){var n;return y.success(q("Folder created.")),n={fq_path:"/"+r},a({changesets:null,createdFolder:n}),t.setPath({path:N.path(),nsId:i}),j("createFolder")}).catch(function(e){var t,n,o,r;return s(),"path"===(null!=(t=e.error)?t[".tag"]:void 0)&&"disallowed_name"===(null!=(n=e.error.path)?n[".tag"]:void 0)?y.error(q("The folder name is invalid.")):"path"===(null!=(o=e.error)?o[".tag"]:void 0)&&"conflict"===(null!=(r=e.error.path)?r[".tag"]:void 0)?y.error(q("A folder with the same name exists.")):y.error(q("Failed to create the folder."))}))},ae=function(e){var t,n,o,r,i,s;return n=e.nsId,o=e.nsPath,s=e.policyUpdate,i=e.onSuccess,r=e.onError,t=new G,t.shareFolder(n,o,s).then(X).then(i)},de=function(e){var t,n,o,r,i;return r=e.nsId,i=e.nsPath,t=e.actions,o=e.listMembersArg,j("validateFolderPath"),n=G(),n.validateFolderPath(r,i,t,o)},ie=function(e,t,n,o){var r;return r=G(),r.restoreFile(e,t,n).then(o)},oe=function(e,t,n){var o;return o=G(),o.permanentDeleteFile(e,t).then(n)},j=function(e){return R.log(N.context().rootNSID,e)},K={},se=function(e){return K=e},ee=function(e){return"/"===e.path&&!L.hasContentManagerCdmInTSD(e.user.id)},{getBasePrefix:J,validateFolderName:ue,loadPath:te,renameFile:re,copyFiles:Y,deleteFiles:Z,moveFiles:ne,getChangesForDirectory:$,setIcons:se,createNewFolder:Q,shareFolder:ae,validateFolderPath:de,restoreFile:ie,permanentDeleteFile:oe,isInCMGoldenGateRoot:ee}}),define("modules/clean/react/copy_to_dropbox/actions",["modules/clean/react/copy_to_dropbox/api","modules/core/browser"],function(e,t){var n;return new(n=function(){function n(){}return n.prototype.copySharedFile=function(n,o,r){return e.copySharedFile(n,o,r).then(function(e){return t.redirect(e)})},n}())}),define("modules/clean/react/copy_to_dropbox/api",["external/es6-promise","modules/clean/ajax"],function(e,t){var n,o;return n=e.Promise,o={},o.copySharedFile=function(e,o,r){var i;return i={link_type:e.linkType,link_key:e.linkKey,subpath:e.subPath,secure_hash:e.secureHash,is_package:e.isPackage},e.itemId&&(i.item_id=e.itemId),new n(function(e){return t.WebProgressRequest({url:"/sm/c2d",data:i,progress_text:r,subject_user:o,success:e})})},o}),define("modules/clean/react/copy_to_dropbox/modal",["external/react","modules/clean/analytics","modules/clean/em_string","modules/clean/react/copy_to_dropbox/actions","modules/clean/react/modal","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p;return u=t.WebMiscActivityLogger,c=r.Modal,d=s._,p=e.DOM.p,c=e.createFactory(c),l=e.createClass({displayName:"CopyToDropboxModal",propTypes:{shareToken:e.PropTypes.object.isRequired,fileOrFolder:e.PropTypes.object.isRequired,role:e.PropTypes.string.isRequired,userId:e.PropTypes.number,onDismiss:e.PropTypes.func},componentDidMount:function(){return u.log("show-c2d-modal",{filename:this.props.fileOrFolder.filename})},_getTitle:function(){var e,t,o,r,s;if(s=i.get_viewer(),e=this.props.fileOrFolder.filename,!s.is_paired)return t=15,e=n.em_snippet(e,t),d("Save ‘%(filename)s’ to my Dropbox").format({filename:e});switch(this.props.role){case"personal":return t=10,e=n.em_snippet(e,t),d("Save ‘%(filename)s’ to my personal Dropbox").format({filename:e});case"work":return o=s.team_name,r=new n(o).length,t=Math.max(10,15-r),e=n.em_snippet(e,t),d("Save ‘%(filename)s’ to my %(team_name)s Dropbox").format({filename:e,team_name:o})}},_getBodyText:function(){var e;if(e=i.get_viewer(),!e.is_paired)return d(this.props.fileOrFolder.is_dir?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");switch(this.props.role){case"personal":return d(this.props.fileOrFolder.is_dir?"This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.");case"work":return this.props.fileOrFolder.is_dir?d("This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name}):d("This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name})}},_getAcceptButtonText:function(){var e;if(e=i.get_viewer(),!e.is_paired)return d("Save to my Dropbox");switch(this.props.role){case"personal":return d("Save to my personal Dropbox");case"work":return d("Save to my %(team_name)s Dropbox").format({team_name:e.team_name})}},_getProgressMessage:function(){var e;if(e=i.get_viewer(),!e.is_paired)return d("Saving to your Dropbox...");switch(this.props.role){case"personal":return d("Saving to your personal Dropbox...");case"work":return d("Saving to your %(team_name)s Dropbox...").format({team_name:e.team_name})}},_handleAccept:function(){var e;return e=this._getProgressMessage(),a.success(e),o.copySharedFile(this.props.shareToken,this.props.userId,e)},render:function(){return c({title:this._getTitle(),acceptButtonText:this._getAcceptButtonText(),dismissButtonText:d("Cancel"),onAccept:this._handleAccept,onDismiss:this.props.onDismiss},p({},this._getBodyText()))}})}),define("modules/clean/react/file_action_button",["external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,o){var r,i,s,a,l,c;return r=t.BubbleMenuItem,a=o._,l=e.createElement,c=e.DOM,s={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},i=e.createClass({displayName:"FileActionButton",propTypes:{type:e.PropTypes.string.isRequired,callback:e.PropTypes.func.isRequired,closeFunc:e.PropTypes.func,className:e.PropTypes.string,isMaestroDesign:e.PropTypes.bool},getDefaultProps:function(){return{closeFunc:null}},_getIconAndText:function(){switch(this.props.type){case s.COMMENT:return{icon:"s_file_comment",text:a("Comment",{comment:"BUTTON"})};case s.COPY:return{icon:"copy",text:a("Copy…",{comment:"BUTTON"})};case s.DELETE:return{icon:"delete_16",text:a("Delete…",{comment:"BUTTON"})};case s.DOWNLOAD:return{icon:"download_arrow",text:a("Download",{comment:"BUTTON"})};case s.MOVE:return{icon:"move_16",text:a("Move…",{comment:"BUTTON"})};case s.OPEN:return{icon:"open",text:a("Open",{comment:"BUTTON"})};case s.PREVIOUS_VERSIONS:return{icon:"previous_versions",text:a("Version history",{comment:"BUTTON"})};case s.REMOVE_LINK:return{icon:"lock",text:a("Remove link",{comment:"BUTTON"})};case s.RENAME:return{icon:"rename",text:a("Rename",{comment:"BUTTON"})};case s.SHARE:return{icon:"s_rainbow",text:a("Share",{comment:"BUTTON"})};case s.ENABLE_COMMENTS:return{icon:"s_file_comment",text:a("Enable comments",{comment:"BUTTON"})};case s.DISABLE_COMMENTS:return{icon:"s_disable",text:a("Disable comments",{comment:"BUTTON"})};case s.SHOW_RESOLVED_COMMENTS:return{icon:"s_resolve",text:a("Show resolved comments",{comment:"BUTTON"})};case s.HIDE_RESOLVED_COMMENTS:return{icon:"s_resolve",text:a("Hide resolved comments",{comment:"BUTTON"})};case s.SUBSCRIBE:return{icon:"s_notifications_on",text:a("Subscribe to notifications",{comment:"BUTTON"})};case s.UNSUBSCRIBE:return{icon:"s_notifications_off",text:a("Unsubscribe from notifications",{comment:"BUTTON"})};default:return null}},render:function(){var e,t,o;return t=this._getIconAndText(),e=t.icon,o=t.text,l(r,{onClick:this.props.callback,closeFunc:this.props.closeFunc,className:this.props.className},this.props.isMaestroDesign?o:l(n,{group:"web",name:e,text:o}))}}),{FileActionButtonType:s,FileActionButton:i}}),define("modules/clean/react/file_comments/logger",["modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n){var o,r,i;return o=t.Annotation,r=function(){function t(){this.disabled=!1}return t.prototype.set_disabled=function(e){return this.disabled=e},t.prototype.log_event=function(t,o,r,i,s,a,l,c,u){return null==l&&(l=null),null==c&&(c=null),null==u&&(u=null),this.disabled?void 0:(n.assert(t,"event_type not provided"),n.assert(o,"file_activity_key not provided"),e.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:t,file_activity_key:o,comment_activity_key:r,client_origin_type:i,activity_context:a,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:s}))},t.prototype.log_annotation_event=function(e,t,n,r,i,s){var a,l,c,u;return null==s&&(s=null),null!=s&&(a=o.createAnnotationFromDict(s),u=a.type,c=a.subtype,l=a.getFirstPdfPage()),this.log_event(e,t,n,null,r,i,u,c,l)},t}(),i=new r});var slice=[].slice;define("modules/clean/react/file_comments/onboarding",["external/classnames","external/react","modules/core/i18n","modules/clean/react/image","modules/clean/react/onboarding_modal","modules/clean/static_urls"],function(e,t,n,o,r,i){var s,a,l,c,u,d,p,h,_;return p=n._,_=i.static_url,h=t.DOM,c=[{src:_("/static/images/commenting/onboarding_step1-vflB01-Fx.png"),srcHiRes:_("/static/images/commenting/onboarding_step1@2x-vflyooTgN.png")},{src:_("/static/images/commenting/onboarding_step2-vflQHsmaO.png"),srcHiRes:_("/static/images/commenting/onboarding_step2@2x-vflEm4vmD.png")},{src:_("/static/images/commenting/onboarding_step3-vflvKl_oO.png"),srcHiRes:_("/static/images/commenting/onboarding_step3@2x-vfljsqrRb.png")}],l=t.createFactory(r),a=t.createFactory(o),d=t.createClass({displayName:"Slide",mixins:[t.addons.PureRenderMixin],statics:{slideImages:c},propTypes:{heading:t.PropTypes.string.isRequired,subheading:t.PropTypes.string.isRequired,image:t.PropTypes.shape({src:t.PropTypes.string.isRequired,srcHiRes:t.PropTypes.string.isRequired}).isRequired,className:t.PropTypes.string},render:function(){return h.div({className:e("comment-onboarding-slide",this.props.className)},a({src:this.props.image.src,srcHiRes:this.props.image.srcHiRes,className:"comment-onboarding-illustration"}),h.h1({className:"comment-onboarding-heading"},this.props.heading),h.h2({className:"comment-onboarding-subheading"},this.props.subheading))}}),u=t.createFactory(d),s=t.createClass({displayName:"CommentingOnboardingModal",mixins:[t.addons.PureRenderMixin],propTypes:{onOpen:t.PropTypes.func,onClose:t.PropTypes.func},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onOpen?e.onOpen():void 0},getSlides:function(){return[u({className:"comment-slide-1",heading:p("Annotate your files"),subheading:p("Give clear, focused feedback that’s faster than email."),image:c[0]}),u({className:"comment-slide-2",heading:p("Point to what you’re talking about"),subheading:p("Just click anywhere inside the doc, or drag around a specific area."),image:c[1]}),u({className:"comment-slide-3",heading:p("Never lose track of feedback"),subheading:p("Conversations stay with the file, and you can view on any device."),image:c[2]})]},render:function(){return l.apply(null,[{className:"comment-onboarding-modal",slideWidth:600,onClose:this.props.onClose}].concat(slice.call(this.getSlides())))}})});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_comments/shared_link_signup_modals",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/react/file_comments/logger","modules/constants/legacy","modules/core/browser","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a){var l,c,u;return c=n.DBModal,u=s._,l=function(){function e(){this._toggle_form=bind(this._toggle_form,this),this._prepare_form=bind(this._prepare_form,this),this._reload=bind(this._reload,this),this.before_modal=bind(this.before_modal,this),this.show_sign_in_modal=bind(this.show_sign_in_modal,this),this.show_sign_up_modal=bind(this.show_sign_up_modal,this),this.hide_modal=bind(this.hide_modal,this),this.init_modals=bind(this.init_modals,this),this.show_register=!1,this.init_modals()}return e.POST_COMMENT_VARIANT="post_comment_variant",e.LIKE_COMMENT_VARIANT="like_comment_variant",e.SUBSCRIBE_VARIANT="subscribe_variant",e.prototype.init_modals=function(){return this.default_signup_modal=new c({element_id:"shared-link-default-comments-signup-modal"}),this.default_signup_modal.before_show=this.before_modal},e.prototype.hide_modal=function(){return this.default_signup_modal.hide()},e.prototype.show_sign_up_modal=function(e){return this.show_register=!0,this.variant=e,this.default_signup_modal.show()},e.prototype.show_sign_in_modal=function(e){return this.show_register=!1,this.variant=e,this.default_signup_modal.show()},e.prototype.set_activity_key=function(e){return this.activity_key=e},e.prototype.before_modal=function(e){var t,n;return this._prepare_form(e),e.find(".toggle-form-link").click(function(t){return function(){return t._toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&n.on("db:register:success",function(e){return function(t,n){return e.user=n,a.success(u("Successfully signed up for Dropbox")),o.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this)),t=e.find(".login-form"),t.length?(n.length&&n.on("db:register:user_exists",function(n){return function(o){var r,i,s,a,l;for(n._toggle_form(e),a=o.prefill,l=r=0,s=a.length;s>r;l=++r)i=a[l],t.find(i).val(l);return t.find(o.focus).focus()}}(this)),t.on("db:login:success",function(e){return function(t,n){return e.user=n,a.success(u("Successfully signed in to Dropbox")),o.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this))):void 0},e.prototype._reload=function(){return i.reload()},e.prototype._prepare_form=function(t){switch(t.find(".form-component").hide(),t.find(".text-variant").hide(),this.show_register?t.find(".register-form-component").show():t.find(".login-form-component").show(),this.variant){case e.POST_COMMENT_VARIANT:return t.find(".text-variant.post-comment-variant").show();case e.LIKE_COMMENT_VARIANT:return t.find(".text-variant.like-comment-variant").show();case e.SUBSCRIBE_VARIANT:return t.find(".text-variant.subscribe-variant").show();default:return t.find(".text-variant.default-variant").show()}},e.prototype._toggle_form=function(e){var t,n,i;return i=e.find(".register-form-component"),n=e.find(".login-form-component"),i.is(":visible")?(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_MODAL,i.fadeOut({complete:function(){return n.show()}})):(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,n.fadeOut({complete:function(){return i.show()}})),o.log_event(t,this.activity_key,null,r.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.MODAL_TOGGLE_BUTTON)},e}()}),define("modules/clean/react/file_modal_controller",["external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/css","modules/clean/react/file_modals","modules/clean/react/modal"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m,f,g;return d=i.FileTransferModal,f=i.RestoreFilesModal,m=i.PermanentlyDeleteModal,l=i.DeleteFileModal,c=i.ExpDeleteFileModal,a=i.ContentManagerBridgeModal,h=i.NoAccessFolderModal,p=s.Modal,g=e.createElement,_={COPY:"copy",MOVE:"move"},u=function(){function e(){}return e.showCopy=function(e,t,n){var o,r,i,s,a,l,c;return i=null!=(a=n.onSuccess)?a:null,s=null!=(l=n.onUndo)?l:null,r=null!=(c=n.onRequestNotSent)?c:null,o=g(d,{files:t,operation:_.COPY,user:e,onSuccess:i,onUndo:s,onRequestNotSent:r}),p.showInstance(o)},e.showMove=function(e,t,n,o){var r,i,s,a,l,c,u;return s=null!=(l=o.onSuccess)?l:null,a=null!=(c=o.onUndo)?c:null,i=null!=(u=o.onRequestNotSent)?u:null,r=g(d,{files:t,path:n,operation:_.MOVE,user:e,onSuccess:s,onUndo:a,onRequestNotSent:i}),p.showInstance(r)},e.showRestore=function(e,t,n){var o;return o=g(f,{files:t,userId:e.id,onSuccess:n}),p.showInstance(o)},e.showPermanentlyDelete=function(e,t,n){var o;return o=g(m,{files:t,userId:e.id,onSuccess:n}),p.showInstance(o)},e.showDelete=function(e,t,o,r,i){var s,a,u;return null==i&&(i=null),a=n.filename(o.currentFQPath),u=o.isInsideSharedFolder,s="V1"===i||"V2"===i?g(c,{files:t,user:e,parentSharedFolderName:u?a:null,onUndo:r,expOQProVariant:i}):g(l,{files:t,user:e,parentSharedFolderName:u?a:null,onUndo:r}),p.showInstance(s)},e.showContentManagerBridge=function(e,t,n){var o;return o=g(a,{files:e,type:t,isLimitedTeam:n}),p.showInstance(o)},e.showNoAccess=function(e){var t;return t=g(h,{folderName:n.filename(e.fq_path)}),p.showInstance(t)},e}(),{FileModalController:u}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/file_modals",["external/react","external/react-dom","external/underscore","modules/clean/em_string","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/render_partials","modules/clean/react/browse/store","modules/clean/react/content_manager/api","modules/clean/react/css","modules/clean/react_format","modules/clean/react/modal","modules/clean/react/tree_view","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/uri","modules/constants/python"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T){var C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q;return k=i.FileTypes,N=s.File,O=a.FileIcon,C=l.BrowseStore,Y=d.reactFormat,M=p.Modal,D=h.FolderTreeView,H=f.SNIPPET_SIZES,K=g.genContentManagerBridgeUri,L=g.GoldenGate,V=S._,Q=S.ungettext,q=T.TRADEMARK_PLUS,G=e.DOM,W=e.createElement,x={COPY:"copy",MOVE:"move"},j=function(){var e,t;return t=C.context(),e=t.isNonUserRelativeContext?c:r},z=function(e,t){var n;return n=C.context(),n.isNonUserRelativeContext&&!L.hasContentManagerCdmInTSD(t.id)?e[0].fq_path.split("/")[1]:null},U=e.createClass({displayName:"PermanentlyDeleteModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.instanceOf(N)).isRequired,userId:e.PropTypes.number.isRequired},getDefaultProps:function(){return{onSuccess:n.noop}},handlePurged:function(){return _.notifyPurgeSuccess(this.props.files.length),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){var e;return C.context().isNonUserRelativeContext?(e=this.props.files[0],c.permanentDeleteFile(e.ns_id,e.ns_path,this.handlePurged)):r.purgeFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handlePurged})},isSingleSharedFolder:function(e){return 1===e.length&&e[0].type===k.SHARED_FOLDER},getTitle:function(e){var t;return t=e.length,this.isSingleSharedFolder(e)?V("Remove access to folder?"):Q("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},renderContent:function(e){var t,n;return t=e.length,1===t?(n=m.filename(e[0].fq_path),this.isSingleSharedFolder(e)?Y(V("Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."),{strong:G.strong(),filename:n}):Y(V("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?"),{strong:G.strong(),filename:n})):G.span(null,Q("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},render:function(){var e;return e={ref:"modal",title:this.getTitle(this.props.files),acceptButtonText:V(this.isSingleSharedFolder(this.props.files)?"Remove my access":"Delete permanently"),dismissButtonText:V("Cancel"),onAccept:this.handleAccept},W(M,e,this.renderContent(this.props.files))}}),B=e.createClass({displayName:"RestoreFilesModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.instanceOf(N)).isRequired,userId:e.PropTypes.number.isRequired,onSuccess:e.PropTypes.func},getDefaultProps:function(){return{onSuccess:n.noop}},handleRestoreSuccess:function(){return _.notifyRestoreSuccess(this.props.files),this.props.onSuccess.apply(null,arguments)},handleRestoreClick:function(e){var t,n;return e.preventDefault(),t=C.context(),t.isNonUserRelativeContext?(n=this.props.files[0],c.restoreFile(n.ns_id,n.ns_path,n.latest_rev,this.handleRestoreSuccess)):r.restoreFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handleRestoreSuccess}),this.refs.modal.close()},handleCancelClick:function(e){return e.preventDefault(),this.refs.modal.close()},getTitle:function(e){return Q("Restore %(num)s file?","Restore %(num)s items…",e).format({num:e})},renderSingleFileContent:function(e,t){var n;return n=m.filename(e.fq_path),[Y(V("The most recent version of <strong>%(filename)s</strong> will be restored."),{strong:G.strong(),filename:n}),G.div({className:"file-modal__single-file-row"},W(O,{file:e,className:"file-modal__single-file-row-icon"}),C.context().isNonUserRelativeContext?n:G.a({href:t,className:"file-modal__single-file-row-link"},n))]},renderMultiFileContent:function(e){return G.span({},Q("Are you sure you want to restore %(num)s item?","Are you sure you want to restore %(num)s items?",e.length).format({num:e.length}))},renderButtons:function(e){return G.div({className:"file-modal__buttons"},e?G.div({className:"file-modal__buttons__alt",ref:"revisionButton"},G.a({href:e},V("View other versions"))):void 0,G.div({className:"file-modal__buttons__main"},G.button({className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},V("Restore")),G.button({className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},V("Cancel"))))},render:function(){var e,t,n,o;return t=this.props.files.length,o=null,1!==t||C.context().isNonUserRelativeContext||(o=r.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId})),n={ref:"modal",title:this.getTitle(t),buttonComponent:this.renderButtons(o)},e=1===t?this.renderSingleFileContent(this.props.files[0],o):this.renderMultiFileContent(this.props.files),W(M,n,e)}}),B=u(B,["/static/css/react/file_modal-vfl5O9OmZ.css"]),R=e.createClass({displayName:"FileTransferModal",statics:{Operations:x},propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,operation:e.PropTypes.oneOf([x.COPY,x.MOVE]).isRequired,user:e.PropTypes.instanceOf(v).isRequired,onSuccess:e.PropTypes.func,onUndo:e.PropTypes.func,onRequestNotSent:e.PropTypes.func,path:e.PropTypes.string},getDefaultProps:function(){return{onSuccess:n.noop}},getInitialState:function(){return{selectedPath:null}},handleOperationSuccess:function(e){var t,n,o,r;return t=e.changesets,o=e.rollbackHints,n=this.props.files.length,r=this.props.user,this.props.operation===x.MOVE?_.notifyMoveSuccess(n,r,t,this.state.selectedPath,o,this.props.onUndo):this.props.operation===x.COPY&&_.notifyCopySuccess(n,r,t,this.state.selectedPath,o,this.props.onUndo),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){var e,t,n,o;if(e=j(),this.props.operation===x.MOVE){if(o=e.moveFiles({path:this.props.path,files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!o)return"function"==typeof(t=this.props).onRequestNotSent?t.onRequestNotSent():void 0}else if(this.props.operation===x.COPY&&(o=e.copyFiles({files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!o))return"function"==typeof(n=this.props).onRequestNotSent?n.onRequestNotSent():void 0},handleFolderSelected:function(e){return this.setState({selectedPath:e})},_getTitle:function(){var e,t;return e=this.props.files.length,this.props.operation===x.MOVE?t=this.props.files[0].is_dir?Q("Move %(num)s folder to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):Q("Move %(num)s file to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):this.props.operation===x.COPY&&(t=this.props.files[0].is_dir?Q("Copy %(num)s folder to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):Q("Copy %(num)s file to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'})),t.format({num:e})},_getActionButtonText:function(){return this.props.operation===x.COPY?V("Copy"):this.props.operation===x.MOVE?V("Move"):void 0},handleModalShown:function(){var e;return e=t.findDOMNode(this.refs.treeView),e?e.focus():void 0},render:function(){return W(M,{ref:"modal",title:this._getTitle(),acceptButtonText:this._getActionButtonText(),onAccept:this.handleAccept,acceptButtonDisabled:!this.state.selectedPath,autoFocusPrimaryInput:!1,onShow:this.handleModalShown,dismissButtonText:V("Cancel")},W(D,{ref:"treeView",rootPath:"/",user:this.props.user,onFolderSelected:this.handleFolderSelected,isRootSelectable:!0,treeRootName:z(this.props.files,this.props.user)}))}}),P=e.createClass({displayName:"DeleteFileModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,user:e.PropTypes.instanceOf(v).isRequired,parentSharedFolderName:e.PropTypes.string,onUndo:e.PropTypes.func,expOQProVariant:e.PropTypes.string},getDefaultProps:function(){return{parentSharedFolderName:null}},handleNotify:function(e){var t,n;return t=e.changesets,n=e.rollbackHints,_.notifyDeleteSuccess(this.props.files.length,this.props.user,t,n,this.props.onUndo)},handleAccept:function(){var e;return e=C.context(),e.isNonUserRelativeContext?c.deleteFiles({files:this.props.files,context:e}):r.deleteFiles({files:this.props.files,userId:this.props.user.id,onSuccess:this.handleNotify})},_isRemovingSharedFolder:function(){return 1===this.props.files.length&&this.props.files[0].target_ns},_getTitle:function(){var e;return e=this.props.files,e.length<1?"":this._isRemovingSharedFolder()&&!L.canDeepNest(this.props.user.id)?V("Remove shared folder?"):1===e.length?V(e[0].is_dir?"Delete folder?":"Delete file?"):Q("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},_getContents:function(){var e,t,n,o,r;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":(n=m.filename(e[0].fq_path),t=e[0].target_ns,null!=this.props.parentSharedFolderName?(o=this.props.parentSharedFolderName,1===e.length&&t&&!L.canDeepNest(this.props.user.id)?(r=w({path:"/work"+e[0].fq_path,query:{shareoptions:1,sharesubfolder:0}}).toString(),Y(V("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’? People outside %(team_name)s with whom you’ve shared this folder will stil have access until you remove them from the <memberListLink>member list</memberListLink>."),{filename:n,shared_folder_name:o,team_name:y.get_viewer().team_name,b:G.b(),
memberListLink:G.a({href:r})})):1===e.length?Y(V("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"),{filename:n,shared_folder_name:o,b:G.b()}):Q("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(shared_folder_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?",e.length).format({item_count:e.length,shared_folder_name:o})):1===e.length&&t&&!C.context().isNonUserRelativeContext?Y(V("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."),{filename:n,b:G.b()}):1===e.length?Y(V("Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"),{filename:n,b:G.b()}):Q("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}))},render:function(){return W(M,{ref:"modal",title:this._getTitle(),onAccept:this.handleAccept,acceptButtonText:V(this._isRemovingSharedFolder()&&!C.context().isNonUserRelativeContext?"Remove":"Delete"),dismissButtonText:V("Cancel")},this._getContents())}}),A=function(e){function t(e,n){this._handleAccept=bind(this._handleAccept,this),t.__super__.constructor.call(this,e,n)}return extend(t,e),t.prototype.render=function(){var e,t;return e="V1"===this.props.expOQProVariant?this._renderFooter():null,t="V2"===this.props.expOQProVariant?this._renderButtons():null,W(M,{ref:"modal",title:this._getTitle(),onAccept:this.handleAccept,altAction:e,buttonComponent:t,acceptButtonText:V(this._isRemovingSharedFolder()?"Remove":"Delete"),dismissButtonText:V("Cancel")},this._getContents(),"V2"===this.props.expOQProVariant?this._renderAdditionalContent():void 0)},t.prototype._renderFooter=function(){var e,t,n;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":(n=m.filename(e[0].fq_path),t=e[0].target_ns,G.div({className:"delete-file-modal-upsell"},G.div({className:"delete-file-modal-upsell__footer"},1===e.length&&t&&!C.context().isNonUserRelativeContext?Y(V("Are you sure you want to delete this shared folder? Instead, keep all your files with Dropbox %(trademark_plus)s. <upgradeLink>Upgrade now.</upgradeLink>"),{upgradeLink:G.a({className:"delete-file-modal-upsell__footer--nowrap",href:w({path:"/pro/buy",query:{oqa:"oqdel"}})}),trademark_plus:q}):1===e.length?Y(V("Are you sure you want to delete this file? Instead, keep all your files with Dropbox %(trademark_plus)s. <upgradeLink>Upgrade now.</upgradeLink>"),{upgradeLink:G.a({className:"delete-file-modal-upsell__footer--nowrap",href:w({path:"/pro/buy",query:{oqa:"oqdel"}})}),trademark_plus:q}):Y(V("Are you sure you want to delete these files? Instead, keep all your files with Dropbox %(trademark_plus)s. <upgradeLink>Upgrade now.</upgradeLink>"),{upgradeLink:G.a({className:"delete-file-modal-upsell__footer--nowrap",href:w({path:"/pro/buy",query:{oqa:"oqdel"}})}),trademark_plus:q}))))},t.prototype._renderAdditionalContent=function(){var e;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":!e[0].target_ns||e.length>1?G.span({className:"delete-file-modal-upsell__additional-text"},Y(V("Instead, keep all your files with Dropbox %(trademark_plus)s."),{trademark_plus:q})):void 0},t.prototype._handleAccept=function(){return this.handleAccept(),M.close()},t.prototype._upgradeRedirect=function(){var e;return e=w({path:"/pro/buy",query:{oqa:"oqdel"}}),E.redirect(e)},t.prototype._renderButtons=function(){return G.div({className:"delete-file-modal-upsell__buttons"},G.button({className:"button-secondary db-modal-button",onClick:this._handleAccept,ref:"secondaryButton"},V(this._isRemovingSharedFolder()?"Remove":"Delete")),G.button({className:"button-primary db-modal-button u-mar-left-s",onClick:this._upgradeRedirect,ref:"primaryButton"},V("Upgrade")))},t}(P),A=u(A,["/static/css/react/exp_file_modal-vfl8ta8sG.css"]),I=e.createClass({displayName:"ContentManagerBridgeModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,type:e.PropTypes.string,isLimitedTeam:e.PropTypes.bool},handleAccept:function(){var e;return e=K(this.props.isLimitedTeam,this.props.files[0].fq_path),E.open_tab(e.toString())},render:function(){return W(M,{ref:"modal",style:"clean",onAccept:this.handleAccept,acceptButtonText:V("Go to Admin Console"),altAction:G.a({onClick:function(){return M.close()}},V("Cancel")),width:350,showX:!1,className:"content-manager-bridge-modal"},"archive"===this.props.type?V("You can archive team folders in the Admin Console."):"rename"===this.props.type?V("You can rename team folders in the Admin Console."):void 0)}}),F=e.createClass({displayName:"NoAccessFolderModal",propTypes:{folderName:e.PropTypes.string.isRequired},render:function(){return W(M,{ref:"modal",style:"default",acceptButtonText:V("Done"),title:V("No access to the folder “%(folder_name)s”").format({folder_name:o.em_snippet(this.props.folderName,H.FILENAME)})},G.div({},V("You don’t have permission to open the folder “%(folder_name)s”. Contact your team admins to gain access.").format({folder_name:o.em_snippet(this.props.folderName,H.FILENAME)})," ",G.a({href:"/team?_tk=left_nav_team",target:"_blank"},V("See list of admins."))))}}),{FileTransferModal:R,RestoreFilesModal:B,PermanentlyDeleteModal:U,DeleteFileModal:P,ContentManagerBridgeModal:I,NoAccessFolderModal:F,ExpDeleteFileModal:A}}),define("modules/clean/react/file_sidebar/comments_wrapper_component",["require","exports","tslib","external/react","modules/clean/activity/constants","modules/clean/comments/store","modules/clean/comments/action_creators","modules/clean/comments/demo_action_creators"],function(e,t,n,o,r,i,s,a){"use strict";var l=function(t){function l(n){var o=t.call(this,n)||this;return o.state={commentsLoaded:e.defined("modules/clean/comments/components/file_comments_pane_container")},o}return n.__extends(l,t),l.prototype.componentDidMount=function(){var t=this,n=this.state.commentsLoaded,o=this.props,r=o.hidePageChrome,i=o.isCommentsDemo;n||r&&!i||e(["modules/clean/comments/components/file_comments_pane_container"],function(){t.setState({commentsLoaded:!0})})},l.prototype.render=function(){var t=this.state.commentsLoaded,n=this.props,l=n.activityContext,c=n.currentFile,u=n.hideComments,d=n.hidePageChrome,p=n.isCommentsDemo,h=n.sharedLinkInfo,_=n.shouldInitiallyFocusInput,m=n.user,f=n.showToggleButton;if(u||d&&!p)return null;if(!t)return c.feedback_off||i.areCommentsHidden()?o.createElement("div",null):o.createElement("div",{id:"file-comments",className:"file-feedback"},o.createElement("div",{className:"comment-holder"}));var g=e("modules/clean/comments/components/file_comments_pane_container"),v=p?a:s,y=p?-1:m?m.id:void 0,E=null;switch(l){case r.ActivityContext.BROWSE_FILE_VIEWER:E=c.fq_path;break;case r.ActivityContext.SHARED_CONTENT_LINK_VIEW:case r.ActivityContext.SHARED_LINK_VIEW:h&&(E=h.url)}return o.createElement("div",{className:"react-file-viewer__activity"},o.createElement(g,{actionCreators:v,actorId:y,context:l,contextData:E,currentFile:c,isDemoMode:p,previewSelector:".react-file-viewer__preview .flex-preview-container",shouldInitiallyFocusInput:_,showToggleButton:f}))},l}(o.Component);t.CommentsWrapperComponent=l}),define("modules/clean/react/file_sidebar/file_sidebar",["require","exports","tslib","external/react","modules/constants/file_viewer","modules/clean/react/file_sidebar/comments_wrapper_component"],function(e,t,n,o,r,i){"use strict";var s=function(t){function s(e){var n=t.call(this,e)||this;return n.state={fileSidebarLoaded:!1},n}return n.__extends(s,t),s.prototype.componentWillMount=function(){var t=this;r.FILE_ACTIVITY_STREAM&&e(["modules/clean/react/file_sidebar/file_sidebar_component"],function(){t.setState({fileSidebarLoaded:!0})})},s.prototype.render=function(){if(r.FILE_ACTIVITY_STREAM){if(this.state.fileSidebarLoaded){var t=e("modules/clean/react/file_sidebar/file_sidebar_component").FileSidebarComponent;return o.createElement(t,n.__assign({},this.props))}return o.createElement("div",null)}return o.createElement(i.CommentsWrapperComponent,n.__assign({},this.props,{showToggleButton:r.MAESTRO_ENABLED}))},s}(o.Component);t.FileSidebar=s}),define("modules/clean/react/file_viewer/actions",["modules/clean/analytics","modules/clean/downloads","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/dispatcher","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/constants/env","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g;return f=e.PreviewActivityLogger,g=n.PreviewHelper,d=o.ActionTypes,p=o.EventTypes,h=s.FilePreviewSession,m=l.PUBSERVER,new(_=function(){function e(){}return e.prototype.setup=function(e,t,n,o){var i,s,a,l,c;return s=null!=o?o:{},c=s.sharedLinkInfos,l=s.shareTokens,a=s.sharePermissions,i=s.disableFlipping,r.dispatch({type:d.SETUP,data:{files:e,currentIndex:t,user:n,sharedLinkInfos:c,shareTokens:l,sharePermissions:a,disableFlipping:i}})},e.prototype.cleanup=function(){return r.dispatch({type:d.CLEANUP})},e.prototype.updateFiles=function(e){return r.dispatch({type:d.UPDATE_FILES,data:{files:e}})},e.prototype.flipNext=function(){return r.dispatch({type:d.FLIP_NEXT})},e.prototype.flipPrevious=function(){return r.dispatch({type:d.FLIP_PREVIOUS})},e.prototype.openFullscreen=function(){var e;return e={file_ext:g.get_extension(a.currentFile())},r.dispatch({type:d.OPEN_FULLSCREEN})},e.prototype.closeFullscreen=function(){var e;return e={file_ext:g.get_extension(a.currentFile())},r.dispatch({type:d.CLOSE_FULLSCREEN})},e.prototype.switchRevision=function(e){return r.dispatch({type:d.SWITCH_REVISION,data:{file:e}})},e.prototype.restoreRevision=function(){return r.dispatch({type:d.RESTORE_REVISION})},e.prototype.fastForwardRevision=function(e){return r.dispatch({type:d.FAST_FORWARD_REVISION,data:{file:e}})},e.prototype.download=function(e){var n;return n=u.parse(e.href),n.updateQuery("dl",1),t.get({url:n.toString(),__do_not_use_expected_domain:m})},e.prototype.logUserAction=function(e,t,n){return null==n&&(n={}),null!=h.currentSession?i.emit(p.FILE_PREVIEW_USER_ACTION,h.currentSession,e,t,n):void 0},e.prototype.pendingFileUploaded=function(){return c.reload(!0)},e.prototype.broadcastPreviewRenderStatus=function(e){return r.dispatch({type:d.BROADCAST_RENDER_STATUS,data:{newStatus:e}})},e.prototype.closePreviewQualityPopup=function(){return r.dispatch({type:d.CLOSE_PREVIEW_QUALITY_POPUP})},e}())}),define("modules/clean/react/file_viewer/coach_mark",["external/react","modules/clean/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/sharing/views/hover_close_button"],function(e,t,n,o,r){var i,s,a,l,c,u,d;return d=e.DOM,s=d.button,l=d.div,c=d.h4,u=d.p,a=e.createElement,i=e.createClass({displayName:"CoachMark",propTypes:{title:e.PropTypes.string.isRequired,imageUrl:e.PropTypes.string.isRequired,imageUrl2x:e.PropTypes.string.isRequired,imageAlt:e.PropTypes.string.isRequired,buttonText:e.PropTypes.string.isRequired,onButtonClick:e.PropTypes.func.isRequired,onCloseButtonClick:e.PropTypes.func,onShown:e.PropTypes.func,showClose:e.PropTypes.bool},componentWillMount:function(){return t.require_css("/static/css/components/bubble_dropdown-vflTPbDJ3.css"),t.require_css("/static/css/components/coach_mark-vfl_pkaya.css")},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onShown?e.onShown():void 0},getDefaultProps:function(){return{onCloseButtonClick:function(){},showCloseButton:!1}},_renderCloseButton:function(){return this.props.showClose?e.createElement(r,{className:"c-coach-mark__x",onClick:this.props.onCloseButtonClick}):null},_renderCoachMarkImage:function(){return e.createElement(o,{className:"c-coach-mark__img u-pad-right-xs",src:this.props.imageUrl,srcHiRes:this.props.imageUrl2x,alt:this.props.imageAlt})},_renderCoachMarkMessage:function(){return l({className:"coach-mark_message"},l({className:"c-coach-mark__header"},this._renderCloseButton(),c({},this.props.title)),u({refs:"coachmarkBody"},this.props.children),s({className:"button-primary button-small c-coach-mark__button",onMouseUp:this.props.onButtonClick,ref:"coachmarkButton"},this.props.buttonText))},render:function(){return l({className:"c-coach-mark bubble-dropdown top-right",ref:"coachmark"},a(n.Flag,{leftAttachment:this._renderCoachMarkImage()},this._renderCoachMarkMessage()),l({className:"bubble-arrow-border"}),l({className:"bubble-arrow"}))}})}),define("modules/clean/react/file_viewer/comments_demo_actions",["require","exports","tslib","external/react","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/title_bar/controls_container"],function(e,t,n,o,r,i,s){"use strict";var a=o.createFactory(r),l=o.createFactory(i.ToggleCommentsContainer),c=o.createFactory(s),u=function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.render=function(){return c({},[a({key:"MoreDropdown",file:this.props.file,isPrivate:!1}),l({key:"ToggleComments",actionCreators:this.props.commentsActionCreators})])},t}(o.Component);t.CommentsDemoActionsClass=u}),define("modules/clean/react/file_viewer/constants",["require","exports"],function(e,t){"use strict";t.ActionTypes={SETUP:"SETUP",CLEANUP:"CLEANUP",UPDATE_FILES:"UPDATE_FILES",FLIP_NEXT:"FLIP_NEXT",FLIP_PREVIOUS:"FLIP_PREVIOUS",OPEN_FULLSCREEN:"OPEN_FULLSCREEN",CLOSE_FULLSCREEN:"CLOSE_FULLSCREEN",SWITCH_REVISION:"SWITCH_REVISION",RESTORE_REVISION:"RESTORE_REVISION",FAST_FORWARD_REVISION:"FAST_FORWARD_REVISION",BROADCAST_RENDER_STATUS:"BROADCAST_RENDER_STATUS",CLOSE_PREVIEW_QUALITY_POPUP:"CLOSE_PREVIEW_QUALITY_POPUP"};var n;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SUCCEEDED=1]="SUCCEEDED"}(n=t.PreviewRenderStatuses||(t.PreviewRenderStatuses={})),t.EventTypes={FILE_VIEWER_OPENED:"FILE_VIEWER_OPENED",FILE_PREVIEW_SESSION_ENDED:"FILE_PREVIEW_SESSION_ENDED",FILE_PREVIEW_ATTEMPT_STARTED:"FILE_PREVIEW_ATTEMPT_STARTED",FILE_PREVIEW_SUPPORT_CONFIRMED:"FILE_PREVIEW_SUPPORT_CONFIRMED",FILE_PREVIEW_SUPPORT_DENIED:"FILE_PREVIEW_SUPPORT_DENIED",FILE_PREVIEW_DOWNLOAD_ATTEMPTED:"FILE_PREVIEW_DOWNLOAD_ATTEMPTED",FILE_PREVIEW_DOWNLOAD_SUCCEEDED:"FILE_PREVIEW_DOWNLOAD_SUCCEEDED",FILE_PREVIEW_DOWNLOAD_FAILED:"FILE_PREVIEW_DOWNLOAD_FAILED",FILE_PREVIEW_RENDER_SUCCEEDED:"FILE_PREVIEW_RENDER_SUCCEEDED",FILE_PREVIEW_RENDER_FAILED:"FILE_PREVIEW_RENDER_FAILED",FILE_PREVIEW_PASS_SHOWN:"FILE_PREVIEW_PASS_SHOWN",FILE_PREVIEW_PASS_HOVER:"FILE_PREVIEW_PASS_HOVER",FILE_PREVIEW_PASS_CLICK:"FILE_PREVIEW_PASS_CLICK",BROWSE_PASS_SHOWN:"BROWSE_PASS_SHOWN",BROWSE_PASS_HOVER:"BROWSE_PASS_HOVER",BROWSE_PASS_CLICK:"BROWSE_PASS_CLICK",FILE_PREVIEW_QUALITY_POPUP_ASKED:"FILE_PREVIEW_QUALITY_POPUP_ASKED",FILE_PREVIEW_QUALITY_POPUP_ANSWERED:"FILE_PREVIEW_QUALITY_POPUP_ANSWERED",FILE_PREVIEW_QUALITY_POPUP_DISMISSED:"FILE_PREVIEW_QUALITY_POPUP_DISMISSED",FILE_PREVIEW_FILE_DOWNLOADED:"FILE_PREVIEW_FILE_DOWNLOADED",FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED:"FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED",FILE_PREVIEW_SHOW_CONTENTS_FAILED:"FILE_PREVIEW_SHOW_CONTENTS_FAILED",FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED:"FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED",FILE_PREVIEW_USER_ACTION:"FILE_PREVIEW_USER_ACTION",FILE_PREVIEW_VIDEO_STALLED:"FILE_PREVIEW_VIDEO_STALLED"},t.SourceContext={BROWSE:"BROWSE",SHARED_LINK_FILE:"SHARED_LINK_FILE",SHARED_LINK_FOLDER:"SHARED_LINK_FOLDER",SHARED_LINK_COLLECTION:"SHARED_LINK_COLLECTION",VERSION_HISTORY:"VERSION_HISTORY"},t.CannedTestFilenames={EXCEL_HTML:"test-workbook.html"};var o;!function(e){e[e.TITLE_BAR=0]="TITLE_BAR",e[e.PREVIEW_CONTENT=1]="PREVIEW_CONTENT",e[e.SIDEBAR=2]="SIDEBAR"}(o=t.FileViewerPane||(t.FileViewerPane={})),t.UserActionNames={SHARE:"share",DOWNLOAD:"download",SAVE_TO_DROPBOX:"save_to_dropbox",SAVE_TO_DROPBOX_PERSONAL:"save_to_dropbox_personal",SAVE_TO_DROPBOX_WORK:"save_to_dropbox_work",OPEN_IN_OFFICE_ONLINE:"open_in_office_online",OPEN_IN_UNITY:"open_in_unity",OPEN_IN_UNITY_FOLDER:"open_in_unity_folder",REMOVE_LINK:"remove_link",VIEW_REVISIONS:"view_revisions",CLICK_DROPBOX_LOGO:"click_dropbox_logo",CLICK_CUSTOM_LOGO:"click_custom_logo",TOGGLE_COMMENTS_ON:"toggle_comments_on",TOGGLE_COMMENTS_OFF:"toggle_comments_off",SIGN_IN:"sign_in",CLICK_NOTIFICATIONS:"click_notifications",CLICK_ACCOUNT_MENU:"click_account_menu",TOGGLE_FULLSCREEN_ON:"toggle_fullscreen_on",TOGGLE_FULLSCREEN_OFF:"toggle_fullscreen_off",PRINT:"print",INLINE_SEARCH:"inline_search",FLIP_NEXT:"flip_next",FLIP_PREV:"flip_prev",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out"},t.UserActionContextNames={TITLE_BAR_MAIN:"title_bar_main",TITLE_BAR_SPLIT_BUTTON:"title_bar_open_split_button",TITLE_BAR_MORE:"title_bar_more",PREVIEW_CONTENT_MAIN:"preview_content_main",PREVIEW_CONTENT_SPLIT_BUTTON:"preview_content_open_split_button",TOOLBAR:"toolbar",VIDEO_PLAYER:"video_player",LIGHTBOX_FRAME:"lightbox_frame",LIGHTBOX_TOOLBAR:"lightbox_toolbar",LIGHTBOX_CLOSE_BUTTON:"lightbox_close_button",SIDEBAR:"sidebar",KEYBOARD:"keyboard",BROWSER:"browser",UNKNOWN:"unknown"};var r;!function(e){e[e.MAIN=0]="MAIN",e[e.SPLIT=1]="SPLIT"}(r=t.SplitButtonActionLocation||(t.SplitButtonActionLocation={}))}),define("modules/clean/react/file_viewer/container",["external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/share_helpers","modules/clean/react/open_in_app/actions"],function(e,t,n,o,r){var i,s,a;return i=n.FileViewer,a=r.openImmediately,s=e.createClass({displayName:"FileViewerContainer",propTypes:{files:e.PropTypes.array.isRequired,currentIndex:e.PropTypes.number.isRequired,user:e.PropTypes.object,fileViewerProps:e.PropTypes.object.isRequired,sharedLinkInfo:e.PropTypes.object,shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object,openImmediatelyInApp:e.PropTypes.bool,onCloseUrl:e.PropTypes.string},_onCloseViewer:function(){return window.open(this.props.onCloseUrl,"_self")},componentWillMount:function(){var e,n;return n={sharedLinkInfos:[this.props.sharedLinkInfo],shareTokens:[this.props.shareToken],sharePermissions:[this.props.sharePermissions],disableFlipping:!1},t.setup(this.props.files,this.props.currentIndex,this.props.user,n),this.props.openImmediatelyInApp?(e=this.props.files[this.props.currentIndex],a(e.open_in_app_data)):void 0},componentWillUnmount:function(){return t.cleanup()},render:function(){var t;return t=this.props.fileViewerProps,t.shareHelpers=o,null!=this.props.onCloseUrl&&(t.onCloseViewer=this._onCloseViewer),e.createElement(i,t)}})}),define("modules/clean/react/file_viewer/controller",["external/react","external/react-dom","modules/constants/python","modules/constants/comments_panel","modules/clean/activity/constants","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/share_helpers","modules/clean/previews/util","modules/core/dom"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m;return p=n.FileViewTargetType,d=r.ActivityContext,h=a.FileViewer,m=c.PermissionHelper,h=e.createFactory(h),_={fileViewer:null,targetElementId:"",open:function(e,n,o,r,a){var c,_,m,f,g;return this.targetElementId=r,this.isShown()?void 0:(a.fileViewTarget===p.SHARED_LINK?a.activityContext=d.SHARED_LINK_VIEW:a.fileViewTarget===p.SHARED_CONTENT_LINK?a.activityContext=d.SHARED_CONTENT_LINK_VIEW:(a.activityContext=d.BROWSE_FILE_VIEWER,a.shareHelpers=l),m=a.onCloseViewer,a.onCloseViewer=function(e){return function(){return e.close(),"function"==typeof m?m():void 0}}(this),a.canClose=!0,c=!!a.disableFlipping,g={disableFlipping:c,sharedLinkInfos:a.sharedLinkInfos,shareTokens:a.shareTokens,sharePermissions:a.sharePermissions},s.setup(e,n,o,g),i.start(),u.scroll_lock_document(),_=h(a),f=document.getElementById(this.targetElementId),this.fileViewer=t.render(_,f))},updateFiles:function(e){return this.isShown()?s.updateFiles(e):void 0},close:function(){var e;return this.isShown()?(e=document.getElementById(this.targetElementId),t.unmountComponentAtNode(e),s.cleanup(),u.scroll_unlock_document(),this.fileViewer=null):void 0},isShown:function(){return null!=this.fileViewer}}}),define("modules/clean/react/file_viewer/copyright_flag",["external/react","modules/clean/react/title_bubble","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var r,i,s,a;return i=n._,s=e.createElement,a=e.DOM,r=e.createClass({displayName:"CopyrightFlag",propTypes:{sharedLink:e.PropTypes.string,shareToken:e.PropTypes.shape({linkKey:e.PropTypes.string,linkType:e.PropTypes.string,subPath:e.PropTypes.string,secureHash:e.PropTypes.string})},getCopyrightHref:function(){var e;return e=null!=this.props.sharedLink?{ssu:this.props.sharedLink}:{link_key:this.props.shareToken.linkKey,link_type:this.props.shareToken.linkType,spath:this.props.shareToken.subPath,shash:this.props.shareToken.secureHash},new o({scheme:"https",authority:"www.dropbox.com",path:"/copyright_complaint",query:e})},render:function(){return s(t,{content:i("Flag for copyright"),position:t.POSITIONS.RIGHT,distanceFromTarget:5,isTargetPositionFixed:!0},a.div({className:"react-copyright-complaint-flag"},a.a({href:this.getCopyrightHref(),className:"flag-link",title:i("Flag for copyright"),rel:"nofollow"})))}})}),define("modules/clean/react/file_viewer/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e}),define("modules/clean/react/file_viewer/file_preview",["external/react","modules/constants/legacy","modules/clean/react/previews/frame_messenger_host","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/browse/models","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/utils","modules/clean/react/previews/archive/preview_archive","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/constants","modules/clean/react/previews/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/preview_pdf","modules/clean/react/previews/preview_video","modules/core/exception","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w){var T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z;return k=n.PreviewFrameMessengerHost,A=o.FilePreviewTimelineLogger,N=o.FilePreviewUserActionLogger,L=i.PermissionHelper,B=i.PreviewHelper,I=s.File,C=a.EventTypes,Y=a.SourceContext,P=c.FilePreviewSession,O=c.FileViewerSession,R=u.FlippableHelpers,M=d.PreviewArchive,T=h.ErrorTypes,K=h.PreviewSessionEndReasons,Z=h.getSessionEndReasonLoggingKey,x=_.PreviewError,W=y.PreviewLinkfile,G=E.PreviewPDF,D=".react-file-viewer__preview iframe",Q=e.createElement,F=e.createFactory(p),U=e.createFactory(m),H=e.createFactory(f.PreviewImage),q=e.createFactory(g.PreviewImageWithAnnotations),V=e.createFactory(v.PreviewImageZoom),j=e.createFactory(b.PreviewVideo),z=e.createClass({displayName:"FilePreview",propTypes:{file:e.PropTypes.shape({preview_type:e.PropTypes.string.isRequired}).isRequired,user:e.PropTypes.object,isFullscreen:e.PropTypes.bool,onCloseViewer:e.PropTypes.func,fileViewTarget:e.PropTypes.number.isRequired,fileViewOrigin:e.PropTypes.number.isRequired,fileViewAction:e.PropTypes.number.isRequired,sharedLinkUrl:e.PropTypes.string,maxFilenameEmLength:e.PropTypes.number.isRequired,areImagePreviewAnnotationsVisible:e.PropTypes.bool,shouldDisplayAnnotationsToolbar:e.PropTypes.bool,areActionablesEnabled:e.PropTypes.bool,index:e.PropTypes.number,count:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,shareToken:e.PropTypes.object,sharedLinkInfo:e.PropTypes.object,sharePermissions:e.PropTypes.object,commentsActionCreators:e.PropTypes.object.isRequired},getDefaultProps:function(){return{user:null,isFullscreen:!1,sharePermissions:null,areActionablesEnabled:!0}},getInitialState:function(){return{hasError:!1,filePreviewSession:null,errorType:null}},componentWillReceiveProps:function(e){return I.areEqual(e.file,this.props.file)?void 0:(this.setState({hasError:!1,errorType:null}),this._viewAttempts=0,this._logPreviewSessionEnded(K.NEW_FILE),this._startNewFilePreviewSession(e.file))},componentWillMount:function(){return this._startNewFilePreviewSession(this.props.file)},componentDidMount:function(){return this._startLogger(),this._viewAttempts=0,this._logView(this.state.hasError),this._windowCloseHandler=function(e){return function(){return e._logPreviewSessionEnded(K.BEFORE_UNLOAD)}}(this),window.addEventListener("beforeunload",this._windowCloseHandler)},componentDidUpdate:function(e,t){return e.file!==this.props.file||t.hasError!==this.state.hasError?this._logView(this.state.hasError):void 0},componentWillUnmount:function(){return this._logPreviewSessionEnded(K.UNMOUNT),this._stopLogger(),this._teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this._windowCloseHandler)},_startLogger:function(){return this._frameMessenger=new k,this._frameMessenger.configureChildMessaging(D,this._onFrameMessage,["pagerendered"]),this._frameMessenger.startListening()},_stopLogger:function(){return this._frameMessenger.stopListening()},_onFrameMessage:function(e){switch(e.action){case"pagerendered":return r.logPageRendered(this.props.file,e.parameters)}},_logView:function(e){var t,n,o,i;return null==e&&(e=!1),null!==this.props.file.ns_id&&(this._viewAttempts++,t=0===(null!=(n=this.props.sharePermissions)&&null!=(o=n.canDownloadRoles)?o.length:void 0),i=B.determineSourceContext(),i!==Y.SHARED_LINK_COLLECTION)?r.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,this.props.sharedLinkUrl,this._viewAttempts,e,t):void 0},_logPreviewSessionEnded:function(e){var t,n,o,r,i;null==e&&(e=K.UNKNOWN),t={session_end_reason:Z(e)},(null!=(i=this.state.filePreviewSession.pageWidths)?i.length:void 0)>0&&(r=this.state.filePreviewSession.pageWidths,n=Math.max.apply(Math,r),o=Math.min.apply(Math,r),t.max_page_width_ratio=(n/r[0]).toString(),t.min_page_width_ratio=(o/r[0]).toString()),this.state.filePreviewSession.recordEvent(C.FILE_PREVIEW_SESSION_ENDED,t)},_setUpFilePreviewLogger:function(e){return this._teardownFilePreviewLogger(),this._filePreviewTimelineLogger=new A(e.id),this._filePreviewTimelineLogger.listenTo(l),this._filePreviewUserActionLogger=new N,this._filePreviewUserActionLogger.listenTo(l)},_startNewFilePreviewSession:function(e){var t;return t=P.currentSession=new P({fileViewerSession:O.currentSession,file:e}),this.setState({filePreviewSession:t}),this._setUpFilePreviewLogger(t),null!==e.ns_id?t.recordEvent(C.FILE_PREVIEW_ATTEMPT_STARTED):void 0},_teardownFilePreviewLogger:function(){var e,t;return null!=(e=this._filePreviewTimelineLogger)&&e.unlistenTo(l),null!=(t=this._filePreviewUserActionLogger)?t.unlistenTo(l):void 0},_renderImagePreview:function(){var e,t,n,o,r,i,s;return t=this.props.file,n=B.get_extension(t),r=t.preview_url||t.thumbnail_url_tmpl,null==r?this._renderUnsupportedErrorPreview():(0===(null!=(i=this.props.sharePermissions)&&null!=(s=i.canViewContextMenuRoles)?s.length:void 0)&&(e=this._onContextMenu),this.props.isFullscreen?V({thumbnailUrlTmpl:r,fileExtension:n,isFlippable:!0,filePreviewSession:this.state.filePreviewSession,onContextMenu:e}):(o={"preview-url":r,"file-extension":B.get_extension(t),isFullscreen:this.props.isFullscreen,"should-display-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:this._triggerError,onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onContextMenu:e,commentsActionCreators:this.props.commentsActionCreators},this.props.areImagePreviewAnnotationsVisible?q(o):H(o)))},_onContextMenu:function(e){return e.preventDefault(),!0},_renderVideoPreview:function(){var e;return e=this.props.file,j({"preview-url":e.video_transcode_url,"thumbnail-url-tmpl":e.thumbnail_url_tmpl,"video-metadata-url":e.video_metadata_url,isFullscreen:this.props.isFullscreen,shouldDisplayAnnotationsToolbar:this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onError:this._triggerError})},_renderLinkfilePreview:function(){var e;return e=this.props.file,Q(W,{filename:B.get_filename(e),data:e.linkfile_data,source:e.linkfile_data.authenticated?"browse":"sharedlink",filePreviewSession:this.state.filePreviewSession})},_renderPDFPreview:function(){var e,t,n;return e=this.props.file,t=B.get_extension(e),Q(G,{fileExtension:t,fqPath:e.fq_path,fileHref:e.href,isFullscreen:this.props.isFullscreen,onCloseViewer:this.props.onCloseViewer,onError:this._triggerError,previewStatus:e.doc_preview_status,previewType:e.preview_type,previewUrl:e.preview_url,thumbnailUrl:e.preview_thumbnail_url,src:e.direct_blockserver_link,userId:null!=(n=this.props.user)?n.id:void 0,isSharedLink:null!=this.props.sharedLinkUrl,sharePermissions:this.props.sharePermissions,filePreviewSession:this.state.filePreviewSession,commentsActionCreators:this.props.commentsActionCreators})},_renderHTMLPreview:function(){var e,t,n,o,r,i;return e=this.props.file,t=B.get_extension(e),"excel"===e.preview_type?(n=null!=e.direct_blockserver_link?e.direct_blockserver_link:e.href,o=B.normalize_extension(t),r=B.get_progressive_url(o,n)):r=null!=e.htmlified_link?e.htmlified_link:e.href,null==r?this._renderUnsupportedErrorPreview():(i=B.usesFrameMessenger(e.preview_type),U({src:r,previewType:e.preview_type,isFullscreen:this.props.isFullscreen,onError:this._triggerError,fileExtension:t,fileDocPreviewStatus:e.doc_preview_status,filePreviewType:e.preview_type,usesFrameMessenger:i,sharePermissions:this.props.sharePermissions,filePreviewSession:this.state.filePreviewSession,commentsActionCreators:this.props.commentsActionCreators}))},_renderAudioPreview:function(){var e;return e=this.props.file,F({src:e.direct_blockserver_link,onError:this._triggerError,filePreviewSession:this.state.filePreviewSession})},_renderArchivePreview:function(){return Q(M,{file:this.props.file,filePreviewSession:this.state.filePreviewSession,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermissions,user:this.props.user})},_renderUnsupportedErrorPreview:function(){return this._renderErrorPreview(T.SUPPORT_ERROR)},_renderErrorPreview:function(e){var t;return t=this.props.shouldDisplayAnnotationsToolbar&&R.isFlippableFile(this.props.file),Q(x,{file:this.props.file,maxFilenameEmLength:this.props.maxFilenameEmLength,filePreviewSession:this.state.filePreviewSession,errorType:e,user:this.props.user,areActionablesEnabled:this.props.areActionablesEnabled,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,shouldDisplayAnnotationsToolbar:t,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext})},_triggerError:function(e){return this.setState({hasError:!0,errorType:e})},_choosePreview:function(){var e;if(null===this.props.file.ns_id)return this._renderErrorPreview(T.PENDING_UPLOAD_ERROR);if(B.isEmptyFile(this.props.file))return this._renderErrorPreview(T.EMPTY_FILE_ERROR);if(!B.extensionSupported(this.props.file))return this._renderErrorPreview(T.EXTENSION_ERROR);if(!B.filesizeSupported(this.props.file))return this._renderErrorPreview(T.FILE_SIZE_ERROR);
switch(e=B.get_extension(this.props.file),this.props.file.preview_type){case"photo":return this._renderImagePreview();case"video":return this._renderVideoPreview();case"linkfile":return this._renderLinkfilePreview();case"adobecs":case"doc":return"indd"===e?this._renderErrorPreview(T.EXTENSION_ERROR):this._renderPDFPreview();case"excel":return L.use_excel2_for_extension(e)?this._renderPDFPreview():this._renderHTMLPreview();case"html":case"text":return this._renderHTMLPreview();case"audio":return this._renderAudioPreview();case"archive":return this._renderArchivePreview();default:return S.assert(!1,"Preview type "+this.props.file.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}},render:function(){return this.state.hasError?this._renderErrorPreview(this.state.errorType):this._choosePreview()}})}),define("modules/clean/react/file_viewer/file_preview_event_emitter",["external/eventemitter3"],function(e){return new e});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/file_viewer",["external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/activity/constants","modules/clean/analytics","modules/clean/comments/action_creators","modules/clean/comments/demo_action_creators","modules/clean/comments/store","modules/clean/css","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/file_events","modules/clean/history","modules/clean/image_preview_util","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/react/file_comments/logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/file_viewer/title_bar","modules/clean/react/file_viewer/utils","modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/pass/utils","modules/clean/react/previews/image_helpers","modules/clean/react/previews/quality_popup/preview_quality_popup","modules/clean/web_timing_logger","modules/constants/comments_panel","modules/constants/file_viewer","modules/constants/python","modules/core/dom","modules/core/notify","modules/core/uri","require"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B){var H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce;return H=r.ActivityContext,ne=i.ShareTibEventLogger,V=_.FilePreviewTimelineLogger,$=f.PreviewHelper,q=g.File,ie=b.UserActionNames,re=b.UserActionContextNames,K=T.FileViewerSession,Y=P.FlippableHelpers,W=A.FileSidebar,J=N.PassHelpers,ee=R.PreviewQualityPopup,le=n.findDOMNode,ae=t.DOM.div,z=t.createFactory(w),te=t.createFactory(S),oe=t.createFactory(I),Q="fileviewer",X="",Z=35,ce="",j=t.createClass({displayName:"FileViewer",propTypes:{fileViewTarget:t.PropTypes.number.isRequired,fileViewOrigin:t.PropTypes.number.isRequired,fileViewAction:t.PropTypes.number.isRequired,disableRouting:t.PropTypes.bool,skipOuterRouting:t.PropTypes.bool,canClose:t.PropTypes.bool,onCloseViewer:t.PropTypes.func,onComponentDidMount:t.PropTypes.func,onComponentWillUnmount:t.PropTypes.func,shareHelpers:t.PropTypes.object,activityContext:t.PropTypes.number.isRequired,hideComments:t.PropTypes.bool,oref:t.PropTypes.string,shouldFocusCommentInput:t.PropTypes.bool,hidePageChrome:t.PropTypes.bool,isVersionHistoryMode:t.PropTypes.bool,canRestoreRevision:t.PropTypes.bool,onRestoreRevision:t.PropTypes.func,accountMenuOptions:t.PropTypes.object,isCommentsDemo:t.PropTypes.bool},getDefaultProps:function(){return{onCloseViewer:null,onComponentDidMount:null,onComponentWillUnmount:null,forceFileUnlocked:!1,shouldFocusCommentInput:!1,hideComments:!1,disableRouting:!1,skipOuterRouting:!1,oref:M.OREF_CONSTANTS.BROWSE_UNKNOWN,hidePageChrome:!1,canClose:!1,isVersionHistoryMode:!1,canRestoreRevision:!1,onRestoreRevision:null,isCommentsDemo:!1}},getInitialState:function(){return o.extend({fileSidebarLoaded:!1},this._getStateFromStore())},componentWillMount:function(){return this._setUpLogging(),L.FILE_ACTIVITY_STREAM&&B(["modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_sidebar/store/instance","modules/clean/react/file_sidebar/store/app/actions"],function(e){return function(t,n,o){var r,i;return r=t.FileSidebarProvider,i=n.store,i.dispatch(o.setState({hideComments:e.props.hideComments,hidePageChrome:e.props.hidePageChrome,isCommentsDemo:e.props.isCommentsDemo})),e.setState({fileSidebarLoaded:!0})}}(this)),this.props.isCommentsDemo?y.set_disabled(!0):u.initInstance()},componentDidMount:function(){var e,t,n;return"function"==typeof(e=this.props).onComponentDidMount&&e.onComponentDidMount(),this._flipNext=o.throttle(this._flipNext,100),this._flipPrevious=o.throttle(this._flipPrevious,100),this._removeStoreListener=C.addListener(this._onUpdateFromStore),this._setupPreviewUrl(this.state.currentFile),this._setupKeymaster(),this._preloadImages(this.state.files,this.state.currentIndex),this._setDocumentTitle($.get_filename(this.state.currentFile),!0),F.scroll_lock_document(),this._shouldSuppressPassInfo()||(t={file:this.state.currentFile,url:null!=(n=this.state.sharedLinkInfo)?n.url:void 0},J.setup(this.state.user,t,null)),this._focusInViewer(),m.start()},componentWillUpdate:function(e,t){var n,o,r,i,s;return o=t.currentFile,this._updatePreviewUrl(o),this._setDocumentTitle($.get_filename(o)),this._preloadImages(t.files,t.currentIndex),key.setScope(Q),this._shouldSuppressPassInfo()||q.areEqual(o,this.state.currentFile)?void 0:(r={file:o,url:null!=(i=t.sharedLinkInfo)?i.url:void 0},n={file:this.state.currentFile,url:null!=(s=this.state.sharedLinkInfo)?s.url:void 0},J.setup(t.user,r,n))},componentWillUnmount:function(){var e,t,n;return this._removeStoreListener(),this._teardownPreviewUrl(),this._cleanupKeymaster(),this._unsetDocumentTitle(),F.scroll_unlock_document(),t={file:this.state.currentFile,url:null!=(n=this.state.sharedLinkInfo)?n.url:void 0},J.teardown(this.state.user,t,!0),"function"==typeof(e=this.props).onComponentWillUnmount?e.onComponentWillUnmount():void 0},_shouldSuppressPassInfo:function(){return this.props.isCommentsDemo||this.props.hideComments||null===this.state.currentFile.ns_id},_getStateFromStore:function(){return{files:C.files(),currentIndex:C.currentIndex(),currentFile:C.currentFile(),user:C.user(),sharedLinkInfo:C.sharedLinkInfo(),shareToken:C.shareToken(),sharePermissions:C.sharePermissions(),isFullscreen:C.isFullscreen(),showPreviewQualityPopup:C.showPreviewQualityPopup()}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore())},_getActivityContextData:function(){var e;switch(e=this.state.currentFile,this.props.activityContext){case H.BROWSE_FILE_VIEWER:return e.fq_path;case H.SHARED_LINK_VIEW:return this.state.sharedLinkInfo.url;case H.SHARED_CONTENT_LINK_VIEW:return this.state.sharedLinkInfo.url;default:return null}},_setUpLogging:function(){var e,t,n,o;return n=$.determineSourceContext(),K.currentSession=new K({sourceContext:n,isSharedLink:!!this.state.sharedLinkInfo}),this.props.fileViewTarget===M.FileViewTargetType.SHARED_CONTENT_LINK&&(o=k.start_time(),e=(new Date).getTime(),t="PREVIEW_PAGE",this.state.user)?ne.log(this.state.user.id,"PREVIEW_RENDER",t,{timing:e-o,containing_ns_id:this.state.currentFile.ns_id,sjid:this.state.currentFile.sjid}):void 0},_setupPreviewUrl:function(e){return this.props.skipOuterRouting?void 0:this._setPreviewUrl(e)},_updatePreviewUrl:function(e){return this._setPreviewUrl(e,!1)},_teardownPreviewUrl:function(){return this.props.skipOuterRouting?void 0:this._unsetPreviewUrl()},_setPreviewUrl:function(e,t){var n,o,r,i;return null==t&&(t=!0),this.props.disableRouting?void 0:(r=$.get_filename(e),n=U.parse(p.get_url()),o=U.encode_parts(n.getPath()),i=n.removeQuery("select").updateQuery({preview:r}).getQuery(),t?p.push_state(o,i,{immediatelyRestoreState:!1}):p.replace_state(o,i))},_unsetPreviewUrl:function(){var e,t,n;return this.props.disableRouting?void 0:(e=U.parse(p.get_url()),t=U.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery(),p.push_state(t,n,{immediatelyRestoreState:!1}))},_focusInViewer:function(){var e,t;if(!this.props.shouldFocusCommentInput){if(t=le(this).querySelector(".button-primary"))return t.focus();if(e=F.getTabbableElementsIn(".react-file-viewer"),e.length)return e[0].focus()}},_flipNext:function(){return E.flipNext()},_flipPrevious:function(){return E.flipPrevious()},_setupKeymaster:function(){return Y.isFlippableFile(this.state.currentFile)&&(key("left",Q,function(e){return function(t){return e._flipPrevious(),E.logUserAction(ie.FLIP_PREV,re.KEYBOARD)}}(this)),key("right",Q,function(e){return function(t){return e._flipNext(),E.logUserAction(ie.FLIP_NEXT,re.KEYBOARD)}}(this))),key("esc",Q,function(e){return function(t){var n;return F.focus_in_input()||F.is_input(t.target)||document.querySelector(".annotation-bubble")?void 0:"function"==typeof(n=e.props).onCloseViewer?n.onCloseViewer():void 0}}(this)),X=key.getScope(),key.setScope(Q)},_cleanupKeymaster:function(){return key.clearScope(Q),key.setScope(X)},_preloadImages:function(e,t){var n,r,i,s,a,l;if(0!==e.length){for(i=[],l=[0,1,2,3,4,5,6,-1,-2],s=0,a=l.length;a>s;s++)n=l[s],r=(t+n+e.length)%e.length,indexOf.call(i,r)<0&&i.push(r);return i.forEach(function(t){var n,r,i;return"photo"===(null!=(i=e[t])?i.preview_type:void 0)&&(n=e[t],r=n.preview_url||n.thumbnail_url_tmpl)?O.preloadImage(r).then(function(e){var n;return n=K.currentSession,o.has(n.imagesFetched,t)?void 0:n.imagesFetched[t]=e}):void 0})}},_setDocumentTitle:function(e,t){return null==t&&(t=!1),this.props.isCommentsDemo?void 0:(t&&(ce=document.title),document.title=e)},_unsetDocumentTitle:function(){return this.props.isCommentsDemo?void 0:""!==ce?document.title=ce:void 0},_getCommentsActionCreators:function(){return this.props.isCommentsDemo?a:s},_renderFlippableControls:function(){return Y.isFlippableFile(this.state.currentFile)&&!this.state.isFullscreen?z({index:""+(this.state.currentIndex+1),numFlippableFiles:this.state.files.length,onNext:this._flipNext,onPrevious:this._flipPrevious}):void 0},_renderFilePreview:function(){var e,t;return e=!this.props.hidePageChrome||this.props.isCommentsDemo,ae({className:"react-file-viewer__preview react-file-preview"},ae({className:"flex-preview-container"},this.state.showPreviewQualityPopup?this._renderPreviewQualityPopup():void 0,te({file:this.state.currentFile,fileViewTarget:this.props.fileViewTarget,fileViewOrigin:this.props.fileViewOrigin,fileViewAction:this.props.fileViewAction,sharedLinkUrl:null!=(t=this.state.sharedLinkInfo)?t.url:void 0,isFullscreen:this.state.isFullscreen,onCloseViewer:this.props.onCloseViewer,user:this.state.user,maxFilenameEmLength:Z,areImagePreviewAnnotationsVisible:e,shouldDisplayAnnotationsToolbar:e,areActionablesEnabled:!this.props.hidePageChrome&&null!==this.state.currentFile.ns_id,index:this.state.currentIndex,count:this.state.files.length,onPrevious:this._flipPrevious,onNext:this._flipNext,shareToken:this.state.shareToken,sharePermissions:this.state.sharePermissions,sharedLinkInfo:this.state.sharedLinkInfo,commentsActionCreators:this._getCommentsActionCreators()})),e?void 0:this._renderFlippableControls())},_renderSidebar:function(){return t.createElement(W,{activityContext:this.props.activityContext,hideComments:this.props.hideComments,hidePageChrome:this.props.hidePageChrome,isCommentsDemo:this.props.isCommentsDemo,shouldInitiallyFocusInput:this.props.shouldFocusCommentInput,currentFile:this.state.currentFile,sharedLinkInfo:this.state.sharedLinkInfo,user:this.state.user})},_renderTitleBar:function(){return this.props.hidePageChrome?null:ae({className:"react-file-viewer__title-bar"},oe({shareToken:this.state.shareToken,sharePermissions:this.state.sharePermissions,file:this.state.currentFile,user:this.state.user,maxFilenameEmLength:Z,canClose:this.props.canClose,onCloseViewer:this.props.onCloseViewer,shareHelpers:this.props.shareHelpers,sharedLinkInfo:this.state.sharedLinkInfo,isVersionHistoryMode:this.props.isVersionHistoryMode,isSeenStatesEnabled:!this._shouldSuppressPassInfo(),isDemoMode:this.props.isCommentsDemo,canRestoreRevision:this.props.canRestoreRevision,onRestoreRevision:this.props.onRestoreRevision,accountMenuOptions:this.props.accountMenuOptions,commentsActionCreators:this._getCommentsActionCreators(),fileViewOrigin:this.props.fileViewOrigin,fileViewAction:this.props.fileViewAction}))},_renderPreviewQualityPopup:function(){return this.props.hidePageChrome?null:null!=this.state.sharedLinkInfo||this.state.user.home_ns_id!==this.state.currentFile.ns_id?null:t.createElement(ee,{file:this.state.currentFile,showProbability:L.PREVIEW_QUALITY_POPUP_PROBABILITY})},render:function(){var e,n,o;return n=$.get_filename(this.state.currentFile),o=this.state.isFullscreen?ae({className:"react-file-viewer",role:"dialog","aria-label":n},this._renderFilePreview()):ae({className:"react-file-viewer",role:"dialog","aria-label":n},this._renderTitleBar(),ae({className:"react-file-viewer__content"},this._renderFilePreview(),this._renderSidebar())),L.FILE_ACTIVITY_STREAM&&this.state.fileSidebarLoaded?(e=B("modules/clean/react/file_sidebar/file_sidebar_provider").FileSidebarProvider,t.createElement(e,{},o)):o}}),se=["/static/css/comments-vfl0vL8dc.css","/static/css/comments_annotations-vfl9mOm0F.css","/static/css/file_comments_pane-vflr_bPm-.css","/static/css/preview_archive-vflWdNToO.css","/static/css/preview_audio-vflognSBl.css","/static/css/preview_pdf-vflkPmVoV.css","/static/css/preview_error-vfl4NeqMQ.css","/static/css/preview_flexbox_layout-vfl_OaU2I.css","/static/css/preview_image-vflh3AREO.css","/static/css/preview_image_with_annotations-vflLOtc89.css","/static/css/preview_linkfile-vflzpnXCF.css","/static/css/preview_quality_popup-vflyrlOUZ.css","/static/css/preview_toolbar-vfloZAcu4.css","/static/css/preview_video-vfl28cjUi.css","/static/css/react_file_viewer-vflzggMgT.css","/static/css/react_title_bar-vflZdgBCG.css","/static/css/video-js-5-custom-vfl-b-w8b.css"],G=v(j,se),{FileViewerWithoutCss:j,FileViewer:G}}),define("modules/clean/react/file_viewer/flippable_controls",["external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n){var o,r,i,s,a;return a=e.DOM,i=a.button,s=a.div,r=n._,o=e.createClass({displayName:"FlippableControls",propTypes:{index:e.PropTypes.string.isRequired,numFlippableFiles:e.PropTypes.number.isRequired,onNext:e.PropTypes.func,onPrevious:e.PropTypes.func},_handlePreviousClick:function(){var e;return"function"==typeof(e=this.props).onPrevious?e.onPrevious():void 0},_handleNextClick:function(){var e;return"function"==typeof(e=this.props).onNext?e.onNext():void 0},render:function(){return this.props.numFlippableFiles>1?s({className:"react-file-viewer__controls"},i({onClick:this._handlePreviousClick,className:"nav-control"},e.createElement(t,{group:"web",name:"s_flip_left",alt:r("Flip left",{comment:"Flip to the previous file in a series of files"})})),s({className:"nav-text"},r("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})),i({onClick:this._handleNextClick,className:"nav-control"},e.createElement(t,{group:"web",name:"s_flip_right",alt:r("Flip right",{comment:"Flip to the next file in a series of files"})}))):null}})}),define("modules/clean/react/file_viewer/full_screen_helpers",["jquery","modules/clean/react/file_viewer/actions"],function(e,t){var n;return n={setupFullscreen:function(t){return t&&(e(document).on("fullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("webkitfullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("msfullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("mozfullscreenchange.preview",this._setupExitFullscreenListeners)),this.setBrowserFullscreen(t)},_setupExitFullscreenListeners:function(){return e(document).off("fullscreenchange.preview"),e(document).off("webkitfullscreenchange.preview"),e(document).off("msfullscreenchange.preview"),e(document).off("mozfullscreenchange.preview"),e(document).on("fullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("webkitfullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("msfullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("mozfullscreenchange.preview",t.closeFullscreen.bind(t))},teardownExitFullscreenListeners:function(){return e(document).off("fullscreenchange.preview"),e(document).off("webkitfullscreenchange.preview"),e(document).off("msfullscreenchange.preview"),e(document).off("mozfullscreenchange.preview")},setBrowserFullscreen:function(t){var n;if(n=e("body")[0],t){if(null!=n.requestFullscreen)return n.requestFullscreen();if(null!=n.msRequestFullscreen)return n.msRequestFullscreen();if(null!=n.mozRequestFullScreen)return n.mozRequestFullScreen();if(null!=n.webkitRequestFullscreen)return n.webkitRequestFullscreen()}else{if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()}}},{FullscreenHelpers:n}}),define("modules/clean/react/file_viewer/models",["require","exports","tslib","external/immutable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/uuid","modules/constants/file_viewer","modules/core/exception"],function(e,t,n,o,r,i,s,a,l){"use strict";var c={};c[r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED]=null,c[r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED]=r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,c[r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]=r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,c[r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]=r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,c[r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,c[r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]=r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,c[r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]=r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,c[r.EventTypes.FILE_PREVIEW_RENDER_FAILED]=r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED;var u=o.Record({id:void 0,sourceContext:void 0,isSharedLink:!1}),d=function(e){function t(t){var n=t.sourceContext,o=t.isSharedLink,r=e.call(this,{id:s.v4({allowInsecure:!0}),sourceContext:n,isSharedLink:o})||this;return r.imagesFetched={},r}return n.__extends(t,e),t}(u);d.currentSession=null,t.FileViewerSession=d;var p=function(){function e(e){var t=e.fileViewerSession,n=e.file;l.assert(!!t,"FileViewerSession required"),l.assert(!!n,"File required"),this.id=s.v4({allowInsecure:!0}),this.fileViewerSession=t,this.file=n,this.previewTimeline={},this.lastEvent=null,this.pagesRendered={}}return e.prototype.recordEvent=function(e,t){if(void 0===t&&(t={}),!(t instanceof Object))throw new Error("extra param of recordEvent should be an object.");if(r.EventTypes.hasOwnProperty(e)&&!this._isEventInTimeline(e)){if(c.hasOwnProperty(e)&&this.lastEvent!==c[e])return void(a.FILE_VIEWER_LOGGER_ERRORS&&l.raiseAndReport("FilePreviewLogger event called out of order",{tags:["file_preview_logger_bad_event_order"],severity:l.SEVERITY.NONCRITICAL,exc_extra:{event:e,sourceContext:this.fileViewerSession.sourceContext,file:this.file}}));this._addToTimeline(e),i.emit(e,this,t),this.lastEvent=e}},e.prototype._isEventInTimeline=function(e){return e in this.previewTimeline},e.prototype._addToTimeline=function(e){this.previewTimeline[e]={timestamp:Date.now()}},e}();p.currentSession=null,t.FilePreviewSession=p}),define("modules/clean/react/file_viewer/more_dropdown",["external/react","modules/clean/previews/util","modules/clean/react/bubble_menu","modules/clean/react/file_action_button","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/file_viewer/more_dropdown/icon","modules/clean/react/sprite","modules/clean/static_urls","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N;return E=t.PreviewHelper,h=n.BubbleMenu,m=o.FileActionButtonType,_=o.FileActionButton,w=i.UserActionNames,S=i.UserActionContextNames,y=a.MoreOptionOrOptionGroup,v=a.MoreOptionDivider,g=l.MoreDropdownIcon,N=u.static_url,T=p._,b=e.createFactory(c),A=e.DOM,P=A.div,C=A.button,I=e.createElement,f=e.createClass({displayName:"MoreDropdown",propTypes:{allowRemoveLink:e.PropTypes.bool,file:e.PropTypes.object.isRequired,user:e.PropTypes.object,isPrivate:e.PropTypes.bool.isRequired,onRemoveShareLink:e.PropTypes.func,isMaestroDesign:e.PropTypes.bool},getInitialState:function(){return this._getStateFromRegistry()},componentDidMount:function(){return this._removeRegistryListener=s.addListener(this._onRegistryUpdate)},componentWillUnmount:function(){return this._removeRegistryListener()},_onRegistryUpdate:function(){return this.setState(this._getStateFromRegistry())},_getStateFromRegistry:function(){return{registeredItems:s.getOptionItems()}},_handleDownloadClick:function(e){return e.preventDefault(),r.download(this.props.file),r.logUserAction(w.DOWNLOAD,S.TITLE_BAR_MORE)},_handleRemoveLinkClick:function(e){return e.preventDefault(),this.props.onRemoveShareLink(),r.logUserAction(w.REMOVE_LINK,S.TITLE_BAR_MORE)},_handlePreviousVersionClick:function(e){return e.preventDefault(),E.redirectToVersionHistory(this.props.file,this.props.user),r.logUserAction(w.VIEW_REVISIONS,S.TITLE_BAR_MORE)},_renderDropdownTarget:function(e){var t,n;return t=null!=(n=(null!=e?e:{}).isDisabled)?n:!1,this.props.isMaestroDesign?C({className:"more-button sprite-button",disabled:t,"aria-label":"More actions"},I(g)):C({className:"more-button button-secondary control__button",disabled:t},b({group:"web",name:"control_more",alt:T("More actions")}))},_renderRemoveShareLink:function(){return I(_,{className:"more-button__remove",type:m.REMOVE_LINK,callback:this._handleRemoveLinkClick,isMaestroDesign:this.props.isMaestroDesign})},_getDropdownItems:function(){var e;return e=[],null!=this.props.onRemoveShareLink&&this.props.allowRemoveLink&&e.push(this._renderRemoveShareLink()),this.props.isPrivate&&(e.push(I(_,{className:"more-button__download",type:m.DOWNLOAD,callback:this._handleDownloadClick,isMaestroDesign:this.props.isMaestroDesign})),e.push(I(_,{className:"more-button__version-history",type:m.PREVIOUS_VERSIONS,callback:this._handlePreviousVersionClick,isMaestroDesign:this.props.isMaestroDesign}))),e},render:function(){var e,t;return e=this._getDropdownItems(),e.length&&this.state.registeredItems.length&&e.push(I(v,{})),t=this.state.registeredItems.map(function(e){return function(t){return I(y,{item:t,isMaestroDesign:e.props.isMaestroDesign})}}(this)),e=e.concat(t),e.length?P({className:"u-mar-left-xs"},I(d,{content:T("More"),position:d.POSITIONS.BOTTOM,distanceFromTarget:10,className:"react-title-bar--title-bubble",isTargetPositionFixed:!0},I(h,{targetButton:this._renderDropdownTarget(),targetFixed:!0,position:h.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"react-file-viewer-dropdown react-file-viewer-more-dropdown",verticalDisplacement:4,items:e}))):P({className:"u-mar-left-xs"},this._renderDropdownTarget({isDisabled:!0}))}})}),define("modules/clean/react/file_viewer/more_dropdown/icon",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("svg",{width:"32px",height:"32px",viewBox:"0 0 32 32",version:"1.1",className:"svg-icon"},o.createElement("defs",null),o.createElement("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fillRule:"evenodd"},o.createElement("g",{id:"editor-header",transform:"translate(-32.000000, -32.000000)"},o.createElement("g",{id:"editor-header-overflow",transform:"translate(32.000000, 32.000000)"},o.createElement("path",{d:"M7,16 C7,14.895 7.888,14 9,14 C10.105,14 11,14.888 11,16 C11,17.105 10.112,18 9,18 C7.895,18 7,17.112 7,16 L7,16 Z M21,16 C21,14.895 21.888,14 23,14 C24.105,14 25,14.888 25,16 C25,17.105 24.112,18 23,18 C21.895,18 21,17.112 21,16 L21,16 Z M14,16 C14,14.895 14.888,14 16,14 C17.105,14 18,14.888 18,16 C18,17.105 17.112,18 16,18 C14.895,18 14,17.112 14,16 L14,16 Z",id:"Shape"})))))},t}(o.Component);t.MoreDropdownIcon=r});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/file_viewer/more_dropdown/models",["external/immutable","external/underscore"],function(e,t){var n,o,r;return n=e.Record({className:null,fileActionButtonType:null,handler:t.noop}),r=e.Record({options:[]}),o=function(e){function t(e){var o,r,i,s;if(null==e&&(e={options:[]}),s=e.options,!(s instanceof Array))throw new Error("MoreOptionGroup takes an object with an object key as an array");for(o=0,r=s.length;r>o;o++)if(i=s[o],!(i instanceof n))throw new Error("MoreOptionGroup can only be a collection of MoreOption objects");t.__super__.constructor.call(this,e)}return extend(t,e),t}(r),{MoreOption:n,MoreOptionGroup:o}});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["external/immutable","external/underscore","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n){var o,r,i,s;return o=n.MoreOption,r=n.MoreOptionGroup,s=function(){function e(){this._listeners=[]}return e.prototype.__emitChange=function(){return this._listeners.forEach(function(e){return e()})},e.prototype.addListener=function(e){if("function"!=typeof e)throw new Error("addListener expects a function");return this._listeners.push(e),function(t){return function(){var n;return t._listeners=function(){var t,o,r,i;for(r=this._listeners,i=[],t=0,o=r.length;o>t;t++)n=r[t],n!==e&&i.push(n);return i}.call(t)}}(this)},e}(),new(i=function(t){function n(){n.__super__.constructor.call(this),this._options=e.List()}return extend(n,t),n.prototype._isValidMoreOption=function(e){return null!=e.fileActionButtonType},n.prototype._isValidMoreOptionGroup=function(e){var t;return t=e.options,t.length&&t.every(function(e){return function(t){return e._isValidMoreOption(t)}}(this))},n.prototype._isValidOption=function(e){return e instanceof o&&this._isValidMoreOption(e)||e instanceof r&&this._isValidMoreOptionGroup(e)},n.prototype.getOptionItems=function(){return this._options.toArray()},n.prototype.addOption=function(e){if(!this._isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");return this._options=this._options.push(e),this.__emitChange()},n.prototype.removeOption=function(e){var t;if(null!=e&&!this._isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");return t=this._options.indexOf(e),t>=0?(this._options=this._options.delete(t),this.__emitChange()):void 0},n.prototype.replaceOption=function(e,t){var n;if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this._isValidOption(e)||!this._isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t))return n=this._options.indexOf(e),n>=0?(this._options=this._options.set(n,t),this.__emitChange()):void 0},n}(s))}),define("modules/clean/react/file_viewer/more_dropdown/views",["external/react","modules/clean/react/bubble_menu","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,o){var r,i,s,a,l,c,u,d,p,h,_,m;return r=t.BubbleMenuItemGroup,i=n.FileActionButton,s=o.MoreOption,c=o.MoreOptionGroup,p=e.createElement,m=e.DOM,_=m.li,h=m.hr,a=e.createClass({displayName:"MoreOption",propTypes:{option:e.PropTypes.instanceOf(s).isRequired,closeFunc:e.PropTypes.func,isMaestroDesign:e.PropTypes.bool},render:function(){return p(i,{type:this.props.option.fileActionButtonType,className:this.props.option.className,callback:this.props.option.handler,closeFunc:this.props.closeFunc,isMaestroDesign:this.props.isMaestroDesign})}}),l=e.createClass({displayName:"MoreOptionDivider",render:function(){return _({role:"separator"},h({className:"c-rule u-mar-bottom-xs"}))}}),u=e.createClass({displayName:"MoreOptionGroup",propTypes:{optionGroup:e.PropTypes.instanceOf(c).isRequired,closeFunc:e.PropTypes.func,isMaestroDesign:e.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},render:function(){var e;return e=this.props.optionGroup.options,p(r,{items:e.map(function(e){return function(t){return p(a,{option:t,isMaestroDesign:e.props.isMaestroDesign})}}(this)),closeFunc:this.props.closeFunc})}}),d=e.createClass({displayName:"MoreOptionOrOptionGroup",propTypes:{item:e.PropTypes.oneOfType([e.PropTypes.instanceOf(s),e.PropTypes.instanceOf(c)]).isRequired,closeFunc:e.PropTypes.func,isMaestroDesign:e.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},render:function(){var e;return e=this.props.item,e instanceof s?p(a,{option:e,closeFunc:this.props.closeFunc,isMaestroDesign:this.props.isMaestroDesign}):p(u,{optionGroup:e,closeFunc:this.props.closeFunc,isMaestroDesign:this.props.isMaestroDesign})}}),{MoreOptionComponent:a,MoreOptionGroupComponent:u,MoreOptionOrOptionGroup:d,MoreOptionDivider:l}}),define("modules/clean/react/file_viewer/mounted_file_actions",["external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/react/user_notifications/constants","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/core/i18n","modules/constants/file_viewer","require"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){var _,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O;return T=n.UserActionNames,w=n.UserActionContextNames,m=n.FileViewerPane,S=i.ToggleCommentsContainer,C=a.UserNotificationsDropdown,_=l.BellDesignTypes,y=c.ShareApiClient,A=u.deleteLinkWithConfirm,I=d._,f=e.createFactory(o),v=e.createFactory(r),b=e.createFactory(S),E=e.createFactory(s),C=e.createFactory(C),O=e.DOM,P=O.button,N=O.div,g=e.createClass({displayName:"MountedFileActions",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,shareHelpers:e.PropTypes.object,commentsActionCreators:e.PropTypes.object.isRequired},getDefaultProps:function(){return{shareHelpers:null}},getInitialState:function(){return{linkMetadata:null}},componentDidMount:function(){return this._setupShare()},_setupShare:function(){var e;return e=new y({userId:this.props.user.id}),e.sharedLinkInfo({fileIdOrPath:this.props.file.fq_path}).then(function(e){return function(t){return e.isMounted()?e.setState({linkMetadata:t}):void 0}}(this))},_handleShareClick:function(){return this.props.shareHelpers.share(this.props.file,this.props.user,null,"PREVIEW_PAGE"),t.logUserAction(T.SHARE,w.TITLE_BAR_MAIN)},_removeShareLink:function(){var e,t;return e=new y({userId:this.props.user.id}),t=this.state.linkMetadata.url,A({client:e,contentName:this.state.linkMetadata.name,onCancel:null,onDeleteLink:function(e){return function(){return e.setState({linkMetadata:null})}}(this),url:t})},_logUserActionInTitleBarFactory:function(e){return function(){return t.logUserAction(e,w.TITLE_BAR_MAIN);
}},_renderToggleSidebar:function(){return p.MAESTRO_ENABLED?null:b({actionCreators:this.props.commentsActionCreators})},_renderUserNotificationsDropdown:function(){return p.MAESTRO_ENABLED?C({key:"UserNotificationsDropdown",isPagelet:!1,isMaestroDesign:p.MAESTRO_ENABLED,onClick:this._logUserActionInTitleBarFactory(T.CLICK_NOTIFICATIONS),bellDesign:_.GRAY_ICON}):void 0},_renderDivider:function(){return p.MAESTRO_ENABLED?N({className:"react-title-bar__divider"}):void 0},render:function(){var e;return E({},null!=this.props.shareHelpers?P({className:"share-button button-primary control__button",onClick:this._handleShareClick},I("Share")):void 0,v({file:this.props.file,user:this.props.user,location:m.TITLE_BAR,isMaestroDesign:p.MAESTRO_ENABLED}),f({allowRemoveLink:null!=(e=this.state.linkMetadata)?e.link_permissions.can_revoke:void 0,file:this.props.file,user:this.props.user,isPrivate:!0,onRemoveShareLink:this._removeShareLink,isMaestroDesign:p.MAESTRO_ENABLED}),this._renderToggleSidebar(),this._renderDivider(),this._renderUserNotificationsDropdown())}})}),define("modules/clean/react/file_viewer/open_button",["external/classnames","external/react","external/underscore","modules/clean/open_with","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button_coachmark","modules/clean/react/file_viewer/utils","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d){var p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M;return I=s.UserActionNames,C=s.UserActionContextNames,y=s.SplitButtonActionLocation,v=l.OpenWithHelpers,T=l.UnityHelpers,k=l.getSplitButtonUserActionContext,P=d._,O=t.createElement,L=t.DOM,A=L.a,N=L.button,R=L.div,D=L.li,M=L.ul,p=t.createFactory(r),g=t.createFactory(a),E=t.createFactory(c),b=t.createFactory(u),m="open-button",h=m+"__download",S=m+"__unity",_=m+"__open-with",w=m+"__unity-folder",f=t.createClass({displayName:"OpenButton",propTypes:{file:t.PropTypes.object.isRequired,isMaestroDesign:t.PropTypes.bool,isUnityDisabled:t.PropTypes.bool,isOpenWithDisabled:t.PropTypes.bool,justifyRight:t.PropTypes.bool,onClick:t.PropTypes.func,user:t.PropTypes.object.isRequired,location:t.PropTypes.number},getDefaultProps:function(){return{isMaestroDesign:!1,isUnityDisabled:!1,isOpenWithDisabled:!1,justifyRight:!0,onClick:null,location:null}},getInitialState:function(){return{coachmarkHidden:!1,unityInfo:null}},componentDidMount:function(){return T.isUnityEnabled()?this._setupUnity():void 0},componentDidUpdate:function(){var e;return null!=(e=this.refs.dropdown)?e.show():void 0},_hideCoachmark:function(){return this.setState({coachmarkHidden:!0})},_setupUnity:function(){return this.props.isUnityDisabled?void this._disableUnity():(T.getUnityFileInfo(this.props.file.ns_id,this.props.file.ns_path,this.props.user.id,function(e){return function(t){return e.isMounted()?e.setState({unityInfo:t}):void 0}}(this),this._disableUnity),window.setTimeout(function(e){return function(){return null===e.state.unityInfo?e._disableUnity():void 0}}(this),1e4))},_disableUnity:function(){return this.isMounted()?this.setState({unityInfo:{can_open_directly:!1,is_locally_available:!1,is_infinite_placeholder:!1}}):void 0},_hasUnityFolderSupport:function(){return!this.props.isUnityDisabled&&null!=this.state.unityInfo&&(!!this.state.unityInfo.is_locally_available||!!this.state.unityInfo.is_infinite_placeholder)&&T.clientSupportsOpenInFileBrowser()},_hasUnityFileSupport:function(){return!this.props.isUnityDisabled&&null!=this.state.unityInfo&&!!this.state.unityInfo.is_locally_available&&this.state.unityInfo.can_open_directly!==!1},_hasOpenWithSupport:function(){return!this.props.isOpenWithDisabled&&v.canOpenWith(this.props.file,this.props.user)},_getNumEnabled:function(){return(this._hasOpenWithSupport()?1:0)+(this._hasUnityFileSupport()?1:0)+(this._hasUnityFolderSupport()?1:0)},_isDropdownDisabled:function(){return this._getNumEnabled()<2},_isButtonDisabled:function(){return null===this.state.unityInfo},_getFileBrowserLabel:function(){var e,t;return e=(null!=(t=this.state.unityInfo)?t.file_browser_display_name:void 0)||P("File Browser"),P("Show in %(file_browser)s").format({file_browser:e})},_getNativeAppLabel:function(){var e,t;return e=(null!=(t=this.state.unityInfo)?t.open_application_name:void 0)||P("Desktop"),P("Open in %(app_name)s").format({app_name:e})},_onClickAnyOpenButtonType:function(){var e;return this._hideCoachmark(),"function"==typeof(e=this.props).onClick?e.onClick():void 0},_getActionContext:function(e){return null!=this.props.location?k(e,this.props.location)||C.UNKNOWN:C.UNKNOWN},_handleUnityFileClick:function(e){return function(t){return function(n){var o;return t._onClickAnyOpenButtonType(),o=t.props.file,T.openFile(o.ns_id,o.ns_path,t.props.user.id),i.logUserAction(I.OPEN_IN_UNITY,t._getActionContext(e)),null!=n?n.preventDefault():void 0}}(this)},_handleUnityFolderClick:function(e){return function(t){return function(n){var o;return t._onClickAnyOpenButtonType(),o=t.props.file,T.openFile(o.ns_id,o.ns_path,t.props.user.id,!0),i.logUserAction(I.OPEN_IN_UNITY_FOLDER,t._getActionContext(e)),null!=n?n.preventDefault():void 0}}(this)},_handleOpenWithClick:function(e){return function(t){return function(n){return t._onClickAnyOpenButtonType(),v.openWith(t.props.file,t.props.user),i.logUserAction(I.OPEN_IN_OFFICE_ONLINE,t._getActionContext(e)),null!=n?n.preventDefault():void 0}}(this)},_handleDownloadClick:function(e){return function(t){return function(n){return t._onClickAnyOpenButtonType(),i.download(t.props.file),i.logUserAction(I.DOWNLOAD,t._getActionContext(e)),null!=n?n.preventDefault():void 0}}(this)},_renderCoachmark:function(e,t){return R({className:"c-coach-mark__container"},e,this.state.coachmarkHidden?void 0:g({file:this.props.file,user:this.props.user,inDropdown:t}))},_renderMainButton:function(){var t,n,r,i;return t={"button-secondary":!0,"c-btn":this.props.isMaestroDesign,"c-btn--secondary":this.props.isMaestroDesign,"c-split-btn":!this._isDropdownDisabled(),"c-split-btn--left":!this._isDropdownDisabled(),control__button:!0,disabled:this._isButtonDisabled()},this._hasUnityFileSupport()?(t[S]=!0,r=N({ref:"openButton",className:e(t),onClick:this._handleUnityFileClick(y.MAIN)},P("Open")),o.is_adobe_app(null!=(i=this.state.unityInfo)?i.open_application_identifier:void 0)?this._renderCoachmark(r,!1):r):this._hasUnityFolderSupport()?(t[w]=!0,N({ref:"openButton",className:e(t),onClick:this._handleUnityFolderClick(y.MAIN)},P("Open"))):this._hasOpenWithSupport()&&!this._isButtonDisabled()?(t[_]=!0,n=N({ref:"openButton",className:e(t),onClick:this._handleOpenWithClick(y.MAIN)},P("Open")),this._renderCoachmark(n,!1)):this._isButtonDisabled()?N({ref:"openButton",className:e(t)},""):(t[h]=!0,N({ref:"openButton",className:e(t),onClick:this._handleDownloadClick(y.MAIN)},P("Download")))},_renderSplitButton:function(){var t,n;return n=e({"button-secondary":!0,"c-btn":this.props.isMaestroDesign,"c-btn--secondary":this.props.isMaestroDesign,"c-split-btn":!0,"c-split-btn--right":!0,"c-split-btn--dropdown":!0,control__button:!0}),t=N({className:n},E({group:"web",name:"control_menu",alt:P("More options")})),this._renderCoachmark(this._renderMenu(t),!0)},_renderDropdownButton:function(){var t,n,r,i;return t=e({"button-secondary":!0,"c-btn":!0,"c-btn--secondary":!0,"download-button":!0,control__button:!0,disabled:this._isButtonDisabled()}),n=!1,this._hasUnityFileSupport()&&o.is_adobe_app(null!=(r=this.state.unityInfo)?r.open_application_identifier:void 0)?n=!0:this._hasOpenWithSupport()&&!this._isButtonDisabled()&&(n=!0),i=N({className:t},P("Open ▾")),n?this._renderCoachmark(i,!0):i},_renderMenu:function(e){var t;return t=v.getOpenWithHandlerData(this.props.file,this.props.user),p({targetButton:e,arrow_position:this.props.justifyRight?"top-right":"top",extra_css_class:"react-file-viewer-dropdown",vertical_displacement:4,bubbleDropdownShown:this._hideCoachmark},M({className:"dropdown-contents"},this._hasUnityFileSupport()?D({},A({href:"#",className:S,onClick:this._handleUnityFileClick(y.SPLIT)},b({group:"web",name:"ow_desktop",text:this._getNativeAppLabel()}))):void 0,this._hasOpenWithSupport()?D({},A({href:"#",className:_,onClick:this._handleOpenWithClick(y.SPLIT)},b({group:"web",name:null!=t?t.icon:void 0,text:null!=t?t.name:void 0}))):void 0,this._hasUnityFolderSupport()?D({},A({href:"#",className:w,onClick:this._handleUnityFolderClick(y.SPLIT)},b({group:"web",name:"ow_folder",text:this._getFileBrowserLabel()}))):void 0))},render:function(){return this.props.isMaestroDesign?R({className:m},this._isDropdownDisabled()?this._renderMainButton():this._renderMenu(this._renderDropdownButton())):R({className:"c-split-btn-container "+m},this._renderMainButton(),this._isDropdownDisabled()?void 0:this._renderSplitButton())}})}),define("modules/clean/react/file_viewer/open_button_coachmark",["external/react","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/utils","modules/clean/react_format","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_,m;return u=t.PreviewHelper,d=r.TooltipHelpers,h=i.reactFormat,m=s.static_url,p=a._,_=function(t){return h(t,{strong:e.DOM.strong()})},l=e.createFactory(o),c=e.createClass({displayName:"OpenButtonCoachmark",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,inDropdown:e.PropTypes.bool.isRequired},getInitialState:function(){return{vendor:null,application:null}},setCoachmarkConfig:function(e,t){return this.setState({vendor:e,application:t})},clearCoachmarkConfig:function(){return this.setCoachmarkConfig(null,null)},onReceiveTooltipInfo:function(e){var t,n,o,r;return n=u.get_extension(this.props.file),o=d.getVendorAndApplication(e,n),null!==o?(r=o.vendor,t=o.application,this.setCoachmarkConfig(r,t)):void 0},componentDidMount:function(){return d.fetchTooltipInfo(this.props.user.id,this.onReceiveTooltipInfo)},hasCoachmark:function(){return this.state.vendor&&this.state.application},dismissCoachmark:function(){return this.clearCoachmarkConfig()},onCoachmarkShown:function(){var e;return e=u.get_extension(this.props.file),d.logImpression(e,this.props.user.id,this.state.application)},onCoachmarkButtonClick:function(){return this.dismissCoachmark()},_renderCoachmark:function(e){var t,n,o,r,i,s;return s=e.title,o=e.imageUrl,r=e.imageUrl2x,n=e.imageAlt,i=e.openButtonBody,t=e.dropdownBody,l({title:s,imageUrl:o,imageUrl2x:r,imageAlt:n,buttonText:p("Got it."),onButtonClick:this.onCoachmarkButtonClick,onShown:this.onCoachmarkShown},this.props.inDropdown?t:i)},_renderMsftWord:function(){return this._renderCoachmark({title:p("Edit shared docs together"),imageUrl:m("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:p("An illustration of a Word file"),buttonText:p("Got it."),openButtonBody:_(p("Click <strong>open</strong> to edit together in Microsoft Word Online.")),dropdownBody:_(p("Choose <strong>Microsoft Word Online</strong> to edit together."))})},_renderMsftExcel:function(){return this._renderCoachmark({title:p("Edit shared spreadsheets together"),imageUrl:m("/static/images/file_viewer/coach_mark_xlsx-vflaEwaN7.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_xlsx@2x-vflkU3Ma1.png"),imageAlt:p("An illustration of an Excel file"),openButtonBody:_(p("Click <strong>open</strong> to edit together in Microsoft Excel Online.")),dropdownBody:_(p("Choose <strong>Microsoft Excel Online</strong> to edit together."))})},_renderMsftPowerpoint:function(){return this._renderCoachmark({title:p("Edit shared presentations together"),imageUrl:m("/static/images/file_viewer/coach_mark_pptx-vfltjppV8.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_pptx@2x-vflpvn3tE.png"),imageAlt:p("An illustration of a Powerpoint file"),openButtonBody:_(p("Click <strong>open</strong> to edit together in Microsoft PowerPoint Online.")),dropdownBody:_(p("Choose <strong>Microsoft PowerPoint Online</strong> to edit together."))})},_renderAdobeAcrobatOrReader:function(){return this._renderCoachmark({title:p("Want to edit this PDF?"),imageUrl:m("/static/images/file_viewer/coach_mark_pdf-vflIMdX1a.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_pdf@2x-vflUkcAgn.png"),imageAlt:p("An illustration of a PDF file"),openButtonBody:_(p("You’re looking at a preview. To open this file for editing, click <strong>Open</strong>.")),dropdownBody:p("You’re looking at a preview. To open this file for editing, click here.")})},render:function(){if(this.hasCoachmark)switch(this.state.vendor){case"msft":switch(this.state.application){case"word":return this._renderMsftWord();case"excel":return this._renderMsftExcel();case"powerpoint":return this._renderMsftPowerpoint()}break;case"adbe":switch(this.state.application){case"acrobat_or_reader":return this._renderAdobeAcrobatOrReader()}}return null}})}),define("modules/clean/react/file_viewer/seen_state_coachmark",["external/react","modules/clean/react/file_viewer/coach_mark","modules/clean/react/pass/utils","modules/clean/react_format","modules/clean/static_urls","modules/clean/zendesk_feedback","modules/core/i18n"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m,f;return c=n.SeenStateHelpers,h=o.reactFormat,f=r.static_url,m=i.showPASSFeedbackForm,u=s._,a=e.createFactory(t),_=e.DOM,d=_.a,p=_.div,l=e.createClass({displayName:"SeenStateCoachmark",propTypes:{shouldShowFeedbackCoachmark:e.PropTypes.bool,userId:e.PropTypes.number.isRequired},getInitialState:function(){return{coachmarkType:null,showCoachmark:!1}},_getCoachmarkCompletion:function(e){return"none"!==e?this.setState({coachmarkType:e,showCoachmark:!0}):this.setState({showCoachmark:!1})},componentDidMount:function(){return c.getCoachmark(this.props.userId,this._getCoachmarkCompletion)},_onCoachmarkButtonClick:function(){return"feedback"===this.state.coachmarkType&&m(),this.setState({showCoachmark:!1}),c.logCoachmarkInteraction(this.props.userId,this.state.coachmarkType,"accepted")},_onCoachmarkClose:function(){return this.setState({showCoachmark:!1}),c.logCoachmarkInteraction(this.props.userId,this.state.coachmarkType,"dismissed")},_renderFeedbackCoachmark:function(){var e;return this.props.shouldShowFeedbackCoachmark?(e=u("Help us improve Dropbox by answering a few questions."),p({className:"feedback-coach-mark"},a({title:u("Have a moment?"),imageUrl:f("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:f("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:u("An illustration explaining the presence and seen state feature"),buttonText:u("Give feedback"),onButtonClick:this._onCoachmarkButtonClick,showClose:!0,onCloseButtonClick:this._onCoachmarkClose},e))):p()},_renderGeneralCoachmark:function(){var e;return e=h(u("You can always turn this off for the files you own. <a>Learn more</a>"),{a:d({className:"plain-link",href:"https://www.dropbox.com/help/9262"})}),p({className:"general-coach-mark"},a({title:u("New! See who viewed this file"),imageUrl:f("/static/images/pass/pass_onboarding_coachmark-vflVCICV4.png"),imageUrl2x:f("/static/images/pass/pass_onboarding_coachmark@2x-vfl16XHDz.png"),imageAlt:u("An illustration explaining the presence and seen state feature"),buttonText:u("Got it"),onButtonClick:this._onCoachmarkButtonClick},e))},render:function(){if(!this.state.showCoachmark)return p();switch(this.state.coachmarkType){case"general":return this._renderGeneralCoachmark();case"feedback":return this._renderFeedbackCoachmark();default:return p()}}})});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/seen_state_facepile",["jquery","external/classnames","external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/viewer_avatar","modules/clean/components/loading_indicator","modules/clean/datetime","modules/clean/em_string","modules/clean/loggers/file_preview_logger","modules/clean/previews/util","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/seen_state_coachmark","modules/clean/react/file_viewer/share_helpers","modules/clean/react/pass/constants","modules/clean/react_format","modules/clean/react/title_bubble","modules/clean/sharing/member_avatars","modules/clean/sharing/ui_util","modules/clean/static_urls","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O){var R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de,pe,he,_e,me,fe,ge,ve,ye;return ae=d.ago,U=h.FilePreviewPassLogger,Z=_.PermissionHelper,x=f.EventTypes,B=v.FilePreviewSession,j=b.MAX_FACES_NORMAL,K=b.MAX_FACES_COMPACT,z=b.MAX_OVERFLOW_BUTTON_INDICATOR,Q=b.PASS_FETCHING_STATUS,_e=S.reactFormat,de=T.getDescriptionForSharedLinkInfo,pe=T.groupAccessTypeString,ge=T.teamAccessTypeString,q=C.GoldenGate,fe=I.static_url,se=N._,ye=N.ungettext,te=n.createFactory(y),ie=n.createFactory(w),me=n.DOM,le=me.button,ue=me.div,he=me.li,ve=me.ul,ce=n.DOM,D=2,R=32,k="CIRCLE",H="SQUARE",G="c-avatar--inactive",M="c-avatar-initials-wrapper",F="c-avatar-initials-wrapper--square",W="#7B8994",Y="c-avatar--overflow",X="c-avatar--shared-link",re=10,ee="normal",J="compact",$="hidden",L=680,V=600,oe=n.createClass({displayName:"SeenStateFacepile",propTypes:{file:n.PropTypes.shape({beacon_context:n.PropTypes.string.isRequired,file_id:n.PropTypes.string.isRequired,ns_id:n.PropTypes.number.isRequired,sjid:n.PropTypes.number.isRequired}).isRequired,user:n.PropTypes.object.isRequired,fromBrowse:n.PropTypes.bool,groups:n.PropTypes.array,hasMemberCountLoaded:n.PropTypes.bool,hasSharedLinkInfoLoaded:n.PropTypes.bool,haveMembersLoaded:n.PropTypes.bool,passFetchingStatus:n.PropTypes.string,presence:n.PropTypes.array,seenStateInfo:n.PropTypes.shape({seen_states:n.PropTypes.array}),sharedLinkInfo:n.PropTypes.shape({allow_download:n.PropTypes.bool,expires_posix:n.PropTypes.number,shared_folder_link_policy:n.PropTypes.string.isRequired,visibility_type:n.PropTypes.number.isRequired}),sharingStorePassInfo:n.PropTypes.shape({users:n.PropTypes.array,invitees:n.PropTypes.array}),uniqueMemberCount:n.PropTypes.number,url:n.PropTypes.string},componentWillMount:function(){return this._resetLogging(),this._filePreviewPassLogger=new U,this._filePreviewPassLogger.listenTo(g),e(window).on("resize.facepile",this._onResize)},componentDidMount:function(){return this._logFacepileShownEvents()},getInitialState:function(){return{sizeMode:this._getSizeMode(),hasHoveredOver:!1}},componentWillReceiveProps:function(e){return this.props.file.ns_id!==e.file.ns_id||this.props.file.sjid!==e.file.sjid?this._resetLogging():void 0},componentDidUpdate:function(e,t){return this._logFacepileShownEvents()},componentWillUnmount:function(){return this._filePreviewPassLogger.unlistenTo(g),e(window).off("resize.facepile")},_getSizeMode:function(){var e,t;return this.props.fromBrowse?ee:(t=ne._getViewportWidth(),e=V>=t?$:L>=t?J:ee)},_computeOverflowBasis:function(e){var t,n,o,r;for(r=this.props.uniqueMemberCount,n=0,o=e.length;o>n;n++)t=e[n],t.incrementOverflowBasis&&r++;return Math.max(r,e.length)},_onResize:function(){return this.setState({sizeMode:this._getSizeMode()})},_resetLogging:function(){return this._hasPassShownBeenLogged=!1,this._hasDisplayedAvatars=!1},_logFacepileShownEvents:function(){var e;return this.props.presence&&this._hasDisplayedAvatars&&!this._hasPassShownBeenLogged?(e=this.props.fromBrowse?x.BROWSE_PASS_SHOWN:x.FILE_PREVIEW_PASS_SHOWN,this._logPassEvent(e),this._hasPassShownBeenLogged=!0):void 0},_logPassEvent:function(e){return g.emit(e,B.currentSession,this.props.file,{numAccessors:this.props.uniqueMemberCount,numViewers:this._getNumViewers(),numCurrentViewers:this._getNumCurrentViewers()})},_getNumViewers:function(){var e,t,n,o,r;for(this._shouldHardcodeCurrentViewer()?(n=1,r=this._seenStateDataWithViewerFiltered(this.props.seenStateInfo.seen_states)):(n=0,r=this.props.seenStateInfo.seen_states),e=0,t=r.length;t>e;e++)o=r[e],null!=o.when_last_seen&&n++;return n},_getNumCurrentViewers:function(){var e,t;return this.props.presence?this._shouldHardcodeCurrentViewer()?(t=function(){var t,n,o,r;for(o=this.props.presence,r=[],t=0,n=o.length;n>t;t++)e=o[t],e!==this.props.user.account_id&&r.push(e);return r}.call(this),1+t.length):this.props.presence.length:0},_getUserAvatarProps:function(e,t,o){var r,a,l;return l={dimension:R,initials:O.getInitials(e),name:e,shape:k},r=s,o||(l.optionalClass=G,A.msie&&(r=i,l.color=W)),a=n.createElement(r,l),o||(a=ce.span({className:M},a)),{dimension:R,photoUrl:t,defaultAvatar:a,optionalClass:l.optionalClass}},_userIsOnline:function(e){var t;return null!=this.props.presence&&(t=e.user_id,indexOf.call(this.props.presence,t)>=0)},_renderUserAvatar:function(e){return n.createElement(r,this._getUserAvatarProps(e.seen_state_user.display_name,e.seen_state_user.photo_circle_url,this._userIsOnline(e.seen_state_user)))},_renderGroupAvatar:function(e){var t,o,r,a,l;return t=pe(e.name,e.access_type,e.num_users),r={alt:t,dimension:R,name:e.name,shape:H,initials:O.getInitials(e.name),optionalClass:G},A.msie?(o=i,r.color=W):o=s,a=ce.span({className:F},n.createElement(o,r)),l=this._wrapButtonWithTooltip(le({className:"pass-facepile-avatar"},a),t,"seen-state-title-bubble group"),ue({className:"react-pass__face-container",key:e.key},l)},_renderTeamGroupAvatar:function(){var e,t,o,r;return o=this.props.groups.find(function(e){return e.is_automatic}),e=ge(o.name,o.access_type),r=n.createElement(a,{alt:e,dimension:R,photoUrl:fe("/static/images/icons/team_32-vflk8mBzO.png"),shape:H}),t=this._wrapButtonWithTooltip(le({className:"pass-facepile-avatar"},r),e,"seen-state-title-bubble group"),ue({className:"react-pass__face-container",key:o.key},t)},_renderSharedLinkAvatar:function(){var e,t,o,r;return e=de(this.props.sharedLinkInfo),t=n.createElement(l,{alt:e,dimension:R,hasAudienceBox:q.hasAudienceBox(this.props.user.id),sharedLinkInfo:this.props.sharedLinkInfo,isMaestroDesign:!0,optionalClass:X}),r=ce.span({className:M},t),o=this._wrapButtonWithTooltip(le({className:"pass-facepile-avatar"},r),e,"seen-state-title-bubble shared-link"),ue({className:"react-pass__face-container"},o)},_renderOverflowAvatarWithTooltip:function(e){var t,o,r;return t=e>=z?z+"+":""+e,o=n.createElement(i,{dimension:R,initials:t,color:W,shape:k,optionalClass:Y}),r=this._wrapButtonWithTooltip(le({className:"pass-facepile-avatar"},o),this._overflowTooltipElement(t),"seen-state-title-bubble facepile-overflow"),ue({className:"react-pass__face-container",key:"overflow-avatar"},r)},_renderAvatarWithTooltip:function(e){var t,n;return t=e.avatar,n=this._wrapButtonWithTooltip(le({className:"pass-facepile-avatar"},t),e.tooltipElement,"seen-state-title-bubble"),ue({className:"react-pass__face-container",key:e.key},n)},_wrapButtonWithTooltip:function(e,t,n){var o;return o=this.props.fromBrowse?x.BROWSE_PASS_HOVER:x.FILE_PREVIEW_PASS_HOVER,ie({content:t,position:w.POSITIONS.BOTTOM,distanceFromTarget:12,isTargetPositionFixed:!0,onMouseEnter:function(e){return function(){return setTimeout(function(){return e.setState({hasHoveredOver:!0})},1e3),e.setState({}),e._logPassEvent(o)}}(this),className:n},e)},_renderCoachmark:function(){return te({userId:this.props.user.id,shouldShowFeedbackCoachmark:this.state.hasHoveredOver})},_offlineTooltipElement:function(e){return ce.span({},_e(se("<b>%(user_name)s</b> <newline/> viewed %(ago)s",{comment:'Format like "userName <newline> viewed 5 days ago"'}),{user_name:this._truncatedTooltipText(e.seen_state_user.display_name),ago:ae(1e3*e.when_last_seen,!1),b:ce.b({key:"thebold"}),newline:ce.br({key:"thenewline"})}))},_onlineTooltipElement:function(e){return ce.span({},_e(se("<b>%(user_name)s</b> <newline/> currently viewing",{comment:'Format like "user_name <newline> currently viewing"'}),{user_name:this._truncatedTooltipText(e),b:ce.b({key:"thebold"}),newline:ce.br({key:"thenewline"})}))},_neverViewedTooltipElement:function(e){return ce.span({},_e(se("<b>%(user_name)s</b> <newline/> never viewed"),{user_name:this._truncatedTooltipText(e),b:ce.b({key:"thebold"}),newline:ce.br({key:"thenewline"})}))},_overflowTooltipElement:function(e){var t;return t=this._truncatedTooltipText(e),ye("%(display_num)s other","%(display_num)s others",t).format({display_num:t})},_truncatedTooltipText:function(e){return p.em_snippet(e,re)},_buildUserInfo:function(e){var t,n,o,r,i,s;return t=this._renderUserAvatar(e),n=e.seen_state_user.display_name,r=e.seen_state_user.user_id||n,o="link_only"===(null!=(i=e.seen_state_user.sharing_access_type)?i.type:void 0),s=this._userIsOnline(e.seen_state_user)?this._onlineTooltipElement(n):null!=e.when_last_seen?this._offlineTooltipElement(e):this._neverViewedTooltipElement(n),{avatar:t,displayName:n,key:r,tooltipElement:s,incrementOverflowBasis:o,isGroup:!1}},_seenStateDataWithViewerFiltered:function(e){return o.filter(e,function(e){return function(t){return t.seen_state_user.user_id!==e.props.user.account_id}}(this))},_partitionUserInfoLists:function(e){var t,n,o,r,i,s;for(i=[],r=[],o=[],t=0,n=e.length;n>t;t++)s=e[t],this._userIsOnline(s.seen_state_user)?i.push(this._buildUserInfo(s)):null!=s.when_last_seen?r.push(this._buildUserInfo(s)):o.push(this._buildUserInfo(s));return{onlineUserInfoList:i,offlineUserInfoList:r,neverViewedUserInfoList:o}},_getAccessorInfoList:function(){var e,t,o,r,i,s,a,l,u,d,p,h;return e=[],r=this._getMergedSeenStateData(),this._shouldHardcodeCurrentViewer()?(u=this._seenStateDataWithViewerFiltered(r),t=this.props.user.account_id,o=!this.props.fromBrowse&&u.length<r.length&&this.props.seenStateInfo.seen_states.some(function(e){var n,o;return o=e.seen_state_user,o.user_id===t&&"link_only"===(null!=(n=o.sharing_access_type)?n.type:void 0)}),h=P.get_viewer().get_user_by_id(this.props.user.id),p=this._getUserAvatarProps(h.display_name,h.photo_url,!0),d=n.createElement(c,p),e.push({avatar:d,displayName:h.display_name,key:this.props.user.account_id,tooltipElement:this._onlineTooltipElement(h.display_name),isGroup:!1,incrementOverflowBasis:o})):u=r,l=this._partitionUserInfoLists(u),a=l.onlineUserInfoList,s=l.offlineUserInfoList,i=this._mergeGroupsWithNeverViewedUsers(l.neverViewedUserInfoList),e.concat(a).concat(s).concat(i)},_getMergedSeenStateData:function(){var e,t,n,o,r,i,s,a;for(n=[].concat(this.props.seenStateInfo.seen_states),a=function(){var e,t,n,o;for(n=this.props.seenStateInfo.seen_states,o=[],e=0,t=n.length;t>e;e++)s=n[e],o.push(s.seen_state_user.user_id);return o}.call(this),i=this.props.sharingStorePassInfo.users,e=0,t=i.length;t>e;e++)o=i[e],r=o.seen_state_user.user_id,indexOf.call(a,r)<0&&(r!==this.props.user.user_id||!this._shouldHardcodeCurrentViewer())&&n.push(o);return n.concat(this.props.sharingStorePassInfo.invitees)},_shouldHardcodeCurrentViewer:function(){var e,t;return t=!(P.get_viewer().is_assume_user_session||this.props.fromBrowse),e=this.props.seenStateInfo.seen_states.some(function(e){return function(t){var n;return n=t.seen_state_user,n.user_id===e.props.user.account_id&&e._userIsOnline(n)}}(this)),t||e},_mergeGroupsWithNeverViewedUsers:function(e){var t,n,o,r;return o=function(){var e,t,o,r;for(o=this.props.groups,r=[],e=0,t=o.length;t>e;e++)n=o[e],n.is_automatic||r.push({name:n.name,access_type:n.access_type,is_automatic:n.is_automatic,num_users:n.num_users,key:n.gid,isGroup:!0});return r}.call(this),r=e.concat(o),t=function(e,t){var n,o;return n=e.isGroup?"name":"displayName",o=t.isGroup?"name":"displayName",e[n].localeCompare(t[o])},r.sort(t)},_seenStateInfoHasLoaded:function(){return null!=this.props.seenStateInfo},_haveSeenStateDataToShow:function(e){var t;return t=e.length,t>=2||1===t&&e[0].key!==this.props.user.account_id},_allDataHasLoaded:function(){return this._seenStateInfoHasLoaded()&&this.props.hasSharedLinkInfoLoaded&&this.props.haveMembersLoaded&&this.props.hasMemberCountLoaded},render:function(){var e,o,r,i,s,a,l;return Z.is_pass_enabled(this.props.user)&&this.state.sizeMode!==$?this.props.passFetchingStatus===Q.ERROR?ue({className:"react-pass__facepile-suppressed"}):this._allDataHasLoaded()?(s=[],a=this.state.sizeMode===J?K:j,this.props.sharedLinkInfo&&(a-=1,s.push(this._renderSharedLinkAvatar())),l=this._renderTeamGroupAvatarIfAppropriate,this.props.groups.some(function(e){return e.is_automatic})&&(a-=1,s.push(this._renderTeamGroupAvatar())),e=this._getAccessorInfoList(),this._haveSeenStateDataToShow(e)&&(e.length<=a?this._pushGroupsAndAccessors(s,e):(r=this._computeOverflowBasis(e),a-=1,i=r-a,e=e.slice(0,a),this._pushGroupsAndAccessors(s,e),s.push(this._renderOverflowAvatarWithTooltip(i)))),s.length?(this._hasDisplayedAvatars=!0,this._renderAvatarsInReverse(s)):(o={"react-pass__vestigial-facepile":!0,"facepile-presence-received":null!=this.props.presence},ue({className:t(o)}))):this.props.fromBrowse?n.createElement(u,{style:u.LoadingIndicatorStyle.DOTS}):ue():ue()},_pushGroupsAndAccessors:function(e,t){var n,o,r,i;for(i=[],o=0,r=t.length;r>o;o++)n=t[o],i.push(e.push(n.isGroup?this._renderGroupAvatar(n):this._renderAvatarWithTooltip(n)));return i},_renderAvatarsInReverse:function(e){var n,o,r;return e.reverse(),n={"react-pass__facepile":!0,"facepile-presence-received":null!=this.props.presence},r=this.props.fromBrowse?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE",o=this.props.fromBrowse?x.BROWSE_PASS_CLICK:x.FILE_PREVIEW_PASS_CLICK,ue({className:"react-pass__facepile-padding"},ue({className:"react-pass__facepile-wrap"},e.length>=D&&!this.props.fromBrowse?ue({className:"seen-state-coach-mark__container"},this._renderCoachmark()):void 0,ue({className:t(n),onClick:function(e){return function(){return e._logPassEvent(o),E.share(e.props.file,P.get_viewer().get_user_by_id(e.props.user.id),e.props.url,r)}}(this)},e)))}}),ne=m(oe,["/static/css/seen_state_facepile-vfluNMbzU.css"]),ne._getViewportWidth=function(){var e;return(null!=(e=document.documentElement)?e.clientWidth:void 0)||1200},ne}),define("modules/clean/react/file_viewer/seen_state_facepile_controller",["require","exports","tslib","external/react","modules/clean/react/file_viewer/seen_state_facepile","modules/clean/react/pass/store","modules/clean/react/pass/utils","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/stores/sharing_info"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=s.PassHelpers,d=o.createElement,p=function(e){function t(t){var n=e.call(this,t)||this;return n.boundUpdate=null,n.state=n._getStateFromStore(),n.boundUpdate=n._onUpdateFromStore.bind(n),n}return n.__extends(t,e),t.prototype._onUpdateFromStore=function(){this.setState(this._getStateFromStore())},t.prototype._getStateFromStore=function(){return{passInfo:{passFetchingStatus:i.passFetchingStatus(this.props.file.ns_id,this.props.file.sjid),presence:i.presence(this.props.file.ns_id,this.props.file.sjid),seenStateInfo:i.seenStateInfo(this.props.file.ns_id,this.props.file.sjid)},sharingInfo:c.getSharingInfo(this.props.user.id,this.props.file.file_id)}},t.prototype._getMemberInfosInPassFormat=function(){return{invitees:this._getInviteeMemberInfos(),users:this._getUserMemberInfos()}},t.prototype._getUserMemberInfos=function(){var e=this.state.sharingInfo.members().get("users");return e.valueSeq().toArray().map(function(e){return{when_last_seen:null,seen_state_user:{user_id:e.account_id,display_name:e.account?e.account.display_name:null,photo_url:e.account?e.account.profile_photo_url:null}}})},t.prototype._getInviteeMemberInfos=function(){var e=this.state.sharingInfo.members().get("invitees");
return e.valueSeq().toArray().map(function(e){return{when_last_seen:null,seen_state_user:{display_name:e.contact}}})},t.prototype._getGroupInfos=function(){var e=this.state.sharingInfo.members().get("groups");return e.valueSeq().toArray().map(function(e){return{access_type:e.access_type,is_automatic:"team"===e.group_type,name:e.group_name,num_users:e.member_count,gid:e.group_id}})},t.prototype._getTruelinkInfo=function(){var e=this.state.sharingInfo.metadata().get("link_metadata");if(!e)return null;var t,n="ALL";switch(e.current_audience){case a.LinkAudience.members:return null;case a.LinkAudience.public:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC;break;default:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY}e.get("password_protected")&&(t=l.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD);var o=this.state.sharingInfo.metadata().get("file_policy").download_policy,r=o===a.DownloadPolicy.disallow,i=e.expiry?Date.parse(e.expiry.toString())/1e3:null;return{visibility_type:t,expires_posix:i,shared_folder_link_policy:n,allow_download:!r}},t.prototype._getShmodelInfo=function(){var e=this.state.sharingInfo.linkMetadata();if(!e)return null;var t,n="ALL";switch(e.link_permissions.get(a.ResolvedVisibilityPolicy.policy_name)){case a.ResolvedVisibilityPolicy.public:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC;break;case a.ResolvedVisibilityPolicy.team_only:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY;break;case a.ResolvedVisibilityPolicy.team_and_password:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD;break;case a.ResolvedVisibilityPolicy.password:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD;break;case a.ResolvedVisibilityPolicy.shared_folder_only:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC,n="MEMBERS_ONLY";break;case a.ResolvedVisibilityPolicy.only_you:t=l.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU}return{expires_posix:e.expires?Date.parse(e.expires.toString())/1e3:null,visibility_type:t,shared_folder_link_policy:n,allow_download:e.link_permissions.get("allow_download")}},t.prototype.componentWillMount=function(){i.add_change_listener(this.boundUpdate),c.add_change_listener(this.boundUpdate),this.props.fromBrowse&&u.setup(this.props.user,{file:this.props.file,url:this.props.url},null,!1)},t.prototype._getPropsFromPassInfo=function(){return this.state.passInfo},t.prototype._getPropsFromSharingInfo=function(){var e={sharedLinkInfo:null,sharingStorePassInfo:{},groups:[],haveMembersLoaded:!1,hasMemberCountLoaded:!1,hasSharedLinkInfoLoaded:!1,uniqueMemberCount:null};return this.state.sharingInfo?(null!=this.state.sharingInfo.memberCounts()&&(e.uniqueMemberCount=this.state.sharingInfo.memberCounts().total_unique_users,e.hasMemberCountLoaded=!0),this.state.sharingInfo.hasDisplayableMembers()&&(e.haveMembersLoaded=!0,e.sharingStorePassInfo=this._getMemberInfosInPassFormat(),e.groups=this._getGroupInfos()),this.props.file.fq_path?l.TRUELINK.TRUELINK_UI[this.props.user.id]&&this.state.sharingInfo.isMetadataLoaded()?(e.hasSharedLinkInfoLoaded=!0,e.sharedLinkInfo=this._getTruelinkInfo()):!l.TRUELINK.TRUELINK_UI[this.props.user.id]&&this.state.sharingInfo.isLinkMetadataLoaded()&&(e.hasSharedLinkInfoLoaded=!0,e.sharedLinkInfo=this._getShmodelInfo()):(e.hasSharedLinkInfoLoaded=!0,e.sharedLinkInfo=null),e):e},t.prototype.render=function(){var e=n.__assign({},this._getPropsFromPassInfo(),this._getPropsFromSharingInfo(),this.props);return d(r,e)},t.prototype.componentWillUnmount=function(){i.remove_change_listener(this.boundUpdate),c.remove_change_listener(this.boundUpdate)},t}(o.Component);p.displayName="SeenStateFacepileController",t.SeenStateFacepileController=p}),define("modules/clean/react/file_viewer/share_helpers",["modules/clean/previews/util","require"],function(e,t){var n,o;return n=e.PreviewHelper,o={share:function(e,o,r,i){return t(["modules/clean/sharing/share_modal_util"],function(t){var s;return s={beaconContext:e.beacon_context,filename:n.get_filename(e),isFolder:!1,nsId:e.ns_id,origin:i,sjid:e.sjid,url:r},null!=e.fq_path&&(s.fqPath=e.fq_path),null!=e.file_id&&(s.fileId=e.file_id),t.showShareModal(o,s)})}}}),define("modules/clean/react/file_viewer/shared_file_actions",["external/react","external/underscore","modules/clean/abuse/report_flag","modules/clean/react/share_download/button","modules/clean/react/account_menu/account_menu","modules/clean/react/bubble_dropdown_v2","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/copyright_flag","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/open_in_app/button","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/react/user_notifications/constants","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/viewer","modules/constants/abuse_report","modules/constants/file_viewer","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S){var w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j;return R=n.ReportFlag,T=r.AccountMenu,B=a.UserActionNames,U=a.UserActionContextNames,P=a.FileViewerPane,O=u.OpenInAppButton,x=d.ToggleCommentsContainer,H=h.UserNotificationsDropdown,C=_.BellDesignTypes,k=m.ShareApiClient,W=f.deleteLinkWithConfirm,G=f.deleteLinkWithConfirmLegacy,q=b._,w=e.createFactory(T),I=e.createFactory(l),A=e.createFactory(c),D=e.createFactory(o),M=e.createFactory(p),F=e.createFactory(x),H=e.createFactory(H),N=e.createFactory(O),j=e.DOM,V=j.a,K=j.div,L=e.createClass({displayName:"SharedFileActions",propTypes:{accountMenuOptions:e.PropTypes.object,shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object,file:e.PropTypes.object.isRequired,user:e.PropTypes.object,sharedLinkInfo:e.PropTypes.object,commentsActionCreators:e.PropTypes.object.isRequired,showOpenInAppButton:e.PropTypes.bool},getDefaultProps:function(){return{user:null}},getInitialState:function(){return{tkey:this.props.file.tkey||null}},_handleAccountClick:function(){throw new Error("Not implemented")},_handleSignInClick:function(){throw new Error("Not implemented")},_removeShareLink:function(){var e,t,n,o;return e=new k({userId:this.props.sharePermissions.canRemoveLinkUids[0]}),t=this.state.linkMetadata,o=(null!=(n=this.props.sharePermissions)?n.canRemoveLinkUids.length:void 0)>0?this.props.shareToken.linkKey:null,G({client:e,contentName:this.props.file.filename,onCancel:null,onDeleteLink:function(){return E.redirect("/home")},tkey:o})},_logUserActionInTitleBarFactory:function(e){return function(){return s.logUserAction(e,U.TITLE_BAR_MAIN)}},_renderOpenInAppButton:function(){return this.props.showOpenInAppButton?N({key:"OpenInAppButton",urls:this.props.file.open_in_app_data}):null},_renderDownloadMenu:function(){return this.props.shareToken&&this.props.sharePermissions?D({key:"ShareDownloadButton",sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,fileOrFolder:this.props.file,location:P.PREVIEW_CONTENT,isMaestroDesign:y.MAESTRO_ENABLED}):void 0},_renderAccountMenu:function(){var e,n;if("ON"!==(n=y.NO_ACCOUNT_MENU_TEST)&&"EXPERIMENT_ON"!==n)return e=t.extend({},this.props.accountMenuOptions,{key:"AccountMenu",position:i.POSITIONS.BOTTOM_LEFT,user:this.props.user,viewer:g.get_viewer(),onClick:this._logUserActionInTitleBarFactory(B.CLICK_ACCOUNT_MENU)}),w(e)},_renderMoreDropdown:function(){var e,t;return t=(null!=(e=this.props.sharePermissions)?e.canRemoveLinkUids.length:void 0)>0?this.props.shareToken.linkKey:null,A({key:"MoreDropdown",allowRemoveLink:null!=t,file:this.props.file,isPrivate:!1,onRemoveShareLink:this._removeShareLink,isMaestroDesign:y.MAESTRO_ENABLED})},_renderToggleComments:function(){return y.MAESTRO_ENABLED?null:F({key:"ToggleComments",actionCreators:this.props.commentsActionCreators})},_renderSignIn:function(){return V({key:"SignInLink",className:"sign-in-link control__button "+(this.props.showOpenInAppButton?"button-secondary":"button-primary"),href:S({path:"/login",query:{cont:E.get_href()}}).toString(),onClick:this._logUserActionInTitleBarFactory(B.SIGN_IN)},q("Sign in"))},_renderUserNotificationsDropdown:function(){return H({key:"UserNotificationsDropdown",isPagelet:!1,isMaestroDesign:y.MAESTRO_ENABLED,onClick:this._logUserActionInTitleBarFactory(B.CLICK_NOTIFICATIONS),bellDesign:C.GRAY_ICON})},_renderDivider:function(){return K({className:"react-title-bar__divider"})},render:function(){return M({},v.REPORT_ENABLED?e.createElement(R,{sharedLink:this.props.sharedLinkInfo.url}):I({sharedLink:this.props.sharedLinkInfo.url}),null!=this.props.user?y.MAESTRO_ENABLED?[this._renderAccountMenu(),this._renderOpenInAppButton(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments(),this._renderDivider(),this._renderUserNotificationsDropdown()]:[this._renderUserNotificationsDropdown(),this._renderAccountMenu(),this._renderOpenInAppButton(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments()]:[this._renderOpenInAppButton(),this._renderSignIn(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments()])}})});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/file_viewer/store",["external/underscore","modules/clean/flux/flux_store","modules/clean/react/browse/models","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/dispatcher","modules/clean/react/file_viewer/utils","modules/constants/file_viewer"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p;return l=n.File,a=o.ActionTypes,d=o.PreviewRenderStatuses,u=i.FlippableHelpers,c=function(e){function t(e){t.__super__.constructor.call(this,e),this._files=[],this._currentIndex=0,this._user=null,this._sharedLinkInfos={},this._shareTokens={},this._sharePermissions={},this._isFullscreen=!1,this._renderStatuses={},this._previewQualityPopupClosed={},this._cachedLatestRevision=null,this._disableFlipping=!1}return extend(t,e),t.prototype.files=function(){return this._files},t.prototype.currentIndex=function(){return this._currentIndex},t.prototype.user=function(){return this._user},t.prototype.sharedLinkInfo=function(){return this._sharedLinkInfos[p(this.currentFile())]},t.prototype.shareToken=function(){return this._shareTokens[p(this.currentFile())]},t.prototype.sharePermissions=function(){return this._sharePermissions[p(this.currentFile())]},t.prototype.isFullscreen=function(){return this._isFullscreen},t.prototype.currentFile=function(){return this._files[this._currentIndex]},t.prototype.isViewingLatestRevision=function(){return!this._cachedLatestRevision},t.prototype.renderStatus=function(){var e;return e=this.currentFile(),e?this._renderStatuses[p(this.currentFile())]:d.UNKNOWN},t.prototype.showPreviewQualityPopup=function(){var e,t,n;return s.PREVIEW_QUALITY_POPUP_PROBABILITY<=0?!1:(n=p(this.currentFile()),t=this._renderStatuses[n]===d.SUCCEEDED,e=this._previewQualityPopupClosed[n]===!1,t&&e)},t.prototype._setup=function(e){var t,n,o,r,i,s,a;return o=e.files,t=e.currentIndex,a=e.user,s=e.sharedLinkInfos,i=e.shareTokens,r=e.sharePermissions,n=e.disableFlipping,this._user=a,this._disableFlipping=n,this._updateFiles(o[t],o,s,i,r)},t.prototype._updateFiles=function(e,t,n,o,r){var i,s,a,l,c,h,_;for(null==n&&(n=null),null==o&&(o=null),null==r&&(r=null),this._sharedLinkInfos={},this._shareTokens={},this._sharePermissions={},this._renderStatuses={},s=c=0,h=t.length;h>c;s=++c)i=t[s],_=p(i),this._sharedLinkInfos[_]=null!=n?n[s]:void 0,this._shareTokens[_]=null!=o?o[s]:void 0,this._sharePermissions[_]=null!=r?r[s]:void 0,this._renderStatuses[_]=d.UNKNOWN,this._previewQualityPopupClosed[_]=this._previewQualityPopupClosed[_]||!1;return a=u.isFlippableFile(e),l=this._getFileIndex(t,e)>=0,!this._disableFlipping&&a&&l?(this._files=u.filterFlippableFiles(t),this._currentIndex=this._getFileIndex(this._files,e)):(this._files=[e],this._currentIndex=0),this.__emitChange()},t.prototype._cleanup=function(){return this._files=[],this._currentIndex=0,this._user=null,this._sharedLinkInfos=[],this._shareTokens=[],this._sharePermissions=[],this._renderStatuses={},this._isFullscreen=!1,this._cachedLatestRevision=null},t.prototype._nextFile=function(){return this._restoreRevision(),this._currentIndex=this._currentIndex===this._files.length-1?0:this._currentIndex+1,this.__emitChange()},t.prototype._previousFile=function(){return this._restoreRevision(),this._currentIndex=0===this._currentIndex?this._files.length-1:this._currentIndex-1,this.__emitChange()},t.prototype._setIsFullscreen=function(e){return this._isFullscreen=e,this.__emitChange()},t.prototype._switchRevision=function(e){return this._cachedLatestRevision||(this._cachedLatestRevision=this._files[this._currentIndex]),this._files[this._currentIndex]=e,this.__emitChange()},t.prototype._restoreRevision=function(){return this._cachedLatestRevision?(this._files[this._currentIndex]=this._cachedLatestRevision,this._cachedLatestRevision=null,this.__emitChange()):void 0},t.prototype._fastForwardRevision=function(e){return this._cachedLatestRevision=e,this.__emitChange()},t.prototype._updateRenderStatus=function(e){var t;return t=this.currentFile(),t?(this._renderStatuses[p(this.currentFile())]=e,this.__emitChange()):void 0},t.prototype._markPreviewQualityPopupAsClosed=function(){return this._previewQualityPopupClosed[p(this.currentFile())]=!0,this.__emitChange()},t.prototype._getFileIndex=function(e,t){var n,o,r,i;for(o=r=0,i=e.length;i>r;o=++r)if(n=e[o],l.areEqual(t,n))return o;return-1},t.prototype.__onDispatch=function(e){switch(e.action.type){case a.SETUP:return this._setup(e.action.data);case a.CLEANUP:return this._cleanup();case a.UPDATE_FILES:return this._updateFiles(this.currentFile(),e.action.data.files);case a.FLIP_NEXT:return this._nextFile();case a.FLIP_PREVIOUS:return this._previousFile();case a.OPEN_FULLSCREEN:return this._setIsFullscreen(!0);case a.CLOSE_FULLSCREEN:return this._setIsFullscreen(!1);case a.FAST_FORWARD_REVISION:return this._fastForwardRevision(e.action.data.file);case a.SWITCH_REVISION:return this._switchRevision(e.action.data.file);case a.RESTORE_REVISION:return this._restoreRevision();case a.BROADCAST_RENDER_STATUS:return this._updateRenderStatus(e.action.data.newStatus);case a.CLOSE_PREVIEW_QUALITY_POPUP:return this._markPreviewQualityPopupAsClosed()}},t}(t),p=function(e){return e.ns_id+":"+e.sjid},new c(r)}),define("modules/clean/react/file_viewer/title_bar",["external/classnames","external/react","modules/constants/env","modules/constants/file_viewer","modules/constants/starred","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/util","modules/clean/react/home/home_access/home_access_util","modules/clean/react/file_viewer/mounted_file_actions","modules/clean/react/file_viewer/seen_state_facepile_controller","modules/clean/react/file_viewer/version_history_file_actions","modules/clean/react/file_viewer/shared_file_actions","modules/clean/react/file_viewer/comments_demo_actions","modules/clean/react/sprite","modules/clean/react/starred/actions","modules/clean/react/starred/star","modules/clean/react/image","modules/clean/react/title_bar/base","modules/clean/react/title_bubble","modules/constants/python","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b){var S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q;return O=r.STARRED_RESOURCE_ID_TYPE,W=s.file_icon,T=s.ICON_SIZES,z=s.parent_dir,G=s.filename,N=a.PreviewHelper,A=a.PermissionHelper,j=l.isHomeEnabled,R=u.SeenStateFacepileController,w=h.CommentsDemoActionsClass,M=m.StarredActions,L=f.Star,B=b._,C=24,I=18,q=t.createElement,Y=t.DOM,H=Y.a,V=Y.div,K=Y.h1,Q=Y.span,P=t.createFactory(c),U=t.createFactory(d),k=t.createFactory(p),S=t.createFactory(w),D=t.createFactory(_),x=t.createFactory(v),F=t.createClass({displayName:"TitleBar",propTypes:{shareToken:t.PropTypes.object,sharePermissions:t.PropTypes.object,file:t.PropTypes.object.isRequired,maxFilenameEmLength:t.PropTypes.number.isRequired,user:t.PropTypes.object,canClose:t.PropTypes.bool,onCloseViewer:t.PropTypes.func,shareHelpers:t.PropTypes.object,sharedLinkInfo:t.PropTypes.object,isVersionHistoryMode:t.PropTypes.bool,isSeenStatesEnabled:t.PropTypes.bool,isDemoMode:t.PropTypes.bool,canRestoreRevision:t.PropTypes.bool,onRestoreRevision:t.PropTypes.func,accountMenuOptions:t.PropTypes.object,commentsActionCreators:t.PropTypes.object.isRequired,fileViewOrigin:t.PropTypes.number,fileViewAction:t.PropTypes.number},getDefaultProps:function(){return{user:null,canClose:!1,onCloseViewer:null,shareHelpers:null,sharedLinkInfo:null,isVersionHistoryMode:!1,isSeenStatesEnabled:!0,isDemoMode:!1,canRestoreRevision:!1,onRestoreRevision:null}},componentWillMount:function(){return this._shouldShowStarred()?setTimeout(function(e){return function(){return M.fetchStatuses(e.props.user.role,[{id:e.props.file.file_id,type:O.ENCODED_FILE_OBJ_ID}])}}(this),0):void 0},_shouldShowStarred:function(){return this._isMountedFile()&&j()},_isSharedFile:function(){return null!=this.props.sharedLinkInfo},_isMountedFile:function(){return!this._isSharedFile()},_closeButtonTitle:function(){var e;if(this._isMountedFile()){if(this.props.isVersionHistoryMode)e=B("Version history");else if(this.props.fileViewOrigin===E.FileViewOriginType.RECENTS)e=B("Recents");else{if(this.props.fileViewAction===E.FileViewActionType.SEARCH)return B("Close");null!=this.props.file.fq_path&&(e=G(z(this.props.file.fq_path)))}if(null!=e)return B("Back to %(folder)s").format({folder:e})}return B("Close")},_showOpenInAppButton:function(){return!(!this.props.file.open_in_app_data||!this.props.file.preview_type)},_redirectToVersionHistory:function(){return N.redirectToVersionHistory(this.props.file,this.props.user)},_renderFileIcon:function(){return o.MAESTRO_ENABLED?null:D({group:"web",name:W(N.get_filename(this.props.file),{size:T.LARGE}),className:"file-icon u-mar-horizontal-xs",alt:""})},_renderFileInfo:function(){var t,n;return n=this.props.sharedLinkInfo,t=e({fileinfo:!0,"u-pad-top-xxs":null!=n&&null!=n.ownerName&&null!=n.ownerTeamName||null==n&&null!=this.props.file.ts}),V({className:t},this._renderFilename(),null!=this.props.sharedLinkInfo?this._renderSharedFileOwner():null!=this.props.file.ts?this._renderLastModifier():void 0)},_renderFilename:function(){return K({className:"filename"},i.em_snippet(N.get_filename(this.props.file),this.props.maxFilenameEmLength))},_renderSharedFileOwner:function(){var e,t,n;return n=this.props.sharedLinkInfo,e=n.ownerName,t=n.ownerTeamName,null!=e&&null!=t&&this._isSharedFile()?Q({className:"file-modifier"},B(" from %(owner)s (%(team)s)").format({owner:i.em_snippet(e,C),team:i.em_snippet(t,I)})):void 0},_renderLastModifier:function(){var e,t,n,o,r;return t=this.props.file,n=t.last_modified_name,e=2,o=t.event_type===e?n?B("%(modifier)s edited ",{comment:"Like 'John Smith edited just now'"}).format({modifier:n}):B("You edited ",{comment:"Like 'You edited just now'"}):B("Modified ",{comment:"Like 'Modified just now"}),r=N.getModifierString(t),Q({className:"file-modifier"},o,q(y,{content:B("View version history"),position:y.POSITIONS.BOTTOM,isTargetPositionFixed:!0},H({className:"file-modifier",onClick:this._redirectToVersionHistory,href:"#"},r)))},_renderStar:function(){return V({},q(L,{id:this.props.file.file_id,idType:O.ENCODED_FILE_OBJ_ID,role:this.props.user.role,ref:"Star"}))},_renderSeenStates:function(){var e;return!this.props.isSeenStatesEnabled||this.props.isVersionHistoryMode||null==this.props.user||null===this.props.file.ns_id?V():q(R,{file:this.props.file,user:this.props.user,fromBrowse:!1,url:null!=(e=this.props.sharedLinkInfo)?e.url:void 0})},_renderFileActions:function(){return this.props.isDemoMode?S({file:this.props.file,commentsActionCreators:this.props.commentsActionCreators}):this._isMountedFile()?this.props.isVersionHistoryMode?U({file:this.props.file,user:this.props.user,canRestoreRevision:this.props.canRestoreRevision,onRestoreRevision:this.props.onRestoreRevision}):P({file:this.props.file,user:this.props.user,shareHelpers:this.props.shareHelpers,commentsActionCreators:this.props.commentsActionCreators}):k({accountMenuOptions:this.props.accountMenuOptions,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,file:this.props.file,user:this.props.user,sharedLinkInfo:this.props.sharedLinkInfo,shareHelpers:this.props.shareHelpers,commentsActionCreators:this.props.commentsActionCreators,showOpenInAppButton:this._showOpenInAppButton()})},render:function(){var e;return x({title:[this._renderFileIcon(),this._renderFileInfo(),this._shouldShowStarred()?this._renderStar():void 0],controls:[this._renderSeenStates(),this._renderFileActions()],customLogoUrl:null!=(e=this.props.sharedLinkInfo)?e.ownerTeamLogo:void 0,canClose:this.props.canClose,closeTitle:this._closeButtonTitle(),onClose:this.props.onCloseViewer})}})}),define("modules/clean/react/file_viewer/toggle_comments",["external/classnames","external/react","modules/clean/comments/flux","modules/clean/comments/store","modules/clean/comments/action_creators","modules/clean/components/scooter/badge","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g,v,y,E,b,S,w;return E=n.connect,d=i.CounterBadge,f=a.UserActionNames,m=a.UserActionContextNames,g=u._,p=t.createFactory(l),w=t.DOM,b=w.div,v=w.button,y=t.createElement,h=t.createClass({displayName:"ToggleComments",mixins:[t.addons.PureRenderMixin],propTypes:{actionCreators:t.PropTypes.object.isRequired,areCommentsHidden:t.PropTypes.bool.isRequired,canEnableComments:t.PropTypes.bool,isCommentingEnabled:t.PropTypes.bool.isRequired,isCommentingReady:t.PropTypes.bool.isRequired,isStoreInitialized:t.PropTypes.bool.isRequired,unreadCommentCount:t.PropTypes.number},getDefaultProps:function(){return{canEnableComments:!1,unreadCommentCount:0}},_onShowCommentsClick:function(){return this.props.actionCreators.showComments(),s.logUserAction(f.TOGGLE_COMMENTS_ON,m.TITLE_BAR_MAIN)},_onHideCommentsClick:function(){return this.props.actionCreators.hideComments(),s.logUserAction(f.TOGGLE_COMMENTS_OFF,m.TITLE_BAR_MAIN)},render:function(){var n,o,r;if(!this.props.isStoreInitialized||this.props.isCommentingReady&&!this.props.isCommentingEnabled){if(!this.props.canEnableComments)return b();n=g("Comments are disabled"),r=p({group:"web",name:"control_comments_on",alt:n}),o=null}else this.props.areCommentsHidden?(n=g("Show Comments"),r=p({group:"web",name:"control_comments_off",alt:n}),o=this._onShowCommentsClick):(n=g("Hide Comments"),r=p({group:"web",name:"control_comments_on",alt:n}),o=this._onHideCommentsClick);return b({className:"toggle-comments u-mar-left-xs"},y(c,{content:n,position:c.POSITIONS.BOTTOM_ALIGN_RIGHT,distanceFromTarget:10,isTargetPositionFixed:!0,className:"react-title-bar--title-bubble"},b({},v({className:e({"button-secondary":!0,"toggle-comments__button":!0,control__button:!0,disabled:this.props.isCommentingReady&&!this.props.isCommentingEnabled}),onClick:o},r),this.props.unreadCommentCount?t.createElement(d,{variant:"loud",count:this.props.unreadCommentCount,maxCount:99,position:d.POSITIONS.TOP_RIGHT}):void 0)))}}),S=function(){return{areCommentsHidden:o.areCommentsHidden(),canEnableComments:o.canEnableComments(),isCommentingEnabled:o.isCommentingEnabled(),isCommentingReady:o.isFileActivityReady(),isStoreInitialized:o.isStoreInitialized(),unreadCommentCount:o.unreadCommentCount()}},_=E(o,S)(h),{ToggleComments:h,ToggleCommentsContainer:_}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/utils",["modules/clean/ajax","modules/clean/gandalf_util","modules/clean/open_with","modules/clean/react/file_viewer/constants","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/core/browser"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m;return _=o.UserActionContextNames,d=o.SplitButtonActionLocation,l=o.FileViewerPane,a=["photo","video"],c={isFlippableFile:function(e){var t;return t=e.preview_type,indexOf.call(a,t)>=0},filterFlippableFiles:function(e){var t;return Array.isArray(e)?function(){var n,o,r;for(r=[],n=0,o=e.length;o>n;n++)t=e[n],this.isFlippableFile(t)&&r.push(t);return r}.call(this):[]}},u={canOpenWith:function(e,o){return t.getGandalfRule("wopi-button-visible")&&e.bytes<=n.MAX_SUPPORTED_FILE_SIZE_B&&null!==n.get_open_handler_for(e,o)},getOpenWithHandlerData:function(e,t){return n.get_open_handler_for(e,t)},openWith:function(e,t){var n,o;return n=this.getOpenWithHandlerData(e,t),o=n.uri+"?hpt_click_ts="+Date.now(),s.redirect(o)}},p={fetchTooltipInfo:function(t,n){var o;return o=e.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return n(e)},subject_user:t})},getVendorAndApplication:function(e,t){var n,o,r,i,s;for(i in e){s=e[i];for(r in s)if(n=s[r],o=n.extensions,indexOf.call(o,t)>=0)return{vendor:i,application:r}}return null},logImpression:function(t,n,o){return"acrobat_or_reader"===o?e.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:o,extension:t},subject_user:n}):e.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:o,extension:t},subject_user:n})}},h={isUnityEnabled:function(){return null!=i},isFileInUnityCache:function(e,t){return!!r.is_cached_and_locally_available(e,t)},clientSupportsOpenInFileBrowser:function(){return i.client_supports_open_in_file_browser()},getFileInfoFromUnityCache:function(e,t){return r.get(e,t)},_fetchFileBrowserDisplayName:function(e,t){var n,o;return o=function(n){return e.file_browser_display_name=n,t(e)},n=function(){return t(e)},i.file_browser_display_name(o,n)},fetchUnityFileInfo:function(e,t,n,o,r){var s;return s=function(e){return function(t){return t.is_locally_available?e._fetchFileBrowserDisplayName(t,o):o(t)}}(this),i.check_file(e,t,n,s,r)},getUnityFileInfo:function(e,t,n,o,r){var i;return this.isFileInUnityCache(e,t)?(i=this.getFileInfoFromUnityCache(e,t),i.is_locally_available&&null==i.file_browser_display_name?this._fetchFileBrowserDisplayName(i,o):o(i)):this.fetchUnityFileInfo(e,t,n,o,r)},openFile:function(e,t,n,o){return i.open_file(e,t,n,i.standard_open_file_handler,function(e){return i.standard_open_file_handler(!1)},o)}},m=function(e,t){if(e===d.MAIN){if(t===l.TITLE_BAR)return _.TITLE_BAR_MAIN;if(t===l.PREVIEW_CONTENT)return _.PREVIEW_CONTENT_MAIN}else if(e===d.SPLIT){if(t===l.TITLE_BAR)return _.TITLE_BAR_SPLIT_BUTTON;if(t===l.PREVIEW_CONTENT)return _.PREVIEW_CONTENT_SPLIT_BUTTON}return _.UNKNOWN},{FlippableHelpers:c,OpenWithHelpers:u,TooltipHelpers:p,UnityHelpers:h,getSplitButtonUserActionContext:m}}),define("modules/clean/react/file_viewer/version_history_file_actions",["external/react","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/title_bar/controls_container","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p;return a=t.FileViewerPane,d=s._,l=e.createFactory(o),c=e.createFactory(r),p=e.DOM.button,u=e.createClass({displayName:"VersionHistoryFileActions",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,canRestoreRevision:e.PropTypes.bool.isRequired,onRestoreRevision:e.PropTypes.func.isRequired},render:function(){return c({},this.props.canRestoreRevision?p({ref:"restoreButton",className:"button-primary control__button restore-button",onClick:this.props.onRestoreRevision},d("Restore")):void 0,l({file:this.props.file,user:this.props.user,isUnityDisabled:!0,isOpenWithDisabled:!0,location:a.TITLE_BAR,isMaestroDesign:i.MAESTRO_ENABLED}))}})}),define("modules/clean/react/flag",["external/classnames","external/underscore","external/react","modules/clean/react/css"],function(e,t,n,o){var r,i;return i=n.DOM,r=n.createClass({displayName:"Flag",propTypes:{alignment:n.PropTypes.oneOf(["top","middle","bottom"]),leftAttachment:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node]),rightAttachment:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node]),spacing:n.PropTypes.oneOf(["xs","s","m","l","xl"]),children:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node])},getDefaultProps:function(){return{alignment:"middle"}},render:function(){var t,n,o,r,s,a;return r={"o-flag":!0},r["o-flag--"+this.props.alignment]=this.props.alignment,t=r,s={"o-flag__flex":!0},s["u-pad-left-"+this.props.spacing]=this.props.spacing&&this.props.leftAttachment,s["u-pad-right-"+this.props.spacing]=this.props.spacing&&this.props.rightAttachment,n=s,o=this.props.leftAttachment?i.div({className:"o-flag__fix"},this.props.leftAttachment):void 0,a=this.props.rightAttachment?i.div({className:"o-flag__fix"},this.props.rightAttachment):void 0,i.div({className:e(t)},o,i.div({className:e(n)},this.props.children),a)}}),r=o(r,["/static/css/scooter/scooter-scoped-vflebHNBy.css"]),{Flag:r}}),define("modules/clean/react/free_positioned",["jquery","external/react","external/react-dom","external/underscore","modules/clean/raf_throttle"],function(e,t,n,o,r){var i,s,a,l,c;return s=r.RafThrottle,l=t.DOM,a={TOP_LEFT:1,TOP:2,TOP_RIGHT:3,LEFT_TOP:4,LEFT:5,LEFT_BOTTOM:6,RIGHT_TOP:7,RIGHT:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM:11,BOTTOM_RIGHT:12,TOP_ALIGN_LEFT:13,TOP_ALIGN_RIGHT:14,LEFT_ALIGN_TOP:15,LEFT_ALIGN_BOTTOM:16,RIGHT_ALIGN_TOP:17,RIGHT_ALIGN_BOTTOM:18,BOTTOM_ALIGN_LEFT:19,BOTTOM_ALIGN_RIGHT:20},c=function(t){var n,o,r,i,s;return s=t.targetNode,n=t.isTargetFixed,r=t.position,o=null!=(i=t.offset)?i:{},function(t,i){var l;if(null==s)return null;if(l=e(s).offset(),n&&(l.top-=e(window).scrollTop(),i&&(l.left-=window.pageXOffset)),null==t)return{top:l.top,left:l.left};switch(o.vertical&&(l.top+=o.vertical),o.horizontal&&(l.left+=o.horizontal),r){case a.TOP_LEFT:return{top:l.top-t.offsetHeight,left:l.left+.5*s.offsetWidth-.75*t.offsetWidth};case a.TOP:return{top:l.top-t.offsetHeight,left:l.left+.5*(s.offsetWidth-t.offsetWidth)};case a.TOP_RIGHT:return{top:l.top-t.offsetHeight,left:l.left+.5*s.offsetWidth-.25*t.offsetWidth};case a.LEFT_TOP:return{top:l.top+.5*s.offsetHeight-.75*t.offsetHeight,left:l.left-t.offsetWidth};case a.LEFT:return{top:l.top+.5*(s.offsetHeight-t.offsetHeight),left:l.left-t.offsetWidth};case a.LEFT_BOTTOM:return{top:l.top+.5*s.offsetHeight-.25*t.offsetHeight,left:l.left-t.offsetWidth};case a.RIGHT_TOP:return{top:l.top+.5*s.offsetHeight-.75*t.offsetHeight,left:l.left+s.offsetWidth};case a.RIGHT:return{top:l.top+.5*(s.offsetHeight-t.offsetHeight),left:l.left+s.offsetWidth};case a.RIGHT_BOTTOM:return{top:l.top+.5*s.offsetHeight-.25*t.offsetHeight,left:l.left+s.offsetWidth};case a.BOTTOM_LEFT:return{top:l.top+s.offsetHeight,left:l.left+.5*s.offsetWidth-.75*t.offsetWidth};case a.BOTTOM:return{top:l.top+s.offsetHeight,left:l.left+.5*(s.offsetWidth-t.offsetWidth)};case a.BOTTOM_RIGHT:return{top:l.top+s.offsetHeight,left:l.left+.5*s.offsetWidth-.25*t.offsetWidth};case a.TOP_ALIGN_LEFT:return{top:l.top-t.offsetHeight,left:l.left};case a.TOP_ALIGN_RIGHT:return{top:l.top-t.offsetHeight,left:l.left+s.offsetWidth-t.offsetWidth};case a.LEFT_ALIGN_TOP:return{top:l.top,left:l.left-t.offsetWidth};case a.LEFT_ALIGN_BOTTOM:return{top:l.top+s.offsetHeight-t.offsetHeight,left:l.left-t.offsetWidth};case a.RIGHT_ALIGN_TOP:return{top:l.top,left:l.left+s.offsetWidth};case a.RIGHT_ALIGN_BOTTOM:return{top:l.top+s.offsetHeight-t.offsetHeight,left:l.left+s.offsetWidth};case a.BOTTOM_ALIGN_LEFT:return{top:l.top+s.offsetHeight,left:l.left};case a.BOTTOM_ALIGN_RIGHT:return{top:l.top+s.offsetHeight,left:l.left+s.offsetWidth-t.offsetWidth}}}},i=t.createClass({displayName:"FreePositioned",
statics:{STICKY_POSITION:a,makeStickyPositioner:c},propTypes:{getPositioning:t.PropTypes.func.isRequired,isTargetFixed:t.PropTypes.bool,initialPositioning:t.PropTypes.shape({top:t.PropTypes.number,left:t.PropTypes.number}),onReposition:t.PropTypes.func,compensateForHorizontalScroll:t.PropTypes.bool},_throttle:null,_scrollHandler:null,_debounceRate:500,getDefaultProps:function(){return{isTargetFixed:!1,initialPositioning:null,compensateForHorizontalScroll:!0}},getInitialState:function(){return{positioning:this.props.initialPositioning}},componentDidMount:function(){return this._throttle=new s(this._updatePositioning),e(window).on("resize.freePositioned",this._throttle.request),this.props.compensateForHorizontalScroll&&(this._scrollHandler=this._createScrollHandler(),e(window).on("scroll.freePositioned",this._scrollHandler)),this._updatePositioning()},componentDidUpdate:function(e){return this.props!==e?this._throttle.request():void 0},componentWillUnmount:function(){return this._throttle.cancelPending(),e(window).off("resize.freePositioned",this._throttle.request),this.props.compensateForHorizontalScroll?e(window).off("scroll.freePositioned",this._scrollHandler):void 0},render:function(){return l.div({ref:"root",style:this._getStyle(),tabIndex:-1},this.props.children)},_getStyle:function(){return o.extend({outline:0,position:this.props.isTargetFixed?"fixed":"absolute"},this.state.positioning)},_createScrollHandler:function(){var e;return e=o.debounce(this._throttle.request,this._debounceRate),function(t){return function(){return t._throttle.request(),e()}}(this)},_updatePositioning:function(){var e;if(this.refs.root)return e=this.props.getPositioning(n.findDOMNode(this),this.props.compensateForHorizontalScroll),null!=e?this.setState({positioning:e},function(e){return function(){var t;return"function"==typeof(t=e.props).onReposition?t.onReposition(e.state.positioning):void 0}}(this)):void 0}})}),define("modules/clean/react/helpers",["external/immutable","external/underscore"],function(e,t){var n;return Object.is||(Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}),n=function(e,t){var n,o,r,i,s,a,l,c,u,d,p;if(e===t)return!0;if(s=Object.keys(e),a=Object.keys(t),s.length!==a.length)return!1;for(o=0,c=s.length;c>o;o++)if(l=s[o],d=e[l],p=t[l],Array.isArray(d)&&Array.isArray(p)){if(d.length!==p.length)return!1;for(r=i=0,u=d.length;u>i;r=++i)if(n=d[r],d[r]!==p[r])return!1}else if(!Object.is(d,p))return!1;return!0},{compareStateAndProps:function(e,n){return!t.isEqual(this.state,n)||!t.isEqual(this.props,e)},shallowCompareStateAndProps:function(e,t){return!n(this.state,t)||!n(this.props,e)}}}),define("modules/clean/react/hidden",["external/react","external/underscore"],function(e,t){var n,o,r,i;return i=e.DOM,r=e.createElement,n=e.createClass({displayName:"Hidden",render:function(){return i.div({className:"hidden-option"},this.props.children)}}),o=e.createClass({displayName:"HiddenSelect",propTypes:{options:e.PropTypes.arrayOf(e.PropTypes.any).isRequired,value:e.PropTypes.any},render:function(){var e;return r(n,{},i.select(t.omit(this.props,"options"),function(){var t,n,o,r;for(o=this.props.options,r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push(i.option({key:e,label:e,value:e}));return r}.call(this)))}}),{Hidden:n,HiddenSelect:o}}),define("modules/clean/react/home/constants",["require","exports"],function(e,t){"use strict";t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE"},t.LoggingTypes={CLICK_INCOMING_ACTION:"click_incoming_action",CLICK_RIGHT_NAV_ITEM:"click_right_nav_item",CLICK_INCOMING_SHOW_READ:"click_incoming_show_read",CLICK_RECENT_ITEMS:"click_recent_item",OPEN_INCOMING:"open_incoming",OPEN_INCOMING_DOCUMENT:"open_incoming_document",OPEN_STARRED_DOCUMENT:"open_starred_item",CLICK_SHOW_ALL:"click_show_all",OPEN_DOCUMENT:"open_document",HOME_PAGE_SHOWN:"home_page_shown"},t.LoggingSections={UNREAD:"home_unread",STARRED:"home_starred",RECENTS:"home_recents"},t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.LoadingTypes={INITIAL:"INITIAL",OLDER:"OLDER",NEWER:"NEWER"},t.DisplayTypeToSpriteName={DOC:"page_white_word_32",PDF:"page_white_acrobat_32",SPREADSHEET:"page_white_excel_32",FILE:"page_white_gray_32",FOLDER:"folder_32",SHARED_FOLDER:"folder_user_32",TEAM_FOLDER:"folder_team_32",PAPER_DOCUMENT:"paper_doc_32",PAPER_FOLDER:"folder_paper_team_32",PAPER_PUBLIC_FOLDER:"folder_team_32",PAPER_PROJECT:"paper_project_32"},t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.DisplayTypeToResourceType={DOC:"FILE",PDF:"FILE",SPREADSHEET:"FILE",FILE:"FILE",FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:"PAPER_DOCUMENT",PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE},t.FeedTypes={UNREAD:"unread",INCOMING:"incoming"},t.ExceptionTags={UNREAD:"home_unread"}}),define("modules/clean/react/home/home_access/home_access_util",["require","exports","modules/constants/starred"],function(e,t,n){"use strict";function o(){return n.HOME_ENABLED||n.HOME_ACCESS_ENABLED}t.isHomeEnabled=o}),define("modules/clean/react/home/starred/constants",["require","exports"],function(e,t){"use strict";t.StarredResourceActionTypes={LOADING_INITIAL:"HOME_STARRED_LOADING_INITIAL",LOADING_ALL:"HOME_STARRED_LOADING_ALL",LOAD_SUCCESS:"HOME_STARRED_LOAD_SUCCESS",LOAD_FAILURE:"HOME_STARRED_LOAD_FAILURE",LOAD_ACTIVITIES_SUCCESS:"HOME_STARRED_LOAD_ACTIVITIES_SUCCESS",LOAD_ACTIVITIES_FAILURE:"HOME_STARRED_LOAD_ACTIVITIES_FAILURE"},t.NOT_PAPER_USER_ERROR="not_paper_user",t.NUM_ACTIVITIES_PER_ITEM=5}),define("modules/clean/react/home/starred/starred_resource_store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/react/home/constants","modules/clean/react/home/starred/constants","modules/clean/react/starred/constants","modules/clean/react/starred/store"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=function(e){function t(){var t=e.call(this,r)||this;return t.orderedIds=[],t.itemsById={},t.loadingState=s.LoadingStates.LOADING,t.activitiesLoadingState=s.LoadingStates.LOADING,t.hasMore=!0,t.areAllRequested=!1,t.isPaperUser=!0,t}return n.__extends(t,e),t.prototype.getItems=function(){var e=this;return this.orderedIds.map(function(t){return e.itemsById[t]}).filter(function(e){var t={id:e.resourceId,type:e.idType},n=c.StarredStore.getLoadingState(t),o=c.StarredStore.getIsStarred(t);return n===l.StarredLoadingState.LOADING||o})},t.prototype.getItem=function(e){return this.itemsById[e]},t.prototype.getLoadingState=function(){return this.loadingState},t.prototype.getActivitiesLoadingState=function(){return this.activitiesLoadingState},t.prototype.getHasMore=function(){return this.hasMore},t.prototype.getAreAllRequested=function(){return this.areAllRequested},t.prototype.getIsPaperUser=function(){return this.isPaperUser},t.prototype.onItemsLoading=function(){this.loadingState=s.LoadingStates.LOADING},t.prototype.onItemsLoadSuccess=function(e,t){var n=this;e.forEach(function(e){var t=e.resourceId;n.itemsById[t]?e=o.extend(e,{latestActivity:n.itemsById[t].latestActivity}):n.orderedIds.push(e.resourceId),n.itemsById[t]=e}),this.loadingState=s.LoadingStates.SUCCESS,this.hasMore=t},t.prototype.onItemsLoadFailure=function(e){this.loadingState=s.LoadingStates.FAILURE,e&&e===a.NOT_PAPER_USER_ERROR&&(this.isPaperUser=!1)},t.prototype.onLoadActivitiesSuccess=function(e){var t=this;e.forEach(function(e){return t.itemsById[e.resourceId]=e}),this.activitiesLoadingState=s.LoadingStates.SUCCESS},t.prototype.onLoadActivitiesFailure=function(){this.activitiesLoadingState=s.LoadingStates.FAILURE},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.StarredResourceActionTypes.LOADING_INITIAL:this.onItemsLoading();break;case a.StarredResourceActionTypes.LOADING_ALL:this.areAllRequested=!0,this.onItemsLoading();break;case a.StarredResourceActionTypes.LOAD_SUCCESS:this.onItemsLoadSuccess(t.items,t.hasMore);break;case a.StarredResourceActionTypes.LOAD_FAILURE:this.onItemsLoadFailure(t.error);break;case a.StarredResourceActionTypes.LOAD_ACTIVITIES_SUCCESS:this.onLoadActivitiesSuccess(t.items);break;case a.StarredResourceActionTypes.LOAD_ACTIVITIES_FAILURE:this.onLoadActivitiesFailure()}this.__emitChange()},t}(i);t.PrivateStarredResourceStoreClass=u,t.StarredResourceStore=new u}),define("modules/clean/react/icon",["external/react","external/underscore","modules/clean/filepath","modules/clean/react/sprite"],function(e,t,n,o){var r,i,s,a,l,c,u;return c=n.file_icon,u=n.folder_icon,s=n.ICON_SIZES,l=e.createElement,a=e.createClass({displayName:"IconSprite",propTypes:{alt:e.PropTypes.string,name:e.PropTypes.string.isRequired},getDefaultProps:function(){return{alt:""}},render:function(){return l(o,{alt:this.props.alt,className:"icon",group:"web",name:this.props.name})}}),r=e.createClass({displayName:"FileIcon",propTypes:{alt:e.PropTypes.string,file:e.PropTypes.shape({filename:e.PropTypes.string.isRequired}).isRequired,size:e.PropTypes.oneOf(t.values(s))},getDefaultProps:function(){return{size:s.LARGE}},render:function(){return l(a,{alt:this.props.alt,name:c(this.props.file.filename,{size:this.props.size})})}}),i=e.createClass({displayName:"FolderIcon",propTypes:{alt:e.PropTypes.string,size:e.PropTypes.oneOf(t.values(s))},getDefaultProps:function(){return{size:s.LARGE}},render:function(){return l(a,{alt:this.props.alt,name:u({size:this.props.size})})}}),{FileIcon:r,FolderIcon:i,ICON_SIZES:s}}),define("modules/clean/react/image",["external/react","external/underscore","modules/constants/page_load","modules/core/exception"],function(e,t,n,o){var r,i,assert,s,a,l,raiseAndReport;return assert=o.assert,raiseAndReport=o.raiseAndReport,s=e.DOM,l=function(e){return-1!==e.indexOf("-vfl")},a=function(e){return e.endsWith(".svg")},i=function(e){return l(e)?void 0:raiseAndReport("Non-VFL path detected: "+e+".  This usually means that the image ","doesn't exist and is 404ing; though another possibility is that the ","image exists but vfl cache busting isn't being applied, which can ","happen when the url is a relative url, since we generally don't ","vfl relative urls.")},r=e.createClass({displayName:"Image",propTypes:{alt:e.PropTypes.string,src:e.PropTypes.string.isRequired,srcHiRes:e.PropTypes.string,onLoad:e.PropTypes.func,className:e.PropTypes.string,id:e.PropTypes.string,width:e.PropTypes.number,height:e.PropTypes.number},getDefaultProps:function(){return{alt:""}},render:function(){var e,n;return i(this.props.src),!a(this.props.src)&&this.props.srcHiRes&&i(this.props.srcHiRes),n=!a(this.props.src)||this.props.srcHiRes?this.props.srcHiRes+" 2x":this.props.src,e={src:this.props.src,srcSet:n,alt:this.props.alt,id:this.props.id,className:this.props.className,onLoad:this.props.onLoad,width:this.props.width,height:this.props.height},t.extend(e,t.pick(this.props,function(e,t){return t.match(/^(aria|data)-/)})),s.img(e)}})}),define("modules/clean/react/maestro/icon_definitions",["require","exports","external/react"],function(e,t,n){"use strict";t.ICONS={bell:{viewBox:"0 0 32 32",el:n.createElement("path",{d:"M17 9.056c2.64.308 4.16 1.872 4.725 4.247.218.913.268 1.652.272 2.918l.003.342c-.003.14.02.305.071.49.113.415.351.894.677 1.391a9.345 9.345 0 0 0 .847 1.1c.84 1.018.406 2.378-.805 2.67-.325.108-.923.258-1.789.405-.344.058-.702.11-1.076.156a4.001 4.001 0 0 1-7.85 0 24.283 24.283 0 0 1-1.083-.158c-.867-.146-1.467-.297-1.73-.386-1.271-.33-1.68-1.661-.819-2.73a9.335 9.335 0 0 0 .809-1.056c.326-.498.564-.976.677-1.392a1.83 1.83 0 0 0 .071-.526c.002-.075.002-.148.003-.309.005-1.266.055-2.003.272-2.915.566-2.375 2.086-3.94 4.725-4.247V8.009a1 1 0 1 1 2 0v1.047zM10.296 20.41s.408-.532.629-.869c.432-.658.758-1.315.934-1.963.097-.358.147-.708.14-1.05.002-.053.003-.13.004-.301.005-1.12.046-1.742.218-2.46.43-1.806 1.5-2.767 3.778-2.767 2.28 0 3.35.961 3.781 2.767.172.719.213 1.343.217 2.462l.003.334c-.006.308.044.658.142 1.016.176.647.502 1.303.933 1.962.377.575.648.893.648.893s-.65.144-1.055.213c-1.304.22-2.862.353-4.669.353-1.806 0-3.366-.133-4.673-.355l-1.03-.235zM17.732 23a2 2 0 0 1-3.464 0h3.464z",style:{fillRule:"evenodd"}})},search:{viewBox:"0 0 24 24",el:n.createElement("path",{d:"M11 16c-2.76 0-5-2.24-5-5s2.24-5 5-5a5.002 5.002 0 0 1 3.737 8.322l2.39 2.392a.99.99 0 0 1-.006 1.407.994.994 0 0 1-1.404.01l-2.598-2.6A4.98 4.98 0 0 1 11 16zm0-1.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z",style:{fillRule:"evenodd"}})}}}),define("modules/clean/react/maestro/svg_icon",["require","exports","external/react","modules/clean/react/maestro/icon_definitions"],function(e,t,n,o){"use strict";t.SvgIcon=function(e){var t=e.name,r=o.ICONS[t],i=r.el,s=r.viewBox;return n.createElement("span",{className:"svg-icon-wrapper"},n.createElement("svg",{className:"svg-icon svg-icon-"+t,viewBox:e.viewBox||s},i))}}),define("modules/clean/react/onboarding_modal",["external/classnames","external/react","modules/core/i18n","modules/core/exception","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/slider"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,assert,T;return w=n._,assert=o.assert,l=r.button,h=i.Modal,d=s.IndicatorGroup,S=s.Slides,E=s.Slider,m=s.NavButtonGroup,T=t.DOM,p=t.createFactory(h),a=t.createFactory(l),y=t.createFactory(E),b=t.createFactory(S),u=t.createFactory(d),_=t.createFactory(m),c=640,v=t.createClass({displayName:"OnboardingSlider",mixins:[t.addons.PureRenderMixin],propTypes:{width:t.PropTypes.number.isRequired,height:t.PropTypes.number,className:t.PropTypes.string,onSlideChange:t.PropTypes.func,onSlideEnd:t.PropTypes.func,initialSlideIndex:t.PropTypes.number,children:function(e,n,o){var r;return r=t.Children.count(e[n]),assert(r>0,o+" has no slide to show")}},getDefaultProps:function(){return{initialSlideIndex:0}},getInitialState:function(){return{currentSlideIndex:this.props.initialSlideIndex}},isAtLastSlide:function(){return this.state.currentSlideIndex+1===this.getSlideCount()},getSlideCount:function(){return t.Children.count(this.props.children)},gotoSlide:function(e){return e!==this.state.currentSlideIndex?(assert(e>=0&&e<this.getSlideCount(),"Invalid slide index: "+e),this.setState({currentSlideIndex:e},function(t){return function(){var n;return"function"==typeof(n=t.props).onSlideChange?n.onSlideChange(e):void 0}}(this))):void 0},prevSlide:function(){return this.gotoSlide(this.state.currentSlideIndex-1)},nextSlide:function(){return this.gotoSlide(this.state.currentSlideIndex+1)},render:function(){return y({className:this.props.className},b({width:this.props.width,height:this.props.height,currentSlideIndex:this.state.currentSlideIndex},this.props.children),u({slideCount:this.getSlideCount(),currentSlideIndex:this.state.currentSlideIndex,onIndicatorClick:this.gotoSlide}),_(null,this.isAtLastSlide()?a({className:"is-done",onClick:this.props.onSlideEnd},w("Got it")):a({className:"is-next",onClick:this.nextSlide},w("Next"))))}}),g=t.createFactory(v),f=t.createClass({displayName:"OnboardingModal",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,onClose:t.PropTypes.func,slideWidth:t.PropTypes.number,slideHeight:t.PropTypes.number,initialSlideIndex:t.PropTypes.number},getDefaultProps:function(){return{slideWidth:c}},closeModal:function(){var e;return h.close(),"function"==typeof(e=this.props).onClose?e.onClose():void 0},render:function(){return p({acceptButtonText:null,onDismiss:this.props.onClose,style:"clean",className:this.props.className,clickOutToClose:!1},g({initialSlideIndex:this.props.initialSlideIndex,width:this.props.slideWidth,height:this.props.slideHeight,onSlideEnd:this.closeModal},this.props.children))}})}),define("modules/clean/react/open_in_app/actions",["require","exports","modules/clean/open_in_mobile_app","modules/constants/file_viewer","modules/core/browser"],function(e,t,n,o,r){"use strict";function i(){var e=navigator.userAgent||"",t=/OS (\d+)_(\d+)_?(\d+)?/,n=e.match(t);return n?parseInt(n[1],10)>=9:!0}function s(e){return e.platform===d.IPAD||e.platform===d.IPHONE}function a(e){return e.platform===d.ANDROID_MARKET}function l(e,t){var o=t.onAppNeeded,l=t.onAppInstalled;s(e)?n.open_ios(e.iOSAppUrl,e.iOSAppStoreUrl,i(),o,l):a(e)&&r.unsafeRedirect(e.androidAppUrl)}function c(e){var t;if(s(e))t=e.iOSAppUrl;else{if(!a(e))return;t=e.androidAppUrl}var n=document.createElement("iframe");n.setAttribute("class","open-in-app-transport"),n.setAttribute("src",t),n.setAttribute("style","display: none"),document.body.appendChild(n)}function u(){n.cleanup()}var d=o.OpenInMobileAppPlatform;t.openInApp=l,t.openImmediately=c,t.cleanUp=u}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","external/react","modules/clean/react/open_in_app/actions","modules/core/i18n"],function(e,t,n,o,r,i){"use strict";var s=function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){r.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){r.cleanUp()},t.prototype.render=function(){return o.createElement("button",{className:"button-primary control__button open-in-app-button",onClick:this.handleClick},this.state.showInstallAppText?i._("Install app?"):i._("Open in app"))},t}(o.Component);t.OpenInAppButton=s}),define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,n){var o,r,i,s,a,l;return l=n.mergeProps,s=e.createElement,a=e.DOM,i=function(n,o,r,i){var a,c,u;return a=null!=(u=n.displayName)?u:"UnnamedComponent",e.createClass({displayName:"Outside"+o+"Handled"+a,propTypes:(c={},c[""+r]=e.PropTypes.func,c[""+i]=e.PropTypes.func,c),componentDidMount:function(){return document.addEventListener(o,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(o,this._handleOutsideEvent,!1)},render:function(){var e,o;return o=l(t.omit(this.props,r,i,"children"),(e={},e[""+r]=this._handleInsideEvent,e)),s(n,o,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[i]?t[i](e):void 0},_handleInsideEvent:function(e){var t,n;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(n=this.props)[r]?n[r](e):void 0}})},o=i("div","click","onClick","onOutsideClick"),r=i("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:o,OutsideMouseDownHandler:r,addOutsideEventHandling:i}}),define("modules/clean/react/overlay",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/free_positioned","modules/clean/react/portal","modules/core/dom"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_;return _=n.DOM,h=n.createElement,p=n.createClass({displayName:"Overlay",propTypes:{children:n.PropTypes.node.isRequired,overlayRoot:n.PropTypes.instanceOf(HTMLElement),overlayTarget:n.PropTypes.instanceOf(HTMLElement),isFullScreen:n.PropTypes.bool,shouldTrapKeyboardFocus:n.PropTypes.bool,isContentFocusable:n.PropTypes.bool,shouldAutoFocusOverlayContent:n.PropTypes.bool,position:n.PropTypes.shape({top:n.PropTypes.number,left:n.PropTypes.number}),onRendered:n.PropTypes.func,onBlur:n.PropTypes.func,className:n.PropTypes.string},getDefaultProps:function(){return{overlayRoot:null,overlayTarget:null,isFullScreen:!1,shouldTrapKeyboardFocus:!1,isContentFocusable:!0,shouldAutoFocusOverlayContent:!0,position:null,onRendered:r.noop,onBlur:r.noop}},componentWillMount:function(){return this._rootContainer=document.body,this.overlayTarget=this.props.overlayTarget||document.activeElement},overlayContentDidMount:function(){return this.$overlayContent=e(o.findDOMNode(this.refs.overlayContent)),this.props.isContentFocusable&&(this._focusElementInOverlay(),this._bindOverlayHandlers()),this.props.isFullScreen&&(this._maskElementsBehindOverlay(this.$overlayContent),c.scroll_lock_document()),this.props.onRendered()},componentDidUpdate:function(e){return this.$overlayContent&&!e.isContentFocusable&&this.props.isContentFocusable?(this._focusElementInOverlay(),this._bindOverlayHandlers()):void 0},componentWillUnmount:function(){return this._unbindOverlayHandlers(),this.props.isFullScreen?(this._unmaskElementsBehindOverlay(this.$overlayContent),c.scroll_unlock_document()):void 0},_bindOverlayHandlers:function(){return this.$overlayContent.on("keydown",this._handleKeyDown),window.addEventListener("mousedown",this._handleFocusOutOverlay,!0),window.addEventListener("blur",this._handleFocusIntoIframe,!0)},_unbindOverlayHandlers:function(){return this.$overlayContent.off("keydown"),window.removeEventListener("mousedown",this._handleFocusOutOverlay,!0),window.removeEventListener("blur",this._handleFocusIntoIframe,!0)},_getContentStyle:function(){return this.props.position&&!this.props.isFullScreen?{top:this.props.position.top,left:this.props.position.left}:{}},_maskElementsBehindOverlay:function(e){return this._setScreenReaderHiddenForSiblingsAndAncestors(e,!0)},_unmaskElementsBehindOverlay:function(e){return this._setScreenReaderHiddenForSiblingsAndAncestors(e,!1)},_setScreenReaderHiddenForSiblingsAndAncestors:function(e,t){var n,o;return o=e.siblings().not("#accessible-announce"),t?o.attr("aria-hidden",!0):o.removeAttr("aria-hidden"),n=e.parent(),n.is(this._rootContainer)?void 0:this._setScreenReaderHiddenForSiblingsAndAncestors(n,t)},_focusElementInOverlay:function(){var e,t;return e=this.$overlayContent.children().first(),null==e.attr("tabindex")&&(e=this.$overlayContent),this.props.shouldAutoFocusOverlayContent&&(t=c.getTabbableElementsIn(this.$overlayContent),t.length>0&&(e=t[0])),e.focus()},_handleKeyDown:function(e){return this.props.isContentFocusable?e.which===i.TAB?this._handleTabNavigate(e):e.which===i.ESC?this._blur(e,this.overlayTarget):void 0:void 0},_handleFocusOutOverlay:function(e){return this.props.isContentFocusable?e.target===this.overlayTarget||this.overlayTarget.contains(e.target)||this.$overlayContent.get(0).contains(e.target)?void 0:this._blur(e,e.target||this.overlayTarget):void 0},_handleFocusIntoIframe:function(e){return"IFRAME"===document.activeElement.tagName?this._blur(e,document.activeElement):void 0},_handleTabNavigate:function(e){var t,n,o,r,i,s,a,l;return this.props.shouldTrapKeyboardFocus||this.props.isFullScreen?c.keepFocusIn(this.$overlayContent,e):(i=c.getTabbableElementsIn(this.$overlayContent),t=i[0],o=i[i.length-1],!e.shiftKey||(s=e.target)!==this.$overlayContent.get(0)&&s!==t?e.shiftKey||(a=e.target)!==this.$overlayContent.get(0)&&a!==o?void 0:(n=c.getFocusableElementsIn(this.overlayTarget.parentNode),l=n.index(this.overlayTarget),r=l<n.length-1?n[l+1]:this.overlayTarget,this._blur(e,r)):this._blur(e,this.overlayTarget))},_blur:function(e,t){return e.preventDefault(),e.stopPropagation(),t.focus(),this.props.onBlur(e)},render:function(){var e,n;return e=t([this.props.className,{"react-overlay":!0,"react-overlay--is-fullscreen":this.props.isFullScreen}]),n={ref:"overlayContent",tabIndex:-1,className:e,style:this._getContentStyle()},this.props.isFullScreen&&(n.role="dialog"),h(l,{parentElement:this.props.overlayRoot||this._rootContainer,onRendered:this.overlayContentDidMount},_.div(n,this.props.children))}}),u=s(p,["/static/css/react/portal_overlay-vflCJkoX6.css"]),d=n.createClass({displayName:"PositionedOverlay",statics:{POSITIONS:a.STICKY_POSITION},propTypes:{targetNode:n.PropTypes.instanceOf(HTMLElement).isRequired,isTargetPositionFixed:n.PropTypes.bool,isContentFocusable:n.PropTypes.bool,position:n.PropTypes.oneOf(r.values(a.STICKY_POSITION)).isRequired,positionOffset:n.PropTypes.shape({horizontal:n.PropTypes.number,vertical:n.PropTypes.number}),className:n.PropTypes.string},getDefaultProps:function(){return{isTargetPositionFixed:!1,isContentFocusable:!0}},getInitialState:function(){return{readyToFocusInOverlay:!1}},_handlePositionUpdated:function(e){return!this.currentPositioning&&this.props.isContentFocusable&&this.setState({readyToFocusInOverlay:!0}),this.currentPositioning=e},render:function(){var e;return e=r.omit(this.props,["children","position"]),h(u,r.defaults({},{overlayTarget:this.props.targetNode,isFullScreen:!1,isContentFocusable:this.state.readyToFocusInOverlay,className:this.props.className},e),h(a,r.defaults({},{getPositioning:a.makeStickyPositioner({targetNode:this.props.targetNode,isTargetFixed:this.props.isTargetPositionFixed,position:this.props.position,offset:this.props.positionOffset}),isTargetFixed:this.props.isTargetPositionFixed,onReposition:this._handlePositionUpdated},e),this.props.children))}}),{Overlay:u,PositionedOverlay:d}}),define("modules/clean/react/paging_list",["external/classnames","external/react","external/react-dom","jquery","external/underscore"],function(e,t,n,o,r){var i,s;return s=t.DOM,i=t.createClass({displayName:"PagingList",propTypes:{customClass:t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.instanceOf(e)]),itemSize:t.PropTypes.number.isRequired,pageSize:t.PropTypes.number.isRequired,threshold:t.PropTypes.number,useTranslate3d:t.PropTypes.bool},getDefaultProps:function(){return{threshold:100,useTranslate3d:!1}},getInitialState:function(){return{from:0,size:this._constrainSize(this.props.pageSize,this.props.children,0)}},componentWillReceiveProps:function(e){var t,n;return t=this._constrainFrom(this.state.from,e.children.length),n=this._constrainSize(this.state.size,e.children,t),this.setState({from:t,size:n})},componentDidMount:function(){return window.addEventListener("resize",this.updateFrame),n.findDOMNode(this).addEventListener("scroll",this.updateFrame),this.updateFrame()},shouldComponentUpdate:function(e,t){return!r.isEqual(e,this.props)||!r.isEqual(t,this.state)},componentDidUpdate:function(){return this.updateFrame()},componentWillUnmount:function(){return window.removeEventListener("resize",this.updateFrame),n.findDOMNode(this).removeEventListener("scroll",this.updateFrame)},_getScroll:function(){var e,t,o;return t=n.findDOMNode(this.refs.scroller).getBoundingClientRect().top,e=n.findDOMNode(this.refs.container).getBoundingClientRect().top,o=e-t},_setScroll:function(e){return n.findDOMNode(this.refs.container).scrollTop+=e-this._getScroll()},_getViewportSize:function(){return n.findDOMNode(this.refs.container).clientHeight},_getStartAndEnd:function(){var e,t;return t=Math.max(0,this._getScroll()-this.props.threshold),e=t+this._getViewportSize()+2*this.props.threshold,{start:t,end:e}},updateFrame:function(){var e,t,n,o,r,i;return o=this._getStartAndEnd(),i=o.start,e=o.end,n=this.props.itemSize,t=this._constrainFrom(Math.floor(i/n),this.props.children.length),r=this._constrainSize(Math.ceil((e-i)/n)+1,this.props.children,t),this.setState({from:t,size:r})},_getSpaceBefore:function(e){return e*this.props.itemSize},_constrainFrom:function(e,t){return e?Math.max(Math.min(e,t-1),0):0},_constrainSize:function(e,t,n){var o,r;return o=t.length,r=this.props.pageSize,Math.min(Math.max(e,r),o-n)},scrollTo:function(e){return this._setScroll(this._getSpaceBefore(e))},scrollAround:function(e){var t,n,o;return t=this._getScroll(),n=this._getSpaceBefore(e),t>n?this._setScroll(n):(o=n-this._getViewportSize()+this.props.itemSize,o>t?this._setScroll(o):void 0)},_renderItems:function(){var e;return e=this.state.from+this.state.size-1,this.props.children.slice(this.state.from,+e+1||9e9)},render:function(){var t,n,o,r;return n={position:"relative",height:this._getSpaceBefore(this.props.children.length)},r=this._getSpaceBefore(this.state.from),o=this.props.useTranslate3d?"translate3d(0px, "+r+"px, 0)":"translate(0px, "+r+"px)",t={MsTransform:o,WebkitTransform:o,transform:o},s.div({className:e("paging-list",this.props.customClass),ref:"container"},s.div({style:n,ref:"scroller"},s.ul({style:t},this._renderItems())))}})}),define("modules/clean/react/pass/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/pass/constants"],function(e,t,n,o){"use strict";var r=function(){function e(){}return e.fetchPassRequest=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_PASS_REQUEST,data:{nsId:e,sjid:t}})},e.fetchSeenStateSuccess=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_SEEN_STATE_SUCCESS,data:{nsId:e,sjid:t}})},e.fetchPresenceSuccess=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_PRESENCE_SUCCESS,data:{nsId:e,sjid:t}})},e.fetchPassError=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_PASS_ERROR,data:{nsId:e,sjid:t}})},e.receivePresenceDelta=function(e,t,r,i,s){n.dispatch({type:o.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,nsId:t,sjid:r,onlineUniqueUsers:i,offlineUniqueUsers:s}})},e.receivePresenceSnapshot=function(e,t,r,i){n.dispatch({type:o.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,nsId:t,sjid:r,onlineUniqueUsers:i}})},e.resetPassInfo=function(e,t){n.dispatch({type:o.ActionTypes.RESET_PASS_INFO,data:{nsId:e,sjid:t}})},e.updateSeenStateInfo=function(e,t,r){n.dispatch({type:o.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{nsId:e,sjid:t,seenStateInfo:r}})},e}();t.PassActions=r}),define("modules/clean/react/pass/constants",["require","exports"],function(e,t){"use strict";t.ActionTypes={FETCH_PASS_REQUEST:"FETCH_PASS_REQUEST",FETCH_SEEN_STATE_SUCCESS:"FETCH_SEEN_STATE_SUCCESS",FETCH_PRESENCE_SUCCESS:"FETCH_PRESENCE_SUCCESS",FETCH_PASS_ERROR:"FETCH_PASS_ERROR",RECEIVE_PRESENCE_DELTA:"RECEIVE_PRESENCE_DELTA",RECEIVE_PRESENCE_SNAPSHOT:"RECEIVE_PRESENCE_SNAPSHOT",RESET_PASS_INFO:"RESET_PASS_INFO",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO"},t.PASS_FETCHING_STATUS={FETCHING:"FETCHING",ERROR:"ERROR",SEEN_STATE_SUCCESS:"SEEN_STATE_SUCCESS",PRESENCE_SUCCESS:"PRESENCE_SUCCESS",PASS_SUCCESS:"PASS_SUCCESS"},t.MAX_FACES_NORMAL=5,t.MAX_FACES_COMPACT=2,t.MAX_OVERFLOW_BUTTON_INDICATOR=99,t.BROWSE_PASS_SESSION_ID="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/pass/store",["external/underscore","modules/clean/flux/base_store","modules/clean/previews/util","modules/clean/react/file_viewer/store","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/clean/sharing/action_types","modules/core/exception"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_;return d=n.PermissionHelper,l=r.ActionTypes,c=r.PASS_FETCHING_STATUS,h=i.SeenStateHelpers,_=s.ShareModalActionTypes,p=function(){function e(){this._userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){return e in this._userIdToUniqueIds||(this._userIdToUniqueIds[e]={}),this._userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){return e in this._userIdToUniqueIds&&t in this._userIdToUniqueIds[e]&&(delete this._userIdToUniqueIds[e][t],!Object.keys(this._userIdToUniqueIds[e]).length)?delete this._userIdToUniqueIds[e]:void 0},e.prototype.getOnlineUserIds=function(){return Object.keys(this._userIdToUniqueIds)},e}(),new(u=function(t){function n(e){n.__super__.constructor.call(this,e),this._seenStateInfos={},this._presenceInfos={},this._passFetchingStatusMap={}}return extend(n,t),n.prototype.presence=function(e,t){var n;return n=this._fileKey(e,t),n in this._presenceInfos?this._presenceInfos[n].getOnlineUserIds():null},n.prototype.seenStateInfo=function(e,t){var n;return n=this._fileKey(e,t),this._seenStateInfos[n]||null},n.prototype.passFetchingStatus=function(e,t){var n;return n=this._fileKey(e,t),this._passFetchingStatusMap[n]||null},n.prototype.getLinkAndGroupInfo=function(e,t){var n,o,r,i,s,a,l,c,u,d,p,h,_;
if(n=this._fileKey(e,t),h=this._seenStateInfos[n],!h)return null;for(u=[],i={},d=this._seenStateInfos[n].seen_states,s=0,l=d.length;l>s;s++)switch(_=d[s],null!=(p=_.seen_state_user.sharing_access_type)?p.type:void 0){case"link_only":u.push(_);break;case"member_access":for(r=_.seen_state_user.sharing_access_type.value||[],a=0,c=r.length;c>a;a++)o=r[a],o in i||(i[o]=[]),i[o].push(_)}return[u,i]},n.prototype._resetPassInfo=function(e,t){var n;return n=this._fileKey(e,t),delete this._seenStateInfos[n],delete this._presenceInfos[n],this.emit_change()},n.prototype._fileKey=function(e,t){return e+":"+t},n.prototype._receivePresenceDelta=function(e,t,n,o,r){var i,s;return i=this._fileKey(t,n),s=this._getOnlineUsersForFileKey(i),this._updatePresenceInfos(i,o,r),this._updateSeenStateInfoWithUpdatedPresence(e,t,n,i,s)},n.prototype._receivePresenceSnapshot=function(e,t,n,o){var r,i;return r=this._fileKey(t,n),i=this._getOnlineUsersForFileKey(r),this._presenceInfos[r]=new p,this._updatePresenceInfos(r,o,[]),this._updateSeenStateInfoWithUpdatedPresence(e,t,n,r,i)},n.prototype._getOnlineUsersForFileKey=function(e){return e in this._presenceInfos||(this._presenceInfos[e]=new p),this._presenceInfos[e].getOnlineUserIds()},n.prototype._updatePresenceInfos=function(e,t,n){var o,r,i,s,a,l;for(r in n){l=n[r];for(a in l)o=l[a],this._presenceInfos[e].removeUniqueUser(r,a)}s=[];for(i in t)l=t[i],s.push(function(){var t;t=[];for(a in l)o=l[a],t.push(this._presenceInfos[e].addUniqueUser(i,a));return t}.call(this));return s},n.prototype._updateSeenStateInfoWithUpdatedPresence=function(t,n,o,r,i){var s,a,l,c;return l=this._getOnlineUsersForFileKey(r),s=e.difference(i,l),a=e.difference(l,i),c=this._makeSeenStateAgreeWithUpdatedPresence(r,l,s,a),this._fetchUnknownSeenStatesOrEmitChange(t,n,o,r,c)},n.prototype._makeSeenStateAgreeWithUpdatedPresence=function(e,t,n,o){var r,i,s,a,l,c,u,d,p,h,_,m;if(!(e in this._seenStateInfos))return[];for(_=[],m=this._seenStateInfos[e].seen_states,u=[],l=[],a=[],c=Date.now()/1e3,i=r=0,s=m.length;s>r;i=++r)p=m[i],h=p.seen_state_user.user_id,_.push(h),indexOf.call(o,h)>=0?(p.when_last_seen=c,l.push(p)):indexOf.call(n,h)>=0?(p.when_last_seen=c,a.push(p)):u.push(p);return this._seenStateInfos[e].seen_states=l.concat(a,u),function(){var e,n,o;for(o=[],e=0,n=t.length;n>e;e++)d=t[e],indexOf.call(_,d)<0&&o.push(d);return o}()},n.prototype._fetchUnknownSeenStatesOrEmitChange=function(e,t,n,o,r){return r.length?h.fetchSeenStateUsers(e,this._seenStateInfos[o],r,t,n):this.emit_change()},n.prototype._updateSeenStateInfo=function(e,t,n){return this._seenStateInfos[this._fileKey(e,t)]=n,this.emit_change()},n.prototype._refetchSeenStateInfo=function(){var e,t,n,r,i;return e=o.currentFile(),i=o.user(),e&&d.is_pass_enabled(i)?(t=e.ns_id,r=e.sjid,n=o.sharedLinkInfo(),h.fetchSeenStateInfo(i,t,r,null!=n?n.url:void 0)):void 0},n.prototype._setPassFetchingStatus=function(e,t,n){var o;return o=this._fileKey(e,t),this._passFetchingStatusMap[o]=n,this.emit_change()},n.prototype._onFetchSeenStateSuccess=function(e,t){var n;return n=this._fileKey(e,t),this._passFetchingStatusMap[n]===c.PRESENCE_SUCCESS?this._setPassFetchingStatus(e,t,c.PASS_SUCCESS):this._passFetchingStatusMap[n]===c.FETCHING?this._setPassFetchingStatus(e,t,c.SEEN_STATE_SUCCESS):null==this._passFetchingStatusMap[n]?a.raiseAndReport("Debugging T123456: pass fetching status is null",{severity:a.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this._passFetchingStatusMap[n]}}):void 0},n.prototype._onFetchPresenceSuccess=function(e,t){var n;return n=this._fileKey(e,t),this._passFetchingStatusMap[n]===c.SEEN_STATE_SUCCESS?this._setPassFetchingStatus(e,t,c.PASS_SUCCESS):this._passFetchingStatusMap[n]===c.FETCHING?this._setPassFetchingStatus(e,t,c.PRESENCE_SUCCESS):null==this._passFetchingStatusMap[n]?a.raiseAndReport("Debugging T123456: pass fetching status is null",{severity:a.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this._passFetchingStatusMap[n]}}):void 0},n.prototype._new_payload=function(e){var t;switch(t=e.action.data,e.action.type){case l.FETCH_PASS_REQUEST:return this._setPassFetchingStatus(t.nsId,t.sjid,c.FETCHING);case l.FETCH_SEEN_STATE_SUCCESS:return this._onFetchSeenStateSuccess(t.nsId,t.sjid);case l.FETCH_PRESENCE_SUCCESS:return this._onFetchPresenceSuccess(t.nsId,t.sjid);case l.FETCH_PASS_ERROR:return this._setPassFetchingStatus(t.nsId,t.sjid,c.ERROR);case l.RECEIVE_PRESENCE_DELTA:return this._receivePresenceDelta(t.userId,t.nsId,t.sjid,t.onlineUniqueUsers,t.offlineUniqueUsers);case l.RECEIVE_PRESENCE_SNAPSHOT:return this._receivePresenceSnapshot(t.userId,t.nsId,t.sjid,t.onlineUniqueUsers);case l.RESET_PASS_INFO:return this._resetPassInfo(t.nsId,t.sjid);case l.UPDATE_SEEN_STATE_INFO:return this._updateSeenStateInfo(t.nsId,t.sjid,t.seenStateInfo);case _.SEND_SHARE_SUCCESS:case _.REMOVE_MEMBER_SUCCESS:return this._refetchSeenStateInfo()}},n}(t))}),define("modules/clean/react/pass/utils",["require","exports","jquery","external/es6-promise","external/underscore","modules/clean/ajax","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/api_v2/types","modules/clean/beacon","modules/clean/previews/util","modules/clean/react/file_viewer/store","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/sharing/actions/sharing_actions","modules/clean/uuid","modules/clean/viewer","modules/constants/file_viewer","modules/constants/python"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v){"use strict";var y=6,E=h.MAX_FACES_NORMAL+h.MAX_OVERFLOW_BUTTON_INDICATOR+1,b=function(){function e(){}return e.setup=function(e,t,o,r){var i=this;void 0===r&&(r=!0),u.PermissionHelper.is_pass_enabled(e)&&(setTimeout(function(){p.PassActions.fetchPassRequest(t.file.ns_id,t.file.sjid);var n=t.file.file_id||t.file.fq_path;n&&(_.SharingActions.loadFileMetadata({user:e,contentId:n,sourceUrl:t.url}),_.SharingActions.listMembers({user:e,contentId:n,isFolder:!1,limit:y,url:t.url}),t.file.fq_path&&_.SharingActions.fetchLinkMetadata({user:e,contentId:n,isFolder:!1})),C.fetchSeenStateInfo(e,t.file.ns_id,t.file.sjid,t.url);var i=t.file.file_id;_.SharingActions.fetchFileMemberCount({user:e,fileId:i,limit:E,url:t.url});var s=new w(t.file,t.url),a=null;o&&(a=new w(o.file,o.url)),T.updatePresence(s,a,e,r)},0),n(window).off("beforeunload.passpresence"),n(window).on("beforeunload.passpresence",function(n){i.teardown(e,t,!1,r),n.returnValue=void 0}))},e.teardown=function(e,t,o,r){var i=t.file,s=t.url;if(void 0===r&&(r=!0),u.PermissionHelper.is_pass_enabled(e)){n(window).off("beforeunload.passpresence");var a=new w(i,s);T.shutdown(a,e,o,r)}},e}();t.PassHelpers=b;var S=function(e,t){p.PassActions.resetPassInfo(e,t),p.PassActions.fetchPassError(e,t)},w=function(){function e(e,t){t?this.authKey="pass_"+t:this.authKey="pass",this.nsId=e.ns_id,this.sjid=e.sjid,this.context=e.beacon_context}return e}();t.BeaconFileData=w;var T=function(){function e(){}return e.updatePresence=function(e,t,n,o){void 0===o&&(o=!0);var r=!f.get_viewer().is_assume_user_session&&o;r&&this.transmitBeaconData(e,t,n.account_id),this.receiveBeaconData(e,n)},e.shutdown=function(e,t,n,o){void 0===o&&(o=!0),this.transmitter&&(!f.get_viewer().is_assume_user_session&&o&&C.updateSeenStateOnResign(t.id,e,n,this.identifier),this.transmitter.stop(),delete this.transmitter,delete this.identifier),this.receiver&&(this.receiver.stop(),delete this.receiver)},e.receiveBeaconData=function(e,t){var n=this;this.receiver&&this.receiver.stop(),i.SilentBackgroundRequest({url:"/get_pass_receiver_token",type:"GET",dataType:"json",data:{account_id:t.account_id,auth_key:e.authKey,context:e.context},success:function(o){if(o.error)S(e.nsId,e.sjid);else{var r=o.token,i=[new c.PresenceParams(c.PresenceType.Context,t.account_id,n.APP,e.context,r)];n.receiver=new c.Receiver(i,function(o){return n.onUpdate(o,t.id,e)},function(){return n.receiveBeaconData(e,t)}),n.receiver.start()}}})},e.onUpdate=function(e,t,n){var o=e[0];if(o.delta){var r=this.parseBeaconUpdates(o.delta);p.PassActions.receivePresenceDelta(t,n.nsId,n.sjid,r.onlineUniqueUsers,r.offlineUniqueUsers)}else if(o.snapshot){var r=this.parseBeaconUpdates(o.snapshot);p.PassActions.receivePresenceSnapshot(t,n.nsId,n.sjid,r.onlineUniqueUsers)}p.PassActions.fetchPresenceSuccess(n.nsId,n.sjid)},e.parseBeaconUpdates=function(e){for(var t={},n={},o=0,r=e;o<r.length;o++){var i=r[o],s=i.agent,a=s.user_id,l=s.source.identifier;i.status===v.BEACON_ONLINE_STATUS?(a in t||(t[a]={}),t[a][l]=!0):i.status===v.BEACON_OFFLINE_STATUS&&(a in n||(n[a]={}),n[a][l]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:n}},e.transmitBeaconData=function(e,t,n){if(this.transmitter){var o=[];t&&o.push(this.getAgentStatusForFile(n,t,v.BEACON_OFFLINE_STATUS)),o.push(this.getAgentStatusForFile(n,e,v.BEACON_ONLINE_STATUS)),this.transmitter.add_or_update_agents(o)}else this.identifier=m.v4({allowInsecure:!0}),this.fetchTransmitterToken(n,e)},e.getAgentStatusForFile=function(e,t,n){var o=new c.Source(this.PLATFORM,this.SURFACE,this.identifier),r=new c.Agent(e,this.APP,t.context,o);return new c.AgentStatus(r,n,t.authKey)},e.fetchTransmitterToken=function(e,t){var n=this;i.SilentBackgroundRequest({url:"/get_pass_transmitter_token",type:"GET",dataType:"json",data:{account_id:e},success:function(o){if(o.error)S(t.nsId,t.sjid);else{var i=o.token;n.transmitter?n.transmitter.update_token(i):n.transmitter=new c.Transmitter(i,function(){return n.fetchTransmitterToken(e,t)},r.noop),t&&n.transmitter.add_or_update_agents([n.getAgentStatusForFile(e,t,v.BEACON_ONLINE_STATUS)]),n.transmitter.start()}}})},e}();T.APP="harmony",T.PLATFORM=c.Platforms.WEB,T.SURFACE="file_viewer",T.receiver=null,T.transmitter=null,T.identifier=null,t.BeaconPresenceHelpers=T,t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT=9e3;var C=function(){function e(){}return e.constructFakeSeenStateInfo=function(e,t,n){for(var o=n.seen_states,i=[],s=0,a=o;s<a.length;s++){var l=a[s];i.push(l.seen_state_user.user_id)}for(var c=0,u=e;c<u.length;c++){var d=u[c];if(!r.contains(i,d.user_id)){d.sharing_access_type&&(d.sharing_access_type=this.convertToUnion(d.sharing_access_type));var p={seen_state_user:d,when_last_seen:t};o.unshift(p)}}return n.seen_states=o,n},e.sjidFileIdentifier=function(e){return"sjid:"+e.toString()},e.convertToUnion=function(e){return e?l.Union.parse(e):null},e.fetchSeenStateUsers=function(e,t,n,r,i){var l=this,c=Date.now()/1e3,u=void 0;return d.currentFile()&&d.sharedLinkInfo()&&(u=d.sharedLinkInfo().url),(new s.ApiV2RootAwareClient).rpc(e,"seen_state/get_seen_state_users",{user_ids:n,file_info:{ns_id:r,file_identifier:this.sjidFileIdentifier(i),url:u}}).catch(a.catchApiError(function(){return S(r,i),o.Promise.reject(void 0)})).then(function(e){var n=l.constructFakeSeenStateInfo(e,c,t);p.PassActions.updateSeenStateInfo(r,i,n)})},e.fetchSeenStateInfo=function(e,t,n,r){var i=this;return(new s.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info",{file_infos:[{ns_id:t,file_identifier:this.sjidFileIdentifier(n),url:r}]}).catch(a.catchApiError(function(){return S(t,n),o.Promise.reject(void 0)})).then(function(e){var o=e[0];if(o.seen_state_error)S(t,n);else{for(var r=o.seen_state_info,s=0,a=r.seen_states;s<a.length;s++){var l=a[s];l.seen_state_user.sharing_access_type=i.convertToUnion(l.seen_state_user.sharing_access_type)}p.PassActions.updateSeenStateInfo(t,n,r),p.PassActions.fetchSeenStateSuccess(t,n)}})},e.getCoachmark=function(e,t){return(new s.ApiV2RootAwareClient).rpc(e,"seen_state/get_coachmark_info",null).catch(a.catchApiError(function(){return o.Promise.reject(void 0)})).then(function(e){var n=e.type_with_data[".tag"];t(n)})},e.logCoachmarkInteraction=function(e,t,n){return(new s.ApiV2RootAwareClient).rpc(e,"seen_state/log_coachmark_interaction",{type:t,interaction:n}).catch(a.catchApiError(function(){return o.Promise.reject(void 0)}))},e.updateSeenStateOnResign=function(e,n,o,r){var i=o?"async":"sync",a=void 0;return o||(a=g.PASS_RESIGN_ONBEFOREUNLOAD_TIMEOUT||t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT),new s.ApiV2RootAwareClient(i,a).rpc(e,"seen_state/update_timestamps_and_mark_offline",{beacon_infos:[{context:n.context,auth_key:n.authKey,identifier:r}]})},e}();t.SeenStateHelpers=C}),define("modules/clean/react/portal",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/react/css"],function(e,t,n,o,r,i){var s;return s=n.createClass({displayName:"Portal",propTypes:{parentElement:n.PropTypes.instanceOf(HTMLElement).isRequired,onRendered:n.PropTypes.func,children:n.PropTypes.element.isRequired},getDefaultProps:function(){return{onRendered:r.noop}},createRenderTargetNode:function(t){var n,o;return t?(o=document.createElement("div"),o.className="react-portal-container",n=e(t).children().not(".react-portal-container").first(),t.insertBefore(o,n.get(0)),o):null},componentDidMount:function(){return this.props.parentElement?this._renderPortalContainerAndContents():void 0},componentWillUnmount:function(){return this._closeCurrentPortal()},componentDidUpdate:function(e){return e.parentElement===this.props.parentElement?this._renderPortalContentsInContainer(this._portalContainerNode):this._renderPortalContainerAndContents()},_closeCurrentPortal:function(){return this._portalContainerNode?(o.unmountComponentAtNode(this._portalContainerNode),this._portalContainerNode.parentNode.removeChild(this._portalContainerNode),this._portalContainerNode=null):void 0},_renderPortalContainerAndContents:function(){return this._closeCurrentPortal(),this._portalContainerNode=this.createRenderTargetNode(this.props.parentElement),this._renderPortalContentsInContainer(this._portalContainerNode)},_renderPortalContentsInContainer:function(e){return e?o.render(n.Children.only(this.props.children),e,this.props.onRendered):void 0},render:function(){return null}}),i(s,["/static/css/react/portal_overlay-vflCJkoX6.css"])}),define("modules/clean/react/previews/archive/preview_archive",["require","exports","tslib","external/react","modules/clean/display_format","modules/clean/loggers/file_preview_logger","modules/clean/previews/util","modules/clean/previews/preview_actions_helper","modules/clean/react/button","modules/clean/react/image","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/open_button","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/em_string","modules/clean/static_urls","modules/clean/web_timing_logger","modules/core/i18n","modules/core/notify","modules/constants/file_viewer"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E){"use strict";var b=16,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickDownload=function(){t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED)},t.onClickShowContents=function(e){e.preventDefault(),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED),y.error(v._("We haven’t built this feature yet, but thank you for showing interest!")),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setUpLogger(),this.logFilePreviewTimeline(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewTimeline(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.logFilePreviewTimeline(u.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this.markWebTiming(),this.logFilePreviewTimeline(u.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(a.PreviewActions.broadcastRenderSucceeded,0)},t.prototype.componentWillUnmount=function(){this.teardownLogger()},t.prototype.setUpLogger=function(){this.logger&&this.teardownLogger(),this.logger=new i.FilePreviewArchiveLogger,this.logger.listenTo(d)},t.prototype.teardownLogger=function(){this.logger.unlistenTo(d),delete this.logger},t.prototype.logFilePreviewTimeline=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e,{preview_type:this.props.file.preview_type})},t.prototype.logFilePreviewEvent=function(e){d.emit(e,this.props.filePreviewSession,{preview_type:this.props.file.preview_type})},t.prototype.markWebTiming=function(){g.mark_time_to_view(),g.mark_time_to_interactive()},Object.defineProperty(t.prototype,"isSharedFile",{get:function(){return Boolean(this.props.sharedLinkInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return Boolean(this.props.file.open_in_app_data)},enumerable:!0,configurable:!0}),t.prototype.renderIcon=function(){return o.createElement(c,{className:"preview-archive__icon",src:f.static_url("/static/images/previews/archive-vflhGD-YR.png"),srcHiRes:f.static_url("/static/images/previews/archive@2x-vfl2j4qq-.png")})},t.prototype.renderMessage=function(){return o.createElement("div",{className:"preview-archive__message"},v._("See what’s inside this compressed file."))},t.prototype.renderFileInfo=function(){var e=s.PreviewHelper.get_filename(this.props.file);return o.createElement("div",{className:"preview-archive__info"},m.em_snippet(e,b),o.createElement("span",{className:"separator"},"·"),r.format_bytes(this.props.file.bytes))},t.prototype.renderControls=function(){return o.createElement("div",{className:"preview-archive__controls"},this.renderShowContentsButton(),this.renderDownloadOrOpenButton())},t.prototype.renderShowContentsButton=function(){return o.createElement(l.Button,{className:"show-contents-button",onClick:this.onClickShowContents},v._("See inside"))},t.prototype.renderDownloadOrOpenButton=function(){return this.isSharedFile?this.allowOpenInApp?o.createElement(h.OpenInAppButton,{urls:this.props.file.open_in_app_data}):o.createElement(_,{sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermission,fileOrFolder:this.props.file,justifyRight:!1,onClick:this.onClickDownload,location:u.FileViewerPane.PREVIEW_CONTENT,isMaestroDesign:E.MAESTRO_ENABLED}):o.createElement(p,{file:this.props.file,user:this.props.user,justifyRight:!1,onClick:this.onClickDownload,location:u.FileViewerPane.PREVIEW_CONTENT})},t.prototype.render=function(){return o.createElement("div",{className:"preview-content preview-content--center preview-archive"},o.createElement("div",{className:"c-modal c-modal--unibody preview-archive__wrapper"},o.createElement("div",{className:"c-modal__content preview-archive__content"},this.renderIcon(),this.renderMessage(),this.renderFileInfo(),this.renderControls())))},t}(o.Component);t.PreviewArchive=S}),define("modules/clean/react/previews/audio/preview_audio",["external/classnames","external/react","external/react-dom","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/average_counter","modules/clean/previews/preview_actions_helper","modules/clean/react/file_viewer/constants","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/utils","modules/clean/web_timing_logger"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f){var g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M;return D=i._,C=c.PreviewActions,S=u.EventTypes,A=m.PreviewAudioHelpers,k=m.PreviewAudioWaveformHelpers,L=t.DOM,M=t.PropTypes,O=t.createFactory(h),N=t.createFactory(d),P=t.createFactory(p),R=t.createFactory(_),v=2,g=1,T=1e3,y=100,w=.85,E=500,b="dropbox_duc_id",I=t.createClass({displayName:"PreviewAudio",propTypes:{src:M.string.isRequired,onError:M.func,filePreviewSession:t.PropTypes.object},getInitialState:function(){return{time:0,duration:0,bufferedLength:0,isPlaying:!1,isReady:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1}},componentDidMount:function(){var e;return this._logFilePreviewEvent(S.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(S.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),e=this._getAudioNode(),e.addEventListener("timeupdate",this._updateTime),e.addEventListener("durationchange",this._updateDuration),e.addEventListener("ended",this._pauseFile),e.addEventListener("canplay",this._setReady),e.addEventListener("progress",this._updateProgress),e.addEventListener("error",this._throwError),this._setWaveformWidth(),window.addEventListener("resize",this._getDebouncedWaveformWidthFunction()),this._sendWaveFormRequest()},componentWillUnmount:function(){var e,t;return e=this._getAudioNode(),e.removeEventListener("timeupdate",this._updateTime),e.removeEventListener("durationchange",this._updateDuration),e.removeEventListener("ended",this._pauseFile),e.removeEventListener("canplay",this._setReady),e.removeEventListener("progress",this._updateProgress),e.removeEventListener("error",this._throwError),window.removeEventListener("resize",this._getDebouncedWaveformWidthFunction()),null!=(null!=(t=this._audioContext)?t.close:void 0)?this._audioContext.close():void 0},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_getAudioNode:function(){return n.findDOMNode(this.refs.audio)},_getDebouncedWaveformWidthFunction:function(){return this._debouncedWaveformWidthFunction||(this._debouncedWaveformWidthFunction=o.debounce(this._setWaveformWidth,100)),this._debouncedWaveformWidthFunction},_setWaveformWidth:function(){return this.isMounted()?this.setState({waveformWidth:n.findDOMNode(this.refs.audioWrapper).offsetWidth}):void 0},_getSrcUrl:function(){var e,t;return e=a.parse(this.props.src),e.updateQuery("duc_id",b),t=e.toString(),"//"===t.slice(0,2)&&(t="https:"+t),t},_setReady:function(){return f.mark_time_to_view(),f.mark_time_to_interactive(),this.setState({isReady:!0}),this._logFilePreviewEvent(S.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(S.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(C.broadcastRenderSucceeded,0),setTimeout(this._setContainer.bind(this),E)},_setContainer:function(){return this.setState({isContainerSet:!0})},_getBufferProgress:function(){var e;return e=this._getAudioNode(),e.duration&&e.buffered.length?e.buffered.end(e.buffered.length-1):0},_updateProgress:function(){var e;return e=this._getBufferProgress(),this.setState({bufferedLength:e})},_updateTime:function(){return this.setState({time:this._getAudioNode().currentTime})},_updateTimeTo:function(e){return this._getAudioNode().currentTime=e,this.setState({time:e})},_updateDuration:function(){var e;return e=this._getBufferProgress(),this.setState({duration:this._getAudioNode().duration,bufferedLength:e})},_playOrPause:function(){return this.state.isPlaying?this._pauseFile():this._playFile()},_playFile:function(){return this._getAudioNode().play(),this.setState({isPlaying:!0})},_pauseFile:function(){return this._getAudioNode().pause(),this.setState({isPlaying:!1})},_toggleMute:function(){var e,t;return t=this.state.isMuted?this.state.volumeLevel||.1:0,this._getAudioNode().volume=t,e={isMuted:!this.state.isMuted},0===this.state.volumeLevel&&(e.volumeLevel=t),this.setState(e)},_changeVolumeTo:function(e){return this._getAudioNode().volume=e,this.setState({volumeLevel:e,isMuted:!e})},_sendWaveFormRequest:function(){var e;return this._setAudioContext(),null==this._audioContext?this._logFailedWaveformGeneration():(e=new XMLHttpRequest,e.open("GET",this._getSrcUrl()),e.responseType="arraybuffer",e.withCredentials=!0,e.onreadystatechange=function(t){return function(){return 4===e.readyState&&t.isMounted()?200===e.status?t._audioContext.decodeAudioData(e.response,t._parseWaveFormBuffer,t._logFailedWaveformGeneration):t._logFailedWaveformGeneration():void 0}}(this),e.send())},_throwError:function(){return s.error(D("An audio error occurred")),r.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:r.SEVERITY.NONCRITICAL}),this._logFilePreviewEvent(S.FILE_PREVIEW_DOWNLOAD_FAILED),this.props.onError()},_updateWaveformState:function(e){return this.isMounted()?this.setState({rawWaveformHeights:e}):void 0},_logFailedWaveformGeneration:function(){return r.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:r.SEVERITY.NONCRITICAL})},_parseWaveFormBuffer:function(e){return this._setWaveformWidth(),k.buildFromBuffer(e,T,y,this.isMounted.bind(this),this._updateWaveformState)},_setAudioContext:function(){var e;return e=window.AudioContext||window.webkitAudioContext,e?this._audioContext=new e:void 0},_renderAudioTag:function(){return L.audio({src:this._getSrcUrl(),preload:"auto",ref:"audio"})},_generateWaveform:function(){var e;return e=Math.floor((this.state.waveformWidth-g)/(v+g)),k.returnWaveform(this.state.rawWaveformHeights,e,w)},_renderRadio:function(){var t,n;return n=0!==this.state.rawWaveformHeights.length,t=e({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isReady||n}),L.div({className:t},A.getRadioImage())},_renderLoading:function(){return L.div({className:"preview-audio__load-wheel"},A.getLoaderWheel())},_renderWaveForm:function(){return O({generateWaveform:this._generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,updateTime:this._updateTimeTo,barWidth:v,barSpacing:g,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isPlayerReady:this.state.isReady,isContainerSet:this.state.isContainerSet})},_renderToolbar:function(){return L.div({className:"toolbar"},this._renderPlayButton(),this._renderDetails(),this._renderVolume())},_renderPlayButton:function(){return N({isPlaying:this.state.isPlaying,onChange:this._playOrPause})},_renderDetails:function(){return P({time:this.state.time,duration:this.state.duration})},_renderVolume:function(){return R({isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this._changeVolumeTo,onMuteToggle:this._toggleMute})},render:function(){var t;return t=e({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isReady}),L.div({className:"flex-preview-container"},L.div({className:"preview-audio preview-content preview-content--center"},L.div({className:"preview-audio__wrapper",ref:"audioWrapper"},L.div({className:"preview-audio__aspect-container"},L.div({className:t},this._renderAudioTag(),this._renderRadio(),this.state.isReady?[this._renderWaveForm(),this._renderToolbar()]:this._renderLoading())))))}})}),define("modules/clean/react/previews/audio/preview_audio_details",["external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n){var o,r,i,s,a;return s=t.formatAudioTime,r=n._,i=e.DOM,a=e.PropTypes,o=e.createClass({displayName:"PreviewAudioDetails",propTypes:{time:a.number.isRequired,duration:a.number.isRequired},_formatString:function(e){return r("%(time)s").format({time:s(e)})},_getDisplayString:function(){return i.span({className:"toolbar-details__time"},this._formatString(this.props.time)+" / "+this._formatString(this.props.duration))},render:function(){return i.div({className:"toolbar-details vertical-align"},i.div({className:"toolbar-details__string vertical-align__child"},this._getDisplayString()))}})}),define("modules/clean/react/previews/audio/preview_audio_play_button",["external/react","modules/clean/react/previews/audio/utils"],function(e,t){var n,o,r,i;return o=t.PreviewAudioHelpers,r=e.DOM,i=e.PropTypes,n=e.createClass({displayName:"PreviewAudioControls",propTypes:{isPlaying:i.bool.isRequired,onChange:i.func.isRequired},_getIconString:function(){return this.props.isPlaying?"pause":"play"},_renderButtonImage:function(){return o.getSprite(this._getIconString())},render:function(){return r.button({className:"toolbar-controller vertical-align",onClick:this.props.onChange},r.div({className:"toolbar-controller__button vertical-align__child"},this._renderButtonImage()))}})}),define("modules/clean/react/previews/audio/preview_audio_visuals",["external/classnames","external/react","external/react-dom"],function(e,t,n){var o,r,i,s;return i=t.DOM,s=t.PropTypes,o=.4,r=t.createClass({displayName:"PreviewAudioVisuals",propTypes:{generateWaveform:s.func.isRequired,time:s.number.isRequired,duration:s.number.isRequired,bufferedLength:s.number.isRequired,updateTime:s.func.isRequired,barWidth:s.number.isRequired,barSpacing:s.number.isRequired,waveformWidth:s.number.isRequired,isWaveformReady:s.bool.isRequired,isPlayerReady:s.bool.isRequired,isContainerSet:s.bool.isRequired},getInitialState:function(){return{scrubPercentage:0,isMouseDown:!1}},_getSeekPercentageFromEvent:function(e){var t,o;return t=n.findDOMNode(this.refs.waveform).getBoundingClientRect(),o=e.pageX-t.left,o/t.width},_getProgress:function(){return this.props.time/(this.props.duration||1)},_getBuffered:function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},_getWidthObject:function(e){return{width:e+"%"}},_scrubTime:function(e){var t;return t=this._getSeekPercentageFromEvent(e),this._updateWaveformScrubToPercentage(t),this.state.isMouseDown?this._updateTime(e):void 0},_resetScrub:function(){return this._updateWaveformScrubToPercentage(0),this._setMouseUp()},_updateWaveformScrubToPercentage:function(e){return this.setState({scrubPercentage:e})},_updateTime:function(e){var t,n;return n=this._getSeekPercentageFromEvent(e),t=n*this.props.duration,this.props.updateTime(t)},_setMouseDown:function(){return this.setState({isMouseDown:!0})},_setMouseUp:function(){return this.setState({isMouseDown:!1})},_getScrubObject:function(e){return{onClick:this._updateTime,onMouseMove:this._scrubTime,onMouseLeave:this._resetScrub,onMouseDown:this._setMouseDown,onMouseUp:this._setMouseUp,className:e}},_getWavebarClasses:function(t){return e({wavebar__single:!0,"wavebar__single--scrubbed":t})},_renderWaveBar:function(e,t){var n,o,r,s,a,l,c;return s=1-e,l={top:100*s+"%",height:100*e+"%"},c=this.props.waveformWidth,n=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth,this.state.scrubPercentage>0?(a=this.state.scrubPercentage*c,o=this._getWavebarClasses(a>n)):(r=this._getProgress()*c,o=this._getWavebarClasses(r>n)),[i.div({className:"wavebar__single wavebar__space"}),i.div({className:o,style:l})]},_renderWaveBars:function(){var t,n,o,r;return n=e({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady}),o=this.props.isWaveformReady?this._getScrubObject(n):{className:n},i.div(o,function(){var e,n,o,i;for(o=this.props.generateWaveform(),i=[],r=e=0,n=o.length;n>e;r=++e)t=o[r],i.push(this._renderWaveBar(t,r));return i}.call(this))},_renderWaveForm:function(){var e;return e=this.props.isWaveformReady?this._getWidthObject(100*this.state.scrubPercentage):this._getWidthObject(0),i.div({className:"waveform"},i.div({className:"waveform__scrub",style:e,ref:"waveformScrub"}),this._renderWaveBars())},_renderProgressBar:function(){var t,n,o;return o=100*this._getProgress(),t=100*this._getBuffered(),n=e({"audio-progress-bar__done":!0,"audio-progress-bar__showing":o}),i.div(this._getScrubObject("audio-progress-bar"),i.div({className:"audio-progress-bar__buffered",style:this._getWidthObject(t)}),i.div({className:n,style:this._getWidthObject(o)}))},render:function(){return i.div({className:"visuals",ref:"waveform"},this._renderWaveForm(),this._renderProgressBar())}})}),define("modules/clean/react/previews/audio/preview_audio_volume",["external/react","external/react-dom","modules/clean/react/previews/audio/utils"],function(e,t,n){var o,r,i,s;return o=n.PreviewAudioHelpers,i=e.DOM,s=e.PropTypes,r=e.createClass({displayName:"PreviewAudioVolume",propTypes:{isMuted:s.bool.isRequired,volumeLevel:s.number.isRequired,onVolumeChange:s.func.isRequired,onMuteToggle:s.func.isRequired},getInitialState:function(){return{isMouseDown:!1}},_setMouseDown:function(){return this.setState({isMouseDown:!0
})},_setMouseUp:function(){return this.setState({isMouseDown:!1})},_getVolumePercentageFromEvent:function(e){var n,o;return o=t.findDOMNode(this.refs.volumebar).getBoundingClientRect(),n=e.pageX-o.left,n/o.width},_safeChangeVolume:function(e){return this.state.isMouseDown?this._changeVolume(e):void 0},_changeVolume:function(e){var t;return t=this._getVolumePercentageFromEvent(e),this.props.onVolumeChange(t)},_getIconString:function(){return this.props.isMuted?"volumeMuted":"volume"},_renderVolumeImage:function(){var e;return e=o.getSprite(this._getIconString()),i.div({className:"toolbar-volume__button vertical-align__child"},i.button({onClick:this.props.onMuteToggle},e))},_renderVolumeBar:function(){var e,t;return t=this.props.isMuted?0:100*this.props.volumeLevel,e={width:t+"%"},i.div({className:"volume-bar vertical-align__child",onMouseUp:this._setMouseUp,onMouseDown:this._setMouseDown,onMouseLeave:this._setMouseUp,onMouseMove:this._safeChangeVolume,onClick:this._changeVolume},i.div({className:"volume-bar__container",ref:"volumebar"},i.div({className:"volume-bar__selected",style:e})))},render:function(){return i.div({className:"toolbar-volume vertical-align"},this._renderVolumeImage(),this._renderVolumeBar())}})}),define("modules/clean/react/previews/audio/utils",["external/react","external/underscore","modules/clean/average_counter","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,r,i,s){var a,l,c,u;return u=i.static_url,c=s._,a={getSprite:function(t){var n;return n=c("%(state)s").format({state:t}),e.createElement(r,{group:"web",name:t,alt:n})},getLoaderWheel:function(){return e.createElement(o,{src:u("/static/images/icons/spinner-blue-overlay-vflLgNAM7.gif"),srcHiRes:u("/static/images/icons/spinner-blue-overlay@2x-vflpi64gx.gif")})},getRadioImage:function(){return e.createElement(o,{src:u("/static/images/icons/waveformEmpty-vflZHW9X-.png"),srcHiRes:u("/static/images/icons/waveformEmpty@2x-vflZvenXO.png")})}},l={buildFromBuffer:function(e,t,o,r,i){var s,a,l;return a=e.getChannelData(0),l=new Array(t),s=function(e){return function(){var c,u,d,p,h,_;return e>=t?void i(l):(d=Math.ceil(e*a.length/t),u=Math.ceil((e+1)*a.length/t),h=u-d,p=h>o?function(){var e,t,n;for(n=[],_=e=0,t=o;t>=0?t>e:e>t;_=t>=0?++e:--e)n.push(Math.abs(a[parseInt(Math.random()*h)+d]));return n}():a.slice(d,u),c=new n,c.addArray(p),l[e]=c.getAverage(),r()?setTimeout(s(e+1),0):void 0)}},setTimeout(s(0),0)},returnWaveform:function(e,o,r){var i,s,a,l,c,u,d,p,h,_,m;if(null==r&&(r=1),_=[],0===e.length||0>=o)return _;for(l=0,p=0,s=function(){var e,t,r;for(r=[],m=e=0,t=o;t>=0?t>e:e>t;m=t>=0?++e:--e)r.push(new n);return r}(),c=u=0,d=e.length;d>u;c=++u)h=e[c],a=Math.floor(c*o/e.length),i=s[a],i.add(h),_[a]=i.getAverage(),a!==p&&(l=Math.max(l,_[p]),p=a);return l=Math.max(l,_[o-1]),t.map(_,function(e){return e*r/l})},generateRandomWaveform:function(e){var t;return function(){var n,o,r;for(r=[],t=n=0,o=e;o>=0?o>n:n>o;t=o>=0?++n:--n)r.push(Math.random());return r}()}},{PreviewAudioHelpers:a,PreviewAudioWaveformHelpers:l}}),define("modules/clean/react/previews/constants",["require","exports"],function(e,t){"use strict";function n(e){return r[e]}t.ErrorTypes={LOAD_ERROR:"LOAD_ERROR",SUPPORT_ERROR:"SUPPORT_ERROR",EXTENSION_ERROR:"EXTENSION_ERROR",NEED_FLASH_ERROR:"NEED_FLASH_ERROR",FILE_SIZE_ERROR:"FILE_SIZE_ERROR",PASSWORD_PROTECTED_ERROR:"PASSWORD_PROTECTED_ERROR",PENDING_UPLOAD_ERROR:"PENDING_UPLOAD_ERROR",EMPTY_FILE_ERROR:"EMPTY_FILE_ERROR"};var o;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NEW_FILE=1]="NEW_FILE",e[e.BEFORE_UNLOAD=2]="BEFORE_UNLOAD",e[e.UNMOUNT=3]="UNMOUNT"}(o=t.PreviewSessionEndReasons||(t.PreviewSessionEndReasons={})),t.RivieraPreviewResponseTypes={UNKNOWN:0,OK:1,CONVERSION_FAILURE:2,TEMPORARY_FAILURE:3,INTERNAL_FAILURE:4,UNSUPPORTED_FORMAT:5,TIMEOUT:6,TOO_BIG:7,INVALID_METADATA:8,SOURCE_CORRUPT:9,TIME_BUDGET_EXCEEDED:10,NOT_FOUND:11,PASSWORD_PROTECTED:12};var r=[];r[o.UNKNOWN]="unknown",r[o.NEW_FILE]="new_file",r[o.BEFORE_UNLOAD]="before_unload",r[o.UNMOUNT]="unmount",t.getSessionEndReasonLoggingKey=n}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host","modules/constants/file_viewer"],function(e,t,n,o,r){"use strict";var i=function(e){function t(){var t=this,n=r.FRAMEMESSENGER_WHITELISTED_ORIGINS,o=n.map(function(e){return"https://"+e});return o.push("null"),t=e.call(this,o)||this}return n.__extends(t,e),t}(o.FrameMessengerHost);t.PreviewFrameMessengerHost=i}),define("modules/clean/react/previews/image_helpers",["external/es6-promise","modules/clean/photos/thumbnail_url_util"],function(e,t){var n,o,r,i;return r=e.Promise,i=t.thumbnailUrlForSize,n=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]],o={IMG_SIZES_ATTR:"90vw",getSrcSet:function(e){return n.map(function(t){var n,o;return o=t[0],n=t[1],i(e,o,n,3)+(" "+o+"w")}).join(", ")},getFallbackSrc:function(e){return i(e,800,600,3)},preloadImage:function(e){return new r(function(t){return function(n,o){var r,i;return i=Date.now(),r=new Image,r.onload=function(){return n({started:i,completed:Date.now()})},r.onerror=function(){return o({started:i,failed:Date.now()})},r.srcset=t.getSrcSet(e),r.sizes=t.IMG_SIZES_ATTR,r.src=t.getFallbackSrc(e)}}(this))}}}),define("modules/clean/react/previews/preview_error",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/display_format","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/previews/util","modules/clean/react_format","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button","modules/clean/react/open_in_app/button","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/react/share_download/button","modules/clean/static_urls","modules/clean/web_timing_logger","modules/constants/file_viewer"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E){"use strict";var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(y.mark_time_to_view(),y.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===f.ErrorTypes.PENDING_UPLOAD_ERROR&&this.props.shareToken){var e=new c.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash);e.startPolling()}},Object.defineProperty(t.prototype,"isSharedFile",{get:function(){return this.props.sharedLinkInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data},enumerable:!0,configurable:!0}),t.prototype.renderActionable=function(){return this.props.areActionablesEnabled||null==this.props.areActionablesEnabled?this.isSharedFile?this.allowOpenInApp?r.createElement(_.OpenInAppButton,{urls:this.props.file.open_in_app_data}):r.createElement(g,{sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,fileOrFolder:this.props.file,justifyRight:!1,location:p.FileViewerPane.PREVIEW_CONTENT,isMaestroDesign:E.MAESTRO_ENABLED}):r.createElement(h,{file:this.props.file,user:this.props.user,justifyRight:!1,location:p.FileViewerPane.PREVIEW_CONTENT,isMaestroDesign:E.MAESTRO_ENABLED}):r.createElement("div",null)},t.prototype.renderFileInfo=function(){var e=u.PreviewHelper.get_filename(this.props.file);return this.props.errorType===f.ErrorTypes.PENDING_UPLOAD_ERROR?r.createElement("div",{className:"preview-error__info"},l.em_snippet(e,this.props.maxFilenameEmLength)):r.createElement("div",{className:"preview-error__info"},l.em_snippet(e,this.props.maxFilenameEmLength),r.createElement("span",{className:"bottom-dot"}," · "),a.format_bytes(this.props.file.bytes))},t.prototype.renderErrorInfo=function(e,t){return r.createElement("div",null,r.createElement("div",{className:"u-mar-bottom-s"},e),r.createElement("div",{className:"preview-error__message u-mar-xs"},t))},t.prototype.getBadFiletypeErrorImage=function(){return r.createElement(m,{src:v.static_url("/static/images/previews/error/filetypeNA_1x-vflfrlFzF.png"),srcHiRes:v.static_url("/static/images/previews/error/filetypeNA_2x-vflXCCBSQ.png")})},t.prototype.getTooBigErrorImage=function(){return r.createElement(m,{src:v.static_url("/static/images/previews/error/large_1x-vflkPYeXF.png"),srcHiRes:v.static_url("/static/images/previews/error/large_2x-vflueyc5P.png")})},t.prototype.getPasswordProtectedErrorImage=function(){return r.createElement(m,{src:v.static_url("/static/images/previews/error/password_1x-vflYknWoW.png"),srcHiRes:v.static_url("/static/images/previews/error/password_2x-vflJBbjf_.png")})},t.prototype.getNoPreviewErrorImage=function(){return r.createElement(m,{src:v.static_url("/static/images/previews/error/previewNA_1x-vflTFvhxk.png"),srcHiRes:v.static_url("/static/images/previews/error/previewNA_2x-vflMDSiZI.png")})},t.prototype.getPendingUploadErrorImage=function(){return r.createElement(m,{className:"icon",src:v.static_url("/static/images/previews/error/FileUploading_1x-vflSMveQj.png"),srcHiRes:v.static_url("/static/images/previews/error/FileUploading_2x-vflG2sw4y.png")})},t.prototype.getPendingUploadSyncImage=function(){return r.createElement(m,{className:"sync-image",src:v.static_url("/static/images/previews/error/fileUploading_justbadge_1x-vflmyKG2f.png"),srcHiRes:v.static_url("/static/images/previews/error/fileUploading_justbadge_2x-vfl3T4urj.png")})},t.prototype.renderAnnotationsToolbar=function(){return this.props.shouldDisplayAnnotationsToolbar?r.createElement("div",{className:"preview-toolbar-container"},r.createElement(s,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext})):void 0},t.prototype.renderError=function(){switch(this.props.errorType){case f.ErrorTypes.PENDING_UPLOAD_ERROR:var e=i._("File is uploading...");return r.createElement("div",{ref:"errorInfo"},r.createElement("div",{className:"u-mar-bottom-s"},this.getPendingUploadErrorImage(),this.getPendingUploadSyncImage()),r.createElement("div",{className:"preview-error__message u-mar-xs"},e));case f.ErrorTypes.EMPTY_FILE_ERROR:return this.renderErrorInfo(this.getNoPreviewErrorImage(),i._("Empty files can’t be previewed"));case f.ErrorTypes.EXTENSION_ERROR:var t=u.PreviewHelper.get_extension(this.props.file);if(t){var n=r.createElement("span",null,d.reactFormat(i._("<span>.%(extension)s</span> files can’t be previewed",{comment:"Like '.exe files can’t be previewed'"}),{span:r.createElement("span",{className:"preview-error__message--bold"}),extension:t}));return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n)}var n=i._("Extensionless files can’t be previewed");return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n);case f.ErrorTypes.FILE_SIZE_ERROR:return this.renderErrorInfo(this.getTooBigErrorImage(),i._("This file is too big to preview"));case f.ErrorTypes.PASSWORD_PROTECTED_ERROR:return this.renderErrorInfo(this.getPasswordProtectedErrorImage(),i._("This file is password-protected"));case f.ErrorTypes.NEED_FLASH_ERROR:return this.renderErrorInfo(this.getNoPreviewErrorImage(),d.reactFormat(i._("Install <a>Adobe Flash Player</a> to preview this video."),{a:r.createElement("a",{href:"https://get.adobe.com/flashplayer/"})}));default:return this.renderErrorInfo(this.getNoPreviewErrorImage(),i._("This file can’t be previewed"))}},t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==f.ErrorTypes.LOAD_ERROR&&this.props.errorType!==f.ErrorTypes.PENDING_UPLOAD_ERROR&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(p.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,{errorType:this.props.errorType})},t.prototype.render=function(){var e=o({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar});return r.createElement("div",{className:e},r.createElement("div",{className:"c-modal c-modal--unibody preview-error__wrapper"},r.createElement("div",{className:"c-modal__content preview-error__content"},this.renderError(),this.renderFileInfo(),this.renderActionable()),this.renderAnnotationsToolbar()))},t}(r.Component);t.PreviewError=b}),define("modules/clean/react/previews/preview_html",["external/react","external/react-dom","jquery","modules/clean/react/previews/frame_messenger_host","modules/clean/previews/preview_actions_helper","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/constants","modules/clean/react/previews/preview_toolbar_container","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S,w,T,C,I;return f=o.PreviewFrameMessengerHost,y=r.PreviewActions,b=i.PreviewHelper,m=s.EventTypes,_=s.CannedTestFilenames,g=a.FullscreenHelpers,w=l.RivieraPreviewResponseTypes,I=e.DOM,T=I.div,C=I.iframe,v="previewhtml",h=["failed","viewer-ready"],S=e.createFactory(c),E=e.createClass({displayName:"PreviewHTML",propTypes:{src:e.PropTypes.string.isRequired,previewType:e.PropTypes.string.isRequired,isFullscreen:e.PropTypes.bool.isRequired,fileExtension:e.PropTypes.string.isRequired,onError:e.PropTypes.func,filePreviewType:e.PropTypes.number,usesFrameMessenger:e.PropTypes.bool,sharePermissions:e.PropTypes.object,filePreviewSession:e.PropTypes.object,commentsActionCreators:e.PropTypes.object.isRequired},getDefaultProps:function(){return{onError:null,filePreviewType:"",usesFrameMessenger:!0,sharePermissions:null}},_getIframeProps:function(){var e;return e={name:"preview-content",type:"text/html",src:this._getIframeSrc(),sandbox:"",className:v,ref:"iframe"},this.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},_getIframeSrc:function(){var e;return e=p.parse(this.props.src),"excel"===this.props.previewType&&(d.FORCE_TEST_EXCEL_HTML?e.updateQuery({canned_file_name:_.EXCEL_HTML}):"password_protected"===d.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===d.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},_handleTrustedMessageFromChild:function(e){var t,n,o;switch(e.action){case"failed":return this._logFilePreviewEvent(m.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(m.FILE_PREVIEW_RENDER_FAILED),o=null!=(n=e.parameters)?n.rivieraStatusCode:void 0,"function"==typeof(t=this.props).onError?t.onError(b.mapRivieraStatusToErrorType(o)):void 0;case"viewer-ready":return this._markWebTiming(),this._logFilePreviewEvent(m.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(m.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(y.broadcastRenderSucceeded,0),this.props.isFullscreen?this._frameMessenger.postMessageToChildren("enter-fullscreen"):this._frameMessenger.postMessageToChildren("exit-viewer-fullscreen")}},componentDidMount:function(){var e,o;return this._logFilePreviewEvent(m.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(m.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.props.usesFrameMessenger&&(this._frameMessenger=new f,this._frameMessenger.configureChildMessaging("iframe."+v,this._handleTrustedMessageFromChild,h),this._frameMessenger.startListening(),g.setupFullscreen(this.props.isFullscreen),n(document).on("keydown",null!=(o=this.refs.previewToolbarContainer)?o.onKeydown:void 0)),e=t.findDOMNode(this.refs.iframe),e.onload=this._handleIframeLoad,e.onerror=this._handleIframeError},componentWillUnmount:function(){var e;return this.props.usesFrameMessenger&&(this._frameMessenger.stopListening(),n(document).off("keydown",null!=(e=this.refs.previewToolbarContainer)?e.onKeydown:void 0),this.props.isFullscreen)?g.teardownExitFullscreenListeners():void 0},_markWebTiming:function(){return u.mark_time_to_view(),u.mark_time_to_interactive()},_handleIframeLoad:function(){return this._logFilePreviewEvent(m.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this.props.usesFrameMessenger?void 0:(this._markWebTiming(),this._logFilePreviewEvent(m.FILE_PREVIEW_RENDER_SUCCEEDED))},_handleIframeError:function(){return this._logFilePreviewEvent(m.FILE_PREVIEW_DOWNLOAD_FAILED),this._markWebTiming()},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_renderToolbarContainer:function(){return S({ref:"previewToolbarContainer",previewToolbarProps:{actions:y,fileExtension:this.props.fileExtension,fileHref:this.props.src,filePreviewType:this.props.previewType,sharePermissions:this.props.sharePermissions},isFullscreen:this.props.isFullscreen,commentsActionCreators:this.props.commentsActionCreators})},render:function(){var e;return e=this._getIframeProps(),T({className:"preview-content"},C(e),this._renderToolbarContainer())}})}),define("modules/clean/react/previews/preview_image",["require","exports","tslib","external/classnames","external/react","jquery","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/previews/preview_actions_helper","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/constants/file_viewer"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_){"use strict";var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={imageVisible:!0},t.onImageLoad=function(){t.markWebTiming(),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED);var e=i(".preview-image-container"),n=e.find(".preview-image");t.setState({imageVisible:!0}),n.off("click").on("click",t.onFullscreen),setTimeout(l.PreviewActions.broadcastRenderSucceeded,0),null!=t.props.onLoad&&t.props.onLoad()},t.onImageError=function(){t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),t.markWebTiming(),null!=t.props.onError&&t.props.onError()},t}return n.__extends(t,e),t.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},t.prototype.logOpen=function(){s.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},t.prototype.markWebTiming=function(){h.mark_time_to_view(),h.mark_time_to_interactive()},t.prototype.onFullscreen=function(){this.props.isFullscreen?c.openFullscreen():d.PreviewImageZoom.open(this.props["preview-url"],this.props["file-extension"])},t.prototype.componentWillUnmount=function(){this.props.isFullscreen===!1&&d.PreviewImageZoom.close()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.logOpen();var e=a.getPreviewImageElement();null!=e&&e.complete&&(_.USE_IMAGE_DIMENSIONS_TO_DETECT_ERROR&&0===e.naturalWidth&&0===e.naturalHeight?this.onImageError():this.onImageLoad())},t.prototype.componentWillReceiveProps=function(e){if(this.props["preview-url"]!==e["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this.logOpen(),this.setState({imageVisible:!1})}},t.prototype.renderPreviewImage=function(){var e={"#{ImagePreviewUtil.PREVIEW_IMAGE_CONTAINER}":!0,"flex-preview-container":!0,"flex-preview-container--padded":!0,"image-visible":this.state.imageVisible};return r.createElement("div",{className:o(e)},r.createElement("div",{className:"#{ImagePreviewUtil.PREVIEW_IMAGE_WRAPPER} preview-content"},r.createElement(p.ResponsiveImage,{thumbnailUrlTmpl:this.props["preview-url"],className:"#{ImagePreviewUtil.PREVIEW_IMAGE} absolute-center",onLoad:this.onImageLoad,onError:this.onImageError})))},t.prototype.render=function(){return this.renderPreviewImage()},t}(r.Component);t.PreviewImage=m}),define("modules/clean/react/previews/preview_image_with_annotations",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/analytics","modules/clean/react/image","modules/clean/image_preview_util","modules/clean/image_annotations","modules/clean/static_urls","modules/clean/photos/thumbnail_url_util","modules/clean/previews/preview_actions_helper","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y){var E,b,S,w,T,C,I,P,A,N,O,R,k;return w=i.PreviewActivityLogger,k=c.static_url,R=u.fullSizeUrl,S=d.PreviewActions,E=h.EventTypes,C=_.PreviewImageZoom,I=f.ResponsiveImage,N=t.createElement,O=t.DOM,A=y._,P=1.25,b=16,T=t.createClass({displayName:"PreviewImageWithAnnotations",propTypes:{"preview-url":t.PropTypes.string.isRequired,"file-extension":t.PropTypes.string.isRequired,onLoad:t.PropTypes.func,onError:t.PropTypes.func,filePreviewSession:t.PropTypes.object,isFullscreen:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func,"should-display-annotations-toolbar":t.PropTypes.bool,onContextMenu:t.PropTypes.func,commentsActionCreators:t.PropTypes.object.isRequired},getDefaultProps:function(){return{onContextMenu:null}},getInitialState:function(){return this.props["should-display-annotations-toolbar"]?{imageVisible:!1,width:"",height:"",zoomPercent:0,minimumZoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1}:{imageVisible:!1}},_logFilePreviewEvent:function(e,t){return null==t&&(t=this.props.filePreviewSession),null!=t?t.recordEvent(e):void 0},_logOpen:function(){return w.log("open",{file_ext:this.props["file-extension"]})},_onImageLoad:function(){var e;return g.mark_time_to_view(),g.mark_time_to_interactive(),this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(E.FILE_PREVIEW_RENDER_SUCCEEDED),this.setState({imageVisible:!0,shouldLoadFullSizeImage:!0}),setTimeout(S.broadcastRenderSucceeded,0),this.imageAnnotations.onImageLoad(this.onResizeImage),"function"==typeof(e=this.props).onLoad?e.onLoad():void 0},_onImageClick:function(){return this._shouldDisableZoom()?void 0:this._openFullscreen()},_openFullscreen:function(){var e;return e={file_ext:this.props["file-extension"]},null!=this.props.isFullscreen?p.openFullscreen(e):C.open(this.props["preview-url"],this.props["file-extension"],this.props.onContextMenu)},_onImageError:function(){return this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_FAILED),null!=this.props.onError?this.props.onError():void 0},_shouldDisableZoom:function(){return this.props["should-display-annotations-toolbar"]},_getImageDOMNode:function(){return this.state.shouldDisplayFullSizeImage?n.findDOMNode(this.refs.previewImageFullSize):n.findDOMNode(this.refs.previewImage)},_onFullSizeLoad:function(){var e;return e=this._calculateZoomPercent(this._getImageDOMNode().height),this.setState({zoomPercent:e,minimumZoomPercent:e})},onResizeImage:function(){var e;return""===this.state.width&&""===this.state.height?(e=this._calculateZoomPercent(this._getImageDOMNode().height),this.setState({zoomPercent:e,minimumZoomPercent:e})):void 0},_onZoom:function(e,t){var o,r,i,s,l,c,u,d,p,h,_,m,f,g,v,y,E;if(e+"px"!==this.state.width)return E=this._calculateZoomPercent(t),E<this.state.minimumZoomPercent?void this._onZoomFit():E>b?(i=b*(null!=(_=n.findDOMNode(this.refs.previewImageFullSize))?_.naturalWidth:void 0),r=b*(null!=(m=n.findDOMNode(this.refs.previewImageFullSize))?m.naturalHeight:void 0),void this._onZoom(i,r)):(p=this._getImageDOMNode().width,h=e/p,o=a.getPreviewImageWrapper(),u=o.scrollLeft(),d=o.scrollTop(),g=o.width(),f=o.height(),l=g*(h-1)/2+u*h,c=f*(h-1)/2+d*h,y=t>=f?"0":"auto",v=e>=g?"0":"auto",s=y+" "+v,this.setState({shouldDisplayFullSizeImage:null!=this.refs.previewImageFullSize,width:e+"px",height:t+"px",margin:s,zoomPercent:E,zoomFit:!1},function(){var e;return o.scrollLeft(l),o.scrollTop(c),this.imageAnnotations.onResize(e=!1)}))},_onZoomIn:function(){var e,t;return t=this._getImageDOMNode().width*P,e=this._getImageDOMNode().height*P,this._onZoom(t,e)},_onZoomOut:function(){var e,t;return t=this._getImageDOMNode().width/P,e=this._getImageDOMNode().height/P,this._onZoom(t,e)},_onZoomOriginalOrFit:function(){return 1===this.state.zoomPercent?this._onZoomFit():this._onZoomOriginal()},_onZoomOriginal:function(){var e,t,o,r;return t=null!=(o=n.findDOMNode(this.refs.previewImageFullSize))?o.naturalWidth:void 0,e=null!=(r=n.findDOMNode(this.refs.previewImageFullSize))?r.naturalHeight:void 0,this._onZoom(t,e)},_onZoomFit:function(){return""!==this.state.width?this.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){var e,t;return this.imageAnnotations.onResize(e=!1),t=this._calculateZoomPercent(this._getImageDOMNode().height),this.setState({zoomPercent:t,minimumZoomPercent:t})}):void 0},_calculateZoomPercent:function(e){var t,o;if(null!=this.refs.previewImageFullSize)return t=n.findDOMNode(this.refs.previewImageFullSize).naturalHeight,e&&t?o=e/t:void 0},componentWillUnmount:function(){var e;return null==this.props.isFullscreen&&C.close(),null!=(e=this.imageAnnotations)?e.reset():void 0},componentWillMount:function(){return this.imageAnnotations=new l},componentDidMount:function(){var e;return this._logFilePreviewEvent(E.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this._logOpen(),e=this._getImageDOMNode(),(null!=e?e.complete:void 0)?v.USE_IMAGE_DIMENSIONS_TO_DETECT_ERROR&&0===e.naturalWidth&&0===e.naturalHeight?this._onImageError():this._onImageLoad():void 0},componentWillReceiveProps:function(e){var t;return e["preview-url"]!==this.props["preview-url"]&&(t=e.filePreviewSession,this._logFilePreviewEvent(E.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this._logOpen(),this.setState({imageVisible:!1}),this.props["should-display-annotations-toolbar"])?(this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1})):void 0},_renderToolbarContainer:function(){return N(m,{previewToolbarProps:{index:this.props.index,count:this.props.count,zoomPercent:this.state.zoomPercent,minimumZoomPercent:this.state.minimumZoomPercent,maximumZoomPercent:b,onPrevious:this.props.onPrevious,onNext:this.props.onNext,onFullscreen:this._openFullscreen,onZoomIn:this._onZoomIn,onZoomOut:this._onZoomOut,onZoomOriginalOrFit:this._onZoomOriginalOrFit},isFullscreen:this.props.isFullscreen,shouldUseImageToolbar:!0,commentsActionCreators:this.props.commentsActionCreators})},_renderPreviewImage:function(){var t,n,r,i,l,c;return r={},r[""+a.PREVIEW_IMAGE_CONTAINER]=!0,r["flex-preview-container"]=!0,r["image-visible"]=this.state.imageVisible,r["annotations-visible"]=!0,r["zoom-disabled"]=this._shouldDisableZoom(),r["has-annotations-toolbar"]=this.props["should-display-annotations-toolbar"],r["zoom-fit"]=this.state.zoomFit,l=r,c=this.state.width&&this.state.height&&this.props["should-display-annotations-toolbar"]?{maxWidth:this.state.width,maxHeight:this.state.height,width:this.state.width,height:this.state.height,margin:this.state.margin}:{},i={},i[""+a.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage,i["absolute-center"]=!0,t=i,n=o.extend({},c),this.state.shouldDisplayFullSizeImage||(n=o.extend(n,{visibility:"hidden"})),O.div({className:e(l)},O.div({className:a.PREVIEW_IMAGE_WRAPPER+" preview-content"},this.state.imageVisible?void 0:O.div({className:"loading-icon-container"},N(s,{className:"loading-icon",src:k("/static/images/icons/fileviewer-loading-vflHF9-Ot.gif"),srcHiRes:k("/static/images/icons/fileviewer-loading@2x-vflW5elqb.gif"),alt:A("Loading")})),this.state.shouldLoadFullSizeImage?O.img({ref:"previewImageFullSize",src:R(this.props["preview-url"]),className:e(t),style:n,onLoad:this._onFullSizeLoad,onClick:this._onImageClick}):void 0,this.state.shouldDisplayFullSizeImage?void 0:N(I,{ref:"previewImage",thumbnailUrlTmpl:this.props["preview-url"],className:a.PREVIEW_IMAGE+" absolute-center",style:c,onLoad:this._onImageLoad,onError:this._onImageError,onClick:this._onImageClick,onContextMenu:this.props.onContextMenu})),this.props["should-display-annotations-toolbar"]?this._renderToolbarContainer():void 0)},render:function(){return this._renderPreviewImage()}}),{PreviewImageWithAnnotations:T}}),define("modules/clean/react/previews/preview_image_zoom",["external/jquery.mousewheel","external/jquery.fs.zoomer","external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/photos/thumbnail_url_util","modules/clean/previews/preview_actions_helper","modules/clean/react/image","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/responsive_image","modules/clean/static_urls","modules/core/browser","modules/core/dom","modules/core/exception","modules/core/uri","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b){var S,w,T,C,I,P,A,N,O,R,k,D;return k=a.fullSizeUrl,T=l.PreviewActions,w=d.EventTypes,O=h.compareStateAndProps,P=m.ResponsiveImage,D=f.static_url,N=o.createElement,R=o.DOM,A=b._,I=o.createFactory(_),S="preview-image-zoomzoom-wrapper",C=o.createClass({statics:{open:function(e,t,n){var i,a,l;return l=s("<div />",{id:S}),s(document.body).append(l),a=o.createElement(C,{thumbnailUrlTmpl:e,fileExtension:t,isFlippable:!1,onContextMenu:n}),i={file_ext:t},r.render(a,l.get(0))},close:function(){var e;return e=document.getElementById(S),e?r.unmountComponentAtNode(e):void 0},SETUP_IMAGE_WAIT_TIME:100},displayName:"PreviewImageZoom",propTypes:{thumbnailUrlTmpl:o.PropTypes.string,fileExtension:o.PropTypes.string,isFlippable:o.PropTypes.bool,filePreviewSession:o.PropTypes.object,onContextMenu:o.PropTypes.func},getDefaultProps:function(){return{onContextMenu:null}},getInitialState:function(){return{loadedFullResolutionImageUrl:null,zoomOutDisabled:!0,zoomInDisabled:!1,dragDisabled:!0}},componentDidMount:function(){return this._logFilePreviewEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this._delayedSetupImage(this.props.thumbnailUrlTmpl)},componentWillReceiveProps:function(e){return e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl?(this._logFilePreviewEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.setState({loadedFullResolutionImageUrl:null}),this._destroyZoomer(),this._delayedSetupImage(e.thumbnailUrlTmpl)):void 0},componentWillUnmount:function(){return this._destroyZoomer(),s(window).off("resize.zommer")},shouldComponentUpdate:O,_delayedSetupImage:function(e){return setTimeout(function(t){return function(){return t.isMounted()&&t.props.thumbnailUrlTmpl===e?t._setupImage(e):void 0}}(this),C.SETUP_IMAGE_WAIT_TIME)},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_setupImage:function(e){return this.fullResolutionImage=new window.Image,this.fullResolutionImage.onload=function(t){return function(){return t.props.thumbnailUrlTmpl===e?t._onFullResolutionImageLoaded():void 0}}(this),this.fullResolutionImage.onerror=this._onFullResolutionImageError,this.fullResolutionImage.src=k(e)},_onFullResolutionImageLoaded:function(){return this.isMounted()?(this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(w.FILE_PREVIEW_RENDER_SUCCEEDED),
this.setState({loadedFullResolutionImageUrl:this.fullResolutionImage.src},this._bindZoomer),setTimeout(T.broadcastRenderSucceeded,0)):void 0},_onFullResolutionImageError:function(){return this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_FAILED),y.assert("Error loading full resoltuion image in zoom view")},_bindZoomer:function(){var e,t;if(null!=this.state.loadedFullResolutionImageUrl)return t=s(".preview-zoom").width(),e=this._getPreviewZoomerElement(),window.zoomer(e,{controls:{zoomIn:s(r.findDOMNode(this.refs.previewZoomContainer.refs.zoomControlZoomIn)),zoomOut:s(r.findDOMNode(this.refs.previewZoomContainer.refs.zoomControlZoomOut)),zoomLabel:s(r.findDOMNode(this.refs.previewZoomContainer.refs.zoomLabel)),zoomLabelContainer:s(r.findDOMNode(this.refs.previewZoomContainer.refs.zoomLabelContainer))},customClass:"preview-zoomer-style",retina:!1,onZoomCallback:this._onZoomCallback,startWidth:t,onContextMenu:this.props.onContextMenu}),null==this.fitToZoom&&(this.fitToZoom=this._getZoomPercent()),s(window).off("resize.zoomer").on("resize.zoomer",function(t){return function(){return zoomer(e,"resize"),t.fitToZoom=t._getZoomPercent()}}(this)),e.off("mousewheel.zoom").on("mousewheel.zoom",function(e){return function(t,n){return t.preventDefault(),e._zoomScroll(n*t.deltaFactor)}}(this))},_destroyZoomer:function(){return window.zoomer(this._getPreviewZoomerElement(),"destroy")},_onZoomCallback:function(e){return this.setState({zoomOutDisabled:e.atMinZoom,zoomInDisabled:e.atMaxZoom,dragDisabled:e.atMinZoom})},_getPreviewZoomerElement:function(){return s(".preview-zoomer")},_getZoomPercent:function(){return parseFloat(s(r.findDOMNode(this.refs.previewZoomContainer.refs.zoomLabel)).text())},_zoomToFit:function(){return s(r.findDOMNode(this.refs.previewZoomContainer.refs.zoomControlZoomOut)).trigger("zoomout")},_zoom100:function(e,t){return zoomer(this._getPreviewZoomerElement(),"zoom100",e,t)},_zoomScroll:function(e){return zoomer(this._getPreviewZoomerElement(),"zoomScroll",e)},_unmount:function(){var e;return this.props.isFlippable?u.closeFullscreen():(e=r.findDOMNode(this).parentNode,r.unmountComponentAtNode(e),s(e).remove())},_onImageDoubleClick:function(e){var t;return s(e.target).hasClass("zoomer")?void 0:this._getZoomPercent()<100?(t=e.target.getBoundingClientRect(),this._zoom100(e.pageX-t.left,e.pageY-t.top)):this._zoomToFit()},_renderImage:function(){return R.div({ref:"previewZoomer",className:"preview-zoomer",style:{textAlign:"center"},onDoubleClick:null!=this.state.loadedFullResolutionImageUrl?this._onImageDoubleClick:void 0},null!=this.state.loadedFullResolutionImageUrl?R.img({className:"preview-zoom",src:this.state.loadedFullResolutionImageUrl,style:{maxHeight:s(".preview-zoom").height(),maxWidth:s(".preview-zoom").width()},onContextMenu:this.props.onContextMenu}):N(P,{thumbnailUrlTmpl:this.props.thumbnailUrlTmpl,className:"preview-zoom",onContextMenu:this.props.onContextMenu}))},_renderLoading:function(){return R.div({className:"preview-zoomer-loading"},o.createElement(c,{alt:A("Loading..."),src:D("/static/images/icons/white-on-dark-spinner-vflInam4o.gif"),srcHiRes:D("/static/images/icons/white-on-dark-spinner@2x-vfltkzAUn.gif")}))},render:function(){var e;return e=null!=this.state.loadedFullResolutionImageUrl?"zoomer-image":null!=g.mozilla?"preview-zoomer-loading":"preview-zoom",I({isFlippable:this.props.isFlippable||!1,renderZoomControls:null!=this.state.loadedFullResolutionImageUrl,onClose:this._unmount,containerClass:e,zoomOutCallback:this._zoomToFit,zoomInDisabled:this.state.zoomInDisabled,zoomOutDisabled:this.state.zoomOutDisabled,dragDisabled:this.state.dragDisabled,ref:"previewZoomContainer"},null!=g.mozilla&&null==this.state.loadedFullResolutionImageUrl?this._renderLoading():this._renderImage())}}),{PreviewImageZoom:C}}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","external/react","modules/clean/analytics","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/preview_actions_helper","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_){"use strict";var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logEvent("requestlinkdata",!0),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},s.SilentBackgroundRequest(n)):s.Request(n)},t.handleLinkDataSuccess=function(e){return null==e.uri?void t.handleLinkDataError():(t.logEvent("displaylinkdata",!0,e.uri),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),void setTimeout(c.PreviewActions.broadcastRenderSucceeded,0))},t.handleLinkDataError=function(){t.logEvent("displaylinkerror",!1),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),t.markWebTiming(),t.state.isMounted&&t.setState({description:h._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){t.logEvent("navlink",!0,t.state.link);var n=d.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logEvent=function(e,t,n,o){void 0===o&&(o={});var r=null;null!=n&&(r=_.parse(n).getAuthority()),i.LinkfileActivityLogger.log(e,l.file_extension(this.props.filename),r,t,this.props.source,o)},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){p.mark_time_to_view(),p.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1,this.logEvent("destroy",!0,this.state.link)},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},i="-",s="";null!=this.props.filename&&(i=l.filename_without_extension(this.props.filename),s=l.file_extension(this.props.filename),""!==s&&(s="."+s));var c=t.MAX_DISPLAYED_FILENAME_CHARS-s.length,u=a.em_snippet(i,c),d="-";null!=this.state.description&&(d=this.state.description);var p={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError};return r.createElement("div",{className:"flex-preview-container"},r.createElement("div",{className:"preview-content preview-content--center"},r.createElement("div",{className:"preview-linkfile-box"},r.createElement("div",{className:o(e)},r.createElement("div",{className:"preview-linkfile-icon"},r.createElement("img",{src:"/static/images/icons128/page_white_linkfile-vfloEntlU.png",alt:""})),r.createElement("div",{className:"preview-linkfile-title"},r.createElement("span",{className:"preview-linkfile-filebase"},u),r.createElement("span",{className:"preview-linkfile-fileext"},s)),r.createElement("div",{className:"preview-linkfile-info"},r.createElement("div",{className:o(p)},d),r.createElement("button",{className:o(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},h._("Open in new tab")))))))},t}(r.Component);m.SPINNER_FADE_DELAY_MSEC=150,m.MAX_DISPLAYED_FILENAME_CHARS=21,t.PreviewLinkfile=m}),define("modules/clean/react/previews/preview_pdf",["require","exports","tslib","external/react","jquery","modules/constants/legacy","modules/constants/file_viewer","modules/core/uri","modules/core/i18n","modules/clean/previews/pdf_loader","modules/clean/previews/preview_actions_helper","modules/clean/previews/preview_status_watcher","modules/clean/react/previews/preview_toolbar_container","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g){"use strict";var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={keydownRegistered:!1,numThumbnails:t.getInitialNumThumbnails(),loading:!0,thumbnailPage:-1,pagesRendered:[]},t.didFinishStatusCheck=function(){t.setState({loading:!1})},t.failedStatusCheck=function(){null!=t.props.onError&&t.props.onError()},t.exitFullscreenCallback=function(){m.FullscreenHelpers.setBrowserFullscreen(!1),u.PreviewActions.exitFullscreen()},t.onDownloadAttempted=function(){t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},t.onDownloadFailed=function(e){t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED);var n;null!=e&&(n=e.rivieraStatus),null!=t.props.onError&&t.props.onError(h.PreviewHelper.mapRivieraStatusToErrorType(n))},t.onDownloadSucceeded=function(e){null!=t.props.filePreviewSession&&(t.props.filePreviewSession.previewSize=e.size,t.props.filePreviewSession.pageCount=e.pageCount,t.props.filePreviewSession.isLinearized=e.isLinearized),t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},t.onRenderFailed=function(){t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_RENDER_FAILED),null!=t.props.onError&&t.props.onError(),g.mark_time_to_view(),g.mark_time_to_interactive()},t.onFirstRenderSucceeded=function(e){null!=t.props.filePreviewSession&&null!=e&&(t.props.filePreviewSession.firstPageRendered=e.pageRendered),g.mark_time_to_view(),g.mark_time_to_interactive(),t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(u.PreviewActions.broadcastRenderSucceeded,0),t.pdfLoader.repositionFile(t.getThumbnailScrollPosition())},t.onPageRendered=function(e){var n=e.page,o=e.pagesRendered,r=Date.now();null==t.props.filePreviewSession||t.props.filePreviewSession.pagesRendered[n]||(t.props.filePreviewSession.pagesRendered[n]=r),null!=e.pageWidths&&null!=t.props.filePreviewSession&&(t.props.filePreviewSession.pageWidths=e.pageWidths.slice(0,5)),o&&t.setState({pagesRendered:o}),t.hideThumbnailsIfPageRendered()},t.onPasswordNeeded=function(){t.hideThumbnails(),g.mark_time_to_view(),g.mark_time_to_interactive(),t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},t.onPageRepositioned=function(e){var n=e.page;t.setState({thumbnailPage:n}),t.hideThumbnailsIfPageRendered()},t.hideThumbnails=function(){t.setState({numThumbnails:0})},t.setThumbnailDOM=function(e,n){t.imageDOMElements=t.imageDOMElements||[],t.imageDOMElements[e]=n},t}return n.__extends(t,e),t.prototype.getInitialNumThumbnails=function(){var e=s.SHARED_LINK_PDF_PERF;if(!e)return 0;if(-1===e.indexOf("THUMBNAIL"))return 0;var t=h.extractLastNumberFromVariant(e);return null!=t?t:1},t.prototype.componentDidMount=function(){var e=h.PreviewHelper.extCanGeneratePreview(this.props.fileExtension)===!1;e&&this.props.previewStatus===i.DOC_PREVIEW_IN_PROGRESS&&null!=this.props.userId&&null!=this.props.fqPath&&(this.statusWatcher=new d,this.statusWatcher.start(this.props.userId,this.props.fqPath,this.didFinishStatusCheck,this.failedStatusCheck)),this.setUpPdfLoader(),this.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.loadPdf(),m.FullscreenHelpers.setupFullscreen(this.props.isFullscreen);var t=this.toolbarContainerRef.onKeydown;!this.state.keydownRegistered&&t&&(r(document).on("keydown",t),this.setState({keydownRegistered:!0}));for(var n=this.imageDOMElements||[],o=0;o<n.length;++o){var s=n[o];null!=s&&s.complete&&0===s.naturalWidth&&0===s.naturalHeight&&this.onThumbnailError(o)}},t.prototype.componentDidUpdate=function(){this.state.loading||this.state.keydownRegistered||(r(document).on("keydown",this.toolbarContainerRef.onKeydown),this.setState({keydownRegistered:!0})),this.loadPdf()},t.prototype.componentWillUnmount=function(){null!=this.pdfLoader&&this.pdfLoader.stopListening(),null!=this.statusWatcher&&this.statusWatcher.stop(),this.props.isFullscreen&&m.FullscreenHelpers.teardownExitFullscreenListeners(),r(document).off("keydown",this.toolbarContainerRef.onKeydown)},t.prototype.setUpPdfLoader=function(){this.pdfLoader=new c,this.pdfLoader.setIsFullscreen(this.props.isFullscreen),this.pdfLoader.setExitFullscreenCallback(this.exitFullscreenCallback),this.pdfLoader.setOnDownloadAttempted(this.onDownloadAttempted),this.pdfLoader.setOnDownloadFailed(this.onDownloadFailed),this.pdfLoader.setOnDownloadSucceeded(this.onDownloadSucceeded),this.pdfLoader.setOnRenderFailed(this.onRenderFailed),this.pdfLoader.setOnFirstRenderSucceeded(this.onFirstRenderSucceeded),this.pdfLoader.setOnPageRendered(this.onPageRendered),this.pdfLoader.setOnPageRepositioned(this.onPageRepositioned),this.pdfLoader.setOnPasswordNeeded(this.onPasswordNeeded),this.pdfLoader.startListening()},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.onThumbnailError=function(e){this.setState({numThumbnails:Math.min(e,this.state.numThumbnails)})},t.prototype.hideThumbnailsIfPageRendered=function(){-1!==this.state.pagesRendered.indexOf(this.state.thumbnailPage)&&this.hideThumbnails()},t.prototype.generatePreviewUrl=function(){return h.PreviewHelper.get_progressive_url(this.getNormaliedExtension(),this.props.src)},t.prototype.getIframeUrl=function(){var e=h.PreviewHelper.get_pdf_js_url(this.getPreviewUrl(),this.getNormaliedExtension());return e=h.PreviewHelper.update_url_with_user_id(e,this.props.userId),e=h.PreviewHelper.update_url_for_annotation(e),e.toString()},t.prototype.getPreviewUrl=function(){return this.props.previewUrl?this.props.previewUrl:this.generatePreviewUrl()},t.prototype.getNormaliedExtension=function(){return h.PreviewHelper.normalize_extension(this.props.fileExtension)},t.prototype.getThumbnailScrollPosition=function(){return null!=this.thumbnailRef&&"none"!==this.thumbnailRef.style.display?this.thumbnailRef.scrollTop:null},t.prototype.loadPdf=function(){this.pdfLoader.openFile(this.getPreviewUrl(),{presentationMode:"ppt"===this.getNormaliedExtension()})},t.prototype.renderPreview=function(){return o.createElement("iframe",{key:"RenderPreviewIFrame",name:"preview-content",type:"application/pdf",className:"pdfjs",id:"pdf-embed-iframe",src:this.getIframeUrl()})},t.prototype.renderLoadingIndicator=function(){return this.state.numThumbnails>0&&this.props.thumbnailUrl?o.createElement("div",{className:"loading-indicator",key:"LoadingIndicator"},o.createElement("div",{className:"loading-indicator__content"},l._("Loading..."))):void 0},t.prototype.renderThumbnails=function(){var e=this;if(this.state.numThumbnails>0&&this.props.thumbnailUrl){for(var t=[],n=a.parse(this.props.thumbnailUrl),r=0;r<this.state.numThumbnails;++r){var i=this.props.thumbnailUrl;r>0&&(n.updateQuery({page:String(r)}),i=n.toString()),t.push(o.createElement("div",{className:"thumbnail__image-wrapper"},o.createElement(f.ResponsiveImage,{key:r,refCallback:this.setThumbnailDOM.bind(this,r),thumbnailUrlTmpl:i,className:"thumbnail__image",onError:this.onThumbnailError.bind(this,r)})))}return o.createElement("div",{className:"thumbnail",key:"Thumbnail",ref:function(t){return e.thumbnailRef=t}},t)}},t.prototype.renderToolbarContainer=function(){var e=this,t={actions:u.PreviewActions,afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileBlockServerUrl:this.props.src,fileHref:this.props.fileHref,filePreviewType:this.props.previewType,isSharedLink:this.props.isSharedLink,sharePermissions:this.props.sharePermissions};return o.createElement(p,{key:"PreviewToolbarContainer",ref:function(t){return e.toolbarContainerRef=t},previewToolbarProps:t,isFullscreen:this.props.isFullscreen,commentsActionCreators:this.props.commentsActionCreators})},t.prototype.render=function(){return o.createElement("div",{className:"preview-content preview-pdf"},this.renderThumbnails(),this.renderLoadingIndicator(),this.renderToolbarContainer(),this.renderPreview())},t}(o.Component);t.PreviewPDF=v});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/previews/preview_toolbar",["external/keymaster","external/react","jquery","modules/clean/analytics","modules/clean/react/previews/frame_messenger_host","modules/clean/keycode","modules/clean/previews/file_view_rams_common","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/sprite","modules/core/dom","modules/core/exception","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){var _,m,f,g,v,y,E,b,S,assert,w,T;return g=o.PreviewActivityLogger,_=r.PreviewFrameMessengerHost,b=l.UserActionNames,E=l.UserActionContextNames,m=c.FullscreenHelpers,assert=p.assert,w=t.createElement,T=t.DOM,S=h._,v={DEFAULT:"default",SPP:"spp",SPREADSHEET:"spreadsheet",HTML:"html"},f={},f[i.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.PAGE_UP]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},f[70]={altKey:!1,ctrlKey:!0,metaKey:!0},f[80]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},f[i.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},y=t.createClass({displayName:"PreviewToolbar",propTypes:{actions:t.PropTypes.object.isRequired,fileExtension:t.PropTypes.string.isRequired,isSharedLink:t.PropTypes.bool,fileBlockServerUrl:t.PropTypes.string,fileHref:t.PropTypes.string,filePreviewType:t.PropTypes.string,afterFileViewerExit:t.PropTypes.func,isHidden:t.PropTypes.bool,shouldDisplayRegionCreationButton:t.PropTypes.bool,onRegionCreationClick:t.PropTypes.func,sharePermissions:t.PropTypes.object},_TOOLBAR_ENTRY_CLASSES:{PAGE_INDICATOR:"page-indicator",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",FULLSCREEN:"fullscreen",PRINT:"print",ENABLE_REGION_CREATION:"enable-region-creation"},_ELEMENT_CONFIGURATIONS:{default:["page-indicator","zoom-in","zoom-out","page-up","page-down","fullscreen","print","enable-region-creation"],spp:["page-indicator","page-up","page-down","fullscreen","print","enable-region-creation"],spreadsheet:["zoom-in","zoom-out","fullscreen","print"],html:["fullscreen","print"]},_PARENT_TO_IFRAME_ACTIONS:{ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_VIEWER_FULLSCREEN:"exit-viewer-fullscreen",PRINT:"print",CLEAR_MOUSE_TRACKING:"clear-mouse-tracking",SCROLL_DOWN:"scroll-down",SCROLL_UP:"scroll-up",SCROLL_LEFT:"scroll-left",SCROLL_RIGHT:"scroll-right",SCREEN_DOWN:"screen-down",SCREEN_UP:"screen-up",ENABLE_REGION_CREATION:"enable-region-creation"},_FADE_TIME_MSEC:400,_IDLE_TIME_MSEC:1500,_trustedIframeDomain:null,_fadeTimeout:null,_fullscreeningTimeout:null,_idleTimeout:null,_previewOpen:!1,_frameMessenger:null,getInitialState:function(){var e;return e={pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:v.DEFAULT,sharePermissions:null}},_reset:function(){return this._clearAllTimeouts(),this.setState({pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:v.DEFAULT})},_setFullscreen:function(e,t){var n,o;return this._logUserAction(e?b.TOGGLE_FULLSCREEN_ON:b.TOGGLE_FULLSCREEN_OFF,t.context),(o=e?this.props.actions.enterFullscreen():this.props.actions.exitFullscreen())?(this._clearFullscreeningTimeout(),e?this.fadeOut():(this.fadeIn(),this._startIdleTimeout()),this.setState({fullscreening:!0}),this._startFullscreeningTimeout(),m.setBrowserFullscreen(e),n=e?this._PARENT_TO_IFRAME_ACTIONS.ENTER_FULLSCREEN:this._PARENT_TO_IFRAME_ACTIONS.EXIT_VIEWER_FULLSCREEN,this._frameMessenger.postMessageToChildren(n)):void 0},_isViewerFullscreen:function(){return this.props.actions.isFullscreen()},_isBrowserFullscreen:function(){return null!=document.fullScreen?document.fullScreen:null!=document.webkitIsFullScreen?document.webkitIsFullScreen:null!=document.mozFullScreen?document.mozFullScreen:null!=document.msFullscreenElement||null!=document.fullscreenElement},_handleClick:function(e){var t,o,r,i,s,a,l;for(s={input_method:"click",file_ext:this.props.fileExtension},l={context:E.TOOLBAR},t=n(e.currentTarget),a=this.state.disabledClasses,r=0,i=a.length;i>r;r++)if(o=a[r],t.hasClass(o))return;return t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN)?this._zoomIn(l):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT)?this._zoomOut(l):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP)?this._pageUp(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN)?this._pageDown(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN)?this._toggleFullscreen(l):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PRINT)?this._printDocument(l):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ENABLE_REGION_CREATION)&&this._onRegionCreationClick(s),this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING)},_postKeysHandledByParent:function(){return this._frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:f})},_handleMessageFromChild:function(e){var t,n,o,r,i,s,a,l,c;switch(o={input_method:"child-message",file_ext:this.props.fileExtension},c={context:E.UNKNOWN},i=e.parameters,e.action){case"page-change":case"pagerendered":if(l=this._isToolbarReadyToShow(),t=this._sanitizePageNumber(i.current_page||i.attributes.page),r=this._sanitizePageNumber(i.pages_count||i.attributes.pages),0>=t||0>=r)return;if(null!=i.doc_type&&this.setState({docType:i.doc_type}),n=[],1>=t&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP),t>=r&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN),0===(null!=(s=this.props.sharePermissions)&&null!=(a=s.canPrintRoles)?a.length:void 0)&&n.push(this._TOOLBAR_ENTRY_CLASSES.PRINT),this.setState({currentPage:t,pagesCount:r,disabledClasses:n}),!l&&this._isToolbarReadyToShow())return this.fadeIn(),this._startIdleTimeout();break;case"idle-mouse":return this.fadeOut(),g.log("idle-mouse",o);case"active-mouse":return this.fadeIn();case"exit-parent-fullscreen":return this._setFullscreen(!1,c);case"keydown":if(null!=i)return this.onKeydown(i);break;case"get-keydown-keys-handled-by-parent":return this._postKeysHandledByParent()}},onPreviewOpen:function(){return this._previewOpen?!0:(n(document).on("keydown",this.onKeydown),n(document).on("fullscreenchange",this.onBrowserFullscreenChange),n(document).on("webkitfullscreenchange",this.onBrowserFullscreenChange),n(document).on("msfullscreenchange",this.onBrowserFullscreenChange),n(document).on("mozfullscreenchange",this.onBrowserFullscreenChange),this._previewOpen=!0,!0)},onPreviewClose:function(){return this._previewOpen?(n(document).off("keydown",this.onKeydown),n(document).off("fullscreenchange",this.onBrowserFullscreenChange),n(document).off("webkitfullscreenchange",this.onBrowserFullscreenChange),n(document).off("msfullscreenchange",this.onBrowserFullscreenChange),n(document).off("mozfullscreenchange",this.onBrowserFullscreenChange),this._reset(),this._frameMessenger.resetOriginsForPosting(),this._previewOpen=!1,!0):!0},componentDidMount:function(){return this._frameMessenger=new _,this._frameMessenger.configureChildMessaging(this.props.actions.getIframeQuery(),n.proxy(this._handleMessageFromChild,this),["page-change","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent","pagerendered"]),this._frameMessenger.startListening(),this._postKeysHandledByParent()},componentWillUnmount:function(){return this._clearAllTimeouts(),this._frameMessenger.stopListening()},renderPageIndicatorText:function(){var e;return this.state.currentPage<1||this.state.pagesCount<1?"":(e=S(this.state.docType===v.SPP?"Slide %(current_page)s of %(pages_count)s":"Page %(current_page)s of %(pages_count)s"),e.format({current_page:this.state.currentPage,pages_count:this.state.pagesCount}))},_renderToolbarButton:function(e,t,n,o){var r,i;return indexOf.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],e)<0?T.span({style:{display:"none"}}):(r=e+" toolbar-button-entry",i=indexOf.call(this.state.disabledClasses,e)>=0,T.div({className:r,onMouseUp:this._handleClick},T.div({className:"toolbar-tooltip"},T.div({className:"toolbar-tooltip-container"},T.div({className:"toolbar-tooltip-pointer-border"})),T.div({className:"toolbar-tooltip-container"},T.div({className:"toolbar-tooltip-body"},o)),T.div({className:"toolbar-tooltip-container"},T.div({className:"toolbar-tooltip-pointer"}))),w(u,{group:t,name:n,className:i?"disabled":"",alt:o})))},_renderPageIndicator:function(){var e;return e=this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR,indexOf.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],e)>=0?T.div({className:this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR},this.renderPageIndicatorText()):void 0},render:function(){var e,t,n,o,r,i,s,a,l;return e="preview-toolbar-overlay-container ",this.state.visible&&!this.props.isHidden||(e+="hide "),this.state.fadingOut&&(e+="fadeout "),t={className:e},i=S(this.state.docType===v.SPP?"Previous slide":"Page up"),o=S(this.state.docType===v.SPP?"Next slide":"Page down"),r=this.state.docType===v.SPP?"left":"up",n=this.state.docType===v.SPP?"right":"down",s=S(0===(null!=(a=this.props.sharePermissions)&&null!=(l=a.canPrintRoles)?l.length:void 0)?"Printing is turned off for this file.":"Print"),T.div(t,T.div({className:"preview-toolbar-overlay",onMouseEnter:this.onMouseEnterToolbar},T.div({className:"preview-toolbar-content"},this._renderPageIndicator(),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT,"web","zoomout",S("Zoom out")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN,"web","zoom",S("Zoom in")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP,"web",r,i),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN,"web",n,o),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN,"web","fullscreen",S("Fullscreen")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PRINT,"web","print",s),this.props.shouldDisplayRegionCreationButton?this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ENABLE_REGION_CREATION,"web","ic_comment_area_large",S("Comment on specific areas")):void 0)))},_sanitizePageNumber:function(e){var t;return null==e?0:(t=parseInt(e),isNaN(t)?0:t)},_getOriginFromUrl:function(e){var t;return t=document.createElement("a"),t.href=e,"https://"+t.hostname},fadeOut:function(){return this.state.fadingOut||this._clearFadeTimeout(),this.setState({fadingOut:!0,tooltipClass:null}),this._startFadeTimeout()},fadeIn:function(){return this._clearIdleTimeout(),this._isViewerFullscreen()?void 0:this._isToolbarReadyToShow()?(this._clearFadeTimeout(),this.setState({visible:!0,fadingOut:!1})):void 0},onMouseEnterToolbar:function(){return this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING),this._clearIdleTimeout()},onKeydown:function(e){var t,o,r,s,a;return o=!1,!this._frameMessenger.childIsValidated()||"dbmodal"===key.getScope()||d.focus_in_input()||d.is_input(e.target)||null!=e.target&&(t=n("#file-comments"),1!==t.length&&(t=n("#photo-comments")),1===t.length&&(e.target===t[0]||n.contains(t[0],e.target)))?void 0:(s={input_method:"keydown",file_ext:this.props.fileExtension,extra:JSON.stringify({keycode:e.keyCode})},a={context:E.KEYBOARD},r=e.keyCode,this.state.docType===v.SPP||r!==i.EQUALS&&r!==i.PLUS_EQUALS_FF&&r!==i.PLUS_CHROME&&r!==i.PLUS_EQUALS_FF_GERMAN?this.state.docType===v.SPP||r!==i.MINUS_FF_MAC&&r!==i.MINUS_FF&&r!==i.MINUS_CHROME?r===i.LEFT?(this.state.docType===v.SPP?this._pageUp(s):this._scrollLeft(s),o=!0):r===i.RIGHT?(this.state.docType===v.SPP?this._pageDown(s):this._scrollRight(s),o=!0):r===i.PAGE_UP?(this.state.docType===v.SPP?this._pageUp(s):this._screenUp(s),o=!0):r===i.SPACE||r===i.PAGE_DOWN?(this.state.docType===v.SPP?this._pageDown(s):this._screenDown(s),o=!0):r===i.UP?(this.state.docType===v.SPP?this._pageUp(s):this._scrollUp(s),o=!0):r===i.DOWN?(this.state.docType===v.SPP?this._pageDown(s):this._scrollDown(s),o=!0):70!==r||e.ctrlKey||e.metaKey?70===r&&(e.ctrlKey||e.metaKey)?this._searchInline(a):80===r?(this._printDocument(a),o=!0):r===i.ESC&&(this._isViewerFullscreen()?this._exitFullscreen(a):this.props.afterFileViewerExit&&!this._isAnnotationBubbleShown()&&this._exitPreview(s),o=!0):(this._isViewerFullscreen()?this._exitFullscreen(a):this._enterFullscreen(a),o=!0):(this._zoomOut(a),o=!0):(this._zoomIn(a),o=!0),o&&null!=e.preventDefault&&e.preventDefault(),!o)},_isAnnotationBubbleShown:function(){return n(".annotation-bubble-container .bubble-dropdown").length>0},_startFadeTimeout:function(){return this._fadeTimeout=setTimeout(function(e){return function(){return e._fadeTimeout=null,e.setState({visible:!1,fadingOut:!1})}}(this),this._FADE_TIME_MSEC)},_clearFadeTimeout:function(){return null!=this._fadeTimeout?(clearTimeout(this._fadeTimeout),this._fadeTimeout=null):void 0},_startFullscreeningTimeout:function(){var e;return e=function(e){return function(){return e._fullscreeningTimeout=null,e.setState({fullscreening:!1})}}(this),this._fullscreeningTimeout=setTimeout(n.proxy(e,this),s.RAMS_FULLSCREEN_TRANSITION_TIME_MSEC)},_clearFullscreeningTimeout:function(){return null!=this._fullscreeningTimeout?(clearTimeout(this._fullscreeningTimeout),this._fullscreeningTimeout=null):void 0},onIdleTimeout:function(){return this._clearIdleTimeout(),this.fadeOut()},_startIdleTimeout:function(){return this._clearIdleTimeout(),this._idleTimeout=setTimeout(n.proxy(this.onIdleTimeout,this),this._IDLE_TIME_MSEC)},_clearIdleTimeout:function(){return null!=this._idleTimeout?(clearTimeout(this._idleTimeout),this._idleTimeout=null):void 0},_clearAllTimeouts:function(){return this._clearFadeTimeout(),this._clearFullscreeningTimeout(),this._clearIdleTimeout()},_isToolbarReadyToShow:function(){return this.state.currentPage>0&&this.state.pagesCount>0},onBrowserFullscreenChange:function(e){var t;return t={context:E.BROWSER},this._isViewerFullscreen&&!this._isBrowserFullscreen()?this._setFullscreen(!1,t):void 0},_logData:function(e,t){return"string"==typeof t.input_method?g.log(e,t):assert(!1,"logData not correctly formed"),"string"==typeof t.input_method},_logUserAction:function(e,t){return a.logUserAction(e,t)},_logAndPostMessage:function(e,t,n){return this._logData(t,n)?this._frameMessenger.postMessageToChildren(e):void 0},_zoomIn:function(e){return this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_IN),this._logUserAction(b.ZOOM_IN,e.context)},_zoomOut:function(e){return this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_OUT),this._logUserAction(b.ZOOM_OUT,e.context)},_pageUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.PAGE_UP,"page-up",e)},_pageDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.PAGE_DOWN,"page-down",e)},_screenUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_UP,"screen-up",e)},_screenDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_DOWN,"screen-down",e);
},_scrollUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_UP,"scroll-up",e)},_scrollDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_DOWN,"scroll-down",e)},_scrollRight:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_RIGHT,"scroll-right",e)},_scrollLeft:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_LEFT,"scroll-left",e)},_toggleFullscreen:function(e){return this._isViewerFullscreen()?this._exitFullscreen(e):this._enterFullscreen(e)},_enterFullscreen:function(e){return this._setFullscreen(!0,e)},_exitFullscreen:function(e){return this._setFullscreen(!1,e)},_exitPreview:function(e){var t;return this._logData("exit-preview",e)&&"function"==typeof(t=this.props).afterFileViewerExit?t.afterFileViewerExit():void 0},_printDocument:function(e){var t;return t=this.props.isSharedLink?this.props.actions.nativePdfPrintFromSharedLink(this.props.fileHref,this.props.fileBlockServerUrl):this.props.actions.nativePdfPrint({href:this.props.fileBlockServerUrl,preview_type:this.props.filePreviewType}),t||this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.PRINT),this._logUserAction(b.PRINT,e.context)},_searchInline:function(e){return this._logUserAction(b.INLINE_SEARCH,e.context)},_onRegionCreationClick:function(){return this.props.onRegionCreationClick()}}),{ReactPreviewToolbarClass:y,PreviewToolbarDocType:v}}),define("modules/clean/react/previews/preview_toolbar_container",["external/react","external/underscore","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/preview_toolbar_region_creation","modules/clean/comments/constants","modules/clean/comments/logging","modules/clean/comments/store","modules/clean/comments/utils","modules/constants/comments_panel"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_,m;return h=o.ReactPreviewToolbarClass,d=i.FileActivityLogEventType,u=i.FileActivityLogClientOriginType,_=e.createElement,m=e.DOM,p=e.createClass({displayName:"PreviewToolbarContainer",propTypes:{previewToolbarProps:e.PropTypes.object.isRequired,isFullscreen:e.PropTypes.bool,shouldUseImageToolbar:e.PropTypes.bool,commentsActionCreators:e.PropTypes.object.isRequired},getInitialState:function(){return this.getComponentState()},getComponentState:function(){return{canAnnotate:l.canAnnotate(this.props.isFullscreen),regionCreationEnabled:a.state.regionCreationEnabled}},onStateChange:function(){return this.setState(this.getComponentState())},componentDidMount:function(){return this.unsubscribeStore=a.listen(this.onStateChange)},componentWillUnmount:function(){return this.unsubscribeStore(),this.props.commentsActionCreators.setRegionCreationEnabled(!1)},_logRegionCreationClick:function(e){return s.logEvent(e,u.ANNOTATION_MODE_BUTTON_IN_TOOLBAR)},_onRegionCreationClick:function(){return this._logRegionCreationClick(d.CLIENT_ANNOTATION_MODE_ENABLED),this.props.commentsActionCreators.setRegionCreationEnabled(!0)},_onRegionCreationDoneClick:function(){return this._logRegionCreationClick(d.CLIENT_ANNOTATION_MODE_DISABLED),this.props.commentsActionCreators.setRegionCreationEnabled(!1)},onKeydown:function(e){var t;return null!=(t=this.refs.previewToolbar)?t.onKeydown(e):void 0},render:function(){var e,o;return o=this.state.regionCreationEnabled&&this.state.canAnnotate,e=c.ALLOW_VIEW_ANNOTATE_MODES&&this.state.canAnnotate,m.div({className:"preview-toolbar-container"},this.props.shouldUseImageToolbar?o?void 0:_(n,t.extend({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this._onRegionCreationClick,canEnableRegionCreation:e})):_(h,t.extend({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this._onRegionCreationClick,isHidden:o,shouldDisplayRegionCreationButton:e})),o?_(r,{ref:"previewToolbarRegionCreation",onRegionCreationDoneClick:this._onRegionCreationDoneClick}):void 0)}})}),define("modules/clean/react/previews/preview_toolbar_region_creation",["external/react","modules/core/dom","modules/core/i18n"],function(e,t,n){var o,r,i;return i=e.DOM,r=n._,o=e.createClass({displayName:"PreviewToolbarRegionCreation",propTypes:{onRegionCreationDoneClick:e.PropTypes.func.isRequired},_renderDoneButton:function(){return i.div({className:"done-button",onMouseUp:this.props.onRegionCreationDoneClick},r("Done"))},_renderHint:function(){return i.div({className:"region-creation-hint"},r("Click and drag to comment on areas"))},render:function(){return i.div({className:"preview-toolbar-overlay-container"},i.div({className:"preview-toolbar-overlay"},i.div({className:"region-creation-toolbar-content"},this._renderHint(),this._renderDoneButton())))}})}),define("modules/clean/react/previews/preview_video",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/image_size","modules/clean/previews/preview_actions_helper","modules/clean/previews/util","modules/clean/react_format","modules/clean/react/helpers","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/constants","modules/clean/static_urls","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri","modules/clean/loggers/file_preview_logger","require"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b){var S,w,T,C,I,P,A,N,O,R,k,D,L,M;return D=s.image_best_fit_size,I=a.PreviewActions,C=l.PermissionHelper,L=c.reactFormat,R=u.compareStateAndProps,w=p.EventTypes,N=p.UserActionContextNames,S=m.ErrorTypes,M=f.static_url,O=v._,T=E.FilePreviewUserActionLogger,k=t.DOM,A=t.createFactory(_),P=t.createClass({displayName:"PreviewVideo",lastPlaybackRate:1,propTypes:{"preview-url":t.PropTypes.string,"thumbnail-url-tmpl":t.PropTypes.string,"video-metadata-url":t.PropTypes.string,isFullscreen:t.PropTypes.bool,filePreviewSession:t.PropTypes.object,shouldDisplayAnnotationsToolbar:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onError:t.PropTypes.func,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func},_setUpLogger:function(){return this.logger&&this.teardownLogger(),this.logger=new T,this.logger.listenTo(h)},_teardownLogger:function(){return this.logger.unlistenTo(h),delete this.logger},_logFilePreviewTimelineEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_logUserAction:function(e,t){var n;return n=o.extend({},t,{preview_type:"video"}),h.emit(w.FILE_PREVIEW_USER_ACTION,this.props.filePreviewSession,e,N.VIDEO_PLAYER,t)},_getSizedImageUrl:function(){return y.parse(this.props["thumbnail-url-tmpl"]).updateQuery({size:D(r(window).width(),r(window).height()),size_mode:2}).toString()},_shutdown:function(){var e,t,n;if(r(".vjs-big-play-button").blur(),null!=this._player){try{this._player.trigger("shutdown"),"Hls"===this._player.techName&&null!=(n=this._player.tech.sourceBuffer)&&n.abort(),this._player.dispose()}catch(t){e=t}return this._player=null}},_onEmbed:function(){return this._logFilePreviewTimelineEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewTimelineEvent(w.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},_onCanPlay:function(){return this._logFilePreviewTimelineEvent(w.FILE_PREVIEW_RENDER_SUCCEEDED),g.mark_time_to_interactive(),setTimeout(I.broadcastRenderSucceeded,0)},_onReady:function(){var e;return e=function(){return r(".vjs-poster").show(),r(".vjs-big-play-button").show(),r(".vjs-big-play-button").focus()},setTimeout(e,0),this._logFilePreviewTimelineEvent(w.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),g.mark_time_to_view()},_onPlay:function(){return r(".vjs-poster").hide(),r(".vjs-big-play-button").hide()},_onEnd:function(){return r(".vjs-poster").show(),r(".vjs-big-play-button").show(),r(".vjs-loading-spinner").hide()},_onWaiting:function(){var e;return null!=(e=this.props.filePreviewSession)?e.recordEvent(w.FILE_PREVIEW_VIDEO_STALLED,{playback_rate:this._player.playbackRate()}):void 0},_onUserInactive:function(){var e;return e=this._player.playbackRate(),e!==this.lastPlaybackRate?(this.lastPlaybackRate=e,this._logUserAction("playback_rate_changed",{playback_rate:e})):void 0},_onError:function(e){var t,n;return"needflash"===e?(this._logFilePreviewTimelineEvent(w.FILE_PREVIEW_SUPPORT_DENIED),void("function"==typeof(t=this.props).onError&&t.onError(S.NEED_FLASH_ERROR))):(this._shutdown(),this._logFilePreviewTimelineEvent(w.FILE_PREVIEW_DOWNLOAD_FAILED),g.mark_time_to_view(),g.mark_time_to_interactive(),"function"==typeof(n=this.props).onError?n.onError(S.LOAD_ERROR):void 0)},_embedVideoLoader:function(){var e;return e=r(n.findDOMNode(this.refs.previewVideoPlayer)),b(["modules/clean/video_loader"],function(t){return function(n){return t._player=n.embed(e,{src:t.props["preview-url"],type:C.use_hls_video()?"application/vnd.apple.mpegurl":"video/flv",useFlash:!C.use_hls_video(),controls:!0,playbackRates:[.5,1,1.5,2,4],preload:"auto",poster:t._getSizedImageUrl(),metadata_link:t.props["video-metadata-url"],metadata:null,onEmbed:t._onEmbed,onCanPlay:t._onCanPlay,onEnd:t._onEnd,onError:t._onError,onReady:t._onReady,onPlay:t._onPlay,onWaiting:t._onWaiting,onUserInactive:t._onUserInactive})}}(this))},componentDidMount:function(){return this._embedVideoLoader(),this._setUpLogger()},componentWillUpdate:function(e){return e["preview-url"]!==this.props["preview-url"]?this._shutdown():void 0},componentDidUpdate:function(e){return e["preview-url"]!==this.props["preview-url"]?this._embedVideoLoader():void 0},componentWillUnmount:function(){return this._shutdown(),this._teardownLogger()},shouldComponentUpdate:R,_renderAnnotationsToolbar:function(){return k.div({className:"preview-toolbar-container"},t.createElement(i,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},_renderPlayer:function(){return k.div({ref:"previewVideoPlayer",className:"video-player"})},render:function(){var t;return t={"flex-preview-container":!0,"flex-preview-container--padded":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar},this.props.isFullscreen?A({isFlippable:!0,renderZoomControls:!1,onClose:function(){return d.closeFullscreen()},containerClass:"video-player"},this._renderPlayer()):k.div({ref:"previewVideoContainer",className:e(t)},k.div({className:"preview-content preview-video"},k.div({className:"preview-video__wrapper"},k.div({className:"preview-video__aspect-container"},k.div({className:"preview-video__container"},this._renderPlayer())))),this.props.shouldDisplayAnnotationsToolbar&&this.props.count>1?this._renderAnnotationsToolbar():void 0)}}),{PreviewVideo:P}}),define("modules/clean/react/previews/preview_zoom_container",["external/keymaster","external/classnames","external/react","external/underscore","jquery","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/store","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/dom","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S;return y=s.UserActionNames,v=s.UserActionContextNames,b=n.createElement,S=n.DOM,E=p._,g=n.createFactory(c),h=n.createFactory(a),m="",_="previewzoomcontainer",f=n.createClass({displayName:"PreviewZoomContainer",propTypes:{isFlippable:n.PropTypes.bool.isRequired,renderZoomControls:n.PropTypes.bool.isRequired,onClose:n.PropTypes.func.isRequired,containerClass:n.PropTypes.string,zoomOutCallback:n.PropTypes.func,zoomInDisabled:n.PropTypes.bool,zoomOutDisabled:n.PropTypes.bool,dragDisabled:n.PropTypes.bool},getDefaultProps:function(){return{zoomInDisabled:!0,zoomOutDisabled:!0,dragDisabled:!0}},getInitialState:function(){return{controlsHidden:!1}},componentDidMount:function(){return this._flipNext=o.throttle(this._flipNext,100),this._flipPrevious=o.throttle(this._flipPrevious,100),key("esc",_,this._onCloseFactory(v.KEYBOARD)),null!=this.props.zoomOutCallback&&key("space",_,this.props.zoomOutCallback),this.props.isFlippable&&(key("left",_,function(e){return function(){return e._startControlsTimer(),e._flipPrevious(v.KEYBOARD)}}(this)),key("right",_,function(e){return function(){return e._startControlsTimer(),e._flipNext(v.KEYBOARD)}}(this))),m=key.getScope(),key.setScope(_),this._startControlsTimer(),this._hideCursor()},componentWillUpdate:function(){return key.setScope(_)},componentWillUnmount:function(){return key.clearScope(_),key.setScope(m),clearTimeout(this.controlsHideTimer),this._showCursor()},_startControlsTimer:function(){return this._showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(e){return function(){return e._hideControls()}}(this),3e3)},_showControls:function(){return this._showCursor(),this.setState({controlsHidden:!1})},_hideControls:function(){return this._hideCursor(),this.setState({controlsHidden:!0})},_showCursor:function(){return r("html").removeClass("no-cursor")},_hideCursor:function(){return r("html").addClass("no-cursor")},_flipNext:function(e){return i.flipNext(),i.logUserAction(y.FLIP_NEXT,e)},_flipPrevious:function(e){return i.flipPrevious(),i.logUserAction(y.FLIP_PREV,e)},_onClick:function(e){var t;return t="."+this.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close",r(e.target).is(t)||0!==r(e.target).parents(t).length?void 0:(e.preventDefault(),this._onCloseFactory(v.LIGHTBOX_FRAME)())},_onMouseMove:function(e){return 0===r(e.target).parents(".preview-toolbar-overlay").length?this._startControlsTimer():clearTimeout(this.controlsHideTimer)},_onCloseFactory:function(e){return function(t){return function(){return i.logUserAction(y.TOGGLE_FULLSCREEN_OFF,e),t.props.onClose()}}(this)},_renderControls:function(){var e,n,o;return n={"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled},o={"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled},e={"preview-toolbar-container":!0,hidden:this.state.controlsHidden},S.div({ref:"previewZoomerToolbarContainer",className:t(e)},S.div({className:"preview-toolbar-overlay-container"},S.div({className:"preview-toolbar-overlay"},S.div({className:"preview-toolbar-content"},this.props.isFlippable?h({index:""+(l.currentIndex()+1),numFlippableFiles:l.files().length,onNext:function(e){return function(){return e._flipNext(v.LIGHTBOX_TOOLBAR)}}(this),onPrevious:function(e){return function(){return e._flipPrevious(v.LIGHTBOX_TOOLBAR)}}(this)}):void 0,this.props.renderZoomControls?[S.div({ref:"zoomControlZoomOut",className:t(o)},g({alt:E("Zoom out"),group:"web",name:"zoomout"})),S.div({ref:"zoomLabelContainer",className:"toolbar-button-entry"},b(u,{content:E("View actual size"),position:u.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},S.span({ref:"zoomLabel",className:"zoom-label"}))),S.div({ref:"zoomControlZoomIn",className:t(n)},g({alt:E("Zoom in"),group:"web",name:"zoom"}))]:void 0))))},_renderClose:function(){var e;return e={"preview-zoomer-close":!0,hidden:this.state.controlsHidden},S.button({ref:"previewZoomerClose",className:t(e),onClick:this._onCloseFactory(v.LIGHTBOX_CLOSE_BUTTON)},g({alt:E("Close"),group:"web",name:"lightbox_close"}))},render:function(){var e;return e={"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled},S.div({ref:"previewZoomerContainer",className:t(e),onClick:this._onClick,onMouseMove:this._onMouseMove},this.props.children,this._renderClose(),this._renderControls())}})}),define("modules/clean/react/previews/quality_popup/constants",["require","exports"],function(e,t){"use strict";function n(e){return r[e]}var o;!function(e){e[e.POPUP=0]="POPUP",e[e.FEEDBACK_MODAL=1]="FEEDBACK_MODAL"}(o=t.QualityPopupStage||(t.QualityPopupStage={}));var r=[];r[o.POPUP]="popup",r[o.FEEDBACK_MODAL]="feedback_modal",t.getPopupStageLoggerKey=n,t.BooleanAnswers={YES:"Y",NO:"N"}}),define("modules/clean/react/previews/quality_popup/feedback_modal",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react_format","modules/core/i18n","modules/clean/react/modal","modules/clean/react/sprite"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isFileSelected:!0,feedback:""},t.onDone=function(){t.props.onDone(t.state.isFileSelected,t.state.feedback),l.Modal.close()},t.onDismiss=function(){t.props.onDismiss(),l.Modal.close()},t.checkboxChange=function(e){t.setState({isFileSelected:e.target.checked})},t}return n.__extends(t,e),t.showInstance=function(e){l.Modal.showInstance(e)},t.prototype.renderFileDonation=function(){var e=r.em_snippet(i.filename(this.props.filename),32),t=i.file_icon(this.props.filename);return o.createElement("label",{className:"file_selection"},o.createElement("div",{className:"file_check"},o.createElement("input",{type:"checkbox",checked:this.state.isFileSelected,onClick:this.checkboxChange,id:"file_selection_checkbox"})),o.createElement("div",{className:"file_image"},o.createElement(c,{group:"web",name:t+"_32",alt:""})),o.createElement("div",{className:"file_desc"},o.createElement("div",{className:"file_desc_container"},o.createElement("div",{className:"main"},s.reactFormat(a._("Include <b>%(filename)s</b>"),{filename:e,b:o.createElement("b",null)})),o.createElement("div",{className:"disclaimer"},a._("The Dropbox team will review your document. It will only be used to help improve previews.")))))},t.prototype.render=function(){var e=this;return o.createElement(l.Modal,{title:a._("Tell us what’s wrong"),acceptButtonText:a._("Send feedback"),dismissButtonText:a._("Cancel"),autoClose:!1,showX:!0,onAccept:this.onDone,onDismiss:this.onDismiss},o.createElement("div",{className:"send_feedback_modal_content"},o.createElement("textarea",{className:"feedback",name:"feedback",id:"feedback",maxLength:255,readOnly:!1,placeholder:a._("My document doesn’t look right because..."),value:this.state.feedback,onChange:function(t){return e.setState({feedback:t.target.value})}}),this.renderFileDonation()))},t}(o.Component);t.PreviewFeedbackModal=u}),define("modules/clean/react/previews/quality_popup/preview_quality_popup",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/loggers/file_preview_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/react/previews/quality_popup/feedback_modal","modules/clean/react/sprite","modules/clean/react/file_viewer/file_preview_event_emitter","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m){"use strict";var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.handleDismissPopup=function(){t.recordDismissed(c.QualityPopupStage.POPUP),t.hidePopup()},t.handleAnswerYes=function(){t.recordAnswer(t.state.question,c.BooleanAnswers.YES),t.feedbackReceived()},t.handleAnswerNo=function(){t.recordAnswer(t.state.question,c.BooleanAnswers.NO),u.shouldShowFeedbackModal(t.state.question)?t.showFeedbackModal():t.feedbackReceived()},t.handleModalDone=function(e,n){var o={};o[u.Questions.FEEDBACK]=n||"",o[u.Questions.DONATE]=e?c.BooleanAnswers.YES:c.BooleanAnswers.NO;var r={};e&&(r._file_nsid=t.props.file.ns_id,r._file_sjid=t.props.file.sjid),t.recordMultipleAnswers(o,r),t.feedbackReceived()},t.handleModalDismiss=function(){t.recordDismissed(c.QualityPopupStage.FEEDBACK_MODAL)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.file,t=r.file_extension(r.filename(e.fq_path));this.popupLogger=new i.FilePreviewQualityPopupLogger,this.popupLogger.listenTo(h),this.handlePreviewOpen(t)},t.prototype.componentWillUnmount=function(){this.popupLogger.unlistenTo(h)},t.prototype.recordQuestions=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l.FilePreviewSession.currentSession;h.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,n,e)},t.prototype.recordAnswer=function(e,t){var n={};n[e]=t,this.recordMultipleAnswers(n)},t.prototype.recordMultipleAnswers=function(e,t){void 0===t&&(t={});var n=l.FilePreviewSession.currentSession;h.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,n,e,t)},t.prototype.recordDismissed=function(e){var t=l.FilePreviewSession.currentSession;h.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,t,e)},t.prototype.showFeedbackModal=function(){var e=o.createElement(d.PreviewFeedbackModal,{filename:r.filename(this.props.file.fq_path),onDone:this.handleModalDone,onDismiss:this.handleModalDismiss});this.recordQuestions(u.Questions.FEEDBACK,u.Questions.DONATE),d.PreviewFeedbackModal.showInstance(e)},t.prototype.feedbackReceived=function(){m.success(_._("Thanks! Your feedback will help improve Dropbox."),3),this.hidePopup()},t.prototype.hidePopup=function(){this.setState({question:void 0}),s.closePreviewQualityPopup()},t.prototype.randomNum=function(e,t){return void 0===t&&(t=0),Math.random()*(e-t)+t},t.prototype.handlePreviewOpen=function(e){if(!(this.randomNum(100)>this.props.showProbability)){var t=u.getQuestionToAsk(e);null!==t&&(this.setState({question:t}),this.recordQuestions(t))}},t.prototype.render=function(){return void 0===this.state.question?null:o.createElement("div",{id:"preview-quality-popup",className:"preview-quality-bar fadeout"},o.createElement("div",{className:"container"},o.createElement("div",{className:"title"},u.getQuestionWording(this.state.question),o.createElement("div",{className:"resolution"},o.createElement("button",{className:"button-as-link looks-good-link",onClick:this.handleAnswerYes},_._("Yes")),o.createElement("span",{className:""},_._("•")),o.createElement("button",{className:"button-as-link something-wrong-link",onClick:this.handleAnswerNo},_._("No")))),o.createElement("div",{className:"hide_button"},o.createElement("button",{className:"button-as-link dismiss-link",onClick:this.handleDismissPopup},o.createElement(p,{group:"web",name:"x",alt:_._("Close")})))),o.createElement("hr",{className:"separator"}))},t}(o.Component);t.PreviewQualityPopup=f}),define("modules/clean/react/previews/quality_popup/questions",["require","exports","modules/core/i18n","modules/constants/file_viewer"],function(e,t,n,o){"use strict";function r(e,t){return d[e].indexOf(t)>-1}function i(e){var t=o.PREVIEW_QUALITY_POPUP_QUESTION;if(!u.hasOwnProperty(t))return null;var n=u[t];return r(n,e)?n:null}function s(e){return!!_[e]}function a(e){return m[e]}function l(e){return f[e]}var c;!function(e){e[e.LOOK_GOOD=0]="LOOK_GOOD",e[e.LOAD_QUICKLY=1]="LOAD_QUICKLY",e[e.IS_ACCURATE=2]="IS_ACCURATE",e[e.FEEDBACK=3]="FEEDBACK",e[e.DONATE=4]="DONATE"}(c=t.Questions||(t.Questions={}));var u={};u.LOOK_GOOD=c.LOOK_GOOD,u.LOAD_QUICKLY=c.LOAD_QUICKLY,u.IS_ACCURATE=c.IS_ACCURATE;var d=[],p=["pdf","doc","docx","ppt","pptx","xls","xlsx"],h=["jpg","jpeg","png","tiff","tif","gif","bmp","webp","wbmp"];d[c.LOOK_GOOD]=p,d[c.LOAD_QUICKLY]=p.concat(h),d[c.IS_ACCURATE]=p;var _=[];_[c.LOOK_GOOD]=!0;var m=[];m[c.LOOK_GOOD]=n._("Does this document look right?"),m[c.LOAD_QUICKLY]=n._("Did this preview load quickly?"),m[c.IS_ACCURATE]=n._("Is this preview accurate?");var f=[];f[c.LOOK_GOOD]="look_good",f[c.LOAD_QUICKLY]="load_quickly",f[c.IS_ACCURATE]="is_accurate",f[c.FEEDBACK]="feedback",f[c.DONATE]="donate",t.isQuestionAllowed=r,t.getQuestionToAsk=i,t.shouldShowFeedbackModal=s,t.getQuestionWording=a,t.getQuestionLoggerKey=l}),define("modules/clean/react/previews/responsive_image",["require","exports","tslib","external/react","modules/clean/react/previews/image_helpers"],function(e,t,n,o,r){"use strict";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e;return e=this.props.onContextMenu?this.props.className+" disabled-context-menu":this.props.className,o.createElement("img",{alt:"",srcSet:r.getSrcSet(this.props.thumbnailUrlTmpl),sizes:r.IMG_SIZES_ATTR,src:r.getFallbackSrc(this.props.thumbnailUrlTmpl),className:e,style:this.props.style,onLoad:this.props.onLoad,onError:this.props.onError,onClick:this.props.onClick,onContextMenu:this.props.onContextMenu,ref:this.props.refCallback})},t}(o.Component);t.ResponsiveImage=i}),define("modules/clean/react/select",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/hidden","modules/clean/react/sprite","modules/clean/react/util","modules/core/dom"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g;return d=a.HiddenSelect,h=t.DOM,p=t.createElement,_=function(e,t){var n,o,r,i;return i=e.scrollTop(),r=i+e.height(),o=t.position().top+i,n=o+t.height(),i>o?e.scrollTop(o):n>r?e.scrollTop(n-e.height()):void 0},g=t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number]),f=t.createClass({displayName:"selectOption",propTypes:{id:t.PropTypes.string,className:t.PropTypes.string,disabled:t.PropTypes.bool,title:t.PropTypes.string,value:g,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},getInitialState:function(){return{id:o.uniqueId("option")}},componentWillReceiveProps:function(e){return null!=e.id?this.setState({id:e.id}):void 0},render:function(){var t,n,o;return t={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled},null!=this.props.className&&(t[this.props.className]=!0),o=this.props.value,n=r.extend(!0,{},this.props),delete n.value,h.div(r.extend({"data-value":o},n,{id:this.state.id,role:"option",className:e(t),"aria-disabled":this.props.disabled}),this.props.children)}}),m=t.createClass({displayName:"selectInput",mixins:[s],mouseInput:!0,propTypes:{name:t.PropTypes.string,onChange:t.PropTypes.func,defaultValue:g,style:t.PropTypes.object,value:g,variant:t.PropTypes.string,className:t.PropTypes.string,ariaLabelId:t.PropTypes.string,ariaDescriptionId:t.PropTypes.string,valueLink:t.PropTypes.object,isDisabled:t.PropTypes.bool,headerElement:t.PropTypes.element},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",ariaLabelId:"",ariaDescriptionId:"",style:null,headerElement:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",selectOptionId:o.uniqueId("selected-option"),listboxId:o.uniqueId("listbox"),value:this.props.defaultValue}},_getFilteredChildren:function(){return o.isArray(this.props.children)?o.filter(this.props.children,function(e){return e}):this.props.children},render:function(){var n,o,r,i,s,a,c;return o={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled},this.props.variant&&(o[this.props.variant]=!0),this.props.className&&(o[this.props.className]=!0),i={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},r=this.renderErrorIfEnabled(),n=this.props.ariaDescriptionId,((null!=(s=this.props.error)?s.message_text:void 0)||null!=(null!=(a=this.props.error)?a.message_html:void 0))&&(n=r.props.id),c=this.selectedOption(),h.div({className:e(o),style:this.props.style,ref:"wrapperDiv"},r,h.button({className:"select-input-button","aria-expanded":this.state.open,"aria-describedby":n,"aria-controls":this.state.listboxId,"aria-labelledby":this.props.ariaLabelId+" "+c.props.id,ref:"selectButton",tabIndex:0,onClick:this.handleClickOnInputButton},h.div({className:"select-input-input filter-item__filter-input",ref:"label"},c,h.div({className:"select-input-dropdown-arrow"},p(l,{group:"web",name:"arrow-down-gray",alt:""})))),p(d,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:function(e){return function(){var n;return n=[],t.Children.forEach(e._getFilteredChildren(),function(e){return n.push(e.props.value)}),n}}(this)()}),h.div({className:"hidden-option-container"},h.div({id:this.state.listboxId,className:e(i),role:"listbox",onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,tabIndex:-1,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t,n;if(!this.props.isDisabled)return e.pageX===t&&e.pageY===n||(this.mouseInput=!0),t=e.pageX,n=e.pageY},_commonPrefixLen:function(e,t){var n;for(e=e.trim().toLowerCase(),t=t.trim().toLowerCase(),n=0;n<e.length&&n<t.length&&e.charAt(n)===t.charAt(n);)n++;return n},_keyboardSelect:function(e){var t,n,r,i,s;return s=o.sortedIndex(this.sortedOptions,{text:e.toLowerCase()},"text"),r=this.sortedOptions[Math.max(s-1,0)],t=this.sortedOptions[Math.min(s,this.sortedOptions.length-1)],i=this._commonPrefixLen(e,r.text),n=this._commonPrefixLen(e,t.text),i>=n?this.setState({keyboarsSelectPrefix:e,focused:r.value}):this.setState({keyboarsSelectPrefix:e,focused:t.value})},handleKeydown:function(e){var t,n,r;if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case i.TAB:return this.setState({open:!1,focused:null}),!0;case i.ENTER:case i.SPACE:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case i.ESC:this.state.open&&(r=this.getValue(),this.setValue(r),this.setState({open:!1}));break;case i.UP:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case i.DOWN:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;o.contains(o.values(i),e.keyCode)||(t=String.fromCharCode(e.which),n=this.state.keyboarsSelectPrefix+t,this._keyboardSelect(n),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout(function(e){return function(){return e.setState({keyboarsSelectPrefix:""}),e._keyboardSelect_timeout=null}}(this),500))}return!1}},prev:function(e){var n,o;return n=null,o=null,t.Children.forEach(this._getFilteredChildren(),function(t){return function(t){return o||t.props.disabled||(o=t),t.props.value===e&&(n=o),t.props.disabled?void 0:o=t}}(this)),null!=n?n.props.value:void 0},next:function(e){var n,o,r;return n=null,o=null,t.Children.forEach(this._getFilteredChildren(),function(t){return function(t){return t.props.disabled?void 0:((null!=o?o.props.value:void 0)===e&&(n=t),o=t)}}(this)),null!=(r=n||o)?r.props.value:void 0},menuChildren:function(){var n,o;return o=this.getValue(),n=t.Children.map(this._getFilteredChildren(),function(n){return function(r){var i;return i=t.cloneElement(r,{onMouseEnter:function(){return u.scroll_lock_document(),n.mouseInput?n.setState({focused:r.props.value}):void 0},onMouseOut:function(){return u.scroll_unlock_document()},onClick:function(){return r.props.disabled?void 0:(n.setState({open:!1}),n.setValue(r.props.value))},className:e({"focused-option":null!=n.state.focused&&n.state.focused===r.props.value,"selected-option":o===r.props.value},r.props.className)})}}(this))},componentWillMount:function(){var e;return e=t.Children.map(this._getFilteredChildren(),function(e){return{value:e.props.value,text:c.getText(e).trim().toLowerCase()}}),this.sortedOptions=o.sortBy(e,"text")},componentDidMount:function(){return this.globalMenuCloser=function(e){return function(t){var o;return e.state.open&&(o=r(t.target).closest(".select-input"),!o.length||o[0]!==n.findDOMNode(e.refs.wrapperDiv))?e.setState({open:!1,focused:null}):void 0}}(this),r(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return r(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(e,t){var o,i,s,a,l;return i=r(n.findDOMNode(this.refs.dropdown)),s=r(n.findDOMNode(this.refs.selectButton)),this.state.open&&(o=i.find("[data-value='"+this.state.focused+"']"),
i.attr("aria-activedescendant",o.attr("id"))),this.state.open&&this.state.focused&&null==this.props.headerElement&&(o=i.find("[data-value='"+this.state.focused+"']"),i.attr("aria-activedescendant",o.attr("id")),_(i,o)),l=t.open&&!this.state.open,a=!t.open&&this.state.open,a&&i.focus(),l?s.focus():void 0},selectedOption:function(){var e;return e=null,null!=this.props.headerElement?this.props.headerElement:(t.Children.forEach(this._getFilteredChildren(),function(t){return function(n){return e||(e=n),(null!=n?n.props.value:void 0)===t.getValue()?e=n:void 0}}(this)),e?t.cloneElement(e,{id:this.state.selectOptionId}):null)},handleClickOnInputButton:function(e){return e.preventDefault(),this.toggle()},toggle:function(){return this.props.isDisabled?void 0:this.state.open?this.setState({open:!1,focused:null}):this.setState({open:!0,focused:this.getValue()})},getValue:function(){var e,t,n,o;return null!=(e=null!=(t=null!=(n=this.props.value)?n:null!=(o=this.props.valueLink)?o.value:void 0)?t:this.state.value)?e:this.props.defaultValue},setValue:function(e){var t,n;return n=this.getValue(),this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),(n!==e||null!=this.props.headerElement)&&"function"==typeof(t=this.props).onChange?t.onChange(n,e):void 0}}),{input:m,option:f}});var slice=[].slice,hasProp={}.hasOwnProperty;define("modules/clean/react/selectable_list",["jquery","external/underscore","external/react","external/react-dom","external/immutable","external/keymaster","modules/clean/keycode","modules/clean/react/outside_event","modules/core/browser","modules/core/exception","modules/clean/react/helpers"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g,assert,v,y,E,b,S,w;return g=a.addOutsideEventHandling,assert=c.assert,w=u.shallowCompareStateAndProps,_="",f=r.Record({selected:new r.OrderedSet,anchor:null}),E=function(e,t){return null==e&&(e=[]),null==t&&(t=null),new f({selected:new r.OrderedSet(e),anchor:t||e[0]})},h="up",p="down",S=function(e){return l.mac&&e.metaKey||!l.mac&&e.ctrlKey},v=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],function(){var n,o,r,i;for(i=[],o=0,r=e.length;r>o;o++)n=e[o],t.isFunction(n)&&i.push(n.apply(this,arguments));return i}},m={onMouseEnter:"handleMouseEnterRow",onMouseDown:"handleMouseDownInRow",onMouseUp:"handleMouseUpInRow",onToggleRowSelected:"handleToggleRowSelected",onFocus:"handleInitialTab"},d={onMouseDown:"handleMouseDownInCheckbox",onToggleRowSelected:"handleToggleRowSelected",onMouseEnter:"noop",onMouseUp:"noop"},b=function(){var e;return"INPUT"===(e=document.activeElement.tagName)||"TEXTAREA"===e||"SELECT"===e||"BUTTON"===e},y=function(i,s){var a,c;return c=null!=(a=(null!=s?s:{}).shouldComponentUpdate)?a:w,i=g(i,"mouseup","onMouseUp","onOutsideMouseUp"),n.createClass({displayName:"Selectable"+i.displayName,propTypes:{allItemIds:n.PropTypes.instanceOf(r.List),onSelectionChange:n.PropTypes.func,selection:n.PropTypes.instanceOf(f),defaultSelection:n.PropTypes.instanceOf(f),keyScope:n.PropTypes.string,linkedOutsideClasses:n.PropTypes.array,addTabbingClassWhenKeyboardNavigating:n.PropTypes.bool,isCheckboxes:n.PropTypes.bool},getDefaultProps:function(){return{onSelectionChange:t.noop,selection:null,defaultSelection:new f,keyScope:"SelectableList",linkedOutsideClasses:[],addTabbingClassWhenKeyboardNavigating:!0}},getInitialState:function(){return{selection:this.props.defaultSelection}},componentWillMount:function(){return this._focusedItem=null,this._handlerCache={},this._isFocused=!1,this._keepFocusOnToggle=!1,this._mostRecentMousedownTarget=null,this._isSelecting=!1},componentDidMount:function(){return this._setupKeyboardShortcuts(),this._focusItem(this._selection().anchor),e(o.findDOMNode(this)).on("focusin.SelectableList",this.getFocusHandler(!0)).on("focusout.SelectableList",this.getFocusHandler(!1))},shouldComponentUpdate:c,componentDidUpdate:function(e,t){var n,o;return(null!=(n=e.selection)?n.anchor:void 0)!==(null!=(o=this.props.selection)?o.anchor:void 0)&&this._selection().selected.size&&(this._focusedItem=this._selection().anchor),this._focusedItem?(this._focusItem(this._focusedItem),this._focusedItem=null):void 0},componentWillUnmount:function(){return this._handlerCache=null,_!==this.props.keyScope&&(key.clearScope(this.props.keyScope),key.setScope(_)),e(o.findDOMNode(this)).off(".SelectableList")},getFocusHandler:function(e){return function(t){return function(){return t._isFocused=e,!0}}(this)},_setupKeyboardShortcuts:function(){var e,t,n,r,i,s,a,c,u;return _=key.getScope(),_!==this.props.keyScope&&key.setScope(this.props.keyScope),s=function(e){return function(t){return e._isFocused&&"BUTTON"!==t.target.tagName}}(this),i=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||o.findDOMNode(e).contains(t.target)&&"INPUT"!==t.target.nodeName}}(this),r=function(e,t){return function(n){return e(n)?(n.preventDefault(),t(n)):null}},u=function(e){return function(){return e._selectNeighboringItem({direction:h})}}(this),n=function(e){return function(){return e._extendSelectionRange({direction:h})}}(this),c=function(e){return function(){return e._selectNeighboringItem({direction:p})}}(this),t=function(e){return function(){return e._extendSelectionRange({direction:p})}}(this),a=function(e){return function(){return e._selectAllItems()}}(this),e=function(e){return function(){return e._deselectAllItems()}}(this),key("up",this.props.keyScope,r(i,u)),key("shift+up",this.props.keyScope,r(i,n)),key("down",this.props.keyScope,r(i,c)),key("shift+down",this.props.keyScope,r(i,t)),key("escape",this.props.keyScope,r(i,e)),l.mac?key("command+a",this.props.keyScope,r(s,a)):key("ctrl+a",this.props.keyScope,r(s,a))},_focusItem:function(e){var t;return t=this.refs[e],t&&!this._keepFocusOnToggle?o.findDOMNode(t).focus():void 0},_itemIds:function(){var e;return this.props.allItemIds?this.props.allItemIds:(e=[],n.Children.forEach(this.props.children,function(t){var n;return(null!=t&&null!=(n=t.props)?n.selectableListId:void 0)?e.push(t.props.selectableListId):(null!=t?t.key:void 0)?e.push(t.key):void 0}),r.List(e))},_selection:function(){return this.props.selection?this.props.selection:this.state.selection},_updateState:function(e,t){return null==t&&(t=!1),this._keepFocusOnToggle=t,this.setState({isSelecting:!1}),r.is(this._selection(),e)?void 0:(this.props.selection||this.setState({selection:e}),this.props.onSelectionChange(e))},_selectAllItems:function(){return this.setSelectedItems({itemIds:this._itemIds().toArray()})},_deselectAllItems:function(){return this.setSelectedItems({itemIds:[]}),o.findDOMNode(this).contains(document.activeElement)?document.activeElement.blur():void 0},_toggleItemSelected:function(e){var t,n,o,r,i,s,a,l,c,u,d,p;if(o=e.itemId,a=e.keepFocusOnToggle,p=this._selection(),p.selected.has(o)){for(p=p.update("selected",function(e){return function(t){return e.setState({isSelecting:!0}),t.delete(o)}}(this)),l=null,t=this._itemIds().indexOf(o),n=i=c=t+1,u=this._itemIds().count();u>=c?u>i:i>u;n=u>=c?++i:--i)if(r=this._itemIds().get(n),p.selected.has(r)){l=r;break}if(!l)for(n=s=d=t-1;0>=d?0>=s:s>=0;n=0>=d?++s:--s)if(r=this._itemIds().get(n),p.selected.has(r)){l=r;break}l||(l=this._itemIds().get(0)),p=p.set("anchor",l)}else p=p.update("selected",function(e){return function(t){return e.setState({isSelecting:!0}),t.add(o)}}(this)).set("anchor",o);return this._updateState(p,a)},_selectItemsInRangeTo:function(e){var t,n,o,r,i,s,a,l,c,u,d,p,h;return s=e.itemId,p=this._selection(),(t=null!=(u=p.anchor)?u:this._itemIds().get(0))?(n=this._itemIds().indexOf(t),c=this._itemIds().indexOf(s),d=this._rangeOfSelectedBlockSurrounding(t),h=d.startIndex,o=d.endIndex,a=function(){var e,t,n,s;for(n=this._itemIds().toArray(),s=[],i=e=0,t=n.length;t>e;i=++e)r=n[i],i>=h&&o>=i&&s.push(r);return s}.call(this),l=function(){var e,t,o,s;for(o=this._itemIds().toArray(),s=[],i=e=0,t=o.length;t>e;i=++e)r=o[i],(i>=c&&n>=i||i>=n&&c>=i)&&s.push(r);return s}.call(this),n>c&&l.reverse(),p=p.update("selected",function(e){return function(t){return e.setState({isSelecting:!0}),t.subtract(a).union(l)}}(this)),this._updateState(p)):void 0},_selectNeighboringItem:function(t){var n,o,r,i;return n=t.direction,r=this._itemIds().indexOf(this._selection().selected.last()),o=0,n===h?o=Math.max(0,r-1):n===p&&(o=Math.min(this._itemIds().count()-1,r+1)),i=this._itemIds().get(o),this._focusedItem=i,this.setSelectedItems({itemIds:[i]}),this.props.addTabbingClassWhenKeyboardNavigating?e(document.body).addClass("tabbing"):void 0},_extendSelectionRange:function(t){var n,o,r,i,s,a,l,c,u;return r=t.direction,c=s=this._selection(),(n=null!=(a=c.anchor)?a:this._itemIds().get(0))?(o=this._itemIds().indexOf(n),l=this._rangeOfSelectedBlockSurrounding(n),u=l.startIndex,i=l.endIndex,this.setState({isSelecting:!0}),r===h?o===i?u-1>=0&&(c=c.update("selected",function(e){return function(t){return t.add(e._itemIds().get(u-1))}}(this))):c=c.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(i))}}(this)):r===p&&(o===u||o!==i?i+1<this._itemIds().count()&&(c=c.update("selected",function(e){return function(t){return t.add(e._itemIds().get(i+1))}}(this))):c=c.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(u))}}(this))),c!==s&&(this._focusedItem=c.selected.last(),this._updateState(c)),this.props.addTabbingClassWhenKeyboardNavigating?e(document.body).addClass("tabbing"):void 0):void 0},_rangeOfSelectedBlockSurrounding:function(e){var t,n,o,r;for(n=this._itemIds().indexOf(e);;)if(r=n,n-=1,0>n||!this._selection().selected.has(this._itemIds().get(n)))break;for(n=r;;){if(o=this._itemIds().get(n),null==o||!this._selection().selected.has(o))break;t=n,n+=1}return{startIndex:r,endIndex:t}},setSelectedItems:function(e){var t,n,o;return n=e.itemIds,this.setState({isSelecting:!0}),o=this._selection().set("selected",r.OrderedSet(n)),t=n.length>0?n[0]:this._itemIds().get(0),this._updateState(o.set("anchor",t))},handleMouseEnterRow:function(e,t){return this._isSelecting?this._selectItemsInRangeTo({itemId:e}):void 0},handleMouseDownInRow:function(e,t){return 2===t.button?void(this._selection().selected.has(e)||this.setSelectedItems({itemIds:[e]})):t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):S(t)?void this._toggleItemSelected({itemId:e}):(this._selection().selected.has(e)||(this.setSelectedItems({itemIds:[e]}),this._isSelecting=!0),this._mostRecentMousedownTarget=e)},handleMouseUpInRow:function(e,t,n){return e===this._mostRecentMousedownTarget&&this.setSelectedItems({itemIds:[e]}),this._isSelecting=!1},handleInitialTab:function(e){return this._itemIds().first()!==e||this._selection().selected.has(e)||this.state.isSelecting?void 0:this.setSelectedItems({itemIds:[e]})},handleToggleRowSelected:function(e,t){return this._toggleItemSelected({itemId:e,keepFocusOnToggle:!0})},handleOutsideMouseUp:function(t){var n;return this._isSelecting=!1,this._mostRecentMousedownTarget=null,n=o.findDOMNode(this),n.contains(t.target)||e(t.target).closest(this.props.linkedOutsideClasses.join()).length||this._mostRecentMousedownTarget?void 0:this._deselectAllItems()},handleMouseDownInCheckbox:function(e,t){return t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e})},noop:function(e,t){},render:function(){var e,o,r,s;return o=this._handlerCache,this._handlerCache={},e=n.Children.map(this.props.children,function(e){return function(r){var i,s,a,l,c,u,p,h,_;if(!(null!=r&&null!=(p=r.props)?p.selectableListId:void 0)&&!(null!=r?r.key:void 0))return r;u=null!=(h=null!=r&&null!=(_=r.props)?_.selectableListId:void 0)?h:r.key,l={},c=e.props.isCheckboxes?d:m;for(a in c)hasProp.call(c,a)&&(s=c[a],assert(!r.props[a],"SelectableList does not support children having seperate "+a+" listeners"),i=a+u,l[a]=o[i]||e[s].bind(e,u),e._handlerCache[i]=l[a]);return n.cloneElement(r,t.extend(l,{ref:u,isSelected:e._selection().selected.has(u)}))}}(this)),r=Object.keys(this.constructor.propTypes),s=t.extend({},t.omit(this.props,r),{selection:this._selection(),onOutsideMouseUp:this.props.isCheckboxes?t.noop():this.handleOutsideMouseUp}),n.createElement(i,s,e)}})},{createSelectableList:y,createSelection:E}}),define("modules/clean/react/share_download/actions",["require","exports","external/react","external/es6-promise","modules/clean/ajax","modules/clean/downloads","modules/clean/multiaccount_login","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/sharing/signup_modal_proxy","modules/clean/viewer","modules/constants/env","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f){"use strict";var g=function(){function e(){}return e.prototype.direct=function(e){var t=function(){var t=function(){var t=f.parse(e.url).updateQuery({dl:"1"}).toString();i.get({url:t,__do_not_use_expected_domain:d.PUBSERVER})};if(!e.downloadTestUrl)return void t();var n=function(){m.error(_._("Failed to download zip file."))},o=function(e){"OK"===e?t():0===e.indexOf("err:")?m.error(_._("The zip file is too large.")):n()};r.SilentBackgroundRequest({url:e.downloadTestUrl,success:o,error:n})};return c.signupForDirectDownload().then(t)},e.prototype.toDropbox=function(e,t,r,i){var d,_;if("anonymous"===r)d=c.signup(),_=p.reload;else{var m=i?i.id:-1;h.assert(-1!==m,"role isn't anonymous => user cannot be null or undefined!"),d=new o.Promise(function(e){var t=u.get_viewer();t.is_user_signed_in(i)?e(m):s.show_modal({role:r,on_success:function(){e(m)}})})}d.then(function(o){var i=n.createElement(a,{shareToken:e,fileOrFolder:t,userId:o,role:r,onDismiss:_});l.Modal.showInstance(i)})},e}(),v=new g;return v});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/share_download/button",["external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/react/share_download/models","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/viewer","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g,v,y,E,b,S,w,T;return d=n.BubbleMenu,p=n.BubbleMenuItem,f=r.FileViewerPane,y=r.SplitButtonActionLocation,T=i.getSplitButtonUserActionContext,g=s.ShareDownloadActionOption,b=u._,w=t.DOM,S=t.createElement,p=t.createFactory(p),E=t.createFactory(l),_=t.createClass({displayName:"DownloadMainButton",propTypes:{className:t.PropTypes.string,isDisabled:t.PropTypes.bool,onClick:t.PropTypes.func,isMaestroDesign:t.PropTypes.bool},getDefaultProps:function(){return{isDisabled:!1,isMaestroDesign:!1}},getInitialState:function(){return{isDisabled:!0}},componentDidMount:function(){return this.setState({isDisabled:this.props.isDisabled})},render:function(){var t,n;return t=e((n={},n[""+this.props.className]=null!=this.props.className,n["button-secondary"]=!0,n["c-btn"]=this.props.isMaestroDesign,n["c-btn--secondary"]=this.props.isMaestroDesign,n["download-button"]=!0,n.control__button=!0,n)),w.button({id:"download-menu-button",className:t,disabled:this.state.isDisabled,onClick:this.props.onClick},this.props.children)}}),m=t.createClass({displayName:"DownloadSimpleButton",propTypes:{targetText:t.PropTypes.string.isRequired,option:t.PropTypes.instanceOf(g).isRequired,onClick:t.PropTypes.func,location:t.PropTypes.number,isMaestroDesign:t.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},render:function(){var e;return e=function(e){return function(t){var n;return t.preventDefault(),"function"==typeof(n=e.props).onClick&&n.onClick(e.props.option),e.props.option.handler(),o.logUserAction(e.props.option.userActionName,T(y.MAIN,e.props.location))}}(this),S(_,{onClick:e,isMaestroDesign:this.props.isMaestroDesign},this.props.targetText)}}),h=t.createClass({displayName:"DownloadDropdown",propTypes:{targetText:t.PropTypes.string.isRequired,options:t.PropTypes.arrayOf(t.PropTypes.instanceOf(g)).isRequired,isDisabled:t.PropTypes.bool,isMaestroDesign:t.PropTypes.bool,justifyRight:t.PropTypes.bool,onClick:t.PropTypes.func,location:t.PropTypes.number,title:t.PropTypes.string},getDefaultProps:function(){return{justifyRight:!0,isMaestroDesign:!1}},getInitialState:function(){return{isDisabled:!0}},componentDidMount:function(){return this.setState({isDisabled:this.props.isDisabled})},_onClickProxy:function(e,t){return function(n){return function(r){var i;return"function"==typeof(i=n.props).onClick&&i.onClick(),"function"==typeof e.handler&&e.handler(),o.logUserAction(e.userActionName,T(t,n.props.location))}}(this)},_renderMoreOptionsButton:function(){var t;return t=e({"button-secondary":!0,"c-btn":this.props.isMaestroDesign,"c-btn--secondary":this.props.isMaestroDesign,"c-split-btn":!0,"c-split-btn--right":!0,"c-split-btn--dropdown":!0,control__button:!0,disabled:this.state.isDisabled}),w.button({className:t},S(a,{group:"web",name:"control_menu",alt:b("More options")}))},_renderDropdownButton:function(){var t;return t=e({"button-secondary":!0,"c-btn":!0,"c-btn--secondary":!0,"download-button":!0,control__button:!0,disabled:this.state.isDisabled}),w.button({className:t},this.props.targetText)},_renderMenu:function(e){var t;return S(d,{targetButton:e,position:this.props.justifyRight?d.POSITIONS.BOTTOM_ALIGN_RIGHT:d.POSITIONS.BOTTOM,verticalDisplacement:4,className:"react-file-viewer-dropdown",items:function(){var e,n,o,r;for(o=this.props.options,r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push(p({onClick:this._onClickProxy(t,y.SPLIT),disabled:t.isDisabled},this.props.isMaestroDesign?t.text:E({group:"web",name:t.spriteName,text:t.text})));return r}.call(this)})},render:function(){var t,n,o;return n=this.props.options[0],t=e({"c-split-btn":!0,"c-split-btn--left":!0,disabled:n.isDisabled}),o=e({"c-split-btn-container":!0,disabled:this.props.isDisabled,"c-title-bubble":this.props.isDisabled,"c-title-bubble--respect-line-break":this.props.isDisabled,"u-font-center":this.props.isDisabled}),this.props.isMaestroDesign?this.props.isDisabled?S(_,{isDisabled:!0,isMaestroDesign:!0},this.props.targetText):this._renderMenu(this._renderDropdownButton()):w.div({className:o,"data-title":this.props.title},S(_,{className:t,isDisabled:n.isDisabled,isMaestroDesign:this.props.isMaestroDesign,onClick:n.isDisabled?void 0:this._onClickProxy(n,y.MAIN)},this.props.targetText),this._renderMenu(this._renderMoreOptionsButton()))}}),v=t.createClass({displayName:"ShareDownloadButton",propTypes:{sharedLinkInfo:t.PropTypes.object.isRequired,shareToken:t.PropTypes.object.isRequired,sharePermissions:t.PropTypes.shape({canCopyToDropboxRoles:t.PropTypes.array.isRequired,canDownloadRoles:t.PropTypes.array.isRequired}),fileOrFolder:t.PropTypes.object.isRequired,isMaestroDesign:t.PropTypes.bool,justifyRight:t.PropTypes.bool,onClick:t.PropTypes.func,location:t.PropTypes.number},getDefaultProps:function(){return{isMaestroDesign:!1}},_getDetailOptions:function(){var e,t,n,o,r,i,s,a,l,u,d,p,h,_,m,f,v;if(u=this.props.sharePermissions,r=u.canDownloadRoles,o=u.canCopyToDropboxRoles,t=g.buildDirectOption,n=g.buildToDropboxOption,l=[],null===(null!=(d=this.props.fileOrFolder)?d.ns_id:void 0))return l;if(e=function(e,t){var r;return r=indexOf.call(o,t)<0,l.push(n(_,i,v,e,t,r))},r.length>0&&l.push(t(this.props.sharedLinkInfo)),o.length>0){for(p=this.props,_=p.shareToken,i=p.fileOrFolder,v=c.get_viewer(),f=v.get_users(!0),s=0,a=f.length;a>s;s++)m=f[s],e(m,m.role);h="anonymous",indexOf.call(o,h)>=0&&e(null,"anonymous")}return l},_getTargetText:function(e){return b(this.props.sharePermissions.canDownloadRoles.length>0?this.props.isMaestroDesign?e>1?"Download ▾":"Download":"Download":"Add to Dropbox")},_getTooltipLabel:function(){var e;return b(null===(null!=(e=this.props.fileOrFolder)?e.ns_id:void 0)?"Download is unavailable while file is uploading.":"The owner turned off the option to download.")},render:function(){var e;return e=this._getDetailOptions(),0===e.length?S(h,{targetText:b("Download"),isDisabled:!0,isMaestroDesign:this.props.isMaestroDesign,options:[{isDisabled:!0}],justifyRight:this.props.justifyRight,onClick:this.props.onClick,location:this.props.location,title:this._getTooltipLabel()}):1===e.length?S(m,{targetText:this._getTargetText(e.length),option:e[0],onClick:this.props.onClick,location:this.props.location,isMaestroDesign:this.props.isMaestroDesign}):S(h,{targetText:this._getTargetText(e.length),options:e,justifyRight:this.props.justifyRight,onClick:this.props.onClick,location:this.props.location,isMaestroDesign:this.props.isMaestroDesign})}})}),define("modules/clean/react/share_download/models",["require","exports","tslib","external/immutable","modules/clean/react/file_viewer/constants","modules/clean/react/share_download/actions","modules/core/i18n"],function(e,t,n,o,r,i,s){"use strict";var a={text:void 0,handler:void 0,spriteName:void 0,isDisabled:void 0,userActionName:void 0},l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.buildDirectOption=function(e){return new t({text:s._("Direct download"),handler:function(){i.direct(e)},spriteName:"download_arrow",userActionName:r.UserActionNames.DOWNLOAD})},t.buildToDropboxOption=function(e,n,o,a,l,c){void 0===c&&(c=!1);var u=s._("Save to my Dropbox"),d="dropbox",p=r.UserActionNames.SAVE_TO_DROPBOX;if(o.is_paired)switch(l){case"personal":u=s._("Save to personal Dropbox"),d="s_house",p=r.UserActionNames.SAVE_TO_DROPBOX_PERSONAL;break;case"work":u=s._("Save to %(team_name)s Dropbox").format({team_name:o.team_name}),d="s_briefcase",p=r.UserActionNames.SAVE_TO_DROPBOX_WORK}return new t({text:u,handler:function(){i.toDropbox(e,n,l,a)},spriteName:d,isDisabled:c,userActionName:p})},t}(o.Record(a));t.ShareDownloadActionOption=l}),define("modules/clean/react/share_sync/actions",["require","exports","external/es6-promise","modules/clean/multiaccount_login","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/viewer"],function(e,t,n,o,r,i){"use strict";function s(e,t,s){new n.Promise(function(e,n){var r=i.get_viewer();r.is_role_signed_in(t)?e():o.show_modal({role:t,on_success:function(){e()}})}).then(function(){r.mountSharedFolder(e,t,s)})}t.syncToDropbox=s}),define("modules/clean/react/share_sync/button",["require","exports","tslib","external/react","modules/clean/react/bubble_menu","modules/clean/react/share_sync/models","modules/clean/sharing/constants","modules/clean/sharing/views/sync_coachmark","modules/clean/react/sprite_div","modules/clean/viewer","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u){"use strict";var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.options.map(function(e){return o.createElement(r.BubbleMenuItem,{onClick:function(){return e.handler()},disabled:e.isDisabled},o.createElement(l,{group:"web",name:e.spriteName,text:e.text}))});return o.createElement(r.BubbleMenu,{targetButton:this.props.targetButton,position:r.BubbleMenu.POSITIONS.BOTTOM,verticalDisplacement:4,items:e})},t}(o.Component),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.onClickedOption=function(e,t){e.preventDefault(),t.handler()},t.prototype.getSyncOptions=function(){var e=this,t=this.props.sharePermission.canSyncToDropboxRoles,n=c.get_viewer(),o=t.map(function(t){return i.ShareSyncActionOption.buildOption(e.props.folder,n,t,s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE)});return o},t.prototype.renderSyncCoachmark=function(){var e=this.props.sharePermission.canSyncToDropboxRoles.length>0;return this.props.showSyncCoachmark&&e?o.createElement("div",{className:"sync-button__coachmark-container"},o.createElement(a.SharingSyncCoachmark,null)):null},t.prototype.renderSyncButton=function(){var e=this;if(""!==this.props.shareToken.subPath)return null;var t=this.props.sharePermission.canSyncToDropboxRoles;if(0===t.length)return null;var n="button-primary control__button sync-button";if(this.props.outOfQuota)return o.createElement("a",{className:n,href:"/pro/buy"},u._("Upgrade to Add Folder"));var r=u._("Add to Dropbox"),i=this.getSyncOptions();if(1===i.length)return o.createElement("button",{className:n,onClick:function(t){return e.onClickedOption(t,i[0])}},r);var s=o.createElement("button",{className:n},r);return o.createElement(d,{targetButton:s,folder:this.props.folder,shareToken:this.props.shareToken,options:i})},t.prototype.render=function(){return o.createElement("div",null,this.renderSyncCoachmark(),this.renderSyncButton())},t}(o.Component);t.ShareSyncButton=p}),define("modules/clean/react/share_sync/models",["require","exports","tslib","external/immutable","modules/clean/react/share_sync/actions","modules/core/i18n"],function(e,t,n,o,r,i){"use strict";var s={text:void 0,handler:void 0,isDisabled:!1,spriteName:void 0},a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.buildOption=function(e,n,o,s){var a=i._("Save to my Dropbox"),l="dropbox";if(n.is_paired)switch(o){case"personal":a=i._("Save to personal Dropbox"),l="s_house";break;case"work":a=i._("Save to %(team_name)s Dropbox").format({team_name:n.team_name}),l="s_briefcase"}return new t({text:a,handler:function(){r.syncToDropbox(e.shared_folder_id,o,s)},spriteName:l})},t}(o.Record(s));t.ShareSyncActionOption=a}),define("modules/clean/react/shared_link/actions",["external/es6-promise","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/core/browser"],function(e,t,n,o){var r,i,s,a;return r=e.Promise,i=t.ShareApiClient,a=n.deleteLinkWithConfirmLegacy,new(s=function(){function e(){}return e.prototype.removeLink=function(e,t,n){return new r(function(o,r){return a({client:new i({userId:e}),contentName:n,onCancel:r,onDeleteLink:o,tkey:t})})},e.prototype.removeLinkAsNonOwner=function(e,t,n){return this.removeLink(e,t,n).then(function(){return o.redirect("/home")})},e}())}),define("modules/clean/react/shared_link_folder/actions",["require","exports","modules/clean/history","modules/clean/react/shared_link_folder/constants","modules/clean/react/shared_link_folder/dispatcher","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i,s){"use strict";function a(e){m("preview",e.filename)}function l(){f("preview")}function c(e){i.redirect(e.href)}function u(){m("lst","")}function d(){f("lst")}function p(e,t,n,i,s){r.sharedLinkFolderDispatcher.dispatch({type:o.SharedLinkFolderAction.InitializeFolder,data:{files:e,folderSharePermissions:t,folderShareTokens:n,folderSharedLinkInfos:i,folders:s}})}function h(){var e=s.parse(n.get_url());return e.setPath(s.encode_parts(e.getPath())),e}function _(e){n.push_state(e.getPath(),e.getQuery())}function m(e,t){var n={};n[e]=t;var o=h();o.updateQuery(n),_(o)}function f(e){var t=h();t.removeQuery(e),_(t)}t.openFile=a,t.closeFile=l,t.openFolder=c,t.enableListMode=u,t.disableListMode=d,t.initializeFolder=p}),define("modules/clean/react/shared_link_folder/app",["require","exports","tslib","external/react","external/underscore","modules/clean/history","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/react/open_in_app/actions","modules/clean/react/shared_link_folder/actions","modules/clean/react/shared_link_folder/page","modules/clean/react/shared_link_folder/store","modules/constants/python","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_){"use strict";var m=function(e){function t(t){var n=e.call(this,t)||this;return n.onUpdateFromStore=function(){if(n.setState(n.getStateFromStore()),n.state.isViewingFile){var e=_.parse(h.get_href()),t=e.getQuery(),o=t.preview;setTimeout(function(){n.setupFileViewer(o)},0)}},n.onLocationChange=function(e,t){var o=t.preview,i={isViewingFile:!!o,shouldForceListMode:"lst"in t};i.isViewingFile&&!n.state.isViewingFile&&n.setupFileViewer(o),r.isMatch(n.state,i)||n.setState(i)},n.state={isViewingFile:!1,shouldForceListMode:!1,files:n.props.contents.files,fileSharePermissions:n.props.contents.fileSharePermissions,fileShareTokens:n.props.contents.fileShareTokens,fileSharedLinkInfos:n.props.contents.fileSharedLinkInfos,folders:n.props.contents.folders},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=_.parse(h.get_href());this.onLocationChange(e.getPath(),e.getQuery()),this.props.openImmediatelyInApp&&this.openImmediatelyInApp();var t=this.props.contents,n=t.files,o=t.fileSharePermissions,r=t.fileShareTokens,i=t.fileSharedLinkInfos,s=t.folders;c.initializeFolder(n,o,r,i,s),this.unsubscribe=d.sharedLinkFolderStore.addListener(this.onUpdateFromStore)},t.prototype.componentWillUnmount=function(){this.unsubscribe()},t.prototype.getStateFromStore=function(){return{files:d.sharedLinkFolderStore.getFiles(),fileSharedLinkInfos:d.sharedLinkFolderStore.getFileSharedLinkInfos(),fileShareTokens:d.sharedLinkFolderStore.getFileShareTokens(),fileSharePermissions:d.sharedLinkFolderStore.getFileSharePermissions(),folders:d.sharedLinkFolderStore.getFolders()}},t.prototype.openImmediatelyInApp=function(){try{this.props.folder.open_in_app_data&&l.openImmediately(this.props.folder.open_in_app_data)}catch(e){}},t.prototype.componentDidMount=function(){i.add_callback("/sh",this.onLocationChange,!0),i.add_callback("/scl",this.onLocationChange,!0)},t.prototype.setupFileViewer=function(e){var t=this.state.files,n=r.find(t,function(t){return t.filename===e}),o=t.indexOf(n);s.setup(t,o,this.props.user,{sharedLinkInfos:this.state.fileSharedLinkInfos,shareTokens:this.state.fileShareTokens,sharePermissions:this.state.fileSharePermissions})},t.prototype.render=function(){if(this.state.isViewingFile)return o.createElement(a.FileViewer,{accountMenuOptions:this.props.accountMenuOptions,activityContext:this.props.activityContext,fileViewOrigin:this.props.fileViewOrigin,fileViewTarget:this.props.fileViewTarget,fileViewAction:p.FileViewActionType.CLICK,skipOuterRouting:!0,canClose:!0,onCloseViewer:c.closeFile});var e={files:this.state.files,folders:this.state.folders};return o.createElement(u.SharedLinkFolderPage,{accountMenuOptions:this.props.accountMenuOptions,folder:this.props.folder,folderSharedLinkInfo:this.props.folderSharedLinkInfo,folderShareToken:this.props.folderShareToken,folderSharePermission:this.props.folderSharePermission,contents:e,user:this.props.user,outOfQuota:this.props.outOfQuota,shouldForceListMode:this.state.shouldForceListMode,showSyncCoachmark:this.props.showSyncCoachmark,takedownRequestType:this.props.takedownRequestType,membershipRequestOptions:this.props.membershipRequestOptions})},t}(o.Component);t.SharedLinkFolderApp=m}),define("modules/clean/react/shared_link_folder/controls",["require","exports","tslib","external/classnames","external/react","external/underscore","modules/clean/react/account_menu/account_menu","modules/clean/react/file_action_button","modules/clean/react/file_viewer/copyright_flag","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/share_sync/button","modules/clean/react/shared_link/actions","modules/clean/react/shared_link_folder/more_dropdown","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/react/user_notifications/constants","modules/clean/viewer","modules/constants/file_viewer","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b){"use strict";var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.removeShareLink=function(e){e.preventDefault();var n=t.props.sharePermission.canRemoveLinkUids[0],o=t.props.shareToken.linkKey,r=t.props.shareToken.displayName;p.removeLinkAsNonOwner(n,o,r)},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"canRemoveLink",{
get:function(){return this.props.sharePermission.canRemoveLinkUids.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canSyncToDropbox",{get:function(){return this.props.sharePermission.canSyncToDropboxRoles.length>0},enumerable:!0,configurable:!0}),t.prototype.renderSyncButton=function(){return this.canSyncToDropbox?r.createElement(d.ShareSyncButton,{folder:this.props.folder,outOfQuota:this.props.outOfQuota,sharedLinkInfo:this.props.sharedLinkInfo,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,showSyncCoachmark:this.props.showSyncCoachmark}):void 0},t.prototype.renderDownloadButton=function(){return r.createElement(u,{fileOrFolder:this.props.folder,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermission,showSyncCoachmark:this.props.showSyncCoachmark,isMaestroDesign:v.MAESTRO_ENABLED})},t.prototype.renderDivider=function(){return r.createElement("div",{className:"react-title-bar__divider"})},t.prototype.renderUserNotificationsDropdown=function(){return this.props.user?r.createElement(m.UserNotificationsDropdown,{isPagelet:!1,isMaestroDesign:v.MAESTRO_ENABLED,bellDesign:f.BellDesignTypes.GRAY_ICON}):void 0},t.prototype.shouldShowOpenInAppButton=function(){return!!this.props.folder.open_in_app_data},t.prototype.renderOpenInAppButton=function(){return this.shouldShowOpenInAppButton()?r.createElement(c.OpenInAppButton,{urls:this.props.folder.open_in_app_data}):null},t.prototype.renderUserControls=function(){return this.props.user?this.renderAccountMenu():this.renderSignIn()},t.prototype.renderAccountMenu=function(){var e=i.extend({},this.props.accountMenuOptions,{isAccountPhotoEnabled:!0,isToolbarAccountPhotoEnabled:!0,user:this.props.user,viewer:g.get_viewer()});return r.createElement(s.AccountMenu,n.__assign({},e))},t.prototype.renderSignIn=function(){var e=new b({path:"/login",query:{cont:y.get_href()}}),t=o({"button-primary":!this.shouldShowOpenInAppButton(),"button-secondary":this.shouldShowOpenInAppButton()},"sign-in-link","control__button");return r.createElement("a",{className:t,href:e.toString()},E._("Sign in"))},t.prototype.renderMoreButton=function(){return this.canRemoveLink?r.createElement(h.MoreDropdown,null,r.createElement(a.FileActionButton,{className:"more-button__remove",type:a.FileActionButtonType.REMOVE_LINK,callback:this.removeShareLink,isMaestroDesign:v.MAESTRO_ENABLED})):void 0},t.prototype.render=function(){return v.MAESTRO_ENABLED?r.createElement(_,null,r.createElement(l,{shareToken:this.props.shareToken}),this.renderOpenInAppButton(),this.renderUserControls(),this.renderSyncButton(),this.renderDownloadButton(),this.renderMoreButton(),this.renderDivider(),this.renderUserNotificationsDropdown()):r.createElement(_,null,r.createElement(l,{shareToken:this.props.shareToken}),this.renderUserNotificationsDropdown(),this.renderOpenInAppButton(),this.renderUserControls(),this.renderSyncButton(),this.renderDownloadButton(),this.renderMoreButton())},t}(r.Component);S.displayName="SharedLinkFolderControls",t.SharedLinkFolderControls=S}),define("modules/clean/react/shared_link_folder/file_gallery",["require","exports","tslib","external/classnames","external/react","modules/clean/react/shared_link_folder/actions","modules/clean/react/shared_link_folder/gallery","modules/clean/react/thumbnail","modules/constants/shared_link_folder"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.files.map(function(e){return r.createElement(s.SharedLinkFolderGalleryCell,{key:e.filename},r.createElement(d,{file:e}))});return r.createElement(u,null,r.createElement(s.SharedLinkFolderGallery,null,e))},t}(r.Component);c.displayName="SharedLinkFolderFileGallery",t.SharedLinkFolderFileGallery=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-file-gallery-container"},this.props.children)},t}(r.Component);u.displayName="FileGalleryContainer";var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),i.openFile(t.props.file)},t}return n.__extends(t,e),t.prototype.render=function(){var e,t="video"===this.props.file.preview_type;t&&l.NEW_VIDEO_WATERMARK&&(e=r.createElement("div",{className:"sl-video-watermark"}));var n=o({"sl-file-gallery-thumbnail-container":!0,"sl-file-gallery-thumbnail-container--video":t&&!l.NEW_VIDEO_WATERMARK});return r.createElement("a",{href:this.props.file.href,onClick:this.onClick,className:"sl-file-link"},r.createElement("div",{className:n},r.createElement(a.Thumbnail,{alt:this.props.file.filename,className:"sl-file-gallery-thumbnail",file:this.props.file,shouldFadeIn:l.THUMBNAIL_IMAGE_FADE_IN}),e))},t}(r.Component);d.displayName="GalleryFile"}),define("modules/clean/react/shared_link_folder/folder_gallery",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react/shared_link_folder/actions","modules/clean/react/shared_link_folder/gallery","modules/clean/react/sprite"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=20,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.folders.map(function(e){return o.createElement(a.SharedLinkFolderGalleryCell,{key:e.filename},o.createElement(p,{folder:e}))});return o.createElement(d,null,o.createElement(a.SharedLinkFolderGallery,null,e))},t}(o.Component);u.displayName="SharedLinkFolderFolderGallery",t.SharedLinkFolderFolderGallery=u;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"sl-folder-gallery-container"},this.props.children)},t}(o.Component);d.displayName="FolderGalleryContainer";var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),s.openFolder(t.props.folder)},t}return n.__extends(t,e),t.prototype.getTruncatedName=function(){return r.em_snippet(this.props.folder.filename,c)},t.prototype.render=function(){return o.createElement("a",{href:this.props.folder.href,onClick:this.onClick},o.createElement("div",{className:"o-flag"},o.createElement("div",{className:"o-flag__fix"},o.createElement(l,{group:"web",name:i.folder_icon({size:i.ICON_SIZES.LARGE}),className:"icon",alt:this.props.folder.filename})),o.createElement("div",{className:"o-flag__flex"},this.getTruncatedName())))},t}(o.Component);p.displayName="GalleryFolder"}),define("modules/clean/react/shared_link_folder/gallery",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(i,null,o.createElement(s,null,this.props.children))},t}(o.Component);r.displayName="SharedLinkFolderGallery",t.SharedLinkFolderGallery=r;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"sl-gallery-container"},this.props.children)},t}(o.Component);i.displayName="GalleryContainer";var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("ol",{className:"sl-gallery-body clearfix"},this.props.children)},t}(o.Component);s.displayName="GalleryBody";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("li",{className:"sl-gallery-cell"},this.props.children)},t}(o.Component);a.displayName="SharedLinkFolderGalleryCell",t.SharedLinkFolderGalleryCell=a}),define("modules/clean/react/shared_link_folder/list",["require","exports","tslib","external/react","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/react/css","modules/clean/react/icon","modules/clean/react/shared_link_folder/actions","modules/clean/react/thumbnail","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d){"use strict";var p=1e3,h=40,_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.folders.map(function(e){return o.createElement(y,{key:e.filename,folder:e})}),t=this.props.files.map(function(e){return o.createElement(E,{key:e.filename,file:e})});return o.createElement(m,null,o.createElement(f,null),o.createElement(g,null,e,t))},t}(o.Component);_.displayName="SharedLinkFolderList",t.SharedLinkFolderList=a(_,["/static/css/scooter/scooter-scoped-vflebHNBy.css"]);var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"sl-list-container"},this.props.children)},t}(o.Component);m.displayName="ListContainer";var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"sl-list-header"},o.createElement("div",{className:"sl-list-row clearfix"},o.createElement("div",{className:"sl-list-column sl-list-column--filename"},d._("Name")),o.createElement("div",{className:"sl-list-column sl-list-column--filesize"},d._("Size",{comment:"byte size on disk"})),o.createElement("div",{className:"sl-list-column sl-list-column--modified"},d._("Modified",{comment:"label for last modified time"}))))},t}(o.Component);f.displayName="ListHeader";var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("ol",{className:"sl-list-body o-list-ui o-list-ui--dividers"},this.props.children)},t}(o.Component);g.displayName="ListBody";var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.onClick()},t}return n.__extends(t,e),t.prototype.getName=function(){return s.em_snippet(this.props.name,h)},t.prototype.getSize=function(){return this.props.bytes?i.format_bytes(this.props.bytes):"--"},t.prototype.getLastModified=function(){return this.props.lastModified?r.ago(this.props.lastModified):"--"},t.prototype.render=function(){return o.createElement("li",{className:"sl-list-row clearfix"},o.createElement("div",{className:"sl-list-column sl-list-column--filename"},o.createElement("a",{href:this.props.href,onClick:this.onClick,className:"sl-file-link"},o.createElement("div",{className:"o-flag"},o.createElement("div",{className:"o-flag__fix"},this.props.icon),o.createElement("div",{className:"o-flag__flex"},this.getName())))),o.createElement("div",{className:"sl-list-column sl-list-column--filesize"},this.getSize()),o.createElement("div",{className:"sl-list-column sl-list-column--modified"},this.getLastModified()))},t}(o.Component);v.displayName="ListItem";var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderIcon=function(){return o.createElement(l.FolderIcon,null)},t.prototype.render=function(){var e=this;return o.createElement(v,{icon:this.renderIcon(),name:this.props.folder.filename,href:this.props.folder.href,onClick:function(){return c.openFolder(e.props.folder)}})},t}(o.Component);y.displayName="FolderListItem";var E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderIcon=function(){return o.createElement(u.ThumbnailIcon,{alt:this.props.file.filename,file:this.props.file})},t.prototype.render=function(){var e=this;return o.createElement(v,{icon:this.renderIcon(),name:this.props.file.filename,bytes:this.props.file.bytes,lastModified:new Date(this.props.file.ts*p),href:this.props.file.href,onClick:function(){return c.openFile(e.props.file)}})},t}(o.Component);E.displayName="FileListItem"}),define("modules/clean/react/shared_link_folder/more_dropdown",["require","exports","tslib","external/react","modules/clean/react/bubble_menu","modules/clean/react/file_viewer/more_dropdown/icon","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getItems=function(){var e;return e=this.props.children instanceof Array?this.props.children:[this.props.children],e.filter(function(e){return!!e})},t.prototype.renderButton=function(e){var t=(void 0===e?{}:e).isDisabled,n=void 0===t?!1:t;return l.MAESTRO_ENABLED?o.createElement("button",{className:"more-button sprite-button",disabled:n,"aria-label":c._("More actions")},o.createElement(i.MoreDropdownIcon,null)):o.createElement("button",{className:"button-secondary control__button more-button",disabled:n},o.createElement(s,{group:"web",name:"control_more",alt:c._("More actions")}))},t.prototype.renderDisabledMenu=function(){return this.renderButton({isDisabled:!0})},t.prototype.renderMenu=function(e){return o.createElement(a,{content:c._("More"),distanceFromTarget:this.props.tooltipOffset,isTargetPositionFixed:!0,position:this.props.tooltipPosition},o.createElement(r.BubbleMenu,{className:"react-file-viewer-dropdown react-file-viewer-more-dropdown",items:e,position:this.props.menuPosition,targetButton:this.renderButton(),targetFixed:!0,verticalDisplacement:this.props.menuOffset}))},t.prototype.render=function(){var e=this.getItems();return o.createElement("div",{className:"u-mar-left-xs"},e.length>0?this.renderMenu(e):this.renderDisabledMenu())},t}(o.Component);u.displayName="MoreDropdown",u.defaultProps={menuOffset:4,menuPosition:r.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,tooltipOffset:10,tooltipPosition:a.POSITIONS.BOTTOM},t.MoreDropdown=u}),define("modules/clean/react/shared_link_folder/page",["require","exports","tslib","external/classnames","external/react","modules/clean/analytics","modules/clean/react/css","modules/clean/em_string","modules/clean/react/shared_link_folder/actions","modules/clean/react/shared_link_folder/file_gallery","modules/clean/react/shared_link_folder/folder_gallery","modules/clean/react/shared_link_folder/list","modules/clean/react/shared_link_folder/title_bar","modules/clean/react/sprite","modules/clean/react/takedown_warning","modules/clean/sharing/constants","modules/clean/static_urls","modules/clean/teams/membership_request_block","modules/clean/web_timing_logger","modules/constants/python","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E){"use strict";function b(e){return T.indexOf(e.preview_type)>=0}var S,w=35,T=["photo","video"];!function(e){e[e.Gallery=0]="Gallery",e[e.List=1]="List"}(S||(S={}));var C=function(e){function t(t){var n=e.call(this,t)||this;return n.state={viewMode:n.getViewMode(t.shouldForceListMode)},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){v.mark_time_to_view(),v.mark_time_to_interactive(),this.logSclTiming()},t.prototype.componentWillReceiveProps=function(e){this.setState({viewMode:this.getViewMode(e.shouldForceListMode)})},t.prototype.logSclTiming=function(){if(this.props.user&&this.props.folderShareToken.linkType===m.TOKEN_LINK_TYPE.SHARED_CONTENT_LINK){var e=(new Date).getTime(),t={ns_id:this.props.folder.shared_folder_id,timing:e-v.start_time()};i.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",m.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,t)}},t.prototype.getViewMode=function(e){return e||!this.isViewToggleAllowed()?S.List:S.Gallery},t.prototype.getTakedownWarning=function(){return this.props.takedownRequestType?r.createElement("div",{className:"sl-takedown-warning"},r.createElement(_,{type:this.props.takedownRequestType})):void 0},t.prototype.getTitle=function(){return a.em_snippet(this.props.folderShareToken.displayName,w)},t.prototype.getContentOwner=function(){var e=this.props.folderSharedLinkInfo,t=e.ownerName,n=e.ownerTeamName,o=e.ownerTeamLogo;if(n){var i;return o&&(i=r.createElement("span",null," via ",r.createElement("a",{href:"//www.dropbox.com?src=shmodel"},y.TRADEMARK_BUSINESS))),r.createElement("span",{className:"sl-title-owner"}," ",E._("from %(owner)s (%(team)s)").format({owner:t,team:n}),i)}},t.prototype.getMediaFiles=function(){return this.props.contents.files.filter(b)},t.prototype.getNonMediaFiles=function(){return this.props.contents.files.filter(function(e){return!b(e)})},t.prototype.isViewToggleAllowed=function(){return this.getMediaFiles().length>0},t.prototype.getGalleryFiles=function(){return this.state.viewMode===S.Gallery?this.getMediaFiles():[]},t.prototype.getGalleryFolders=function(){return this.state.viewMode===S.Gallery?this.props.contents.folders:[]},t.prototype.getListFiles=function(){return this.state.viewMode===S.Gallery?this.getNonMediaFiles():this.props.contents.files},t.prototype.getListFolders=function(){return this.state.viewMode===S.List?this.props.contents.folders:[]},t.prototype.render=function(){var e,t=this.getGalleryFiles(),n=this.getGalleryFolders(),o=this.getListFiles(),i=this.getListFolders(),s=t.length+n.length+o.length+i.length;this.isViewToggleAllowed()&&(e=r.createElement(D,{viewMode:this.state.viewMode}));var a;if(s>0){var l=void 0,h=void 0,_=void 0;n.length>0&&(l=r.createElement(u.SharedLinkFolderFolderGallery,{folders:n})),t.length>0&&(h=r.createElement(c.SharedLinkFolderFileGallery,{files:t})),(o.length>0||i.length>0)&&(_=r.createElement(d.SharedLinkFolderList,{files:o,folders:i})),a=r.createElement(R,null,l,h,_)}else a=r.createElement(k,null);return r.createElement(I,null,r.createElement(P,null,r.createElement(p.SharedLinkFolderTitleBar,{accountMenuOptions:this.props.accountMenuOptions,folder:this.props.folder,outOfQuota:this.props.outOfQuota,sharedLinkInfo:this.props.folderSharedLinkInfo,shareToken:this.props.folderShareToken,sharePermission:this.props.folderSharePermission,showSyncCoachmark:this.props.showSyncCoachmark,user:this.props.user})),r.createElement(A,null,r.createElement(N,null,r.createElement(O,null,this.getTakedownWarning(),this.getTitle(),this.getContentOwner()),e),a),r.createElement(g.MembershipRequestBlock,{membershipRequestOptions:this.props.membershipRequestOptions}))},t}(r.Component);C.displayName="SharedLinkFolderPage",C.defaultProps={shouldForceListMode:!1},t.SharedLinkFolderPageWithoutCss=C,t.SharedLinkFolderPage=s(C,["/static/css/react_title_bar-vflZdgBCG.css"]);var I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-page-container"},this.props.children)},t}(r.Component);I.displayName="PageContainer";var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-page-header"},this.props.children)},t}(r.Component);P.displayName="PageHeader";var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-page-body"},this.props.children)},t}(r.Component);A.displayName="PageBody";var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-header clearfix"},this.props.children)},t}(r.Component);N.displayName="FolderHeader";var O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("h3",{className:"sl-title"},this.props.children)},t}(r.Component);O.displayName="FolderTitle";var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-body"},this.props.children)},t}(r.Component);R.displayName="FolderBody";var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-body sl-body--empty-folder"},r.createElement("img",{className:"sl-empty-folder-icon",src:f.static_url("/static/images/icons128/folder-vfl8tOYL3.png"),alt:""}),r.createElement("h3",{className:"sl-empty-folder-message"},E._("This folder is empty")))},t}(r.Component);k.displayName="EmptyFolderBody";var D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"sl-view-toggle-container"},r.createElement(L,{isSelected:this.props.viewMode===S.Gallery,icon:"toggle_grid",label:E._("View as gallery"),onClick:l.disableListMode}),r.createElement(L,{isSelected:this.props.viewMode===S.List,icon:"toggle_list",label:E._("View as list"),onClick:l.enableListMode}))},t}(r.Component);D.displayName="FolderViewToggle";var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.onClick()},t}return n.__extends(t,e),t.prototype.render=function(){var e=o({"sl-view-toggle-option":!0,selected:this.props.isSelected});return r.createElement("a",{className:e,href:"#",onClick:this.onClick},r.createElement(h,{group:"web",name:this.props.icon,alt:this.props.label}))},t}(r.Component);L.displayName="FolderViewToggleOption"}),define("modules/clean/react/shared_link_folder/title_bar",["require","exports","tslib","external/react","modules/clean/react/shared_link_folder/controls","modules/clean/react/title_bar/base"],function(e,t,n,o,r,i){"use strict";var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderControls=function(){return o.createElement(r.SharedLinkFolderControls,{accountMenuOptions:this.props.accountMenuOptions,folder:this.props.folder,outOfQuota:this.props.outOfQuota,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission,showSyncCoachmark:this.props.showSyncCoachmark,user:this.props.user})},t.prototype.render=function(){var e=this.props.sharedLinkInfo&&this.props.sharedLinkInfo.ownerTeamLogo;return o.createElement(i,{controls:this.renderControls(),customLogoUrl:e})},t}(o.Component);s.displayName="SharedLinkFolderTitleBar",t.SharedLinkFolderTitleBar=s}),define("modules/clean/react/slider",["external/classnames","external/react","modules/clean/css"],function(e,t,n){var o,r,i,s,a,l;return l=n.require_css,a=t.DOM,o=t.createClass({displayName:"IndicatorGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,currentSlideIndex:t.PropTypes.number.isRequired,slideCount:t.PropTypes.number.isRequired,onIndicatorClick:t.PropTypes.func},render:function(){var t;return a.ul({className:e("c-slider__indicator-group",this.props.className)},function(){t=[];for(var e=0,n=this.props.slideCount;n>=0?n>e:e>n;n>=0?e++:e--)t.push(e);return t}.apply(this).map(function(t){return function(n){return a.li({key:"indicator-"+n,className:e({"c-slider__indicator":!0,"is-active":n===t.props.currentSlideIndex}),onClick:function(){var e;return"function"==typeof(e=t.props).onIndicatorClick?e.onIndicatorClick(n):void 0}})}}(this)))}}),r=t.createClass({displayName:"NavButtonGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},render:function(){return a.div({className:e("c-slider__nav-button-group",this.props.className)},this.props.children)}}),s=t.createClass({displayName:"Slides",mixins:[t.addons.PureRenderMixin],propTypes:{currentSlideIndex:t.PropTypes.number.isRequired,width:t.PropTypes.number.isRequired,height:t.PropTypes.number},getSlideCount:function(){return t.Children.count(this.props.children)},render:function(){var n;return a.div({className:"c-slider__window",style:{width:this.props.width+"px",height:null!=(n=this.props.height)?n:"auto"}},a.div({className:"c-slider__slides"},t.Children.map(this.props.children,function(t){return function(n,o){return a.div({className:e({"c-slider__slide":"c-slider__slide","is-active":t.props.currentSlideIndex===o}),style:{width:t.props.width+"px",transform:"translateX("+100*-t.props.currentSlideIndex+"%)"}},n)}}(this))))}}),i=t.createClass({displayName:"Slider",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},componentWillMount:function(){return l("/static/css/components/slider-vflbeTc0k.css")},render:function(){return a.div({className:e("c-slider",this.props.className)},this.props.children)}}),{NavButtonGroup:r,Slider:i,IndicatorGroup:o,Slides:s}}),define("modules/clean/react/sprite_div",["external/classnames","external/react","modules/clean/react/sprite"],function(e,t,n){var o,r,i;return r=t.createElement,i=t.DOM.div,o=t.createClass({displayName:"SpriteDiv",propTypes:{group:t.PropTypes.string.isRequired,name:t.PropTypes.string.isRequired,text:t.PropTypes.string,alt:t.PropTypes.string,spritePosition:t.PropTypes.oneOf(["left","right"])},getDefaultProps:function(){return{alt:"",spritePosition:"left"}},render:function(){var t,o,s,a,l,c,u,d;switch(s=this.props.group,l=this.props.name,d=this.props.text,t=this.props.alt,u=e(["sprite-frame","small","icon-"+this.props.spritePosition]),c=i({className:u,key:0},r(n,{group:s,name:l,alt:t})),a=i({className:"sprite-text",key:1},d),this.props.spritePosition){case"left":o=[c,a];break;case"right":o=[a,c]}return i({className:"sprite-div"},o)}})}),define("modules/clean/react/starred/actions",["require","exports","external/es6-promise","modules/clean/flux/dispatcher","modules/clean/react/starred/constants","modules/clean/react/starred/api","modules/clean/react/starred/model"],function(e,t,n,o,r,i,s){"use strict";var a=function(){function e(){}return e.fetchStatuses=function(e,t,a){return void 0===a&&(a=!0),a&&o.dispatch({type:r.StarredActionTypes.LOADING,idTypePairs:t}),i.fetchStatuses(e,t).then(function(e){o.dispatch({type:r.StarredActionTypes.SET_STATUS,starredStatuses:s.statusResultsToStarredStatuses(e)})}).catch(function(e){return o.dispatch({type:r.StarredActionTypes.LOAD_FAILURE,idTypePairs:t}),n.Promise.reject(e)})},e.update=function(e,t,n,s){var a={id:t,type:n};o.dispatch({type:r.StarredActionTypes.LOADING,idTypePairs:[a]});var l,c=i.update(e,t,n,s);return c.then(function(){return l=s}).catch(function(e){throw l=!s,e}).finally(function(){o.dispatch({type:r.StarredActionTypes.SET_STATUS,starredStatuses:[{idTypePair:{id:t,type:n},starred:l}]})}),c},e}();t.StarredActions=a}),define("modules/clean/react/starred/api",["require","exports","external/es6-promise","modules/clean/ajax"],function(e,t,n,o){"use strict";var r=function(e,t){var r=function(n,r){o.WebRequest({url:e,type:"POST",dataType:"json",data:t,success:n,error:function(e,t,n){return r(Error(n))}})};return new n.Promise(function(e,t){r(e,t)})};t.fetchStatuses=function(e,t){return r("/starred/get_status",{role:e,resources_json:JSON.stringify(t)})},t.update=function(e,t,n,o){return r("/starred/update",{role:e,resource_id:t,id_type:n,is_starred:o})}}),define("modules/clean/react/starred/constants",["require","exports"],function(e,t){"use strict";t.StarredLoadingState={LOADING:"LOADING",LOAD_SUCCESS:"LOAD_SUCCESS",LOAD_FAILED:"LOAD_FAILED"},t.StarredActionTypes={LOADING:"STARRED_LOADING",SET_STATUS:"STARRED_SET_STATUS",LOAD_FAILURE:"STARRED_LOAD_FAILURE"}}),define("modules/clean/react/starred/id_type_pair",["require","exports"],function(e,t){"use strict";function n(e){return e.type+":"+e.id}t.idTypePairToString=n}),define("modules/clean/react/starred/model",["require","exports"],function(e,t){"use strict";function n(e){return e.map(function(e){return{idTypePair:{id:e.id,type:e.type},starred:e.is_starred}})}t.statusResultsToStarredStatuses=n}),define("modules/clean/react/starred/star",["require","exports","tslib","external/classnames","external/react","modules/clean/react/home/starred/starred_resource_store","modules/clean/react/sprite","modules/clean/react/starred/actions","modules/clean/react/starred/store","modules/clean/react/css","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d){"use strict";var p=function(e){function t(t){var n=e.call(this,t)||this;return n.onStoreUpdate=function(){var e=n.getStateFromStore();n.state.isStarred!==e.isStarred&&n.props.onStatusChange&&n.props.onStatusChange(e.isStarred),n.setState(e)},n.onClick=function(e){if(e.stopPropagation(),e.preventDefault(),!n.state.isLoading){var t=!n.state.isStarred;a.StarredActions.update(n.props.role,n.props.id,n.props.idType,t).then(function(){n.props.onStatusChange&&n.props.onStatusChange(t)}).catch(function(e){var o,r=i.StarredResourceStore.getItem(n.props.id);o=r?t?u._("There was a problem starring %(item_name)s").format({item_name:r.title}):u._("There was a problem unstarring %(item_name)s").format({item_name:r.title}):t?u._("There was a problem starring your selection"):u._("There was a problem unstarring your selection"),d.error(o)})}},n.state=n.getStateFromStore(),n.removeStoreListener=l.StarredStore.addListener(n.onStoreUpdate),n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.prototype.getStateFromStore=function(){var e={id:this.props.id,type:this.props.idType};return{isLoading:l.StarredStore.getIsLoading(e),isStarred:l.StarredStore.getIsStarred(e)}},t.prototype.render=function(){if(void 0===this.state.isStarred)return null;var e=this.state.isStarred||this.state.isLoading?"s_star_32":"s_unstar_32",t={star__toggle:!0,"star__toggle--starred":this.state.isStarred,"star__toggle--unstarred":!this.state.isStarred,"star__toggle--loading":this.state.isLoading};return r.createElement("button",{className:o(t),role:"button","aria-pressed":this.state.isStarred,"aria-label":"Star",onClick:this.onClick,onDoubleClick:this.onClick},r.createElement(s,{group:"web",name:e,alt:""}))},t}(r.PureComponent);p.displayName="Star",t.Star=c(p,["/static/css/starred/star-vflP8cCAD.css"])}),define("modules/clean/react/starred/store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/browse/store","modules/clean/react/browse/constants","modules/clean/react/starred/actions","modules/clean/react/home/home_access/home_access_util","modules/constants/starred"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){"use strict";var h=l.BrowseStore,_=function(e){function t(){var t=e.call(this,r)||this;return t.idsToLoadingState={},t.idsToStarred={},t}return n.__extends(t,e),t.prototype.getLoadingState=function(e){return this.idsToLoadingState[a.idTypePairToString(e)]},t.prototype.getIsStarred=function(e){return this.idsToStarred[a.idTypePairToString(e)]},t.prototype.getIsLoading=function(e){return this.getLoadingState(e)===s.StarredLoadingState.LOADING},t.prototype.onLoading=function(e){var t={};e.forEach(function(e){return t[a.idTypePairToString(e)]=s.StarredLoadingState.LOADING}),this.idsToLoadingState=o.extend(this.idsToLoadingState,t)},t.prototype.onSetStatus=function(e){var t={},n={};e.forEach(function(e){var o=a.idTypePairToString(e.idTypePair);t[o]=s.StarredLoadingState.LOAD_SUCCESS,n[o]=e.starred}),this.idsToLoadingState=o.extend(this.idsToLoadingState,t),this.idsToStarred=o.extend(this.idsToStarred,n)},t.prototype.onLoadFailure=function(e){var t=this,n={};e.forEach(function(e){var o=a.idTypePairToString(e),r=t.idsToLoadingState[o];void 0!==r&&r!==s.StarredLoadingState.LOADING||(n[o]=s.StarredLoadingState.LOAD_FAILED)}),this.idsToLoadingState=o.extend(this.idsToLoadingState,n)},t.prototype.onBrowseChange=function(){
var e=this;r.waitFor([h.dispatchToken]);var t=h.files().toArray(),n=t.map(function(e){return{type:p.STARRED_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,id:e.file_id}}).filter(function(t){return t.id&&!e.idsToLoadingState.hasOwnProperty(a.idTypePairToString(t))});n.length&&(u.StarredActions.fetchStatuses(h.user().role,n,!1),this.onLoading(n))},t.prototype.__onDispatch=function(e){var t=e.action,n=h.context();switch(t.type){case c.BrowseActionTypes.LOAD_PATH:case c.BrowseActionTypes.ADD_FILES:case c.BrowseActionTypes.CHANGE_FILES:case c.BrowseActionTypes.INITIALIZE_EVERYTHING:d.isHomeEnabled()&&!n.isNonUserRelativeContext&&this.onBrowseChange();break;case s.StarredActionTypes.LOADING:this.onLoading(t.idTypePairs);break;case s.StarredActionTypes.SET_STATUS:this.onSetStatus(t.starredStatuses);break;case s.StarredActionTypes.LOAD_FAILURE:this.onLoadFailure(t.idTypePairs)}this.__emitChange()},t}(i);t._StarredStoreClass=_,t.StarredStore=new _}),define("modules/clean/react/tabs/tab_bar",["jquery","external/classnames","external/underscore","external/react","external/react-dom","modules/clean/css","modules/clean/keycode","modules/clean/react/tabs/tab_util"],function(e,t,n,o,r,i,s,a){var l;return l=o.PropTypes,o.createClass({displayName:"TabBar",propTypes:{tabs:l.arrayOf(l.oneOfType([l.string,l.number,l.shape({value:l.oneOfType([l.string,l.number]),label:l.string,rightAlign:l.bool})])).isRequired,selectedIndex:l.number,onChange:l.func,idPrefix:l.string},getDefaultProps:function(){return{selectedIndex:0,onChange:function(){}}},componentDidMount:function(){return this._fixTabWidth()},componentDidUpdate:function(){return this._fixTabWidth()},_cleanUpTabWidth:function(){return e("a",r.findDOMNode(this)).css("width","")},_fixTabWidth:function(){return this._cleanUpTabWidth(),e("a",r.findDOMNode(this)).width(function(){return e(this).width()})},_normalizedTabs:function(){return this.props.tabs.map(function(e){return"string"!=typeof e&&"number"!=typeof e||(e={value:e,label:e}),e})},_onKeydown:function(e){var t,n,o,r;return r=this._normalizedTabs(),t=null,(n=e.keyCode)===s.LEFT||n===s.UP?t=0===this.props.selectedIndex?r.length-1:this.props.selectedIndex-1:(o=e.keyCode)!==s.RIGHT&&o!==s.DOWN||(t=this.props.selectedIndex===r.length-1?0:this.props.selectedIndex+1),null!=t?(e.preventDefault(),this._selectTab(t,{focusOnTab:!0})):void 0},_selectTab:function(e,t){var n;return null==t&&(t={}),n=this._normalizedTabs()[e],this.props.onChange(n.value,e),t.focusOnTab===!0?r.findDOMNode(this.refs[e]).focus():void 0},_onClick:function(e,t){return t.preventDefault(),e!==this.props.selectedIndex?this._selectTab(e,{focusOnTab:!0}):void 0},_renderTab:function(e,n,r){var i,s,l,c,u;return s=t({"c-tabs__tab":!0,"c-tabs__tab--selected":n===this.props.selectedIndex,"c-tabs__tab--fr":e.rightAlign,"c-tabs__tab--rightmost":r}),c=n===this.props.selectedIndex,l=e.contentId?e.contentId:c?a.getTabContentId(this.props.idPrefix):"",u=c?"0":"-1",i=o.createElement("a",{href:"#",ref:n,id:a.getTabId(this.props.idPrefix,n),onClick:this._onClick.bind(this,n),onKeyDown:this._onKeydown,role:"tab","aria-selected":c,"aria-controls":l,tabIndex:u,className:"c-tabs__label"},e.label),o.createElement("li",{key:n,className:s,role:"presentation","data-value":e.value},i)},render:function(){var e,t,n,r;return r=this._normalizedTabs(),t=function(){var t,o,i;for(i=[],e=t=0,o=r.length;o>t;e=++t)n=r[e],i.push(this._renderTab(n,e,e===r.length-1));return i}.call(this),o.createElement("ul",{className:"c-tabs__bar",role:"tablist",ref:"tablist"},t)}})}),define("modules/clean/react/tabs/tab_nav",["jquery","external/underscore","external/classnames","external/react","modules/clean/react/css","modules/clean/react/tabs/tab_bar","modules/clean/react/tabs/tab_util","modules/clean/react/tabs/tabs"],function(e,t,n,o,r,i,s,a){var l,c,u,d;return c=a.TabContent,d=o.DOM,l=o.PropTypes,u=o.createClass({displayName:"TabNav",propTypes:{tabs:l.arrayOf(l.oneOfType([l.string,l.number,l.shape({value:l.oneOfType([l.string,l.number]),label:l.string,rightAlign:l.bool})])),defaultSelectedIndex:l.number,onChange:l.func,idPrefix:l.string,variant:l.string,className:l.string},getDefaultProps:function(){return{defaultSelectedIndex:0,variant:s.variants.DEFAULT,onChange:function(){}}},getInitialState:function(){return{selectedIndex:this.props.defaultSelectedIndex}},componentWillReceiveProps:function(e){return this.props.defaultSelectedIndex!==e.defaultSelectedIndex?this.setState({selectedIndex:e.defaultSelectedIndex}):void 0},_onChange:function(e,t){return this.props.onChange(e,t),this.setState({selectedIndex:t})},render:function(){var e;return e=this.props.idPrefix?this.props.idPrefix:"tabset"+t.uniqueId(),d.div({className:n(this.props.variant,this.props.className)},o.createElement(i,{tabs:this.props.tabs,onChange:this._onChange,idPrefix:e,selectedIndex:this.state.selectedIndex}),o.createElement(c,{isSelected:!0,id:s.getTabContentId(e),tabId:s.getTabId(e,this.state.selectedIndex)},this.props.children))}}),r(u,["/static/css/components/tabs-vflVBuar6.css"])}),define("modules/clean/react/tabs/tab_util",[],function(){var e;return e={variants:{DEFAULT:"c-tabs",CENTER:"c-tabs c-tabs--center",MINIMAL:"c-tabs c-tabs--minimal",UNDERLINE:"c-tabs--underline",OVERLINE:"c-tabs--overline"},getTabId:function(e,t){return e+"_tab"+(null!=t?t:"")},getTabContentId:function(e,t){return e+"_tabcontent"+(null!=t?t:"")}}}),define("modules/clean/react/tabs/tabs",["jquery","external/underscore","external/classnames","external/react","modules/clean/react/tabs/tab_bar","modules/clean/react/tabs/tab_util","modules/core/browser"],function(e,t,n,o,r,i,s){var a,l,c,u;return u=o.DOM,a=o.PropTypes,c=o.createClass({displayName:"Tabs",propTypes:{idPrefix:a.string,variant:a.string,selectedIndex:a.number,onChange:a.func,className:a.string},getDefaultProps:function(){return{variant:i.variants.DEFAULT,onChange:function(){}}},getInitialState:function(){var e;return e=this.props.idPrefix?this.props.idPrefix:"tabset"+t.uniqueId(),{selectedIndex:0,idPrefix:e}},componentWillMount:function(){var t,n,r;return r=[],n=this.state.selectedIndex,t=this.state.idPrefix,o.Children.forEach(this.props.children,function(e,o){var s;return s=i.getTabContentId(t,o),r.push({label:e.props.title,contentId:s,hashPrefix:e.props.hashPrefix,hashURL:e.props.hashURL,rightAlign:e.props.rightAlign}),e.props.isSelected?n=o:void 0}),this.setState({tabs:r,selectedIndex:n}),e(window).on("hashchange",this._selectTabFromHash)},componentWillReceiveProps:function(e){return void 0!==e.selectedIndex&&e.selectedIndex!==this.state.selectedIndex?this.setState({selectedIndex:e.selectedIndex}):void 0},componentWillUnmount:function(){return e(window).off("hashchange",this._selectTabFromHash)},componentDidMount:function(){return this._selectTabFromHash()},_onChange:function(e,t){var n;return this.setState({selectedIndex:t}),n=this.state.tabs[t],n.hashURL&&s.set_hash(n.hashURL),this.props.onChange(e,t)},_selectTabFromHash:function(){var e,t,n,o,r,i,a,l,c;if(e=s.get_hash(),null!=e){for(c=this.state.tabs,a=[],o=r=0,i=c.length;i>r;o=++r){if(l=c[o],t=l.hashPrefix,n=l.hashURL,null!=t&&0===(null!=e?e.indexOf(t):void 0)||e===n){this.setState({selectedIndex:o});break}a.push(void 0)}return a}},render:function(){return u.div({className:n(this.props.variant,this.props.className)},o.createElement(r,{tabs:this.state.tabs,onChange:this._onChange,idPrefix:this.state.idPrefix,selectedIndex:this.state.selectedIndex}),o.Children.map(this.props.children,function(e){return function(t,n){return o.cloneElement(t,{isSelected:n===e.state.selectedIndex,id:i.getTabContentId(e.state.idPrefix,n),tabId:i.getTabId(e.state.idPrefix,n)})}}(this)))}}),l=o.createClass({displayName:"TabContent",propTypes:{id:a.string,isSelected:a.bool,tabId:a.string,hashPrefix:a.string,hashURL:a.string,title:a.string},render:function(){var e;return e={"c-tabs__content":!0,"c-tabs__content--selected":this.props.isSelected},u.div({id:this.props.id,className:n(e),role:"tabpanel","aria-labelledby":this.props.tabId},this.props.children)}}),{Tabs:c,TabContent:l}}),define("modules/clean/react/takedown_warning",["external/react","modules/clean/react_format","modules/constants/python","modules/core/i18n"],function(e,t,n,o){var r,i,s,a,l,c,u;return c=t.reactFormat,r=n.TakedownRequestTypes,s=o._,u=e.DOM,a=u.a,l=u.div,i=e.createClass({displayName:"TakedownWarning",propTypes:{type:e.PropTypes.number},_getWarningMessage:function(){switch(this.props.type){case r.DMCA:return c(s("Certain files in this folder can’t be shared due to a takedown request in accordance with the DMCA. <a>Learn more</a>"),{a:a({target:"_top",href:"/help/210"})});default:return c(s("Certain files in this folder are unavailable. For more information <a>contact Dropbox support</a>."),{a:a({target:"_top",href:"/ticket"})})}},render:function(){return l({className:"notify server-success"},this._getWarningMessage())}})}),define("modules/clean/react/teams/modals/limited_team_folder_settings_modal",["external/react","external/underscore","modules/core/i18n","modules/clean/analytics","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_upsell_modal_banner","modules/clean/sharing/folder_settings_modal","modules/constants/python"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p;return d=n._,u=o.TeamsWebActionsLogger,l=r.Modal,c=s.SharedFolderSettingsModal,p=e.createElement,{showWithProps:function(e){var n,o;return n={altAction:p(i,{upsellText:d("Want to access these settings as well as other admin controls? Upgrade to %(trademark_business)s.").format({trademark_business:a.TRADEMARK_BUSINESS}),upgradeButtonText:d("Upgrade now"),redirectQuery:{tk:"team_settings",_camp:"modal"},logEventName:"team_folder_settings_upsell"})},o=l.showInstance(p(c,t(e).extend(n))),u.log("team_folder_settings",null,null,null,!1,u.LOG_CATEGORY.TEAM_INFO),o}}}),define("modules/clean/react/teams/modals/limited_team_share_folder_modal",["external/react","modules/core/i18n","modules/clean/analytics","modules/clean/filepath","modules/clean/react/modal","modules/core/browser","modules/core/uri"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h;return u=t._,c=n.TeamsWebActionsLogger,l=r.Modal,h=e.DOM,p=e.createElement,d=function(e){return c.log(e,null,null,null,!1,c.LOG_CATEGORY.TEAM_INFO)},a=e.createClass({mixins:[e.addons.PureRenderMixin],displayName:"LimitedTeamShareFolderModal",propTypes:{fqPath:e.PropTypes.string.isRequired},_navigateToTeam:function(){return d("team_folder_share_invite"),i.redirect(s({path:"/team",query:{invite_members:"",tk:"team_folder_share_invite",_camp:"modal"}}))},render:function(){var e;return e=o.filename(this.props.fqPath),p(l,{title:u("Share %(folder_name)s").format({folder_name:e}),acceptButtonText:u("Invite"),onAccept:this._navigateToTeam,showButtonDivider:!0},h.div({},u("To share the %(folder_name)s with someone, invite them to join your team!").format({folder_name:e})))}}),{showModalInstance:function(e){var t;return t=l.showInstance(p(a,e)),d("team_folder_share"),t}}}),define("modules/clean/react/teams/modals/limited_team_upsell_modal_banner",["external/react","modules/core/browser","modules/core/uri","modules/clean/react/button","modules/clean/analytics"],function(e,t,n,o,r){var i,s,a,l,c,u;return a=o.button,s=r.TeamsWebActionsLogger,c=e.DOM,l=e.createElement,u=e.PropTypes,i=e.createClass({mixins:[e.addons.PureRenderMixin],propTypes:{upgradeButtonText:u.string.isRequired,upsellText:u.string.isRequired,logEventName:u.string,redirectUrl:u.string,redirectQuery:u.shape({tk:u.string,_camp:u.string})},displayName:"LimitedTeamUpsellModalBanner",_handleCTAClick:function(){return this.props.logEventName&&s.log(this.props.logEventName,{},null,null,!1,s.LOG_CATEGORY.UPGRADE),t.redirect(n({path:this.props.redirectUrl?this.props.redirectUrl:"/team/upgrade",query:this.props.redirectQuery}))},render:function(){return c.div({className:"modal-upsell-bar"},c.div({className:"modal-upsell-bar__message"},this.props.upsellText),c.div({className:"modal-upsell-bar__action"},l(a,{className:"modal-upsell-bar__cta-button",onClick:this._handleCTAClick},this.props.upgradeButtonText)))}})}),define("modules/clean/react/thumbnail",["external/classnames","external/react","external/underscore","modules/clean/photos/thumb_store","modules/clean/react/icon","modules/clean/react/sprite","modules/clean/static_urls","modules/constants/python","modules/core/uri"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h,_,m,f,g,v,y,E,b,S;return u=r.FileIcon,E=s.static_url,h=a.THUMBNAIL_SIZE_MODE,c=E("/static/images/preview_fail-vflc3IDxf.png"),d=E("/static/images/icons/ajax-loading-small-blue-vflm7vRcz.gif"),p="178x178",y=t.DOM.img,g=t.createElement,b=new o,f=t.PropTypes.shape({isLoading:t.PropTypes.bool.isRequired,src:t.PropTypes.string}),_=t.createClass({displayName:"Thumbnail",propTypes:{alt:t.PropTypes.string.isRequired,className:t.PropTypes.string,thumbnail:f.isRequired,onClick:t.PropTypes.func,shouldFadeIn:t.PropTypes.bool},_getSrc:function(){return this.props.thumbnail.src?this.props.thumbnail.src:this.props.thumbnail.isLoading?this.props.shouldFadeIn?void 0:d:c},_getAlt:function(){var e;return this.props.shouldFadeIn?e=this.props.thumbnail.isLoading?"":this.props.alt:this.props.alt},render:function(){var t,n,o;return o={},o[""+this.props.className]=null!=this.props.className,t=o,this.props.shouldFadeIn&&(t["thumbnail-image"]=!0,t["thumbnail-image--loaded"]=!this.props.thumbnail.isLoading),n={onClick:this.props.onClick,src:this._getSrc(),alt:this._getAlt(),className:e(t)},y(n)}}),m=t.createClass({displayName:"ThumbnailIcon",propTypes:{file:t.PropTypes.object.isRequired,thumbnail:f.isRequired},render:function(){return this.props.thumbnail.src?y({alt:"",className:"icon",src:this.props.thumbnail.src}):g(u,{file:this.props.file})}}),v=function(e){var t;if(e)return t=l.parse(e),t.updateQuery("size",p),t.updateQuery("size_mode",h.EXACT),t.toString()},S=function(e){var o,r,i;return o=null!=(r=e.displayName)?r:"UnnamedComponent",i="ThumbnailLoader("+o+")",t.createClass({displayName:i,propTypes:{file:t.PropTypes.shape({thumbnail_url_tmpl:t.PropTypes.string}).isRequired},getInitialState:function(){return this._getStateForTemplateUrl(this.props.file.thumbnail_url_tmpl)},componentDidMount:function(){return this._bindThumbStore()},componentWillReceiveProps:function(e){var t;return t=e.file.thumbnail_url_tmpl,t!==this.props.file.thumbnail_url_tmpl?this.setState(this._getStateForTemplateUrl(t)):void 0},componentWillUpdate:function(){return this._unbindThumbStore()},componentDidUpdate:function(){return this._bindThumbStore()},componentWillUnmount:function(){return this._unbindThumbStore()},_getStateForTemplateUrl:function(e){var t,n,o;return o=v(e),o&&(n=b.get_thumb(o)),t=Boolean(o)&&!Boolean(n),{isLoading:t,src:n,url:o}},_bindThumbStore:function(){var e;if(this.state.isLoading&&!this._bindingId)return e=this.state.url,this._bindingId=b.bind_url(e,{onSuccess:function(t){return function(){return t.setState({isLoading:!1,src:b.get_thumb(e)})}}(this),onError:function(e){return function(){return e.setState({isLoading:!1})}}(this)})},_unbindThumbStore:function(){return this._bindingId?(b.unbind_url(this._bindingId),delete this._bindingId):void 0},render:function(){return g(e,n.extend(n.clone(this.props),{thumbnail:{isLoading:this.state.isLoading,src:this.state.src}}))}})},{Thumbnail:S(_),ThumbnailIcon:S(m)}}),define("modules/clean/react/title_bar/base",["external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/image","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/clean/static_urls","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h,_,m,f,g,v,y,E;return p=n.UserActionNames,d=n.UserActionContextNames,E=s.static_url,c=a.MAESTRO_ENABLED,h=l._,y=e.DOM,_=y.a,m=y.button,g=y.div,v=y.img,f=e.createElement,u=e.createClass({displayName:"TitleBarBase",propTypes:{title:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node,e.PropTypes.arrayOf(e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node]))]),controls:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node,e.PropTypes.arrayOf(e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node]))]),customLogoUrl:e.PropTypes.string,canClose:e.PropTypes.bool,closeTitle:e.PropTypes.string,onClose:e.PropTypes.func},getDefaultProps:function(){return{canClose:!1}},_renderCornerIcon:function(){return this.props.canClose?this._renderClose():this._renderLogo()},_handleClose:function(e){var t;e.stopPropagation(),"function"==typeof(t=this.props).onClose&&t.onClose()},_renderClose:function(){return c?f(i,{position:i.POSITIONS.RIGHT,content:this.props.closeTitle,className:"title-bar-back-tooltip",isTargetPositionFixed:!0},m({className:"react-title-bar__close u-mar-horizontal-xxs",onClick:this._handleClose},f(o,{alt:h("Back"),width:32,src:E("/static/images/file_viewer/arrow_left-vflSMJAmE.png"),srcHiRes:E("/static/images/file_viewer/arrow_left@2x-vflTImUmm.png")}))):m({className:"react-title-bar__close u-mar-horizontal-xxs",title:h("Close"),onClick:this._handleClose},f(r,{group:"web",name:"control_close",alt:h("Close")}))},_logLogoClick:function(){return t.logUserAction(this.props.customLogoUrl?p.CLICK_CUSTOM_LOGO:p.CLICK_DROPBOX_LOGO,d.TITLE_BAR_MAIN)},_renderLogo:function(){var e,t;return t="title-bar-icon__img",e=this.props.customLogoUrl?v({alt:"Logo",src:this.props.customLogoUrl,className:t}):f(o,{alt:"Dropbox",src:E("/static/images/header/header_logo_shmodel-vflsZ7QsE.png"),srcHiRes:E("/static/images/header/header_logo_shmodel@2x-vflvJX68X.png"),className:t}),_({href:"//www.dropbox.com?src=shmodel",className:"title-bar-icon u-mar-horizontal-xxs",onClick:this._logLogoClick},e)},render:function(){var t,n,o;return n=function(e){return e},o=e.Children.map(this.props.title,n),t=e.Children.map(this.props.controls,n),g({className:"react-title-bar"},g({className:"react-title-bar__title-wrap"},this._renderCornerIcon(),o&&!c?g({className:"react-title-bar__divider u-mar-vertical-xs"}):void 0,o),g({className:"react-title-bar__action-wrap"},t))}})}),define("modules/clean/react/title_bar/controls_container",["external/react"],function(e){var t,n;return n=e.DOM.div,t=e.createClass({displayName:"TitleBarControlsContainer",render:function(){return n({className:"react-title-bar__controls u-mar-right-xs"},this.props.children)}})}),define("modules/clean/react/title_bubble",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/react/css","modules/clean/react/overlay"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m,f;return u=s.PositionedOverlay,m=n.DOM,_=n.createElement,a=e(document.body),l="titleBubble-positioningTarget",d={TOP:u.POSITIONS.TOP,BOTTOM:u.POSITIONS.BOTTOM,LEFT:u.POSITIONS.LEFT,RIGHT:u.POSITIONS.RIGHT,BOTTOM_ALIGN_RIGHT:u.POSITIONS.BOTTOM_ALIGN_RIGHT,BOTTOM_ALIGN_LEFT:u.POSITIONS.BOTTOM_ALIGN_LEFT,TOP_ALIGN_RIGHT:u.POSITIONS.TOP_ALIGN_RIGHT,TOP_ALIGN_LEFT:u.POSITIONS.TOP_ALIGN_LEFT},f={},f[""+d.TOP]="top",f[""+d.BOTTOM]="bottom",f[""+d.LEFT]="left",f[""+d.RIGHT]="right",f[""+d.BOTTOM_ALIGN_RIGHT]="bottom-align-right",f[""+d.BOTTOM_ALIGN_LEFT]="bottom-align-left",f[""+d.TOP_ALIGN_RIGHT]="top-align-right",f[""+d.TOP_ALIGN_LEFT]="top-align-left",c=f,h=n.createClass({displayName:"TitleBubble",propTypes:{content:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.string]).isRequired,children:n.PropTypes.element.isRequired,position:n.PropTypes.oneOf(r.values(d)).isRequired,distanceFromTarget:n.PropTypes.number,isTargetPositionFixed:n.PropTypes.bool,onMouseEnter:n.PropTypes.func,shouldReadContents:n.PropTypes.bool,className:n.PropTypes.string},getDefaultProps:function(){return{distanceFromTarget:0,isTargetPositionFixed:!1,onMouseEnter:r.noop,shouldReadContents:!1,className:null}},getInitialState:function(){return{isFocused:!1,isHovering:!1,targetNode:null}},componentWillMount:function(){return this.titleBubbleId=r.uniqueId("react-title-bubble-")},componentDidMount:function(){var e;return e=this._getTargetNode(),this._adjustArrowPosition(e),this._throttledSetState=r.throttle(this.setState,100)},componentDidUpdate:function(){return this.state.targetNode||this._getTargetNode(),this._adjustArrowPosition(this.state.targetNode)},_getTargetNode:function(){var t,n,r;return r=o.findDOMNode(this.refs.titleBubbleContainer),t=r.childNodes[0],"NOSCRIPT"!==t.tagName?(n=r.getElementsByClassName(l)[0]||t,this.setState({targetNode:n}),this.props.shouldReadContents&&e(t).attr("aria-describedby",this.titleBubbleId),n):void 0},_getPositionOffset:function(){var e;return e={horizontal:0,vertical:0},c[this.props.position].match(/^top/)?e.vertical=-this.props.distanceFromTarget:c[this.props.position].match(/^bottom/)?e.vertical=this.props.distanceFromTarget:c[this.props.position].match(/^left/)?e.horizontal=-this.props.distanceFromTarget:c[this.props.position].match(/^right/)&&(e.horizontal=this.props.distanceFromTarget),e},_adjustArrowPosition:function(t){var n;if(null!=t)switch(this.props.position){case p.POSITIONS.TOP_ALIGN_LEFT:case p.POSITIONS.BOTTOM_ALIGN_LEFT:return n=e(o.findDOMNode(this.refs.arrow)),n.css("left",t.offsetWidth/2);case p.POSITIONS.TOP_ALIGN_RIGHT:case p.POSITIONS.BOTTOM_ALIGN_RIGHT:return n=e(o.findDOMNode(this.refs.arrow)),n.css("right",t.offsetWidth/2)}},render:function(){var o;return o=t("react-title-bubble","react-title-bubble--"+c[this.props.position],this.props.className),m.div({ref:"titleBubbleContainer",className:"react-title-bubble__container",onClick:function(e){return function(){return e._throttledSetState({isFocused:!1,isHovering:!1})}}(this),onFocus:function(e){return function(){return e._throttledSetState({isFocused:!0})}}(this),onBlur:function(e){return function(){return e._throttledSetState({isFocused:!1})}}(this),onMouseEnter:function(e){return function(){return e.props.onMouseEnter(),e._throttledSetState({isHovering:!0})}}(this),onMouseLeave:function(t){return function(){return e(t.state.targetNode).is(":focus")||e(t.state.targetNode).children(":focus").length?t._throttledSetState({isHovering:!1}):t._throttledSetState({isFocused:!1,isHovering:!1})}}(this)},n.Children.only(this.props.children),this.state.isHovering||this.state.isFocused&&a.hasClass("tabbing")?_(u,{className:"react-title-bubble--disable-pointer",targetNode:this.state.targetNode,isTargetPositionFixed:this.props.isTargetPositionFixed,position:this.props.position,positionOffset:this._getPositionOffset(),isContentFocusable:!1},m.div({id:this.titleBubbleId,className:o},this.props.content,m.div({ref:"arrow",className:"arrow"}))):void 0)}}),p=i(h,["/static/css/components/title_bubble-vfl3yK_gU.css"]),p.POSITIONS=d,p.POSITIONING_TARGET_CLASS=l,p}),define("modules/clean/react/tooltip",["external/react","external/react-dom","external/underscore","jquery"],function(e,t,n,o){var r,i,s,a,l,c,u,d,p,h,_;return u={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},h=e.DOM,s="tooltip-holder",r=7,a=1e4,i="data-event-id",p=function(){var e,t;return e=s,t=o("#"+e),t.length||(t=o("<div />").attr({id:e,style:"z-index: "+a}).prependTo("body")),t[0]},d=function(e){var t,n,o;return n=e.offset(),o=e.outerWidth(),t=e.outerHeight(),{left_x:n.left,right_x:n.left+o,top_y:n.top,bottom_y:n.top+t,width:o,height:t}},c=e.createClass({displayName:"TooltipBubble",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(_ in u)e.push(u[_]);return e}()),contents:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.string]),className:e.PropTypes.string,mouse_move_cb:e.PropTypes.func,mouse_out_cb:e.PropTypes.func,targetElementDimensions:e.PropTypes.shape({left_x:e.PropTypes.number,right_x:e.PropTypes.number,top_y:e.PropTypes.number,bottom_y:e.PropTypes.number,width:e.PropTypes.number,height:e.PropTypes.number})},render:function(){var e,t,n,i,s;return t=this.props.targetElementDimensions,n=o(window),s=o(window).scrollTop(),i=o(window).scrollLeft(),e=function(){switch(this.props.position){case u.TOP:return{bottom:n.height()-t.top_y+r+s};case u.BOTTOM:return{top:t.bottom_y+r-s};case u.LEFT:return{right:n.width()-t.left_x+r+i};case u.RIGHT:return{left:t.right_x+r-i}}}.call(this),h.div({className:"tooltip-bubble "+(this.props.className||""),ref:"tooltip",style:e,onMouseMove:this.props.mouse_move_cb?this.props.mouse_move_cb:void 0,onMouseLeave:this.props.mouse_out_cb?this.props.mouse_out_cb:void 0},h.div({className:"tooltip-inner"},this.props.contents))},componentDidMount:function(){return this._centerAndShow()},componentDidUpdate:function(){return this._centerAndShow()},_centerAndShow:function(){var e,n,r,i,s,a,l,c,p;return e=o(t.findDOMNode(this.refs.tooltip)),l=this.props.targetElementDimensions,c=d(e),a=o(window).scrollTop(),s=o(window).scrollLeft(),(r=this.props.position)===u.TOP||r===u.BOTTOM?(n=l.left_x+l.width/2-c.width/2-s,e.css("left",n+"px")):(i=this.props.position)!==u.LEFT&&i!==u.RIGHT||(p=l.top_y+l.height/2-c.height/2-a,e.css("top",p+"px")),e.show()}}),l=e.createClass({displayName:"Tooltip",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(_ in u)e.push(u[_]);return e}()),tooltip_contents:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.string]),tooltip_classname:e.PropTypes.string,hide_delay:e.PropTypes.number,interaction_enabled:e.PropTypes.bool},render:function(){return h.div({className:"tooltip-target",onMouseMove:function(e){return function(t){return e._show(t)}}(this),onMouseLeave:this._on_mouse_leave(),id:this.state.tooltip_id,ref:"tooltipTarget"},this.props.children)},componentDidMount:function(){return o(document).bind("scroll."+this.state.event_id,function(e){return function(t){return e._hide(t)}}(this))},componentDidUpdate:function(){return this.state.visible?this._render_tooltip():void 0},componentWillUnmount:function(){var e;return o(document).unbind("scroll."+this.state.event_id),e=p(),t.unmountComponentAtNode(e)},_on_mouse_leave:function(e){return function(e){return function(t){return e.props.hide_delay>0?e._scheduleHide(e.props.hide_delay):e._hide(t)}}(this)},_render_tooltip:function(){var n,r;return r=p(),o("#"+s).css("position","fixed"),o("#"+s).css("left","0"),o("#"+s).css("right","0"),this.props.hide_delay>0&&o("#"+s).attr(i,this.state.event_id),this.props.position===u.TOP?(o("#"+s).css("top","auto"),o("#"+s).css("bottom","0")):(o("#"+s).css("top","0"),o("#"+s).css("bottom","auto")),n=e.createElement(c,{position:this.props.position,contents:this.props.tooltip_contents,className:this.props.tooltip_classname,mouse_move_cb:this.props.interaction_enabled?this._clear_timeout:void 0,mouse_out_cb:this.props.interaction_enabled?this._on_mouse_leave():void 0,targetElementDimensions:d(o(t.findDOMNode(this.refs.tooltipTarget)))}),t.unmountComponentAtNode(r),t.render(n,r)},_show:function(){return!this.state.visible||this._last_timeout?(this._render_tooltip(),this.setState({visible:!0}),this._clear_timeout()):void 0},_hide:function(){var e,n;if(this.state.visible)return n=p(),this._last_timeout?(e=o(n).attr(i),e===this.state.event_id&&(t.unmountComponentAtNode(n),null!=this._clear_timeout())):t.unmountComponentAtNode(n),this.setState({visible:!1})},_scheduleHide:function(e){return this.state.visible?this._last_timeout=setTimeout(this._hide,e):void 0},_clear_timeout:function(){return this._last_timeout?(clearTimeout(this._last_timeout),this._last_timeout=null):void 0},getInitialState:function(){return{visible:!1,event_id:n.uniqueId()}},getDefaultProps:function(){return{interaction_enabled:!1,hide_delay:0}}}),{Tooltip:l,TooltipPosition:u}}),define("modules/clean/react/tree_view",["jquery","external/immutable","external/underscore","external/classnames","external/react","external/react-dom","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css","modules/clean/react/browse/store","modules/clean/react/image","modules/clean/react/sprite","modules/clean/viewer","modules/core/i18n","modules/core/notify","modules/clean/keycode"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f){var g,v,y,E,b,S,w,T,C,I,P,A,N,O,R;return R=l.filename,g=u.BrowseStore,A=_._,O=r.DOM,N=r.createElement,E=20,y=15,b={None:"None",TreeItem:"TreeItem",HeaderItem:"HeaderItem",StaticHeader:"StaticHeader"},C=t.Record({key:void 0,label:"",icon:null,disabled:!1,canExpand:!1,forceExpanded:!1}),S=t.Record({childItemsByParentKey:t.Map(),parentItemByChildKey:t.Map(),items:t.Map(),rootItem:new C}),S.createWithRootItem=function(e){return new S({rootItem:e,items:t.Map([[e.key,e]])})},S.prototype.getParentItem=function(e){var t;if(e)return t=this.parentItemByChildKey.get(e.key),t?this.items.get(t):null},S.prototype.getChildItems=function(e){return this.childItemsByParentKey.get(e.key)||null},S.prototype.isParent=function(e){return this.childItemsByParentKey.has(e.key)},S.prototype.setChildItems=function(e,n){return this.withMutations(function(o){var r;return n=t.List(n),r=t.Map(n.map(function(e){return[e.key,e]})),o.set("items",o.items.merge(r)),o.set("childItemsByParentKey",o.childItemsByParentKey.set(e.key,n)),n.forEach(function(t){return o.set("parentItemByChildKey",o.parentItemByChildKey.set(t.key,e.key))})})},w=r.createClass({displayName:"TreeGroupView",propTypes:{ariaLabel:r.PropTypes.string},render:function(){return O.ul({className:"tree-view__group",role:"group"},this.props.children)}}),I=r.createClass({displayName:"TreeItemView",propTypes:{item:r.PropTypes.instanceOf(C).isRequired,id:r.PropTypes.string.isRequired,isSelected:r.PropTypes.bool,isExpanded:r.PropTypes.bool,canExpand:r.PropTypes.bool,level:r.PropTypes.number,onClick:r.PropTypes.func,onExpandButtonClick:r.PropTypes.func,showAsHeader:r.PropTypes.bool},getDefaultProps:function(){return{isSelected:!1,isExpanded:!1,canExpand:!1,level:0,onClick:n.noop,onExpandButtonClick:n.noop,showAsHeader:!1}},handleClick:function(e){var t;return e.preventDefault(),e.stopPropagation(),this.props.item.disabled||(null!=(t=i.findDOMNode(this.refs.expandButton))?t.contains(e.target):0)?void 0:this.props.onClick(this.props.item)},handleExpandClick:function(e){return e.preventDefault(),this.props.onExpandButtonClick(this.props.item,!this.props.isExpanded)},_renderExpandButton:function(){return O.div({className:"tree-view__expand-button",onClick:this.handleExpandClick,ref:"expandButton",role:"button"},N(p,{group:"web",name:this.props.isExpanded?"bullet_minus":"bullet_plus",alt:A(this.props.isExpanded?"Collapse":"Expand")}))},_renderIcon:function(){return O.div({className:"tree-view__icon-wrapper"},N(p,{className:"tree-view__item-icon",group:"web",name:this.props.item.icon,alt:""}))},render:function(){var e,t,n;return t=!this.props.canExpand,e=o({"tree-view__item":!0,"tree-view__item--leaf":t}),n={key:this.props.item.key,id:this.props.id,className:e,onClick:this.handleClick,role:"treeitem","aria-disabled":this.props.item.disabled,"aria-label":this.props.item.label,"aria-level":this.props.level+1},this.props.canExpand&&!this.props.showAsHeader&&(n["aria-expanded"]=this.props.isExpanded),this.props.isSelected&&(n["aria-selected"]=!0),O.li(n,O.span({className:o({"tree-view__item-row":!0,"tree-view__item-row--disabled":this.props.item.disabled}),style:{paddingLeft:this.props.showAsHeader?0:this.props.level*y}},this.props.showAsHeader||t?void 0:this._renderExpandButton(),this.props.item.icon?this._renderIcon():void 0,this.props.item.label?O.span({className:"tree-view__item-label"},a.em_snippet(this.props.item.label,E)):void 0),this.props.children)}}),T=r.createClass({displayName:"TreeHeaderView",propTypes:{item:r.PropTypes.instanceOf(C).isRequired,id:r.PropTypes.string.isRequired},_renderIcon:function(){return this.props.item.icon?N(p,{className:"tree-view__header-icon",group:"web",name:this.props.item.icon,alt:""}):null},render:function(){return O.div({className:"tree-view__item-row"},this._renderIcon(),O.h3({className:"tree-view__header",id:this.props.id},this.props.item.label))}}),P=r.createClass({displayName:"TreeView",propTypes:{tree:r.PropTypes.instanceOf(S).isRequired,rootStyle:r.PropTypes.oneOf(n.keys(b)),onItemSelected:r.PropTypes.func,onItemExpanded:r.PropTypes.func},getDefaultProps:function(){return{rootStyle:b.None,
treeItemView:I,onItemSelected:function(){},onItemExpanded:function(){}}},getInitialState:function(){return{selectedItemKey:null,expandedItemKeys:t.Set([this.props.tree.rootItem.key]),showFocused:!1}},componentDidMount:function(){return e(i.findDOMNode(this)).on("keydown",this.handleKeyDown)},componentWillUnmount:function(){return e(i.findDOMNode(this)).off("keydown")},componentDidUpdate:function(t,n){var o,r;return this.state.selectedItemKey&&this.state.selectedItemKey!==n.selectedItemKey&&(o=e(i.findDOMNode(this)),r=o.find('[aria-selected="true"]').eq(0),r.length)?this._scrollElementIntoViewIfNeeded(r,o):void 0},_scrollElementIntoViewIfNeeded:function(e,t){var n,o,r,i,s,a,l;return r=t.scrollTop(),s=r+e.position().top,l=s-r,0>l?void t.scrollTop(s):(n=t.innerHeight(),o=r+n,i=e.innerHeight(),a=s+i,a>o?t.scrollTop(s-n+i):void 0)},_hasSelectableRootItem:function(){var e;return e=this.props.rootStyle,e===b.TreeItem||e===b.HeaderItem},_getHTMLIdPrefix:function(){return this._HTMLIdPrefix||(this._HTMLIdPrefix="tree-view-"+Math.floor(16777215*Math.random()).toString(16))},selectItem:function(e){return this.setState({selectedItemKey:null!=e?e.key:void 0}),this.props.onItemSelected(e)},_getLastLeafOf:function(e){var t;return t=this.props.tree.getChildItems(e),this.state.expandedItemKeys.contains(e.key)&&(null!=t?t.size:void 0)>0?this._getLastLeafOf(t.last()):e},_getPrevItem:function(e){var t,n,o,r;return(o=this.props.tree.getParentItem(e))?(r=this.props.tree.getChildItems(o),n=r.indexOf(e),n>0?this._getLastLeafOf(r.get(n-1)):0===n?(t=o===this.props.tree.rootItem,t&&!this._hasSelectableRootItem()?null:o):null):null},_getNextItem:function(e,t){var n,o,r,i,s,a;return null==t&&(t=!0),e?(r=this.state.expandedItemKeys.contains(e.key),n=r&&this.props.tree.isParent(e),t&&n?this.props.tree.getChildItems(e).first():(s=this.props.tree.getParentItem(e))?(a=this.props.tree.getChildItems(s),i=a.size-1,o=a.indexOf(e),o===i?this._getNextItem(s,!1):o>=0&&i>o?a.get(o+1):null):null):null},advanceSelection:function(e){var t,n,o;return null==e&&(e=!1),this.state.selectedItemKey?(o=this.props.tree.items.get(this.state.selectedItemKey),n=e?this._getPrevItem(o):this._getNextItem(o),n?(this.selectItem(n),!0):void 0):(t=this._hasSelectableRootItem()?this.props.tree.rootItem:this.props.tree.getChildItems(this.props.tree.rootItem).first(),this.selectItem(t),!0)},_getValidHTMLIdForItem:function(e){return(""+this._getHTMLIdPrefix()+e.key).replace(/\s+/g,"_")},_setItemExpanded:function(e,t){return t?this.state.expandedItemKeys.add(e):this.state.expandedItemKeys.delete(e)},_canItemExpand:function(e){return e&&(e.canExpand||this.props.tree.isParent(e))},handleExpandButtonClick:function(e,t){return this.setState({expandedItemKeys:this._setItemExpanded(e.key,t)}),this.props.onItemExpanded(e,t)},handleKeyDown:function(e){var t;switch(e.which){case f.UP:if(this.advanceSelection(!0))return e.preventDefault();break;case f.DOWN:if(this.advanceSelection(!1))return e.preventDefault();break;case f.RIGHT:if(t=this.props.tree.items.get(this.state.selectedItemKey),this._canItemExpand(t))return this.handleExpandButtonClick(t,!0),e.preventDefault();break;case f.LEFT:if(t=this.props.tree.items.get(this.state.selectedItemKey),this._canItemExpand(t))return this.handleExpandButtonClick(t,!1),e.preventDefault()}},_renderSingleItem:function(e,t,o,r){var i,s;return null==o&&(o=null),null==r&&(r={}),i={id:this._getValidHTMLIdForItem(e),key:e.key,item:e,isSelected:this.state.selectedItemKey===e.key,isExpanded:this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,canExpand:this._canItemExpand(e)&&!e.forceExpanded,level:t,onClick:this.selectItem,onExpandButtonClick:this.handleExpandButtonClick},s=n.extend({},i,r),N(this.props.treeItemView,s,o)},_renderItemAndDescendants:function(e,t){var n,o;return o=this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,this.props.tree.isParent(e)&&o&&(n=this._renderChildrenOfItemAsGroup(e,t+1)),this._renderSingleItem(e,t,n)},_renderChildrenOfItemAsGroup:function(e,t){var n;return e&&this.props.tree.isParent(e)?(n=this.props.tree.getChildItems(e).map(function(e){return function(n){return e._renderItemAndDescendants(n,t)}}(this)),N(w,null,n.toJS())):null},render:function(){var e,t,n,r,i;if(t={role:"tree",tabIndex:0,onFocus:function(e){return function(){return e.setState({showFocused:!0})}}(this),onBlur:function(e){return function(){return e.setState({showFocused:!1})}}(this),className:o("tree-view","ax-focusable",{"is-focused":this.state.showFocused})},n=this.props.tree.rootItem,this.state.selectedItemKey&&(r=this.props.tree.items.get(this.state.selectedItemKey),t["aria-activedescendant"]=this._getValidHTMLIdForItem(r)),this.props.rootStyle===b.TreeItem)i=N(w,null,this._renderItemAndDescendants(n,0));else if(this.props.rootStyle===b.HeaderItem)e=this._getValidHTMLIdForItem(n),i=N(w,null,this._renderSingleItem(n,0,null,{showAsHeader:!0,id:e}),this._renderChildrenOfItemAsGroup(n,0));else if(this.props.rootStyle===b.StaticHeader)e=this._getValidHTMLIdForItem(n),i=N(w,null,N(T,{item:n,id:e}),this._renderChildrenOfItemAsGroup(n,0));else{if(this.props.rootStyle!==b.None)throw new Error("Unknown root style: "+this.props.rootStyle);i=this._renderChildrenOfItemAsGroup(this.props.tree.rootItem,0)}return e&&(t["aria-labelledby"]=e),O.div(t,i,this.props.children)}}),P=c(P,["/static/css/react/tree_view-vflOwUm_p.css","/static/css/accessibility-vflRPMGHg.css"]),v=r.createClass({displayName:"FolderTreeView",propTypes:{user:r.PropTypes.object.isRequired,rootPath:r.PropTypes.string,onFolderSelected:r.PropTypes.func,isRootSelectable:r.PropTypes.bool,treeRootName:r.PropTypes.string},getDefaultProps:function(){return{rootPath:"/",onFolderSelected:function(){},isRootSelectable:!1,treeRootName:null}},getInitialState:function(){return{showLoadingScreen:!1,tree:null}},componentWillMount:function(){var e;return this.state.tree?void 0:(e=this._constructRootItem(),this.setState({tree:S.createWithRootItem(e)}))},componentDidMount:function(){return this._isMounted=!0,this.asyncFetchSubFoldersForItem(this.state.tree.rootItem)},componentWillUnmount:function(){return this._isMounted=!1,this._pendingAjaxRequest?(this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=null):void 0},_constructRootItem:function(){var e,t;return t=this.props.treeRootName||h.get_role_title(this.props.user)||A("Dropbox"),e=h.get_viewer().is_paired?this.props.user.is_team?"s_briefcase":"s_house":"dropbox",new C({key:this.props.rootPath,icon:e,label:t})},_parseFolderList:function(e){var n,o,r,i,s,a;for(s=JSON.parse(e),a=[],o=0,i=s.length;i>o;o++)n=s[o],r=n.path,a.push(new C({key:r,label:R(n.path),canExpand:n.has_subdirs,icon:n.icon,disabled:n.read_only}));return t.List(a)},asyncFetchSubFoldersForItem:function(e){var t,n,o,r,i;return r=e.key,o=e===this.state.tree.rootItem,o&&this.setState({showLoadingScreen:!0}),t=g.context(),t.isNonUserRelativeContext?(i="/browse_util/tree_view_team_folder_contents",n={ns_id:t.rootNSID,ns_path:r,hide_tmfs:!0}):(i="/browse_util/tree_view_folders",n={folder:r}),this._pendingAjaxRequest&&this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=s.WebRequestOref({url:i,type:"POST",subject_user:this.props.user.id,data:n,success:function(t){return function(n){var o,r;return o=t._parseFolderList(n),r=t.state.tree.setChildItems(e,o),t.setState({tree:r})}}(this),error:function(){return m.error(A("An error occurred while trying to load your folder."))},complete:function(e){return function(){return e._pendingAjaxRequest=null,e._isMounted&&o?e.setState({showLoadingScreen:!1}):void 0}}(this)})},handleItemSelected:function(e){return this.props.onFolderSelected(e.key)},handleExpandButtonClick:function(e,t){return t&&!this.state.tree.isParent(e)?this.asyncFetchSubFoldersForItem(e):void 0},_renderLoadingMessage:function(){return O.span({className:"tree-view__loading-label"},A("Loading your folders…"))},render:function(){var e;return e=this.props.isRootSelectable?b.HeaderItem:b.StaticHeader,N(P,{tree:this.state.tree,rootStyle:e,onItemSelected:this.handleItemSelected,onItemExpanded:this.handleExpandButtonClick},this.state.showLoadingScreen?this._renderLoadingMessage():void 0)}}),{INDENT_SIZE_PX:y,MAX_LABEL_LENGTH:E,RootStyle:b,FolderTreeView:v,TreeView:P,TreeItemView:I,TreeItem:C,Tree:S}}),define("modules/clean/react/user_notifications/actions",["external/underscore","modules/clean/browse_interface","modules/clean/loggers/notification_logger","modules/clean/notserver","modules/clean/react/user_notifications/api","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/clean/referrer_cleansing_redirect","modules/clean/sharing/api/client","modules/clean/sharing/notifications","modules/clean/viewer","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m){var f,g,v,y,E,b;return y=n.NotificationLogger,v=o.NotClients,f=i.ActionTypes,g=a.BluenoteAction,b=h._,new(E=function(){function n(){}return n.prototype.load=function(){return s.dispatch({type:f.LOAD_REQUEST}),r.getAll(l.getCursor(),this._activeUserOnlyMode).then(function(e){var t;return t=[],t=t.concat(e.notifications),y.logReceive(t),s.dispatch({type:f.LOAD_SUCCESS,data:e}),e},function(){return s.dispatch({type:f.LOAD_FAILURE})})},n.prototype.loadOnceAndWatch=function(e){return this._hasLoadedOnce?void 0:(this._hasLoadedOnce=!0,this._activeUserOnlyMode=e,this.load(),this._watch())},n.prototype._acknowledge=function(e){return r.ack(e)},n.prototype._markAllAsSeen=function(){var e;return e=l.getUnseen(),0!==e.length?(r.markAsSeen(e),s.dispatch({type:f.MARK_AS_SEEN_REQUEST})):void 0},n.prototype.resetAcknowledgements=function(){return s.dispatch({type:f.RESET_ACKNOWLEDGEMENTS})},n.prototype._watch=function(){return e.each(v,function(e){return function(t,n){var o,r,i;return o="undefined"!=typeof ensemble&&null!==ensemble&&null!=(i=ensemble.viewer)?i.getActiveUser():void 0,e._activeUserOnlyMode&&(null!=o?o.userId:void 0)!==parseInt(n)?void 0:r=t.subscribe_user({name:"UserNotificationsActions",handler:function(){return e.load().then(function(e){return t.handler_success(r,{nid:e.cursor[n]})},function(){return t.handler_failure(r)})}})}}(this))},n.prototype.viewNotifications=function(){return this._markAllAsSeen()},n.prototype._actionPerformed=function(e,t){return y.logAction(e,t),e.isUnread?this._acknowledge(e):void 0},n.prototype.triggerGenericLegacyNotificationAction=function(e){return this._actionPerformed(e,"click")},n.prototype.dismissLegacySharingNotification=function(e,t){return this._actionPerformed(e,"button_1"),d.register_dismiss(t)},n.prototype.mountFromLegacySharingNotification=function(e,t){return this._actionPerformed(e,"button_0"),d.register_mount(t)},n.prototype.upgradeToMountFromLegacySharingNotification=function(e){return this._actionPerformed(e,"button_0"),d.upgrade_to_mount()},n.prototype.triggerBluenoteAction=function(e,t,n){return this._actionPerformed(e,n),t.actionType===g.BLUENOTE_ACTION_TYPES.OPEN_URL?this._performBluenoteOpenUrlAction(t.params):t.actionType===g.BLUENOTE_ACTION_TYPES.MOUNT_SHARED_FOLDER?this._performBluenoteMountSharedFolder(e,t.params):void 0},n.prototype._performBluenoteOpenUrlAction=function(e){return c.redirect(e.urlPath)},n.prototype._performBluenoteMountSharedFolder=function(e,n){var o,r;return r=p.get_viewer().get_user_by_id(e.userId),o=new u.FolderShareApiClient({userId:r.id}),_.info(b("Adding shared folder ...")),o.mount({contentId:n.nsId,origin:"NOTIFICATION_WEB"}).then(function(e){var n;return n=m({path:t.get_browse_root(r)+e.path_lower}).toString(),c.redirect(n),_.clear(),_.success(b("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))},function(e){var t,n;return _.clear(),"insufficient_quota"===(null!=e&&null!=(t=e.error)?t[".tag"]:void 0)?(_.info(b("Continue upgrading to add the shared folder to your Dropbox.")),n=m({scheme:"https",authority:"www.dropbox.com",path:"/pro/buy"}),n.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),c.redirect(n.toString())):null!=(null!=e?e.message:void 0)?_.error(e.message):_.error(b("Failed to add the shared folder."))})},n}())}),define("modules/clean/react/user_notifications/api",["modules/clean/ajax","modules/clean/react/user_notifications/models"],function(e,t){var n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E;return n=t.BluenoteAction,o=t.BluenoteAvatarIcon,r=t.BluenoteCampaignInfo,i=t.BluenoteData,s=t.BluenoteGenericIcon,a=t.BluenoteMountFolderActionParams,l=t.BluenoteOpenUrlActionParams,u=t.SharedFolderInviteData,d=t.UserNotification,g={},c=100,E=function(e){return new d({id:e.nid,userId:e.user_id,typeId:e.type_id,typeData:y(e),targetObjectKey:e.target_object_key,status:e.status,seenState:e.seen_state,feedTimeInSec:e.feed_time,rawDropdownRowHtml:e.notification_div,roleLabel:e.role_label})},y=function(e){switch(e.type_id){case d.TYPES.SHARED_FOLDER_INVITE:return v(e);case d.TYPES.BLUENOTE:return m(e)}},v=function(e){return new u({overQuotaStatus:e.sf_invite_overquota})},m=function(e){var t;return t=e.bluenote_payload,null!=t?new i({templateType:t.template_type,templateVersion:t.template_version,campaignInfo:_(t.campaign_info),displayMessage:t.home_params.message,icon:f(t.image),surfaceAction:p(t.home_params.surface_action),buttonActions:t.home_params.button_actions.map(p)}):void 0},_=function(e){return null!=e?new r({campaignId:e.campaignId,categoryId:e.categoryId,versionId:e.versionId,contentId:e.contentId}):void 0},f=function(e){return null!=e?"avatar"===e.type?o({avatarInitials:e.avatar_initials,avatarUrl:e.avatar_url}):s({lowResIconUrl:e.system_url32,highResIconUrl:e.system_url64}):void 0},p=function(e){var t;return null!=e?(t=void 0,"open_url"===e.action_name?t=n.BLUENOTE_ACTION_TYPES.OPEN_URL:"mount_shared_folder"===e.action_name&&(t=n.BLUENOTE_ACTION_TYPES.MOUNT_SHARED_FOLDER),new n({buttonLabel:e.label,actionType:t,params:h(t,e.params)})):void 0},h=function(e,t){if(null!=t){if(e===n.BLUENOTE_ACTION_TYPES.OPEN_URL)return new l({urlPath:t.url_path});if(n.BLUENOTE_ACTION_TYPES.MOUNT_SHARED_FOLDER)return new a({nsId:t.ns_id})}},g.getAll=function(t,n){var o,r,i,s;return null==n&&(n=!1),o={count:c,template_version:3},null!=t&&(o.last_received_nid_by_user_id=JSON.stringify(t)),s=n?e.SilentBackgroundRequest({url:"/web/notifications/retrieve_user",data:o,subject_user:"undefined"!=typeof ensemble&&null!==ensemble&&null!=(r=ensemble.viewer)&&null!=(i=r.getActiveUser())?i.userId:void 0,dataType:"json"}):e.SilentBackgroundRequest({url:"/web/notifications/retrieve",data:o,dataType:"json"}),s.then(function(e){var t;return t=e.notifications.map(E),{cursor:e.latest_nid,notifications:t}})},g.ackAll=function(t){var n,o,r;return null==t&&(t=!1),r=t?e.SilentBackgroundRequest({url:"/web/notifications/ack_all_user",subject_user:"undefined"!=typeof ensemble&&null!==ensemble&&null!=(n=ensemble.viewer)&&null!=(o=n.getActiveUser())?o.userId:void 0,dataType:"json"}):e.SilentBackgroundRequest({url:"/web/notifications/ack_all",dataType:"json"}),r.then(function(e){var t;return t=e.map(E)})},g.ack=function(t){return e.SilentBackgroundBeaconRequest({url:"/web/notifications/ack",subject_user:t.userId,data:{nids:JSON.stringify([t.id])},dataType:"json"})},g.markAsSeen=function(t){var n,o,r,i,s;for(s={},o=0,r=t.length;r>o;o++)i=t[o],(s[i.userId]||(s[i.userId]=[])).push(i.id);return n={nids_by_user_id:JSON.stringify(s)},e.SilentBackgroundRequest({url:"/web/notifications/mark_seen",data:n,dataType:"json"})},g}),define("modules/clean/react/user_notifications/avatar_icon",["external/react","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/user_notifications/models"],function(e,t,n,o,r){var i,s,a,l;return l=n.VALID_AVATAR_DIMENSIONS,i=n.AVATAR_DIMENSION_BY_SIZE,a=r.BluenoteAvatarIcon,s=e.createClass({displayName:"AvatarIcon",propTypes:{avatarIconRecord:e.PropTypes.instanceOf(a).isRequired,thumbStore:e.PropTypes.instanceOf(o).isRequired,className:e.PropTypes.string,size:e.PropTypes.oneOf(l)},componentDidMount:function(){return this._bindAvatarUrl(this.props)},componentWillUnmount:function(){return this._unbindAvatarUrl()},componentWillReceiveProps:function(e){var t,n;return t=this.props.avatarIconRecord,n=e.avatarIconRecord,t.avatarUrl!==n.avatarUrl?(this._unbindAvatarUrl(),this._bindAvatarUrl(e)):void 0},getInitialState:function(){var e,t;return e=void 0,t=this.props.avatarIconRecord,null!=t.avatarUrl&&(e=this.props.thumbStore.get_thumb(t.avatarUrl)),{avatarImage:e}},getDefaultProps:function(){return{size:i.MEDIUM}},_bindAvatarUrl:function(e){var t;return t=e.avatarIconRecord,null!=t.avatarUrl?this._thumbRequestId=e.thumbStore.bind_url(t.avatarUrl,{onSuccess:function(n){return function(){var o;return o=e.thumbStore.get_thumb(t.avatarUrl),n.state.avatarImage!==o?n.setState({avatarImage:o}):void 0}}(this)}):void 0},_unbindAvatarUrl:function(){return this.props.thumbStore.unbind_url(this._thumbRequestId)},render:function(){var n;return n=this.props.avatarIconRecord,null!=this.state.avatarImage?e.createElement("img",{className:this.props.className,src:this.state.avatarImage,width:this.props.size,height:this.props.size}):e.createElement(t,{name:n.avatarInitials,dimension:this.props.size,initials:n.avatarInitials,shape:"CIRCLE",optionalClass:this.props.className})}})}),define("modules/clean/react/user_notifications/constants",function(){var e;return e={},e.ActionTypes={LOAD_REQUEST:"USER_NOTIFICATIONS_LOAD_REQUEST",LOAD_SUCCESS:"USER_NOTIFICATIONS_LOAD_SUCCESS",LOAD_FAILURE:"USER_NOTIFICATIONS_LOAD_FAILURE",ACKNOWLEDGEMENT_REQUEST:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_REQUEST",ACKNOWLEDGEMENT_SUCCESS:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_SUCCESS",ACKNOWLEDGEMENT_FAILURE:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_FAILURE",RESET_ACKNOWLEDGEMENTS:"USER_NOTIFICATIONS_RESET_ACKNOWLEDGEMENTS",MARK_AS_SEEN_REQUEST:"USER_NOTIFICATIONS_MARK_AS_SEEN_REQUEST"},e.EventTypes={RENDERED_NOTIFICATIONS:"USER_NOTIFICATIONS_RENDERED_NOTIFICATIONS"},e.BellDesignTypes={BLUE_ICON:"BLUE_ICON",GRAY_ICON:"GRAY_ICON"},e}),define("modules/clean/react/user_notifications/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e}),define("modules/clean/react/user_notifications/dropdown",["require","exports","tslib","external/classnames","external/react","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/title_bubble","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown_bell","modules/clean/react/user_notifications/dropdown_body","modules/clean/react/user_notifications/store","external/components","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_){"use strict";var m=function(e){function t(t){var n=e.call(this,t)||this;return n.state={actionableCount:p.getActionableCount(),isDisabled:!0},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){l.loadOnceAndWatch(this.props.isPagelet),this.removeStoreListener=p.addListener(this.onUpdateFromStore.bind(this)),this.setState(function(e,t){return e.isDisabled=!1,e})},t.prototype.componentWillUnmount=function(){this.removeStoreListener()},t.prototype.onUpdateFromStore=function(){this.setState(function(e,t){return e.actionableCount=p.getActionableCount(),e})},t.prototype.render=function(){if(this.props.isMaestroDesign){var e=r.createElement(h.Popover,null,r.createElement(h.PopoverTrigger,{"aria-label":_._("Notifications menu"),className:"notification-button"},r.createElement(u.UserNotificationsDropdownBell,{isMaestroDesign:!0,actionableCount:this.state.actionableCount,bellDesign:this.props.bellDesign})),r.createElement(h.PopoverContent,{attachment:"right"},r.createElement(h.PopoverContentTitle,null,_._("Notifications")),r.createElement("div",{className:"notifications-dropdown"},r.createElement(d.UserNotificationsDropdownBody,{isMaestroDesign:!0}))));return this.props.isMaestroDesign&&this.props.bellDesign===c.BellDesignTypes.GRAY_ICON&&(e=r.createElement(a,{content:_._("Notifications"),position:a.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"react-title-bar--title-bubble",isTargetPositionFixed:!0},e)),e}var t,n=o("header-nav-link","sprite-button","notification-button"),s=r.createElement("button",{className:n,title:_._("Notifications menu"),onClick:this.props.onClick,disabled:this.state.isDisabled},r.createElement(u.UserNotificationsDropdownBell,{actionableCount:this.state.actionableCount,isMaestroDesign:!1,bellDesign:this.props.bellDesign}));return t=this.props.accountMenuVisible?i.POSITIONS.BOTTOM_LEFT:i.POSITIONS.BOTTOM_ALIGN_RIGHT,r.createElement(i,{targetButton:s,targetFixed:!0,position:t,className:"no-padding notifications-dropdown"},r.createElement("div",{className:"notifications-header"},_._("Notifications")),r.createElement(d.UserNotificationsDropdownBody,{isMaestroDesign:!1}))},t}(r.Component);m.displayName="UserNotificationsDropdown",m.defaultProps={isPagelet:!1,isMaestroDesign:!1,accountMenuVisible:!0,bellDesign:c.BellDesignTypes.BLUE_ICON};var f=s(m,["/static/css/components/title_bubble-vfl3yK_gU.css","/static/css/components/bubble_dropdown_v2-vflhhYVBe.css","/static/css/components-vflS2LJ_R.css","/static/css/notifications-vflQZ_e47.css"]);t.UserNotificationsDropdown=f}),define("modules/clean/react/user_notifications/dropdown_bell",["require","exports","tslib","external/classnames","external/react","modules/clean/components/scooter/badge","modules/clean/react/css","modules/clean/react/maestro/svg_icon","modules/clean/react/sprite","modules/clean/react/user_notifications/constants","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u){"use strict";var d=500,p=function(e){function t(t){var n=e.call(this,t)||this,o=n.props.actionableCount>0;return o&&n.scheduleShakeReset(),n.state={isShaking:o},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){clearTimeout(this.shakeResetTimeout)},t.prototype.componentWillReceiveProps=function(e){var t=e.actionableCount>0&&e.actionableCount!==this.props.actionableCount;t&&(this.setState({isShaking:!0}),this.scheduleShakeReset())},t.prototype.scheduleShakeReset=function(){var e=this;clearTimeout(this.shakeResetTimeout),this.shakeResetTimeout=setTimeout(function(){e.setState({isShaking:!1})},d)},t.prototype.renderBell=function(){if(this.props.isMaestroDesign)return r.createElement(a.SvgIcon,{name:"bell"});var e=o({web:!0,"notifications-bell":!0,shake:this.state.isShaking});return r.createElement(l,{group:"web",name:"notifications_icon_blue",className:e,alt:u._("Notifications")})},t.prototype.renderBadge=function(){return this.props.isMaestroDesign&&this.props.bellDesign!==c.BellDesignTypes.GRAY_ICON?this.props.actionableCount?r.createElement("div",{className:"badge-red-dot"}):null:r.createElement(i.CounterBadge,{count:this.props.actionableCount,maxCount:99,position:i.CounterBadge.POSITIONS.TOP_RIGHT,isMaestroDesign:this.props.isMaestroDesign})},t.prototype.render=function(){var e="";return this.props.actionableCount>0&&(e=u.ungettext("%(count)s new","%(count)s new",this.props.actionableCount,{comment:"new notification count"}).format({count:this.props.actionableCount})),r.createElement("div",{className:"notification-button-bell-container"},r.createElement("span",{className:"ax-visually-hidden"},e),this.renderBell(),this.renderBadge())},t}(r.Component);p.defaultProps={actionableCount:0,isMaestroDesign:!1,bellDesign:c.BellDesignTypes.BLUE_ICON};var h=s(p,["/static/css/scooter/scooter-scoped-vflebHNBy.css"]);t.UserNotificationsDropdownBell=h}),define("modules/clean/react/user_notifications/dropdown_bluenote_row",["external/classnames","external/purify","external/react","modules/clean/avatar/initials_avatar_with_color","modules/clean/datetime","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/button","modules/clean/react/image","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/avatar_icon","modules/clean/react/user_notifications/generic_icon","modules/clean/static_urls"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S;return f=s.button,h=c.BluenoteAvatarIcon,_=c.UserNotification,S=p.static_url,E=n.DOM,v=E.div,b=E.span,y=E.img,g=n.createElement,m=n.createClass({displayName:"UserNotificationsDropdownBluenoteRow",propTypes:{notification:n.PropTypes.instanceOf(_).isRequired,thumbStore:n.PropTypes.instanceOf(i).isRequired,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},_renderNotificationText:function(e){return v({className:"feed-text--button-wrapper"},n.DOM.button({className:"u-unbutton u-font-left feed-text__button"},v({className:"feed-text__button-text",dangerouslySetInnerHTML:{__html:t.sanitize(e.typeData.displayMessage)}})))},_renderImage:function(e){var t,n;return n=e.typeData.icon,t="feed-image feed-image--bluenote",n instanceof h?g(u,{avatarIconRecord:n,thumbStore:this.props.thumbStore,className:t}):g(d,{genericIconRecord:n,className:t})},_feedTimeString:function(e){var t;return t=Date.now()-e,t>6048e5?r.nice_date_with_month_name(e,!1):r.ago(e)},_renderTimeAndRoleLabel:function(e){var t;return t=this._feedTimeString(e.feedTime),e.roleLabel&&!this.props.isMaestroDesign&&(t=t+" · "+e.roleLabel),b({className:"feed-time"},t)},_handleSurfaceAction:function(e){var t;return t=e.typeData.surfaceAction,null!=t?l.triggerBluenoteAction(e,t,"surface"):void 0},_renderButton:function(e,t,n){return g(f,{className:"notification u-mar-right-xs u-mar-top-xs",importance:n>0?"tertiary":void 0,onClick:function(t){var o;return t.target.disabled=!0,o=e.typeData.buttonActions[n],l.triggerBluenoteAction(e,o,"button_"+n),t.stopPropagation()}},t)},_renderButtonActions:function(e){var t,n,o,r,i,s;for(n=[],s=e.typeData.buttonActions,r=o=0,i=s.length;i>o;r=++o)t=s[r],n.push(this._renderButton(e,t.buttonLabel,r));return n.length>0?b({className:"feed-action action-available"},n):void 0},render:function(){var t,n,o,r;return r=this.props.notification,t=r.typeData,o=e({"feed-row":!0,clickable:null!=t.surfaceAction,read:r.isRead}),n=v({onClick:this._handleSurfaceAction.bind(this,r),className:o},this._renderImage(r),this._renderNotificationText(r),this._renderTimeAndRoleLabel(r),this._renderButtonActions(r))}})}),define("modules/clean/react/user_notifications/dropdown_body",["require","exports","tslib","external/react","external/react-dom","jquery","modules/clean/loggers/folder_invite_impression_logger","modules/clean/loggers/notification_logger","modules/clean/loggers/notification_tray_logger","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/static_urls","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown_row","modules/clean/react/user_notifications/dropdown_bluenote_row","modules/clean/react/user_notifications/event_emitter","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v){"use strict";function y(e,t){return t.feedTime-e.feedTime}var E=10,b=10,S=10,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUpdateFromStore=function(){t.setStateFromStore(),t.legacyRender()},t.onScroll=function(){t.hasMore&&t.scrollWithinOffsetToBottom(S)&&t.appendNotifications(b)},t.onMouseScroll=function(e){var n=e.originalEvent||e,o=n.detail?-40*n.detail:n.wheelDelta,i=r.findDOMNode(t);!t.hasMore&&0>=o&&t.scrollWithinOffsetToBottom(0)?e.preventDefault():o>=0&&0===i.scrollTop&&e.preventDefault()},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.folderInviteImpressionLogger=new s.FolderInviteImpressionLogger,this.folderInviteImpressionLogger.listenTo(m)},t.prototype.componentDidMount=function(){this.removeStoreListener=g.addListener(this.onUpdateFromStore),this.addEventHandlers(),this.setStateFromStore(),this.legacyRender(),l.logTrayOpen(this.badgeCount),d.viewNotifications()},t.prototype.shouldComponentUpdate=function(){return!1},t.prototype.componentWillUnmount=function(){this.removeStoreListener(),this.folderInviteImpressionLogger.unlistenTo(m),d.resetAcknowledgements()},t.prototype.addEventHandlers=function(){var e=i(r.findDOMNode(this));e.scroll(this.onScroll),e.on("mousewheel",this.onMouseScroll),e.on("DOMMouseScroll",this.onMouseScroll)},t.prototype.setStateFromStore=function(){var e=g.getAll().sort(y);this.notifications=e.filter(function(e){return!e.isInvisible}),this.isLoading=g.isLoading(),this.badgeCount=g.getActionableCount()},t.prototype.removeNotifications=function(){var e=i(r.findDOMNode(this));return e.find("#event-feed").empty(),this.hasMore=this.notifications.length>0},t.prototype.appendNotifications=function(e){var t=i(r.findDOMNode(this)),n=t.find(".feed-row").length,s=this.notifications.slice(n,n+e);a.NotificationLogger.logRender(s,n);for(var l=new c,u=0,d=s;u<d.length;u++){var v=d[u],y=g.isAcknowledged(v);if(v.rawDropdownRowHtml){var E=h.buildLegacyElement(v,y);t.find("#event-feed").append(E)}else if(v.typeId===f.UserNotification.TYPES.BLUENOTE){var b=document.createElement("div");t.find("#event-feed").append(b),r.render(o.createElement(_,{notification:v,thumbStore:l,isMaestroDesign:this.props.isMaestroDesign}),b)}}var S=n+s.length;this.hasMore=S<this.notifications.length,t.toggleClass("empty",0===S),m.emit(p.EventTypes.RENDERED_NOTIFICATIONS,{notifications:s})},t.prototype.scrollWithinOffsetToBottom=function(e){var t=r.findDOMNode(this),n=t.scrollHeight-t.scrollTop-t.offsetHeight;return e>=n},t.prototype.legacyRender=function(){this.isLoading||(this.removeNotifications(),this.appendNotifications(E))},t.prototype.render=function(){return o.createElement("div",{id:"event-feed-container",className:"show"},o.createElement("div",{id:"event-feed"},o.createElement("div",{id:"notification-loading"},o.createElement("img",{src:u.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:v._("Loading...")}))),o.createElement("div",{id:"event-feed-empty"},o.createElement("img",{src:u.static_url("/static/images/empty_notifications-vflQy8YVJ.png"),alt:""}),o.createElement("div",{id:"event-feed-empty-text"},v._("We’ll let you know when we’ve got something new for you!"))))},t}(o.Component);w.displayName="UserNotificationsDropdownBody",w.defaultProps={isMaestroDesign:!1},t.UserNotificationsDropdownBody=w}),define("modules/clean/react/user_notifications/dropdown_row",["external/underscore","jquery","modules/clean/datetime","modules/clean/react/user_notifications/legacy_thumb_loader","modules/clean/react/user_notifications/actions","modules/clean/sprite"],function(e,t,n,o,r,i){var s,a,l;return l=new o,s=6048e5,a={buildLegacyElement:function(e,n){var o;return o=t(e.rawDropdownRowHtml),this._initImages(o),this._setTimeLabel(o,e.feedTime),this._addClientStateClasses(o,e,n),this._initActionHandlers(e,o),o},_initImages:function(e){return e.find("img").each(function(e){return function(n,o){var r;return r=t(o),r.attr("alt",""),e._loadImage(r)}}(this))},_setTimeLabel:function(e,t){var o,r;return o=e.find("#feed-time-label"),null!=o?(r=Date.now()-t,r>s?o.text(n.nice_date_with_month_name(t,!1)):o.text(n.ago(t))):void 0},_loadImage:function(t){var n;return(n=t.data("src"))?l.load(n).progress(function(){return t.data("src",null),t.data("loading-src",n)}).then(function(n){var o;return t.data("loading-src",null),o=function(){return t.addClass("thumbnail"),t.parent(".feed-thumbnail").addClass("has-frame")},0===n.indexOf("data:image")?o():(t.load(o),t.error(e.once(function(){var e;return e=t.data("fail-src")||i.SPACER,t.attr("src",e)}))),t.attr("src",n)}):void 0},_addClientStateClasses:function(e,t,n){var o;return o=e.hasClass("feed-row")?e:e.find(".feed-row"),t.isInvisible&&o.addClass("invisible"),t.isRead&&!n?o.addClass("read"):void 0},_initActionHandlers:function(e,t){return t.on("click",function(){return r.triggerGenericLegacyNotificationAction(e),
!0}),t.on("click",".share-content-dismiss",function(){return r.dismissLegacySharingNotification(e,this),!1}),t.on("click",".share-content-mount",function(){return r.mountFromLegacySharingNotification(e,this),!1}),t.on("click",".share-content-upgrade-mount",function(){return r.upgradeToMountFromLegacySharingNotification(e),!1})}}}),define("modules/clean/react/user_notifications/event_emitter",["external/eventemitter3"],function(e){var t;return new(t=e)}),define("modules/clean/react/user_notifications/generic_icon",["external/react","modules/clean/react/image","modules/clean/react/user_notifications/models","modules/clean/static_urls"],function(e,t,n,o){var r,i,s;return r=n.BluenoteGenericIcon,s=o.static_url,i=e.createClass({displayName:"GenericIcon",propTypes:{genericIconRecord:e.PropTypes.instanceOf(r),className:e.PropTypes.string},render:function(){var n,o,r;return o=this.props.genericIconRecord,r=null!=o?o.lowResIconUrl:void 0,n=null!=o?o.highResIconUrl:void 0,null!=r&&null!=n||(r=s("/static/images/icons32/system_notification_default_icon-vflY4Rt4U.png"),n=s("/static/images/icons64/system_notification_default_icon-vflc0pSwy.png")),e.createElement("div",{className:this.props.className},e.createElement(t,{src:r,srcHiRes:n}))}})}),define("modules/clean/react/user_notifications/legacy_thumb_loader",["external/underscore","jquery","modules/clean/photos/batch_thumb_loader"],function(e,t,n){var o,r,i;return i=16,r=24,o=function(){function o(){var t;this._cache={},t=new n({batch_size:i,max_parallel_request:r}),this._queueThumb=function(e,n,o){return t.queue_thumb(e,n,{onrequest:o})},this._flushQueue=e.debounce(function(){return t.flush()},0)}return o.prototype.load=function(e){var n;return this._cache[e]||(n=new t.Deferred,this._queueThumb(e,n.resolve,n.notify),this._flushQueue(),this._cache[e]=n.promise()),this._cache[e]},o}()});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/user_notifications/models",["external/immutable"],function(e){var t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E;return E={},h={UNREAD:0,READ:1,INVISIBLE:2},d={UNSEEN:1,SEEN:2},_={0:"unread",1:"read",2:"invisible"},g={SHARED_FOLDER_INVITE:100,BLUENOTE:2200},t={OPEN_URL:1,MOUNT_SHARED_FOLDER:2},y=e.Record({id:void 0,userId:void 0,typeId:void 0,typeData:void 0,targetObjectKey:void 0,status:void 0,feedTimeInSec:void 0,rawDropdownRowHtml:void 0,roleLabel:void 0,seenState:void 0}),v=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.SEEN_STATE=d,t.STATUSES=h,t.STATUS_STRINGS=_,t.TYPES=g,Object.defineProperties(t.prototype,{key:{get:function(){return this.userId+" "+this.typeId+" "+this.targetObjectKey}},isUnread:{get:function(){return this.status===h.UNREAD}},isRead:{get:function(){return this.status===h.READ}},isInvisible:{get:function(){return this.status===h.INVISIBLE}},isSeen:{get:function(){return this.isInvisible||null==this.seenState?!this.isUnread:this.seenState===d.SEEN}},type:{get:function(){return this.typeId}},feedTime:{get:function(){return new Date(1e3*this.feedTimeInSec)}},campaignId:{get:function(){var e;return this.typeId===t.TYPES.BLUENOTE&&null!=(null!=(e=this.typeData.campaignInfo)?e.campaignId:void 0)?""+this.typeData.campaignInfo.campaignId:void 0}},campaignVersion:{get:function(){var e;return this.typeId===t.TYPES.BLUENOTE&&null!=(null!=(e=this.typeData.campaignInfo)?e.versionId:void 0)?""+this.typeData.campaignInfo.versionId:void 0}}}),t}(y),p={ALREADY_OVER:"overquota",WILL_BE_OVER:"will_be_overquota"},f=e.Record({overQuotaStatus:void 0}),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.OVER_QUOTA_STATUSES=p,t}(f),a=e.Record({templateType:void 0,templateVersion:void 0,campaignInfo:void 0,displayMessage:void 0,icon:void 0,surfaceAction:void 0,buttonActions:void 0}),s=e.Record({campaignId:void 0,categoryId:void 0,versionId:void 0,contentId:void 0}),l=e.Record({lowResIconUrl:void 0,highResIconUrl:void 0}),i=e.Record({avatarInitials:void 0,avatarUrl:void 0}),r=e.Record({actionType:void 0,buttonLabel:void 0,params:void 0}),n=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n.BLUENOTE_ACTION_TYPES=t,n}(r),o=e.Record({urlPath:void 0}),u=e.Record({urlPath:void 0}),c=e.Record({nsId:void 0}),E.UserNotification=v,E.SharedFolderInviteData=m,E.BluenoteData=a,E.BluenoteGenericIcon=l,E.BluenoteAvatarIcon=i,E.BluenoteAction=n,E.BluenoteActionParams=o,E.BluenoteCampaignInfo=s,E.BluenoteOpenUrlActionParams=u,E.BluenoteMountFolderActionParams=c,E});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/user_notifications/store",["external/underscore","external/immutable","modules/clean/flux/flux_store","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher"],function(e,t,n,o,r){var i,s;return i=o.ActionTypes,new(s=function(n){function o(e){o.__super__.constructor.call(this,e),this._isLoading=!1,this._userNotifications=new t.List,this._acknowledgedNotificationKeys=new t.Set,this._additionalSeenNotificationKeys=new t.Set,this._cursor=null}return extend(o,n),o.prototype.isLoading=function(){return this._isLoading},o.prototype.getActionableCount=function(){return this._getUnseen().size},o.prototype.getUnacknowledgedCount=function(){return this._getUnacknowledged().size},o.prototype.getCursor=function(){return this._cursor},o.prototype.getAll=function(){return this._userNotifications.toArray()},o.prototype.isAcknowledged=function(e){return this._acknowledgedNotificationKeys.has(e.key)},o.prototype._getUnacknowledged=function(){var e;return e=this._userNotifications.filter(function(e){return e.isUnread}),e.filter(function(e){return function(t){return!e.isAcknowledged(t)}}(this))},o.prototype.getUnseen=function(){return this._getUnseen().toArray()},o.prototype._getUnseen=function(){var e;return e=this._userNotifications.filter(function(e){return!e.isSeen}),e.filter(function(e){return function(t){return!e._additionalSeenNotificationKeys.has(t.key)}}(this))},o.prototype._onLoadRequest=function(){return this._isLoading?void 0:(this._isLoading=!0,this.__emitChange())},o.prototype._onLoadSuccess=function(n){var o,r,i,s,a;if(this._isLoading&&(this._isLoading=!1,this.__emitChange()),e.isEqual(n.cursor,this._cursor)||(this._cursor=n.cursor,this.__emitChange()),n.notifications.length>0){for(this._additionalSeenNotificationKeys=this._additionalSeenNotificationKeys.clear(),a=new t.OrderedMap,s=n.notifications.concat(this._userNotifications.toArray()),o=0,r=s.length;r>o;o++)i=s[o],a.has(i.key)||(a=a.set(i.key,i));return this._userNotifications=a.toList(),this.__emitChange()}},o.prototype._onLoadFailure=function(){return this._isLoading?(this._isLoading=!1,this.__emitChange()):void 0},o.prototype._onAcknowledgementRequest=function(){var e;return e=new t.Set(this._getUnacknowledged().map(function(e){return e.key})),this._acknowledgedNotificationKeys.equals(e)?void 0:(this._acknowledgedNotificationKeys=e,this.__emitChange())},o.prototype._onAcknowledgementSuccess=function(e){var n,o;return o=new t.Set(e),n=o.map(function(e){return e.key}),n.equals(this._acknowledgedNotificationKeys)?void 0:(this._acknowledgedNotificationKeys=n,this.__emitChange())},o.prototype._onResetAcknowledgements=function(){var e;return e=new t.Set,e.equals(this._acknowledgedNotificationKeys)?void 0:(this._acknowledgedNotificationKeys=e,this.__emitChange())},o.prototype._onMarkAsSeenRequest=function(){return this._additionalSeenNotificationKeys=new t.Set(this._getUnseen().map(function(e){return e.key})),this.__emitChange()},o.prototype.__onDispatch=function(e){switch(e.action.type){case i.LOAD_REQUEST:return this._onLoadRequest();case i.LOAD_SUCCESS:return this._onLoadSuccess(e.action.data);case i.LOAD_FAILURE:return this._onLoadFailure();case i.ACKNOWLEDGEMENT_REQUEST:return this._onAcknowledgementRequest();case i.ACKNOWLEDGEMENT_SUCCESS:return this._onAcknowledgementSuccess(e.action.data.notifications);case i.RESET_ACKNOWLEDGEMENTS:return this._onResetAcknowledgements();case i.MARK_AS_SEEN_REQUEST:return this._onMarkAsSeenRequest()}},o}(n))(r)});var slice=[].slice,hasProp={}.hasOwnProperty;define("modules/clean/react/util",["external/react","external/underscore","external/es6-promise"],function(e,t,n){var o,r,i,s,a;return o=n.Promise,r=function(t){var n;return"string"==typeof t?t:"string"==typeof t.props?t.props:t.props.text?t.props.text:(n=[],e.Children.forEach(t.props.children,function(e){return n.push(r(e))}),n.join(""))},s=function(t,n,o){var r,i;return n(t)?o(t):(r=!1,i=[],e.Children.forEach(t.props.children,function(e){return function(e){var t;return t=s(e,n,o),i.push(t),t!==e?r=!0:void 0}}(this)),r?e.cloneElement(t,{},i):t)},i=function(){var e,t,n,o,r,i,s,a;for(e=1<=arguments.length?slice.call(arguments,0):[],i={},t=[],n=0,r=e.length;r>n;n++){s=e[n];for(o in s)hasProp.call(s,o)&&(a=s[o],"className"===o?t.push(a):i[o]=a)}return null!=t.length&&(i.className=t.join(" ")),i},a=function(e,t){return new o(function(n,o){return e.setState(t,n)})},{getText:r,mergeProps:i,replaceSubtree:s,setStatePromise:a}}),define("modules/clean/react_format",["require","exports","external/react","external/underscore","modules/core/exception","modules/clean/js_environment"],function(e,t,n,o,r,i){"use strict";function s(e,t){null==t&&(t={});for(var r=new RegExp(["%%","(%\\(([a-zA-Z0-9_]+)\\)s)","(<\\s*([a-zA-Z0-9_]+)\\s*\\/>)","(<\\s*([a-zA-Z0-9_]+)\\s*>)","(<\\s*\\/\\s*([a-zA-Z0-9_]+)\\s*>)"].join("|"),"g"),i=0,s=[{name:"root",components:[]}];;){var l=r.exec(e);if(!l)break;var c=s[s.length-1].components;if(c.push(e.slice(i,l.index)),"%%"===l[0])c.push("%");else if(l[1]){var u=t[l[2]];null==u?a('No substitution was given for the placeholder "'+l[2]+'".'):c.push(String(u))}else if(l[3]){var u=t[l[4]];null==u?a('No substitution was given for the self-closing tag "'+l[4]+'".'):n.isValidElement(u)?c.push(u):a('The substitution given for the self-closing tag "'+l[4]+'" was not a valid React element.')}else if(l[5]){var d=l[6];s.push({name:d,components:[]})}else if(l[7]){var d=l[8];if(s.length<=1)a('Trying to close a "'+d+'" tag, but there was no preceding open tag.');else{var p=s.pop(),h=p.name,_=p.components,m=_.filter(function(e){return""!==e});if(h!==d)a('Trying to close a "'+d+'" tag, but the matching open tag was a "'+h+'".');else if(null==t[d])a('No substitution was given for the tag "'+d+'".');else if(o.isFunction(t[d])){var f=t[d](m);n.isValidElement(f)?s[s.length-1].components.push(f):a('A thunk was passed as the substitution for the "'+d+'" tag, but the thunk did not resolve to a valid React element.')}else n.isValidElement(t[d])?s[s.length-1].components.push(n.cloneElement(t[d],{},m)):a('The substitution given for the tag "'+d+'" was not a valid React element.')}}i=l.index+l[0].length}s.length>1&&a("Not all XML tags were closed properly! For standalone tags without a corresponding close tag, please use XML self-closing tag syntax. This string contains "+(s.length-1)+" unclosed tags.");var g=s[0].components;return g.push(e.slice(i,e.length)),g.filter(function(e){return""!==e})}function a(e){(i.isTest||c>l)&&(l++,r.raiseAndReport("reactFormat: "+e,{tags:["reactFormat"]}))}t.reactFormat=s;var l=0,c=20}),define("modules/clean/referrer_cleansing_redirect",["external/sjcl","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/uri"],function(e,t,n,o,r){var i,s,a,l;return l=function(n){var r,i,s,a;return r=e.codec.utf8String.toBits(o.read(t.JS_CSRF_COOKIE)),a=e.codec.utf8String.toBits(n),i=new e.misc.hmac(r),s=i.encrypt(n),e.codec.base64.fromBits(s)},s=function(e){var t,n;return t=r.parse(e).scheme,t&&"http"!==t&&"https"!==t?"#":(n=new r({scheme:"https",authority:"www.dropbox.com",path:"/referrer_cleansing_redirect"}),n.setQuery({url:e,hmac:l(e)}),n)},a=function(e){return n.redirect(s(e))},i={get_redirect_uri:s,redirect:a}}),define("modules/clean/revisions/file_revisions_iterator",["jquery","modules/clean/ajax","modules/clean/react/browse/models"],function(e,t,n){var o,r,i,s,a;return o=n.File,s=50,r=function(){function e(e){this.file=e.file,this.action_description=e.action_description,this.is_primary_revision=e.is_primary_revision,this.author=e.author,this.device_name=e.device_name,this.when_mses=e.when_mses}return e}(),a=function(e){return new r({file:o.fromServerObject(e.preview_info),action_description:e.action_description,is_primary_revision:e.is_primary_revision,author:e.author,device_name:e.device_name,when_mses:e.ts})},i=function(){function n(e,t,n){this.fqPath=e,this.userId=t,null==n&&(n={}),this.cursor=n.initialCursor||null,this.deserializer=n.deserializer||a}return n.prototype.next=function(n){var o,r;return null==n&&(n=s),r=new e.Deferred,o={path:this.fqPath,limit:n},this.cursor&&(o.cursor=this.cursor),t.WebRequest({url:"/file_revisions",type:"GET",subject_user:this.userId,data:o,success:function(e){return function(t){var n,i;return o=JSON.parse(t),e.cursor=o.cursor,i=function(){var e,t,r,i;for(r=o.revisions,i=[],e=0,t=r.length;t>e;e++)n=r[e],i.push(this.deserializer(n));return i}.call(e),r.resolve({revisions:i,hasMore:o.more})}}(this),error:function(e){return r.reject({errorText:e.error_text})}}),r.promise()},n}()}),define("modules/clean/search/search_helpers",["jquery","modules/clean/analytics","modules/clean/history"],function(e,t,n){var o,r;return o=t.SearchClientActivityLogger,r={buildSearchURL:function(e,t,o){var i;return i=r.queryParams(t,o),n.construct_url("/search/"+e.role,i)},queryParams:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),n=e.toLowerCase().trim().replace(/\ +/g," "),{query:n,query_unnormalized:e,last_fq_path:t}},logSearchAction:function(e,t,n,r){var i;return null==r&&(r="full-view"),i={file_nsid:e.ns_id,file_sjid:e.sjid,firefly:!0,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:r,action_type:n},o.log("result_action",t.id,i)},highlightMatch:function(t,n){var o,r,i,s,a,l,c,u;if(!n)return e("<span />").text(t);for(i=0,a=0,r=e("<span />");i<t.length;)c=n[a],a>=n.length?(l=!1,s=i+t.length):c.pos>i?(l=!1,s=c.pos):(l=!0,s=c.pos+c.len),u=t.substring(i,s),o=e("<span/>").text(u),o.addClass(""),l&&(o.addClass("highlighted"),o.addClass("is-highlighted")),r.append(o),i=s,l&&a++;return r},highlightMatchWithEmoji:function(t,n){var o,r,i,s,a,l,c,u,d;if(!n)return e("<span />").text(t);for(r=e("<span />"),i=t,a=l=0,c=n.length;c>l;a=++l)s=n[a],u=i.indexOf(s.string),0>u||(r.append(e("<span/>").text(i.substring(0,u))),d=i.substring(u,u+s.string.length),o=e("<span/>").text(d),o.addClass("highlighted"),o.addClass("is-highlighted"),r.append(o),i=i.substring(u+s.string.length,i.length));return i&&r.append(e("<span/>").text(i)),r},highlightMatchString:function(e,t){var n;return n=/[\uD800-\uDBFF][\uDC00-\uDFFF]/,n.test(e)?this.highlightMatchWithEmoji(e,t)[0].innerHTML:this.highlightMatch(e,t)[0].innerHTML}}}),define("modules/clean/search/search_type",function(){var e;return e={COMPLETION:"completion",DELETED:"deleted",FULLTEXT:"full-text"}}),define("modules/clean/sharing/action_types",["modules/clean/flux/action_type"],function(e){var t,n,o;return o=e.withActionNamespace,t=o("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",SET_COMMENT_CHECKBOX_PREF_REQUEST:"set-comment-checkbox-pref-request",SET_COMMENT_CHECKBOX_PREF_SUCCESS:"set-comment-checkbox-pref-success",SET_COMMENT_CHECKBOX_PREF_FAILURE:"set-comment-checkbox-pref-failure",SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:"set-comment-checkbox-pref-help-request",SET_COMMENT_CHECKBOX_HELP_PREF_SUCCESS:"set-comment-checkbox-pref-help-success",SET_COMMENT_CHECKBOX_HELP_PREF_FAILURE:"set-comment-checkbox-pref-help-failure",CLEAR_SHARING_PAYWALL_INFO:"clear-sharing-paywall-info",FETCH_SHARING_PAYWALL_INFO_REQUEST:"fetch-sharing-paywall-info-request",FETCH_SHARING_PAYWALL_INFO_SUCCESS:"fetch-sharing-paywall-info-success",PAYWALL_GRANDFATHER_MODAL_DISMISS:"paywall-grandfather-modal-dismiss",PAYWALL_GRANDFATHER_MODAL_LEARN_MORE:"paywall-grandfather-modal-learn-more",CLEAR_UNSHARE_FROM_PAYWALL:"clear-unshare-from-paywall",UNSHARE_FROM_PAYWALL:"unshare-from-paywall",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",HANDLE_CONTENT_NAME_FOCUS_CHANGE:"handle-content-name-focus-change",UPDATE_BANNER:"update-banner",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load"}),n=o("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"}),{SharingActionTypes:n,ShareModalActionTypes:t}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/actions/share_modal",["jquery","require","external/react","external/react-dom","external/es6-promise","external/underscore","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/api_v2/types","modules/clean/flux/dispatcher","modules/clean/growth/experiments/logger","modules/clean/growth/experiments/sharing_paywall_actions_store","modules/clean/previews/util","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/react/file_viewer/store","modules/clean/react/modal","modules/clean/react/pass/actions","modules/clean/react/pass/constants","modules/clean/react/pass/store","modules/clean/react/pass/utils","modules/clean/sharing/action_types","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/constants","modules/clean/sharing/file_settings_modal","modules/clean/sharing/link_settings_modal","modules/clean/sharing/parent_folder_access_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/teams/admin/api/admin_console_api_client","modules/clean/teams/membership_discovery_util","modules/clean/teams/modals/create_team_prompt_modal","modules/clean/legacy_pyxl_controllers/ajax_form","modules/constants/teams","modules/core/browser","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G){var K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de,pe,he,_e,me,fe,ge,ve,ye,Ee,be,Se,we,Te,Ce,Ie,Pe,Ae,Ne,Oe,Re,ke,De,Le,Me,Fe,xe,Ue,Be,He,qe,Ve,We,Ge,Ke,je,ze;return fe=r.Promise,Ce=s.SharingExperimentsLogger,Pe=s.TeamsWebActionsLogger,Q=a.AppError,ke=a.catchApiError,Ae=l.UnionScalar,ue=d.PAYWALL_SERIES_LOGGING_NAME,me=p.PermissionHelper,Se=_.SharedWithActionTypes,Z=m.BrowseStore,le=g.Modal,pe=v.PassActions,ce=y.PASS_FETCHING_STATUS,he=b.PassHelpers,ye=S.ShareModalActionTypes,we=w.SharingActions,Te=T.SharingApi,J=C.CombinedPolicy,oe=C.FolderPolicy,ie=C.GroupMembershipInfo,se=C.LinkAudience,_e=C.PassPolicy,Le=I.combinedPolicyDiffToApi,Me=I.contactsToMembers,We=I.memberAccessLevelApiToRecord,xe=I.folderMetadataApiToRecord,Ke=P.showMemberAccessChangeConfirmationModal,je=A.showRelinquishMembershipConfirmationModal,K=N.ACCESS_LEVEL,j=N.ALPHA_FILE_METADATA_PERMISSIONS,z=N.ALPHA_FOLDER_METADATA_PERMISSIONS,ee=N.FILE_METADATA_PERMISSIONS,te=N.FOLDER_METADATA_PERMISSIONS,ne=N.FOLDER_METADATA_PERMISSIONS_INTERNAL,ae=N.MEMBER_ACTION,ge=N.SHARING_EXPERIMENTS,Ie=N.TRUELINK,Oe=N.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE,Ne=N.VALIDATE_PATH_PERMISSIONS,Ge=O.showFileSettingsModal,be=R.SharedLinkSettingsModal,ze=R.showUpgradeToBizBanner,de=k.ParentFolderAccessModal,Ee=D.SharePageActionTypes,He=M.getContentIdsForContentInfo,X=F.CONTACT_ERROR_LEVEL,Ue=F.genAddMemberErrorMessage,Be=F.genShareSuccessMessage,qe=F.getNewFolderPathFromContentName,re=F.GoldenGate,Ve=F.logTiburonEvent,Y=x.AdminConsoleApiClient,Fe=U.filterSuggestableUsers,$=B.CreateTeamPromptModal,De=n.createElement,Re=W.i18n_default_project("sharing")._,ve=function(){function n(e,t,n){this.updateLinkSettings=bind(this.updateLinkSettings,this),this._parseParentFolderAccessError=bind(this._parseParentFolderAccessError,this),this.showParentFolderAccessModalIfQualified=bind(this.showParentFolderAccessModalIfQualified,this),this.shareIfFileFolder=bind(this.shareIfFileFolder,this),this.sendShare=bind(this.sendShare,this),this.refreshSharedWithColumnContentData=bind(this.refreshSharedWithColumnContentData,this),this.redirectToNsId=bind(this.redirectToNsId,this),this.recipientsChange=bind(this.recipientsChange,this),this.openShareModal=bind(this.openShareModal,this),this.handleSelectLinkAudience=bind(this.handleSelectLinkAudience,this),this.handleLoadingError=bind(this.handleLoadingError,this),this.handleLinkSettingsClick=bind(this.handleLinkSettingsClick,this),this.handleGetMetadataSuccess=bind(this.handleGetMetadataSuccess,this),this.handleMemberAccessChange=bind(this.handleMemberAccessChange,this),this._fetchMetadataForSharedFolder=bind(this._fetchMetadataForSharedFolder,this),this._fetchMetadataForFileFolder=bind(this._fetchMetadataForFileFolder,this),this.fetchMetadataForFile=bind(this.fetchMetadataForFile,this),this.changeRecipientAccess=bind(this.changeRecipientAccess,this),this.changeAccess=bind(this.changeAccess,this),this._client=e,this._user=t,this._shareModalClass=n,this._linkSeenStateInfo=null,this._groupSeenStateInfo=null,this._presentAccountIds=null,this._hasLoggedSet={}}return n.prototype.initializeShareModal=function(e,t){var n;return null==t&&(t={}),n=e.contentInfo,c.dispatch({type:ye.SHARE_MODAL_OPEN,data:{shareModalInfo:e,initialProps:t},contentIds:He(n),user:this._user}),this._sharingInfo=L.getSharingInfo(this._user.id,n.id),this._fetchInitialData()},n.prototype._fetchInitialData=function(){var e,t,n,o,r;return e=this._sharingInfo.contentInfo(),n=this._sharingInfo.isNonUserRelativeContext(),this._beginTime=Date.now(),this.admin_client=new Y(t=!1),this._fetchPassInfo(e),r=[],e.isFileFolder()?r.push(this._fetchMetadataForFileFolder(e)):(r.push(this.listMembers(e.id,e.url())),e.isFile()?r.push(this.fetchMetadataForFile(e)):e.isSharedFolder()&&r.push(this._fetchMetadataForSharedFolder(e))),r.push(this._fetchMemberCounts()),Ie.TRUELINK_UI[this._user.id]?(this._sharingInfo.isTeamPolicyLoaded()||r.push(this._fetchTeamPolicy()),this._sharingInfo.areSharingPrefsLoaded()||r.push(this._fetchSharingPrefs())):(r.push(this._fetchTeamPolicy()),r.push(this._fetchSharingPrefs()),this._sharingInfo.canShareLink()&&!n&&e.isMounted()&&r.push(this.fetchLinkMetadata())),o=ge.PAYWALL_SHARED_FOLDER[this._user.id],indexOf.call(ge.PAYWALL_SHARED_FOLDERS_ON_VARIANTS,o)>=0&&r.push(this._fetchSharingPaywallInfo()),fe.all(r)},n.prototype._fetchPassInfo=function(e){var t,n,o,r,i,s,a,l,c;return this._sharingInfo.shouldBlockMemberListOnPassLoad()&&setTimeout(function(e){return function(){return e._dispatch(ye.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD)}}(this),4e3),o=this._isContentInfoForBrowseFileRow(e),o&&me.is_pass_enabled(this._user)?(s=this._getPassFileInfo(e),r=s[0],c=s[1],t=s[2],i=E.passFetchingStatus(r,c),i===ce.PASS_SUCCESS?(a=E.getLinkAndGroupInfo(r,c),this._linkSeenStateInfo=a[0],this._groupSeenStateInfo=a[1],this._presentAccountIds=E.presence(r,c)):null==i?(n={file:{ns_id:r,sjid:c,beacon_context:t},url:null},l=!o,he.setup(this._user,n,null,l)):void 0):void 0},n.prototype.getSharingInfo=function(){return this._sharingInfo},n.prototype.clearCachedPassInfo=function(){var e;return e=[null,null,null],this._linkSeenStateInfo=e[0],this._groupSeenStateInfo=e[1],this._presentAccountIds=e[2],e},n.prototype.getPassInfo=function(){var e,t,n,o,r,i,s,a,l,c;return t=this._getContentInfo(),!me.is_pass_enabled(this._user)||t.isFolder()?[[],{},[],ce.ERROR]:null!=this._linkSeenStateInfo&&null!=this._groupSeenStateInfo&&null!=this._presentAccountIds?[this._linkSeenStateInfo,this._groupSeenStateInfo,this._presentAccountIds,ce.PASS_SUCCESS]:(s=this._getPassFileInfo(t),o=s[0],c=s[1],e=s[2],null==o||null==c?(a=[[],{},[]],this._linkSeenStateInfo=a[0],this._groupSeenStateInfo=a[1],this._presentAccountIds=a[2],[[],{},[],ce.ERROR]):(r=E.passFetchingStatus(o,c),r===ce.PASS_SUCCESS?(n=E.getLinkAndGroupInfo(o,c),i=E.presence(o,c),this._linkSeenStateInfo=n[0],this._groupSeenStateInfo=n[1],this._presentAccountIds=i.slice(),this._isContentInfoForFilePreview(t)&&(l=this._user.account_id,indexOf.call(this._presentAccountIds,l)<0)&&this._presentAccountIds.push(this._user.account_id),[this._linkSeenStateInfo,this._groupSeenStateInfo,this._presentAccountIds,r]):[[],{},[],r]))},n.prototype._getPassFileInfo=function(e){return this._isContentInfoFromPassRelatedOrigin(e)?[e.nsId(),e.sjid(),e.beaconContext()]:[null,null,null]},n.prototype._isContentInfoFromPassRelatedOrigin=function(e){var t;return"BROWSE_FILE_ROW"===(t=e.extras.origin)||"BROWSE_FILE_FACEPILE"===t||"PREVIEW_PAGE_FACEPILE"===t||"PREVIEW_PAGE"===t},n.prototype._getContentInfo=function(){return this._sharingInfo.contentInfo()},n.prototype._dispatch=function(e,t){return null==t&&(t={}),c.dispatch({type:e,data:t,contentIds:[this._getContentInfo().id],user:this._user})},n.prototype.changeAccess=function(e,t,n){var o,r,i,s,a;return null==n&&(n=!1),a=fe.resolve(),s=e.memberId(),r=this._getContentInfo(),o=r.id,t===ae.REMOVE?s===this._user.account_id?this._client.relinquishMembership({contentId:o,leaveACopy:n}).then(function(e){return function(){return r.isFolder()?G.success(Re("Folder access removed.")):G.success(Re("File access removed.")),le.close(),e.redirectToBrowseUrl("/")}}(this)):(a=(r.isFileFolder()?this._client.getParentFolderAccess({contentId:this._sharingInfo.parentSharedFolderId(),memberId:s}):this.removeMember(o,e,n,r.isFolder())).then(function(t){return function(n){return t.showParentFolderAccessModalIfQualified("remove",e,n)}}(this)),this.openShareModal()):a=t===K.OWNER?this._client.transferContent({contentId:o,memberId:s}).then(function(t){return function(){return t._dispatch(ye.TRANSFER_OWNER_SUCCESS),G.success(Re("Made %(name)s the owner").format({name:e.displayName()})),t._fetchInitialData(),t.openShareModal()}}(this)):(r.isFileFolder()&&t===K.READER?this._client.getParentFolderAccess({contentId:this._sharingInfo.parentSharedFolderId(),memberId:s,accessLevel:t}):(i=this._getContentInfo().isFileFolder(),i?this._dispatch(ye.MEMBER_ACTION_PENDING,{member:e}):void 0,this.shareIfFileFolder().then(function(n){return function(){return i&&n._dispatch(ye.MEMBER_ACTION_COMPLETE,{member:e}),n._changeMemberAccess(n._getContentInfo().id,e,t)}}(this)).catch(function(t){return function(){return i?t._dispatch(ye.MEMBER_ACTION_COMPLETE,{member:e}):void 0}}(this)))).then(function(t){return function(n){return t.showParentFolderAccessModalIfQualified("update",e,n)}}(this)),a.then(this.refreshSharedWithColumnContentData)},n.prototype._changeMemberAccess=function(e,t,n){var o;return o=t.access_type,this._dispatch(ye.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:n}),this._client.updateMember({contentId:e,memberId:t.memberId(),accessLevel:n}).then(function(e){return function(n){return null!=n.access_level&&null!=n.warning?(e._dispatch(ye.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:n.access_level}),n):void 0}}(this)).catch(ke(function(e){return function(n){return e._dispatch(ye.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:o}),e._parseParentFolderAccessError(n)}}(this)))},n.prototype.changeRecipientAccess=function(e){return this._dispatch(ye.CHANGE_RECIPIENT_ACCESS,{newAccess:e})},n.prototype.changeRecipientMessage=function(e){return this._dispatch(ye.CHANGE_RECIPIENT_MESSAGE,{message:e})},n.prototype.closeModal=function(){return le.close()},n.prototype.createSharedLink=function(){return this.log("CLICK_TIB_CREATE_LINK"),
this._dispatch(ye.CREATE_LINK_REQUEST),this._client.createSharedLink({fileIdOrPath:this._getContentInfo().displayPath()}).then(function(e){return function(t){return e._dispatch(ye.CREATE_LINK_SUCCESS,{linkMetadata:t}),e._refreshSharedWithColumnLinkData()}}(this)).catch(ke(function(e){return function(){return e._dispatch(ye.CREATE_LINK_FAILURE)}}(this)))},n.prototype.fetchLinkMetadata=function(){return Ie.TRUELINK_UI[this._user.id]?void 0:(this._dispatch(ye.FETCH_LINK_METADATA_REQUEST),this._client.sharedLinkInfo({fileIdOrPath:this._getContentInfo().idForLink()}).then(function(e){return function(t){return e._dispatch(ye.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}}(this)).catch(function(e){return function(){return e._dispatch(ye.FETCH_LINK_METADATA_FAILURE),Z.context().isNonUserRelativeContext?void 0:(G.error(Re("There was a problem completing this request.")),le.close())}}(this)))},n.prototype._fetchMemberCounts=function(){var e;return e=this._getContentInfo(),this._dispatch(ye.FETCH_MEMBER_COUNTS_REQUEST),e.isSharedFolder()||e.isFolder()&&e.isInSharedFolder()?this._client.getMemberCounts({contentId:e.isSharedFolder()?e.sharedFolderId():e.nsId()}).then(function(e){return function(t){return e._dispatch(ye.FETCH_MEMBER_COUNTS_SUCCESS,{memberCounts:t})}}(this)):fe.resolve()},n.prototype.fetchMetadataForFile=function(e){return we.loadFileMetadata({user:this._user,contentId:e.id,sourceUrl:e.url(),client:this._client}).catch(ke(this.handleLoadingError))},n.prototype._fetchMetadataForFileFolder=function(e){var t,n,o,r,s;return n=re.canActOnInheritedMembers(this._user.id)?ae.ALL:[],r=this._user.is_cdm_member?Oe:Ne,t={actions:Object.keys(r),listMembersArg:{actions:n},shouldParseMetadataFromError:re.canDeepNest(this._user.id)},Z.context().isNonUserRelativeContext?(s=this._client.validateNsIdAndNsPath,o={nsId:e.nsId(),nsPath:e.nsPath()}):(s=this._client.validateFqPath,o={fqPath:e.displayPath()}),s(i.extend(o,t)).then(function(t){return function(n){var o,r;return r=n.metadata,o=n.inheritedMembers,t.handleGetMetadataSuccess(r),e=t._getContentInfo(),t.listMembers(e.id,e.url(),e.isFileFolder()&&o)}}(this)).catch(ke(this.handleLoadingError))},n.prototype._fetchMetadataForSharedFolder=function(e){var t,n;return this._user.is_cdm_member?(n=ne,t=this._client.getMetadataInternal):Ie.TRUELINK_UI[this._user.id]?(n=z,t=this._client.getMetadataAlpha):(n=te,t=this._client.getMetadata),t({contentId:e.id,actions:Object.keys(n)}).then(this.handleGetMetadataSuccess).catch(ke(this.handleLoadingError))},n.prototype._fetchSharingPrefs=function(){return this._dispatch(ye.FETCH_SHARING_PREFS_REQUEST),this._client.getSharingPrefs().then(function(e){return function(t){return e._dispatch(ye.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:t})}}(this))},n.prototype._fetchSharingPaywallInfo=function(){return this._dispatch(ye.FETCH_SHARING_PAYWALL_INFO_REQUEST),this._client.getSharingPaywallInfo().then(function(e){return function(t){return e._dispatch(ye.FETCH_SHARING_PAYWALL_INFO_SUCCESS,{sharingPaywallInfo:t})}}(this))},n.prototype.logPaywallEvent=function(e,t){return t=t||{},t.num_folders_owned=this._sharingInfo.paywallNumOwned(),u.log(ue,e,t)},n.prototype.onShareModalUnmount=function(e){var t,n;return this._teardownPass(),(null!=(n=this._sharingInfo.foldersToUnshare())?n.size:void 0)>0&&this.unshareFoldersBatch(),t=(null!=e?e.serializeInputData():void 0)||{},this._dispatch(ye.SHARE_MODAL_CLOSE,t)},n.prototype.onUnshareFromPaywall=function(e){return this._dispatch(ye.UNSHARE_FROM_PAYWALL,e)},n.prototype.unshareFoldersBatch=function(){var e,t;return t=this._sharingInfo.foldersToUnshare().map(function(e){return String(e)}),e=this._sharingInfo.paywallKeepACopy(),this._client.unshareFolderBatch({nsIds:t,leaveACopy:e}),this._dispatch(ye.CLEAR_UNSHARE_FROM_PAYWALL)},n.prototype._fetchTeamPolicy=function(){return this._dispatch(ye.FETCH_TEAM_POLICY_REQUEST),this._client.getCurrentAccountCached().then(function(e){return function(t){var n;return e._dispatch(ye.FETCH_TEAM_POLICY_SUCCESS,{teamPolicy:null!=(n=t.team)?n.sharing_policies:void 0})}}(this))},n.prototype._getSuggestableUsers=function(e){return Fe(e,function(e){return function(n){var o,r;return o=n.contacts,r=n.is_admin,o.length>0?t(["modules/clean/teams/membership_suggestion_modal"],function(t){var n;return n=t.MembershipSuggestionModal,le.showInstance(De(n,{isAdmin:r,isFile:e._sharingInfo.contentInfo().isFile(),contacts:o}))}):le.close()}}(this),function(){return le.close()})},n.prototype.handleMemberAccessChange=function(e,t){var n,o,r,i,s,a,l,c,u;return r=e.displayName(),t===ae.REMOVE||t===K.OWNER?(a=t===ae.REMOVE&&e.memberId()===this._user.account_id,i=this._getContentInfo().isFolder(),s=this._getContentInfo().isNestedSharedFolder(),o=null!=(u=e.permissions.leave_a_copy)?u.allow:void 0,l=function(n){return function(o){return n.changeAccess(e,t,o===!0)}}(this),c=this.openShareModal,a?je(i,s,l,c,n=!0):Ke(r,t,i,s,o,l,c)):this.changeAccess(e,t)},n.prototype.handleContentNameChange=function(e){var t;return t="SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE",this._hasLoggedSet[t]||(this._sharingExperimentsLog(t),this._hasLoggedSet[t]=!0),this._dispatch(ye.HANDLE_CONTENT_NAME_CHANGE,{name:e})},n.prototype.handleContentNameFocusChange=function(e){return this._dispatch(ye.HANDLE_CONTENT_NAME_FOCUS_CHANGE,{focus:e})},n.prototype.handleGetMetadataSuccess=function(e){return this._dispatch(ye.FETCH_METADATA_SUCCESS,{metadata:e}),c.dispatch({type:Ee.FETCH_METADATA_SUCCESS,metadata:e,user:this._user})},n.prototype.handleLinkSettingsClick=function(){var e,t,n,o;return e=function(e){return function(){return e._refreshSharedWithColumnLinkData(),e.setLinkMetadata(null),e.openShareModal()}}(this),t=this._sharingInfo.getInitialProps().onDeleteLink||e,n=function(e){return function(t){return e.setLinkMetadata(t),e._refreshSharedWithColumnLinkData()}}(this),o=ze(this._user),Pe.log("open_link_settings_modal"),le.showInstance(De(be,{client:this._client,isFile:this._getContentInfo().isFile(),linkMetadata:this._sharingInfo.linkMetadata(),onClose:this.openShareModal,onDeleteLink:t,onPolicySet:n,showUpgradeToBiz:o,isTeam:this._user.is_team}))},n.prototype.handleLoadingError=function(e){var t,n;return e instanceof Q?this._dispatch(ye.FETCH_METADATA_FAILURE,{reason:null!=(t=e.error)&&null!=(n=t.bad_path)?n[".tag"]:void 0}):(G.error(e.message||Re("There was a problem completing this request.")),le.close())},n.prototype.handleSelectLinkAudience=function(e){var t,n;if(!this._sharingInfo.isUpdatingLinkAudience())return t=(null!=(n=this._sharingInfo.linkMetadata())?n.current_audience:void 0)||se.members,this.shareIfFileFolder().then(function(t){return function(){var n,o;return t._dispatch(ye.CHANGE_LINK_AUDIENCE_REQUEST,{newAudience:e}),t._getContentInfo().isFile()?(o=j,n=t._client.updatePolicy.bind(t._client)):(o=te,n=t._client.updatePolicyAlpha.bind(t._client)),n({actions:Object.keys(o),contentId:t._getContentInfo().id,newPolicy:J({audience:e})})}}(this)).then(function(e){return function(t){return e._dispatch(ye.CHANGE_LINK_AUDIENCE_SUCCESS,{metadata:t})}}(this)).catch(ke(function(e){return function(){return e._dispatch(ye.CHANGE_LINK_AUDIENCE_FAILURE,{prevAudience:t}),fe.reject()}}(this)))},n.prototype.handleUpdateFilePolicy=function(e,t){var n,o,r,i,s,a,l,c,u,d,p;if(this.handleGetMetadataSuccess(e),i=this.getSharingInfo().filePolicy(),o=this._getContentInfo(),l=this._getPassFileInfo(o),a=l[0],d=l[1],n=l[2],null!=a&&null!=d){if(i.pass_policy===_e.disabled&&t.pass_policy===_e.enabled)return this.clearCachedPassInfo(),pe.resetPassInfo(a,d),pe.fetchPassError(a,d),this._dispatch(ye.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO);if(i.pass_policy===_e.enabled&&t.pass_policy===_e.disabled)return s=this._isContentInfoForBrowseFileRow(o),p=s?null:null!=(c=f.sharedLinkInfo())?c.url:void 0,this.clearCachedPassInfo(),this.listMembers(o.id,p),r={file:{ns_id:a,sjid:d,beacon_context:n},url:p},u=!s,he.setup(this._user,r,null,u)}},n.prototype.listMembers=function(e,t,n){return we.listMembers({user:this._user,contentId:this._getContentInfo().id,isFolder:this._sharingInfo.isFolder(),url:t,members:n,client:this._client})},n.prototype._isContentInfoForBrowseFileRow=function(e){return"BROWSE_FILE_ROW"===e.extras.origin&&!e.isFolder()},n.prototype._isContentInfoForFilePreview=function(e){return("PREVIEW_PAGE"===e.extras.origin||"PREVIEW_PAGE_FACEPILE"===e.extras.origin)&&!e.isFolder()},n.prototype.log=function(e,t){return Ve(this._getContentInfo(),this._user.id,e,t)},n.prototype.logIfHaventBefore=function(e,t,n){return null==t&&(t={}),null==n&&(n=!0),this._hasLoggedSet[e]?void 0:(this._hasLoggedSet[e]=!0,n&&(t.timing=Date.now()-this._beginTime),this.log(e,t))},n.prototype.openShareModal=function(){return le.showInstance(De(this._shareModalClass,{actionHandler:this}))},n.prototype.recipientsChange=function(e,t){return null==t&&(t=""),fe.resolve().then(function(n){return function(){return n._dispatch(ye.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t})}}(this))},n.prototype.redirectToBrowseUrl=function(e){return h.setUrl({path:e})},n.prototype.redirectToNsId=function(e,n){var o,r;return r=Z.mountPoints().get(e),o=function(e){return function(){return n?t(["modules/clean/sharing/share_modal_util"],function(t){var n;return(n=t.showShareModal)(e._user,Z.context(),{origin:"PARENT_FOLDER_MODAL"})}):void 0}}(this),h.setPath({path:r,onPathLoaded:o,nsId:e})},n.prototype.redirectToUpgrade=function(){return V.redirect("/upgrade?oqa=spw")},n.prototype.refreshSharedWithColumnContentData=function(){return this._getContentInfo().isFolder()?c.dispatch({type:Se.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}}):c.dispatch({type:Se.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[this._getContentInfo().id]}})},n.prototype._refreshSharedWithColumnLinkData=function(){return c.dispatch({type:Se.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this._getContentInfo().displayPath()]}})},n.prototype.removeMember=function(e,t,n,o){return this._dispatch(ye.MEMBER_ACTION_PENDING,{member:t}),this._client.removeMember({contentId:e,memberId:t.memberId(),leaveACopy:n}).then(function(e){return function(n){return e._fetchMemberCounts().then(function(){return null!=(null!=n?n.access_level:void 0)&&null!=(null!=n?n.warning:void 0)?(e._dispatch(ye.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:n.access_level}),n):(o?G.success(Re("Folder access removed.")):G.success(Re("File access removed.")),e._dispatch(ye.REMOVE_MEMBER_SUCCESS,{member:t}))})}}(this)).catch(ke(function(e){return function(n){return e._dispatch(ye.MEMBER_ACTION_COMPLETE,{member:t}),e._parseParentFolderAccessError(n)}}(this)))},n.prototype.setAddMessageAsCommentChecked=function(e){return this._dispatch(ye.SET_COMMENT_CHECKBOX_PREF_REQUEST,{checked:e}),this._client.setSharingPrefs({add_message_as_comment_checked:e})},n.prototype.setAddMessageAsCommentHelpClosed=function(){return this._dispatch(ye.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST),this._client.setSharingPrefs({add_message_as_comment_help_shown:!1})},n.prototype.setContentNameAndSendShare=function(t,n){var r,i;return i=o.findDOMNode(n),r=null!=i?i.value:void 0,new Te(this._user).validate_new_sf_path(r,qe(r,this._user.cdm_tmf_path),function(e){return function(){return e._dispatch(ye.VALIDATE_CONTENT_NAME_SUCCESS,{contentName:r}),e._sendShare(t)}}(this),function(t){return function(n){var o,r,s;return t._sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME"),o=H.extract_errors(n.responseText),t._dispatch(ye.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:null!=(r=o.folder_name)?r.message_text:void 0}),null!=(s=e(i))?s.select():void 0}}(this))},n.prototype.setLinkMetadata=function(e){return this._dispatch(ye.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:e})},n.prototype.paywallGrandfatherModalDismiss=function(){return this._dispatch(ye.PAYWALL_GRANDFATHER_MODAL_DISMISS)},n.prototype.paywallGrandfatherModalLearnMore=function(){return this.logPaywallEvent("view_learn_more"),this._dispatch(ye.PAYWALL_GRANDFATHER_MODAL_LEARN_MORE)},n.prototype.sendShare=function(e,t){return this._sharingInfo.contentInfo().pathExists()?this._sendShare(e):fe.resolve().then(function(n){return function(){return n.setContentNameAndSendShare(e,t)}}(this))},n.prototype._sendShare=function(e){var t,n,o;return this.log("CLICK_TIB_SEND_BUTTON"),t=Date.now(),o=null,n=this._isNewlySharedContent(),this.recipientsChange(null!=e?e.getContacts():void 0).then(function(e){return function(){return e._sharingInfo.contactsError().level===X.ERROR?fe.reject():(o=Me(e._sharingInfo.recipientTokens()),e.shareIfFileFolder())}}(this)).then(function(e){return function(){return e._dispatch(ye.SEND_SHARE_REQUEST),e._client.addMembers({accessLevel:e._sharingInfo.recipientAccess(),contentId:e._sharingInfo.contentInfo().id,addMessageAsComment:e._sharingInfo.isAddMessageAsCommentChecked(),customMessage:e._sharingInfo.recipientMessage(),members:o})}}(this)).catch(ke(function(e){return function(n){return e._dispatch(ye.SEND_SHARE_FAILURE),G.error(Ue(n)),e.log("SHARE_MODAL_SEND_FAIL",{timing:Date.now()-t,num_recipients:o.length}),fe.reject()}}(this))).then(function(r){return function(){var i,s,a,l;return r._dispatch(ye.SEND_SHARE_SUCCESS),G.success(Be(r._sharingInfo.recipientTokens(),r._sharingInfo.contentInfo().name(),l=r._sharingInfo.isTeamSharedFolder(),a=r._sharingInfo.isFolderInsideTeamFolderTree())),r.log("SHARE_MODAL_SEND_SUCCESS",{timing:Date.now()-t,num_recipients:o.length}),"function"==typeof(i=r._sharingInfo.getInitialProps()).onSuccessSharing&&i.onSuccessSharing(),null!=e&&e.finishLogging(!1),r.refreshSharedWithColumnContentData(),q.SHOW_CREATE_TEAM_MODAL_AFTER_SHARING&&n&&o.length>=2?le.showInstance(De($,{invitedMembers:r._sharingInfo.recipientTokens().filter(function(e){return e.email!==r._user.email})})):"V1"===q.SUBGROWTH_BIZ_UPSELL_VARIANT&&r._sharingInfo.ownerTeam()?(s=r._sharingInfo.recipientTokens().map(function(e){return e.email}),r._getSuggestableUsers(s)):le.close()}}(this))},n.prototype._isNewlySharedContent=function(){var e;return this._getContentInfo().isFile()?1===(null!=(e=this._sharingInfo.members())?e.getMemberCount():void 0):!this._getContentInfo().isSharedFolder()},n.prototype.shareIfFileFolder=function(e){var t,n,o;return null==e&&(e=null),this._getContentInfo().isFileFolder()?this._sharingInfo.shareFolderPromise()?this._sharingInfo.shareFolderPromise():(n=this._sharingInfo.isNonUserRelativeContext()?"ns:"+this._getContentInfo().nsId()+this._getContentInfo().nsPath():this._getContentInfo().displayPath(),t={fqPath:n,folderPolicy:e},this._sharingInfo.isNonUserRelativeContext()&&(t.teamMemberId=this._user.team_member_id),o=Ie.TRUELINK_UI[this._user.id]?this._client.shareAlpha(t):this._client.share(t),this._dispatch(ye.SHARE_FOLDER_REQUEST,{promise:o}),o.then(function(e){return function(t){return e._dispatch(ye.SHARE_FOLDER_SUCCESS,{metadata:t}),c.dispatch({type:Ee.FETCH_METADATA_SUCCESS,metadata:t,user:e._user}),t}}(this)).catch(function(e){return function(){return e._dispatch(ye.SHARE_FOLDER_FAILURE),fe.reject()}}(this)),o):fe.resolve()},n.prototype.shareFile=function(){var e;if(!this._getContentInfo().isFile())throw Error("Not a file");return e=j,this._client.share({contentId:this._getContentInfo().id,actions:Object.keys(e)}).then(function(e){return function(t){var n;return e._dispatch(ye.FETCH_METADATA_SUCCESS,{metadata:t}),c.dispatch({type:Ee.FETCH_METADATA_SUCCESS,metadata:t,user:e._user}),n={audience:new Ae("public")},e._client.setLinkSettings({linkSettings:n,url:t.preview_url})}}(this)).then(function(e){return function(t){return e._dispatch(ye.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}}(this))},n.prototype.showParentFolderAccessModalIfQualified=function(e,t,n){return null!=n?le.showInstance(De(de,{contentInfo:this._getContentInfo(),memberAccessLevelResult:n,memberDisplayName:t.displayName(),originalAction:e,isInContentManager:this._sharingInfo.isNonUserRelativeContext(),onClose:this.openShareModal,onParentFolderClicked:this.redirectToNsId})):void 0},n.prototype._parseParentFolderAccessError=function(e){var t;return t=e.error,"member_error"===e.error[".tag"]&&(t=e.error.member_error),"no_explicit_access"===t[".tag"]?We(this._user.id,t):G.error(e.message||Re("There was a problem completing this request."))},n.prototype._sharingExperimentsLog=function(e,t){var n;return null==t&&(t={}),n=this._getContentInfo().extras.modalSessionId,t.modalSessionId||(t.modalSessionId=n),Ce.log(this._user.id,e,t)},n.prototype._teardownPass=function(){var e,t,n,o,r,i,s,a;return this.clearCachedPassInfo(),t=this._getContentInfo(),o=this._isContentInfoForBrowseFileRow(t),o&&me.is_pass_enabled(this._user)?(i=this._getPassFileInfo(t),r=i[0],a=i[1],e=i[2],n={file:{ns_id:r,sjid:a,beacon_context:e},url:null},s=!o,he.teardown(this._user,n,!0,s)):void 0},n.prototype.updateBanner=function(e){return this._dispatch(ye.UPDATE_BANNER,{banner:e})},n.prototype.updateLinkSettings=function(e){var t,n;return n=e.newPolicy,t=Le(n).link_settings,this._client.setLinkSettings({linkSettings:t,url:this._sharingInfo.linkMetadata().url}).then(function(e){return function(t){return e._dispatch(ye.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}}(this))},n}()}),define("modules/clean/sharing/actions/sharing_actions",["require","exports","external/es6-promise","modules/clean/flux/dispatcher","modules/clean/previews/util","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/file_settings_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/core/exception"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){"use strict";t.SharingActions={loadFileMetadataBatch:function(e,t){return new s.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(a.ALPHA_FILE_METADATA_PERMISSIONS)}).then(function(t){return o.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t})})},loadFolderLinkMetadataBatch:function(e,t){return n.Promise.resolve({}).then(function(){return t.forEach(function(t){return o.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,user:e,contentIds:[t]})})}),new s.FolderShareApiClient({userId:e.id}).validateFolderPathBatch({paths:t}).then(function(t){t.forEach(function(t){var n=t.metadata,r=t.path;n&&n.link_metadata?o.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,data:{linkMetadata:n.link_metadata},user:e,contentIds:d.getContentIdsForMetadata(n).concat([r])}):o.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE,user:e,contentIds:[r]})})})},loadFileMetadata:function(e){var t=e.user,n=e.contentId,r=e.sourceUrl,d=e.client,p=u.getSharingInfo(t.id,n);if(p&&p.fetchingMetadataPromise())return p.fetchingMetadataPromise();d=d||new s.FileShareApiClient({userId:t.id});var h,_;l.showFileSettingsModal(t)?(h=a.ALPHA_FILE_METADATA_PERMISSIONS,_=d.getMetadataAlpha):(h=a.FILE_METADATA_PERMISSIONS,_=d.getMetadata);var m=_({contentId:n,actions:Object.keys(h),sourceURL:r}).then(function(e){o.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:t,data:[e]}),o.dispatch({type:c.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:t})});return o.dispatch({type:i.ShareModalActionTypes.FETCH_METADATA_REQUEST,contentIds:[n],data:{promise:m},user:t}),m},listMembers:function(e){var t=e.user,a=e.contentId,l=e.isFolder,c=e.limit,d=e.url,h=e.members,_=e.client;p.assert(!c||100>=c,"listMembers not implemented for limit > 100");var m=c||9999999,f=u.getSharingInfo(t.id,a);if(f){var g=f.fetchingMembersRequest();if(g&&m<=g.limitNonNull)return g.promise;if(f.hasDisplayableMembers()&&m<f.members())return n.Promise.resolve({})}var v=Math.random().toString(),y=r.PermissionHelper.is_pass_enabled(t)&&!l;_||(_=l?new s.FolderShareApiClient({userId:t.id}):new s.FileShareApiClient({userId:t.id}));var E,b=function(e){return e?(o.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[a],user:t}),_.listMembersContinue({cursor:e,url:d,isAlpha:y}).then(function(e){o.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[a],data:{members:e,requestId:v},user:t}),b(e.cursor)})):n.Promise.resolve({})};return E=h?n.Promise.resolve(h):_.listMembers({contentId:a,url:d,limit:c,isAlpha:y}),E=E.then(function(e){o.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[a],data:{members:e,requestId:v},user:t}),c||b(e.cursor)}),o.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[a],data:{limitNonNull:m,requestId:v,promise:E},user:t}),E},fetchFileMemberCount:function(e){var t=e.user,a=e.fileId,l=e.limit,c=e.url,u=e.client;u=u||new s.FileShareApiClient({userId:t.id});var d;return d=r.PermissionHelper.is_pass_enabled(t)&&a?u.getMemberCounts({contentId:a,url:c,limit:l}):n.Promise.resolve({count:-1,exceeds_limit:!1}),o.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[a],user:t}),d.then(function(e){o.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[a],data:e,user:t})})},fetchLinkMetadata:function(e){var t=e.user,n=e.contentId,r=e.client;a.TRUELINK.TRUELINK_UI[t.id]||(r=r||new s.ShareApiClient({userId:t.id}),o.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,contentIds:[n],data:{},user:t}),r.sharedLinkInfo({fileIdOrPath:n}).then(function(e){o.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,contentIds:[n],data:{linkMetadata:e},user:t})}))}}}),define("modules/clean/sharing/api",["modules/clean/ajax","modules/core/exception","jquery"],function(e,t,n){var o,r,i,assert;return i=e.WebRequest,o=e.FormWebRequest,assert=t.assert,r=function(){function e(e){this.user=e}return e.REQUEST_SUCCEEDED_EVENT="db:sharing_api:request_succeeded",e.prototype.get_sync_vars_for_ns_id=function(e,t,n,o){var r;return r={ns_id:e,sub_path:t},this._make_request("/sharing/get_sync_vars_for_ns_id",r,n,o,!0)},e.prototype.validate_new_sf_path=function(e,t,n,o){var r;return r={share_type:"new",folder_name:e,path:t},this._make_request("/share_ajax/validate_folder",r,n,o,!0)},e.prototype.validate_shareable_existing_sf_path=function(e,t,n){var o;return o={share_type:"shareable_existing",path:e},this._make_request("/share_ajax/validate_folder",o,t,n,!0)},e.prototype._make_request=function(t,r,s,a,l,c){var u,d,p;return null==l&&(l=!1),null==c&&(c=!0),u={url:t,data:r,success:function(o,i,a){return"function"==typeof s&&s(a),n(document).trigger(e.REQUEST_SUCCEEDED_EVENT,{request_url:t,ns_id:r.ns_id||null})},error:function(e){return"function"==typeof a?a(e):void 0},complete:function(e){return function(){var t;return null!=(t=e.loading_elem)?t.removeClass("ajax-loading"):void 0}}(this)},c&&(u.subject_user=this.user.id),null!=(d=this.loading_elem)&&d.addClass("ajax-loading"),(p=l?o:i)(u)},e}(),{SharingApi:r}});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/api/client",["external/immutable","external/underscore","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/contacts/types","modules/clean/react/content_manager/api","external/es6-promise","modules/clean/sharing/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/core/exception","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d){var p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,assert,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y;return P=n.UserActionsRootAwareClient,h=o.AppError,O=o.catchApiError,Y=i.validateFolderPath,b=s.Promise,p=a.ACCESS_LEVEL,v=a.MEMBER_ACTION,C=a.TRUELINK,_=l.FilePolicy,f=l.FolderPolicy,y=l.MemberPermission,T=l.SharingMembership,I=l.TeamSharingPolicies,A=c.accessLevelConstToApi,N=c.accountInfoApiToRecord,R=c.combinedPolicyDiffToApi,k=c.fileMetadataApiToRecord,D=c.folderMetadataApiToRecord,L=c.fullAccountApiToRecord,M=c.hasFolderMetadataRecordInMetadata,F=c.linkMetadataApiToRecord,x=c.listFilesResultApiToRecord,U=c.listFoldersResultApiToRecord,B=c.makeMemberSelector,H=c.memberAccessLevelApiToRecord,q=c.memberCountsApiToRecord,V=c.membershipApiToRecord,W=c.parseFolderPermissions,G=c.parseFolderPolicy,j=c.sharedContentLinkMetadataToRecord,z=c.sharingPrefsApiToRecord,assert=u.assert,w=function(e){function t(e){this.message=e,this.name="ShareError",this.stack=(new Error).stack}return extend(t,e),t}(Error),S=function(){function n(e){var t;this.userId=e.userId,this.client=null!=(t=e.client)?t:null,null==this.client&&(this.client=new P)}return n.prototype.addMembers=function(e){var t,n,o,r,i,s,a;throw n=e.contentId,r=e.members,t=e.accessLevel,o=null!=(s=e.customMessage)?s:null,i=null!=(a=e.quiet)?a:!1,new TypeError("Not implemented")},n.prototype.removeMember=function(e){var t,n;throw t=e.contentId,n=e.memberId,new TypeError("Not implemented")},n.prototype.getMetadata=function(e){var t,n,o;throw n=e.contentId,t=null!=(o=e.actions)?o:[],new TypeError("Not implemented")},n.prototype.getMetadataInternal=function(e){var t,n,o;throw n=e.contentId,t=null!=(o=e.actions)?o:[],new TypeError("Not implemented")},n.prototype.getMetadataAlpha=function(e){var t,n,o;throw n=e.contentId,t=null!=(o=e.actions)?o:[],new TypeError("Not implemented")},n.prototype.listMembers=function(e){var t,n;throw t=e.contentId,n=e.isAlpha,new TypeError("Not implemented")},n.prototype.listMembersContinue=function(e){var t,n;throw t=e.cursor,n=e.isAlpha,new TypeError("Not implemented")},n.prototype.getMemberCounts=function(e){var t;throw t=e.contentId,new TypeError("Not implemented")},n.prototype.getParentFolderAccess=function(e){var t,n,o;throw n=e.contentId,o=e.memberId,t=e.accessLevel,new TypeError("Not implemented")},n.prototype.updateMember=function(e){var t,n,o;throw n=e.contentId,o=e.memberId,t=e.accessLevel,new TypeError("Not implemented")},n.prototype.dismissInviteNotification=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/dismiss_invite_notification",{content_id:t})},n.prototype.getSharingPrefs=function(){return this.client.rpc(this.userId,"users/get_sharing_prefs",null,!1).then(z)},n.prototype.setSharingPrefs=function(e){return this.client.rpc(this.userId,"users/set_sharing_prefs",e)},n.prototype.getSharingPaywallInfo=function(){return this.client.rpc(this.userId,"users/get_sharing_paywall_info")},n.prototype.claimMembership=function(e){var t;return t=e.contentUrl,this.client.rpc(this.userId,"sharing/claim_membership",{content_url:t})},n.prototype.checkJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_job_status",{async_job_id:t})},n.prototype.getAccountBatch=function(e){var t;return t=e.accountIds,t.length>0?this.client.rpc(this.userId,"users/get_account_batch",{account_ids:t}).then(function(e){return e.map(N)}):b.resolve([])},n.prototype._getAccountBatchCache={},n.prototype.getAccountBatchCached=function(e){var n,o,r,i,s,a;return n=e.accountIds,i=this._getAccountBatchCache,s=t.partition(n,function(e){return e in i}),r=s[0],a=s[1],o=t.values(t.pick(i,r)),this.getAccountBatch({accountIds:a}).then(function(e){var n;return n=t.object(e.map(function(e){return[e.account_id,e]})),t.extendOwn(i,n),e.concat(o)})},n.prototype.resetGetAccountBatchCache=function(){return this._getAccountBatchCache={}},n.prototype.getCurrentAccount=function(e){return this.client.rpc(this.userId,"users/get_current_account").then(function(e){return L(e)})},n.prototype._getCurrentAccountCache=null,n.prototype.getCurrentAccountCached=function(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache},n.prototype.resetGetCurrentAccountCache=function(){return this._getCurrentAccountCache={}},n.prototype.requestAccess=function(e){var t,n;return t=e.contentUrl,n=e.customMessage,this.client.rpc(this.userId,"sharing/request_access",{content_url:t,custom_message:n})},n.prototype.sharedLinkInfo=function(e){var t,n;return t=e.fileIdOrPath,assert(null!=t,"an fqPath or fileId must be present to retrieve shared link info"),n=this.client.rpc(this.userId,"sharing/alpha/list_shared_links",{path:t,direct_only:!0}),n.then(function(e){return 0===e.links.length?null:F(e.links[0])})},n.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this.client.rpc(this.userId,"sharing/alpha/create_shared_link_with_settings",{path:t}).then(F)},n.prototype.modifySharedLinkSettings=function(e){var t,n,o;return o=e.url,n=e.settings,t=e.remove_expiration,this.client.rpc(this.userId,"sharing/alpha/modify_shared_link_settings",{url:o,settings:n,remove_expiration:t}).then(F)},n.prototype.revokeSharedLink=function(e){var t;return t=e.url,this.client.rpc(this.userId,"sharing/revoke_shared_link",{url:t})},n.prototype.getLinkMetadata=function(e){var t;return t=e.url,this.client.rpc(this.userId,"sharing/alpha/get_link_metadata",{url:t}).then(j)},n.prototype.setLinkSettings=function(e){var t,n;return t=e.linkSettings,n=e.url,this.client.rpc(this.userId,"sharing/alpha/set_link_settings",{link_settings:t,url:n}).then(j)},n.prototype._addAccountsToMembership=function(t){return this._addAccountsToMembershipBatch(e.Map([[1,t]])).then(function(e){return e.get(1)})},n.prototype._addAccountsToMembershipBatch=function(t){var n;return n=t.valueSeq().flatMap(function(e){return e.users.valueSeq()}).map(function(e){return e.memberId()}).toSet().toArray(),n.length>0?this.getAccountBatchCached({accountIds:n}).then(function(n){var o;return o=e.Map(n.map(function(e){return[e.account_id,e]})),t.map(function(e,t){return e.set("users",e.users.map(function(e){return function(e){var t;return t=o.get(e.account_id),null!=t?e.set("account",t):e}}(this)))})}):b.resolve(t)},n}(),E=function(e){function t(){this.validateNsIdAndNsPath=bind(this.validateNsIdAndNsPath,this),this.validateFqPath=bind(this.validateFqPath,this),this.getMetadataAlpha=bind(this.getMetadataAlpha,this),this.getMetadataInternal=bind(this.getMetadataInternal,this),this.getMetadata=bind(this.getMetadata,this),t.__super__.constructor.apply(this,arguments),this._promises={}}return extend(t,e),t.prototype.addMembers=function(e){var t,n,o,r,i,s,a;return n=e.contentId,r=e.members,t=e.accessLevel,o=null!=(s=e.customMessage)?s:null,i=null!=(a=e.quiet)?a:!1,this.createPromise("addMembers")},t.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.createPromise("getMetadata")},t.prototype.getMetadataInternal=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.createPromise("getMetadataInternal")},t.prototype.getMetadataAlpha=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.createPromise("getMetadataAlpha")},t.prototype.dismissInviteNotification=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.cursor)?o:null,this.createPromise("dismissInviteNotification")},t.prototype.getSharingPrefs=function(){return this.createPromise("getSharingPrefs")},t.prototype.getSharingPaywallInfo=function(){return this.createPromise("getSharingPaywallInfo")},t.prototype.getOwnedSharedFolders=function(){return this.createPromise("getOwnedSharedFolders")},t.prototype.listMembers=function(e){var t,n;return t=e.contentId,n=e.isAlpha,this.createPromise("listMembers")},t.prototype.listMembersContinue=function(e){var t,n;return t=e.cursor,n=e.isAlpha,this.createPromise("listMembersContinue")},t.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this.createPromise("getMemberCounts")},t.prototype.getParentFolderAccess=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.createPromise("getParentFolderAccess")},t.prototype.removeMember=function(e){var t,n;return t=e.contentId,n=e.memberId,this.createPromise("removeMember")},t.prototype.setLinkSettings=function(e){
var t,n;return t=e.linkSettings,n=e.url,this.createPromise("setLinkSettings")},t.prototype.share=function(e){var t,n,o,r,i,s,a,l,c;return o=e.fqPath,r=null!=(i=e.memberPolicy)?i:null,t=null!=(s=e.aclUpdatePolicy)?s:null,c=null!=(a=e.sharedLinkPolicy)?a:null,n=null!=(l=e.forceAsync)?l:!1,this.createPromise("share")},t.prototype.shareInternal=function(e){var t,n,o,r,i,s,a;return r=e.fqPath,n=null!=(i=e.folderPolicy)?i:null,o=null!=(s=e.forceAsync)?s:!1,t=null!=(a=e.confidential)?a:!1,this.createPromise("shareInternal")},t.prototype.requestAccess=function(e){var t,n;return t=e.contentUrl,n=e.customMessage,this.createPromise("requestAccess")},t.prototype.sharedLinkInfo=function(e){var t;return t=e.fileIdOrPath,this.createPromise("sharedLinkInfo")},t.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this.createPromise("transferContent")},t.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this.createPromise("createSharedLink")},t.prototype.updateMember=function(){return this.createPromise("updateMember")},t.prototype.validateFqPath=function(e){var t,n,o;return n=e.fqPath,t=null!=(o=e.actions)?o:[],this.createPromise("validateFqPath")},t.prototype.validateNsIdAndNsPath=function(e){var t,n,o,r;return n=e.nsId,o=e.nsPath,t=null!=(r=e.actions)?r:[],this.createPromise("validateNsIdAndNsPath")},t.prototype.getCurrentAccountCached=function(e){return this.createPromise("getCurrentAccountCached")},t.prototype.modifySharedLinkSettings=function(e){var t,n,o;return o=e.url,n=e.settings,t=e.remove_expiration,this.createPromise("modifySharedLinkSettings")},t.prototype.revokeSharedLink=function(e){var t;return t=e.url,this.createPromise("revokeSharedLink")},t.prototype.relinquishMembership=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)?o:!1,this.createPromise("relinquishMembership")},t.prototype.setConfidentiality=function(e){var t,n;return n=e.contentId,t=e.confidential,this.createPromise("setConfidentiality")},t.prototype.createPromise=function(e){var t;return t=this._promises[e],t&&t.calledBeforeCreatePromise?(this._promises[e]=null,t.promise):(t={},t.promise=new b(function(e,n){return t.resolve=e,t.reject=n}),this._promises[e]=t,t.promise)},t.prototype.getPromise=function(e){var t;return null!=(t=this._promises[e])?t.promise:void 0},t.prototype.resolvePromise=function(e,t,n){var o;return null==n&&(n=!1),this._promises[e]||this.createPromise(e),o=this._promises[e],o.calledBeforeCreatePromise=n,o.resolve.apply(null,t),o.promise},t.prototype.rejectPromise=function(e,t){var n;return this._promises[e]||this.createPromise(e),n=this._promises[e],n.reject.apply(null,t),n.promise},t}(S),m=function(t){function n(){return this.getMetadataBatchAlpha=bind(this.getMetadataBatchAlpha,this),this.getMetadataAlpha=bind(this.getMetadataAlpha,this),this.getMetadata=bind(this.getMetadata,this),n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.prototype.addMembers=function(e){var t,n,o,r,i,s,a,l,c,u,d;return r=e.contentId,s=e.members,i=null!=(l=e.customMessage)?l:null,a=null!=(c=e.quiet)?c:!1,t=null!=(u=e.accessLevel)?u:p.READER,n=null!=(d=e.addMessageAsComment)?d:!1,o=A(t),0===(null!=i?i.length:void 0)&&(i=null),this.client.rpc(this.userId,"sharing/add_file_member",{file:r,members:s,custom_message:i,quiet:a,access_level:o,add_message_as_comment:n})},n.prototype.removeMember=function(e){var t,n,o;return t=e.contentId,o=e.memberId,this.client.rpc(this.userId,"sharing/remove_file_member_2",{file:t,member:B(o)},n=!1).then(function(e){return function(t){return H(e.userId,t)}}(this))},n.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.client.rpc(this.userId,"sharing/get_file_metadata",{file:n,actions:t},!1).then(k)},n.prototype.getMetadataAlpha=function(e){var t,n,o,r;return n=e.contentId,t=null!=(o=e.actions)?o:[],r=e.sourceURL,this.client.rpc(this.userId,"sharing/alpha/get_file_metadata",{file:n,actions:t,url:r},!1).then(k)},n.prototype.getMetadataBatchAlpha=function(e){var t,n,o;return n=e.contentIds,t=null!=(o=e.actions)?o:[],this.client.rpc(this.userId,"sharing/alpha/get_file_metadata/batch",{files:n,actions:t},!1).then(function(e){return e.map(function(e){return k(e.result)})})},n.prototype.share=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.client.rpc(this.userId,"sharing/share_file",{file:n,actions:t}).then(k)},n.prototype.listMembers=function(e){var t,n,o,r,i,s,a;return t=e.contentId,a=null!=(r=e.url)?r:null,o=null!=(i=e.limit)?i:100,n=null!=(s=e.isAlpha)?s:!1,this.client.rpc(this.userId,n?"sharing/alpha/list_file_members":"sharing/list_file_members",{file:t,actions:v.ALL,include_inherited:!0,limit:o,url:n?a:void 0},!1).then(V).then(this._addAccountsToMembership.bind(this))},n.prototype.listMembersContinue=function(e){var t,n,o,r,i;return t=e.cursor,i=null!=(o=e.url)?o:null,n=null!=(r=e.isAlpha)?r:!1,this.client.rpc(this.userId,n?"sharing/alpha/list_file_members/continue":"sharing/list_file_members/continue",{cursor:t,url:n?i:void 0}).then(function(e){return V(e,null)}).then(this._addAccountsToMembership.bind(this))},n.prototype.listMembersBatch=function(t){var n,o,r;return n=t.contentIds,o=null!=(r=t.limit)?r:10,this.client.rpc(this.userId,"sharing/list_file_members/batch",{files:n,limit:o}).then(function(t){var n,o,r,i;for(i={},o=0,r=t.length;r>o;o++)n=t[o],"result"===n.result[".tag"]&&(i[n.file]=V(n.result.members,n.result.member_count));return e.Map(i)}).then(this._addAccountsToMembershipBatch.bind(this))},n.prototype.getMemberCounts=function(e){var t,n,o,r;return t=e.contentId,n=e.limit,r=null!=(o=e.url)?o:null,this.client.rpc(this.userId,"sharing/get_file_member_counts",{file:t,limit:n,url:r})},n.prototype.getParentFolderAccess=function(e){var t,n,o;throw n=e.contentId,o=e.memberId,t=e.accessLevel,new w("Parent folder access points not implemented for files")},n.prototype.relinquishMembership=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/relinquish_file_membership",{file:String(t)})},n.prototype.listReceivedFiles=function(e){var t,n,o,r;return n=null!=(o=e.limit)?o:100,t=null!=(r=e.actions)?r:[],this.client.rpc(this.userId,"sharing/list_received_files",{limit:n,actions:t}).then(x)},n.prototype.listReceivedFilesContinue=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/list_received_files/continue",{cursor:t}).then(x)},n.prototype.updateMember=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/update_file_member",{file:String(n),member:B(o),access_level:A(t)}).then(function(e){return function(t){return H(e.userId,t)}}(this))},n.prototype.updatePolicy=function(e){var t,n,o,r;return o=e.contentId,r=e.newPolicy,t=e.actions,n=R(r),n.actions=t,n.file=o,this.client.rpc(this.userId,"sharing/alpha/update_file_policy",n).then(function(e){return null!=e.metadata&&(e=e.metadata),k(e)})},n.prototype.unshare=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/unshare_file",{file:String(t)})},n}(S),g=function(e){function t(){return this.updatePolicyAlpha=bind(this.updatePolicyAlpha,this),this.updatePolicy=bind(this.updatePolicy,this),this.validateNsIdAndNsPath=bind(this.validateNsIdAndNsPath,this),this.validateFqPath=bind(this.validateFqPath,this),this.getMetadataInternal=bind(this.getMetadataInternal,this),this.getMetadataAlpha=bind(this.getMetadataAlpha,this),this.getMetadata=bind(this.getMetadata,this),this._shareComplete=bind(this._shareComplete,this),t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.share=function(e){var t,n,o,r,i,s,a;return o=e.fqPath,t=null!=(r=e.folderPolicy)?r:null,n=null!=(i=e.forceAsync)?i:!1,a=null!=(s=e.teamMemberId)?s:null,this._share({fqPath:o,folderPolicy:t,forceAsync:n,confidential:!1,internal:!1,teamMemberId:a})},t.prototype.shareAlpha=function(e){var t,n,o,r,i,s,a;return o=e.fqPath,n=null!=(i=e.folderPolicy)?i:null,a=null!=(s=e.teamMemberId)?s:null,t=R(n),t.path=o,r={},null!=a&&(r["Dropbox-API-Select-Admin"]=a),this.client.rpc(this.userId,"sharing/alpha/share_folder",t,!1,r).then(function(e){return function(t){return e._shareComplete(t,!1)}}(this))},t.prototype.shareInternal=function(e){var t,n,o,r,i,s,a;return r=e.fqPath,n=null!=(i=e.folderPolicy)?i:null,o=null!=(s=e.forceAsync)?s:!1,t=null!=(a=e.confidential)?a:!1,this._share({fqPath:r,folderPolicy:n,forceAsync:o,confidential:t,internal:!0})},t.prototype._share=function(e){var t,n,o,r,i,s,a,l,c;return i=e.fqPath,o=e.folderPolicy,r=e.forceAsync,n=e.confidential,a=e.internal,c=e.teamMemberId,t={path:i},null!=o&&o.forEach(function(e,n){return null!=e&&"resolved_member_policy"!==n?t[n]={".tag":e}:void 0}),l="sharing/share_folder",a&&(t.confidentiality=n?"confidential":"not_confidential",l="sharing/share_folder_internal"),s={},null!=c&&(s["Dropbox-API-Select-Admin"]=c),this.client.rpc(this.userId,l,t,!1,s).then(function(e){return function(t){return e._shareComplete(t,a)}}(this))},t.prototype._shareComplete=function(e,t){return("complete"===e[".tag"]?b.resolve(e):K(this.checkShareJobStatus.bind(this,{jobId:e.async_job_id,internal:t}))).then(D)},t.prototype.checkShareJobStatus=function(e){var t,n,o;return n=e.jobId,t=e.internal,o=t?"sharing/check_share_internal_job_status":"sharing/check_share_job_status",this.client.rpc(this.userId,o,{async_job_id:n})},t.prototype.checkRemoveMemberJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_remove_member_job_status",{async_job_id:t})},t.prototype.addMembers=function(e){var t,n,o,r,i,s,a,l,c,u;return r=e.contentId,a=e.members,t=e.accessLevel,i=null!=(c=e.customMessage)?c:null,l=null!=(u=e.quiet)?u:!1,o=A(t),0===(null!=i?i.length:void 0)&&(i=null),n={shared_folder_id:String(r),members:function(){var e,t,n;for(n=[],e=0,t=a.length;t>e;e++)s=a[e],n.push({member:s,access_level:o});return n}(),custom_message:i,quiet:l},this.client.rpc(this.userId,"sharing/add_folder_member",n)},t.prototype.fetchNsId=function(e){return this.client.rpc(this.userId,"files/get_metadata",{path:e}).then(function(e){var t;return null!=(t=e.sharing_info)?t.shared_folder_id:void 0})},t.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/get_folder_metadata"})},t.prototype.getMetadataAlpha=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/alpha/get_folder_metadata"})},t.prototype.getMetadataInternal=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/get_folder_metadata_2"})},t.prototype._getMetadata=function(e){var t,n,o,r;return n=e.contentId,t=null!=(r=e.actions)?r:[],o=e.metadataApi,this.client.rpc(this.userId,o,{shared_folder_id:String(n),actions:t}).then(D)},t.prototype._metadataAndInheritMembers=function(e){var t;return t=e.members_cursor,t?this.listMembersContinue({cursor:t}).then(function(t){return{metadata:e,inheritedMembers:t}}):{metadata:e,inheritedMembers:new T}},t.prototype.validateFqPath=function(e){var t,n,o,r,i,s,a,l;return n=e.fqPath,t=null!=(r=e.actions)?r:[],o=null!=(i=e.listMembersArg)?i:{},l=null!=(s=e.shouldParseMetadataFromError)?s:!1,a=this.client.rpc(this.userId,"sharing/validate_folder_path",{path:n,actions:t,list_members_arg:o},!1),this._validatePathContinue(a,l)},t.prototype.validateNsIdAndNsPath=function(e){var t,n,o,r,i,s,a,l,c;return o=e.nsId,r=e.nsPath,t=null!=(i=e.actions)?i:[],n=null!=(s=e.listMembersArg)?s:{},c=null!=(a=e.shouldParseMetadataFromError)?a:!1,l=Y({nsId:o,nsPath:r,actions:t,listMembersArg:n}),this._validatePathContinue(l,c)},t.prototype._validatePathContinue=function(e,t){return e.catch(O(function(e){var n,o;if("already_shared"===(null!=(n=e.error)&&null!=(o=n.bad_path)?o[".tag"]:void 0))return e.error.bad_path;if(t&&e instanceof h&&e.error&&"no_permission"===e.error[".tag"]&&M(e.error))return e.error;throw e})).then(D).then(this._metadataAndInheritMembers.bind(this))},t.prototype.validateFolderPathBatch=function(e){var t,n;return t=e.paths,n=this.client.rpc(this.userId,"sharing/validate_folder_path/batch",{paths:t}).then(function(e){return e.entries.map(function(e){var t,n,o,r,i,s;return s=e.result,t=null,"metadata"===s[".tag"]?t=s:"no_permission"===(null!=(o=s.path_error)?o[".tag"]:void 0)?t=s.path_error:"already_shared"===(null!=(r=s.path_error)&&null!=(i=r.bad_path)?i[".tag"]:void 0)&&(t=s.path_error.bad_path),n=null,t&&t.link_metadata&&(n=D(t)),{path:e.path,metadata:n}})})},t.prototype.updatePolicy=function(e){var t,n,o;return n=e.contentId,o=e.newPolicy,t=o,t.shared_folder_id=String(n),this.client.rpc(this.userId,"sharing/update_folder_policy",t).then(D)},t.prototype.updatePolicyAlpha=function(e){var t,n,o;return n=e.contentId,o=e.newPolicy,t=R(o),t.shared_folder_id=String(n),this.client.rpc(this.userId,"sharing/alpha/update_folder_policy",t).then(D)},t.prototype.unshare=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)?o:!1,this.client.rpc(this.userId,"sharing/unshare_folder",{shared_folder_id:String(t),leave_a_copy:n}).then(function(e){return function(t){return"complete"===t[".tag"]?b.resolve(t):K(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},t.prototype.getOwnedSharedFolders=function(){return this.client.rpc(this.userId,"users/list_owned_shared_folders").then(function(e){return b.resolve(e)})},t.prototype.unshareFolderBatch=function(e){var t,n,o;return n=e.nsIds,t=null!=(o=e.leaveACopy)?o:!1,this.client.rpc(this.userId,"sharing/unshare_folder/batch",{shared_folder_ids:n,leave_a_copy:t}).then(function(e){return"async_job_id"===e[".tag"]?b.resolve(e):b.reject(e)})},t.prototype.listMembers=function(e){var t,n,o,r,i;return t=e.contentId,o=null!=(r=e.limit)?r:100,n=null!=(i=e.isAlpha)?i:!1,this.client.rpc(this.userId,"sharing/list_folder_members",{shared_folder_id:String(t),actions:v.ALL,limit:o}).then(V).then(this._addAccountsToMembership.bind(this))},t.prototype.listMembersContinue=function(e){var t,n,o;return t=e.cursor,n=null!=(o=e.isAlpha)?o:!1,this.client.rpc(this.userId,"sharing/list_folder_members/continue",{cursor:t}).then(function(e){return V(e,null)}).then(this._addAccountsToMembership.bind(this))},t.prototype.listMountableFolders=function(e){var t,n,o,r,i;return o=null!=e?e:{},n=null!=(r=o.limit)?r:100,t=null!=(i=o.actions)?i:[],this.client.rpc(this.userId,"sharing/list_mountable_folders",{limit:n,actions:t}).then(U)},t.prototype.listMountableFoldersContinue=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/list_mountable_folders/continue",{cursor:t}).then(U)},t.prototype.listMountableFoldersAlpha=function(e){var t,n,o,r,i;return o=null!=e?e:{},n=null!=(r=o.limit)?r:100,t=null!=(i=o.actions)?i:[],this.client.rpc(this.userId,"sharing/alpha/list_mountable_folders",{limit:n,actions:t}).then(U)},t.prototype.listMountableFoldersContinueAlpha=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/alpha/list_mountable_folders/continue",{cursor:t}).then(U)},t.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/get_folder_member_counts",{shared_folder_id:String(t)}).then(q)},t.prototype.getParentFolderAccess=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/get_parent_folder_access",{shared_folder_id:String(n),member:B(o),access_level:null!=t?A(t):void 0}).then(H.bind(null,this.userId))},t.prototype.relinquishMembership=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)?o:!1,this.client.rpc(this.userId,"sharing/relinquish_folder_membership",{shared_folder_id:String(t),leave_a_copy:n}).then(function(e){return function(t){return"complete"===t[".tag"]?b.resolve():K(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},t.prototype.removeMember=function(e){var t,n,o,r,i;return t=e.contentId,r=e.memberId,o=null!=(i=e.leaveACopy)?i:!1,this.client.rpc(this.userId,"sharing/remove_folder_member",{shared_folder_id:String(t),member:B(r),leave_a_copy:o},n=!1).then(function(e){return function(t){return"complete"===t[".tag"]?b.resolve():K(e.checkRemoveMemberJobStatus.bind(e,{jobId:t.async_job_id}))}}(this)).then(function(e){return function(t){return H(e.userId,t)}}(this))},t.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this.client.rpc(this.userId,"sharing/transfer_folder",{shared_folder_id:String(t),to_dropbox_id:n})},t.prototype.updateMember=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/update_folder_member",{shared_folder_id:String(n),member:B(o),access_level:A(t)}).then(function(e){return function(t){return H(e.userId,t)}}(this))},t.prototype.mount=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/mount_folder",{shared_folder_id:String(t)}).then(D)},t.prototype.unmount=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/unmount_folder",{shared_folder_id:String(t)})},t.prototype.setConfidentiality=function(e){var t,n;return n=e.contentId,t=e.confidential,this.client.rpc(this.userId,"sharing/set_confidentiality",{shared_folder_id:String(n),confidentiality:t?"confidential":"not_confidential"}).then(function(e){return function(t){return"complete"===t[".tag"]?b.resolve(t):K(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id,internal:!0}))}}(this)).then(D)},t}(S),K=function(e,t){var n,o,r,i,s,a,l;return i=null!=t?t:{},r=null!=(s=i.interval)?s:1e3,l=null!=(a=i.timeout)?a:null,o=null!=l?Date.now()+l:null,n=function(t,i){return null!=o&&Date.now()>o?i():e().then(function(e){switch(e[".tag"]){case"failed":return i(e);case"complete":return t(e);case"in_progress":return window.setTimeout(n,r,t,i)}})},new b(n)},{FilePolicy:_,FileShareApiClient:m,FolderPolicy:f,FolderShareApiClient:g,MemberPermission:y,MockShareApiClient:E,parseFolderPermissions:W,parseFolderPolicy:G,ShareError:w,ShareApiClient:S,TeamSharingPolicies:I}}),define("modules/clean/sharing/api/types/metadata",["require","exports","tslib","external/immutable","modules/clean/api_v2/types"],function(e,t,n,o,r){"use strict";t.MemberPolicy={team:new r.UnionScalar("team"),anyone:new r.UnionScalar("anyone")},t.AclUpdatePolicy={owner:new r.UnionScalar("owner"),editors:new r.UnionScalar("editors")},t.SharedLinkPolicy={anyone:new r.UnionScalar("anyone"),members:new r.UnionScalar("members")},t.SharedFolderMemberMemberPolicy={team:new r.UnionScalar("team"),anyone:new r.UnionScalar("anyone")},t.SharedFolderJoinPolicy={from_team_only:new r.UnionScalar("from_team_only"),from_anyone:new r.UnionScalar("from_anyone")},t.SharedLinkCreatePolicy={default_public:new r.UnionScalar("default_public"),default_team_only:new r.UnionScalar("default_team_only"),team_only:new r.UnionScalar("team_only")},t.RequestedVisibilityPolicy={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},t.ResolvedVisibilityPolicy={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only"},t.VisibilityDisallowedReason={delete_and_recreate:"delete_and_recreate",restricted_by_shared_folder:"restricted_by_shared_folder",restricted_by_team:"restricted_by_team",user_account_type:"user_account_type",user_not_on_team:"user_not_on_team"},t.LinkExpiryPolicy={policy_name:"expires"},t.PassPolicy={policy_name:"pass_policy",enabled:"enabled",disabled:"disabled"},t.DownloadPolicy={policy_name:"download_policy",allow:"allow",disallow:"disallow"},t.LinkAudience={public:"public",team:"team",members:"members"},t.GroupManagementType={user_managed:new r.UnionScalar("user_managed"),company_managed:new r.UnionScalar("company_managed"),system_managed:new r.UnionScalar("system_managed")};var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({id:null,name:null},"Team"));t.Team=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo"));t.TeamMemberInfo=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({id:null,name:null,sharing_policies:null},"FullTeam"));t.FullTeam=a;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null},"TeamSharingPolicies"));t.TeamSharingPolicies=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount"));t.BasicAccount=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null},"FullAccount"));t.FullAccount=u;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({allow:!1,reason:null},"PermissionSetting"));t.PermissionSetting=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.shared_folder_id||this.path_lower},t.prototype.isSharedFolder=function(){return Boolean(this.shared_folder_id)},t.prototype.isNewSharedFolder=function(){return!this.shared_folder_id},t}(o.Record({access_type:null,is_confidential:!1,is_inside_team_folder:!1,is_team_folder:!1,link_metadata:null,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,preview_url:null,shared_folder_id:null,time_invited:null},"SharedFolderMetadata"));t.SharedFolderMetadata=p;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({acl_update_policy:null,download_policy:null,member_policy:null,pass_policy:null,resolved_member_policy:null,shared_link_policy:null},"FolderPolicy"));t.FolderPolicy=h;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({acl_update_policy:null,download_policy:null,member_policy:null,pass_policy:null,shared_link_policy:null,audience:null,access_level:null,expiry:null,password:null},"CombinedPolicy"));t.CombinedPolicy=_;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({change_options:null,disable_pass:null,edit_contents:null,enable_pass:null,invite_editor:null,invite_viewer:null,invite_viewer_no_comment:null,leave_a_copy:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,update_confidentiality:null,unmount:null,unshare:null},"FolderPermissions"));t.FolderPermissions=m;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({entries:o.Map(),cursor:null},"ListFoldersResult"));t.ListFoldersResult=f;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.id},t.prototype.isSharedFolder=function(){return!1},t.prototype.isNewSharedFolder=function(){return!1},t}(o.Record({access_type:null,id:null,file_policy:null,link_metadata:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null,time_invited:null},"SharedFileMetadata"));t.SharedFileMetadata=g;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({change_options:null,disable_pass:null,edit_contents:null,enable_pass:null,invite_viewer:null,invite_viewer_no_comment:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,unshare:null,view_members:null},"FilePermissions"));t.FilePermissions=v;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({download_policy:null,pass_policy:null},"FilePolicy"));t.FilePolicy=y;var E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({entries:o.Map(),cursor:null},"ListFilesResult"));t.ListFilesResult=E;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getMemberCount=function(){return this.memberCount||this.invitees.count()+this.groups.count()+this.users.count()},t}(o.Record({cursor:null,invitees:o.Map(),groups:o.Map(),users:o.Map(),memberCount:null},"SharingMembership"));t.SharingMembership=b,t.makeMemberKey=function(e,t){return e+":"+t};var S=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.memberId=function(){return this.account_id},o.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},o.prototype.displayName=function(){return this.account?this.account.display_name:void 0},o.prototype.type=function(){return"users"},o}(o.Record({access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,same_team:null,team_member_id:null,time_last_seen:null},"UserMembershipInfo"));t.UserMembershipInfo=S;var w=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.memberId=function(){return this.contact_type+":"+this.contact},o.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},o.prototype.displayName=function(){return this.contact},o.prototype.type=function(){return"invitees"},o}(o.Record({access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null,same_team:null},"InviteeMembershipInfo"));t.InviteeMembershipInfo=w;var T=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.memberId=function(){return this.group_id},o.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},o.prototype.displayName=function(){return this.group_name},o.prototype.type=function(){return"groups"},o}(o.Record({access_type:null,group_external_id:null,group_id:null,group_management_type:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_member:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo"));t.GroupMembershipInfo=T;var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({leave_a_copy:null,make_editor:null,make_owner:null,make_viewer:null,make_viewer_no_comment:null,remove:null},"MemberPermissions"));t.MemberPermissions=C;var I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({total_unique_users:null,users_outside_team:null,exceeds_count:!1},"MemberCounts"));t.MemberCounts=I;var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({access_level:null,warning:null,parentFolders:null},"MemberAccessLevelResult"));t.MemberAccessLevelResult=P;var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({name:null,shared_folder_id:null,permissions:null},"ParentFolderInfo"));t.ParentFolderInfo=A;var N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isFolder=function(){return"folder"===this.file_type},t.prototype.teamInfo=function(){return this.content_owner_team_info?this.content_owner_team_info:this.team_member_info?this.team_member_info.team_info:void 0},t}(o.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,size:null,team_member_info:null,preview_type:null},"LinkMetadata"));t.LinkMetadata=N;var O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({requested_visibility:null,link_password:null,expires:null,allow_download:null},"LinkPolicy"));t.LinkPolicy=O;var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({allow_comments:null,can_revoke:null,allow_download:null,can_allow_download:null,can_disallow_download:null,can_set_expiry:null,can_remove_expiry:null,requested_visibility:null,resolved_visibility:null,restricting_shared_folder_path:null,revoke_failure_reason:null,team_restricts_comments:null,visibility_policies:null},"LinkPermissions"));t.LinkPermissions=R;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({policy:null,resolved_policy:null,allowed:null,disallowed_reason:null},"LinkVisibilityPolicy"));t.LinkVisibilityPolicy=k;var D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({add_message_as_comment_checked:null,add_message_as_comment_help_shown:null,access_reader_no_comment_content_links:null,access_reader_no_comment_shared_folders:null},"SharingPrefs"));t.SharingPrefs=D;var L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({change_audience:null,remove_expiry:null,remove_password:null,set_expiry:null,set_password:null},"SharedContentLinkPermissions"));t.SharedContentLinkPermissions=L;var M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({audience_options:null,current_audience:null,expiry:null,link_permissions:null,password_protected:null,url:null},"SharedContentLinkMetadata"));t.SharedContentLinkMetadata=M;var F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(o.Record({audience:null,remove_expiry:null,set_expiry:null,remove_password:null,set_password:null},"SharedContentLinkSettings"));t.SharedContentLinkSettings=F}),define("modules/clean/sharing/api/util/types",["external/immutable","external/underscore","modules/clean/api_v2/types","modules/clean/contacts/types","modules/clean/sharing/constants","modules/clean/sharing/link_info","modules/clean/sharing/api/types/metadata","modules/clean/sharing/ui_util"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de,pe,he,_e,me,fe,ge,ve,ye,Ee,be,Se,we,Te,Ce,Ie,Pe,Ae,Ne,Oe,Re,ke,De,Le;return ie=n.formatTimestamp,K=n.Union,j=n.UnionScalar,l=r.ACCESS_LEVEL,N=r.MEMBER_ACTION,p=r.FOLDER_METADATA_PERMISSIONS,w=i.LinkInfo,c=s.BasicAccount,u=s.CombinedPolicy,d=s.DownloadPolicy,h=s.FilePermissions,_=s.FilePolicy,m=s.FolderPermissions,f=s.FolderPolicy,g=s.FullAccount,v=s.FullTeam,b=s.GroupMembershipInfo,E=s.GroupManagementType,S=s.InviteeMembershipInfo,T=s.LinkMetadata,C=s.LinkPermissions,I=s.LinkVisibilityPolicy,P=s.ListFilesResult,A=s.ListFoldersResult,O=s.MemberAccessLevelResult,R=s.MemberCounts,k=s.MemberPermissions,D=s.ParentFolderInfo,L=s.PassPolicy,M=s.PermissionSetting,H=s.SharingMembership,q=s.SharingPrefs,F=s.SharedContentLinkMetadata,x=s.SharedContentLinkPermissions,U=s.SharedFileMetadata,B=s.SharedFolderMetadata,V=s.Team,W=s.TeamMemberInfo,G=s.TeamSharingPolicies,z=s.UserMembershipInfo,y=a.GoldenGate,Z=function(e){switch(e){case l.OWNER:return new j("owner");case l.WRITER:return new j("editor");case l.READER:
return new j("viewer");case l.READER_NO_COMMENT:return new j("viewer_no_comment")}},Q=function(e){var t;switch(null!=(t=e.type)?t:e){case"owner":return l.OWNER;case"editor":return l.WRITER;case"viewer":return l.READER;case"viewer_no_comment":return l.READER_NO_COMMENT}},ce=function(e){if(!e)return null;switch(e[".tag"]){case"user_managed":return E.user_managed;case"company_managed":return E.company_managed;case"system_managed":return E.system_managed}},de=function(e){return null!=e.path_lower&&null!=e.access_type&&null!=e.policy},ne=function(e){return new B({access_type:Q(K.parse(e.access_type)),is_inside_team_folder:e.is_inside_team_folder,is_team_folder:e.is_team_folder,link_metadata:null!=e.link_metadata?Pe(e.link_metadata):void 0,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new V(e.owner_team):null,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,permissions:null!=e.permissions?oe(e.permissions):void 0,policy:Ce(e.policy),preview_url:e.preview_url,shared_folder_id:e.shared_folder_id,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0,is_confidential:null!=e.is_confidential?e.is_confidential:void 0})},Y=function(e){var t,n,o,r,i;for(o={},t=0,n=e.length;n>t;t++)r=e[t],o[r.action[".tag"]]=new M({allow:r.allow,reason:null!=(i=r.reason)?i[".tag"]:void 0});return o},oe=function(e){var t;return t=Y(e),new m(t)},Ae=function(e){var t;return t=Y(e),new x(t)},re=function(e){var t,n,o,r,i,s;return null==e?new f:new f({acl_update_policy:null!=(t=e.acl_update_policy)?t[".tag"]:void 0,download_policy:null!=(n=e.download_policy)?n[".tag"]:void 0,member_policy:null!=(o=e.member_policy)?o[".tag"]:void 0,resolved_member_policy:null!=(r=e.resolved_member_policy)?r[".tag"]:void 0,shared_link_policy:null!=(i=e.shared_link_policy)?i[".tag"]:void 0,pass_policy:null!=(s=e.pass_policy)?s[".tag"]:void 0})},fe=function(t){return new A({entries:new e.Map(t.entries.map(ne).map(function(e){return[e.shared_folder_id,e]})),cursor:t.cursor})},ee=function(e){return new U({access_type:null!=e.access_type?Q(K.parse(e.access_type)):l.READER,id:e.id,file_policy:le(e),link_metadata:null!=e.link_metadata?Pe(e.link_metadata):void 0,name:e.name,owner_team:null!=e.owner_team?new V(e.owner_team):null,policy:null!=e.policy?Ce(e.policy):new f,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:te(e.permissions),preview_url:e.preview_url,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0})},te=function(e){var t,n,o,r,i;if(o={},null!=e)for(t=0,n=e.length;n>t;t++)r=e[t],o[r.action[".tag"]]=new M({allow:r.allow,reason:null!=(i=r.reason)?i[".tag"]:void 0});return new h(o)},me=function(t){return new P({entries:new e.Map(t.entries.map(function(e){return[e.id,ee(e)]})),cursor:t.cursor})},Se=function(t,n){var o,r,i,s;return null==n&&(n=null),new H({cursor:t.cursor,invitees:new e.Map(function(){var e,n,o,s;for(o=t.invitees,s=[],e=0,n=o.length;n>e;e++)r=o[e],i=pe(r),s.push([i.memberKey(),i]);return s}()),groups:new e.Map(function(){var e,n,r,s;for(r=t.groups,s=[],e=0,n=r.length;n>e;e++)o=r[e],i=ue(o),s.push([i.memberKey(),i]);return s}()),users:new e.Map(function(){var e,n,o,r;for(o=t.users,r=[],e=0,n=o.length;n>e;e++)s=o[e],i=De(s),r.push([i.memberKey(),i]);return r}()),memberCount:n})},pe=function(e){var t,n;return t=e.invitee[".tag"],new S({access_type:Q(K.parse(e.access_type)),contact:e.invitee[t],contact_type:t,initials:e.initials,is_inherited:e.is_inherited,permissions:be(e.permissions),same_team:Boolean(null!=(n=e.user)?n.same_team:void 0)})},ue=function(e){return new b({access_type:Q(K.parse(e.access_type)),group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_management_type:ce(e.group.group_management_type),group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:e.is_inherited,is_member:e.group.is_member,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:be(e.permissions),same_team:e.group.same_team})},De=function(e){return new z({access_type:Q(K.parse(e.access_type)),account_id:e.user.account_id,initials:e.initials,is_inherited:e.is_inherited,permissions:be(e.permissions),same_team:e.user.same_team,team_member_id:e.user.team_member_id,time_last_seen:e.time_last_seen&&new Date(e.time_last_seen)})},be=function(e){var t,n,o,r,i;if(o={},null!=e)for(t=0,n=e.length;n>t;t++)r=e[t],o[r.action[".tag"]]=new M({allow:r.allow,reason:null!=(i=r.reason)?i[".tag"]:void 0});return new k(o)},Ee=function(e){return new R(e)},ye=function(e,t){var n,o,r,i,s;if(!y.canActOnInheritedMembers(e))return new O;if(null!=t.access_details)for(i=[],s=t.access_details,n=0,o=s.length;o>n;n++)r=s[n],i.push(we(r));return new O({access_level:null!=t.access_level?Q(K.parse(t.access_level)):void 0,warning:t.warning,parentFolders:i})},we=function(e){return new D({name:e.folder_name,shared_folder_id:e.shared_folder_id,permissions:be(e.permissions)})},he=function(e){return new T({url:e.url,client_modified:null!=e.client_modified?new Date(e.client_modified):null,content_owner_team_info:null!=e.content_owner_team_info?new V(e.content_owner_team_info):null,expires:null!=e.expires?new Date(e.expires):null,file_type:e[".tag"],id:e.id,link_permissions:_e(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:null!=e.server_modified?new Date(e.server_modified):null,size:e.size,team_member_info:Re(e.team_member_info),preview_type:e.preview_type})},_e=function(e){var t,n,o,r;return null==e?new C:new C({allow_download:e.allow_download,allow_comments:e.allow_comments,can_allow_download:e.can_allow_download,can_disallow_download:e.can_disallow_download,can_revoke:e.can_revoke,can_set_expiry:e.can_set_expiry,can_remove_expiry:e.can_remove_expiry,requested_visibility:null!=(t=e.requested_visibility)?t[".tag"]:void 0,resolved_visibility:null!=(n=e.resolved_visibility)?n[".tag"]:void 0,restricting_shared_folder_path:e.restricting_shared_folder_path,revoke_failure_reason:null!=(o=e.revoke_failure_reason)?o[".tag"]:void 0,team_restricts_comments:e.team_restricts_comments,visibility_policies:null!=(r=e.visibility_policies)?r.map(Le):void 0})},Le=function(e){var t,n,o;return new I({policy:null!=(t=e.policy)?t[".tag"]:void 0,resolved_policy:null!=(n=e.resolved_policy)?n[".tag"]:void 0,allowed:e.allowed,disallowed_reason:null!=(o=e.disallowed_reason)?o[".tag"]:void 0})},Re=function(e){return null==e?null:new W({display_name:e.display_name,member_id:e.member_id,team_info:null!=e.team_info?new V(e.team_info):null})},X=function(e){return new c({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id})},se=function(e){var t;return t=null!=e.team?new v({id:e.team.id,name:e.team.name,sharing_policies:ke(e.team.sharing_policies)}):null,new g({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:t})},ke=function(e){var t,n,o;return null==e?null:new G({shared_folder_member_policy:null!=(t=e.shared_folder_member_policy)?t[".tag"]:void 0,shared_folder_join_policy:null!=(n=e.shared_folder_join_policy)?n[".tag"]:void 0,shared_link_create_policy:null!=(o=e.shared_link_create_policy)?o[".tag"]:void 0})},Oe=function(e){return new q({add_message_as_comment_checked:e.add_message_as_comment_checked,add_message_as_comment_help_shown:e.add_message_as_comment_help_shown,access_reader_no_comment_content_links:e.access_reader_no_comment_content_links,access_reader_no_comment_shared_folders:e.access_reader_no_comment_shared_folders})},le=function(e){var t,n,o;return t={},t[L.policy_name]=(null!=(n=e.pass_policy)?n[".tag"]:void 0)||L.enabled,t[d.policy_name]=(null!=(o=e.download_policy)?o[".tag"]:void 0)||d.allow,new _(t)},ge=function(e){return"email"===e.type?"email:"+e.value:e.value},ve=function(e){return e.startsWith("email:")?new j("email",e.substr(6)):new j("dropbox_id",e)},Ie=function(e){var n,o,r;return null!=e?(r=K.parse(e.link_permissions.resolved_visibility).type,o=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},n={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:null!=e.expires?new Date(e.expires):null,visibility:r,isPackage:e.is_package},t.extend(n,o),new w(n)):null},Ce=re,Te=function(e){var t,n,o,r;for(o={},t=0,n=e.length;n>t;t++)r=e[t],o[p[r.action[".tag"]]]=r.allow;return o},$=function(e){var t;return function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)if(t=e[n],t.type===o.NEW_STYLE_GROUP)i.push(new j("dropbox_id",t.getContactID()));else{if(t.type===o.INVALID)throw new Error("Unknown contact type");i.push(new j("email",t.getContactID()))}return i}()},Pe=function(t){var n;return new F({audience_options:e.Set(function(){var e,o,r,i;for(r=t.audience_options,i=[],e=0,o=r.length;o>e;e++)n=r[e],i.push(n[".tag"]);return i}()),current_audience:t.current_audience[".tag"],expiry:null!=t.expiry&&new Date(t.expiry)>new Date?new Date(t.expiry):null,link_permissions:Ae(t.link_permissions),password_protected:t.password_protected,url:t.url})},Ne=function(e){if(e.remove_expiry&&null!=e.set_expiry)throw Error("Cannot set both remove_expiry and set_expiry");if(e.remove_password&&null!=e.set_password)throw Error("Cannot set both remove_password and set_password");return{audience:new j(e.audience).toJSON(),expiry:e.remove_expiry?new j("remove_expiry").toJSON():null!=e.set_expiry?new j("set_expiry",ie(e.set_expiry)).toJSON():void 0,password:e.remove_password?new j("remove_password").toJSON():null!=e.set_password?new j("set_password",e.set_password).toJSON():void 0}},ae=function(e,t){var n;return new u({acl_update_policy:e.acl_update_policy,download_policy:e.download_policy||"allow",member_policy:e.resolved_member_policy,pass_policy:e.pass_policy,shared_link_policy:e.shared_link_policy,audience:null!=t?t.current_audience:void 0,access_level:null!=t?t.access_level:void 0,expiry:{status:(null!=t?t.expiry:void 0)?"on":"off",value:null!=(n=null!=t?t.expiry:void 0)?n:""},password:{status:(null!=t?t.password_protected:void 0)?"on":"off"}})},J=function(e){var n,o,r,i;if(n={},!e)return n;if(null!=e.acl_update_policy&&(n.acl_update_policy=e.acl_update_policy),null!=e.download_policy&&(n.download_policy=e.download_policy),null!=e.member_policy&&(n.member_policy=e.member_policy),null!=e.pass_policy&&(n.pass_policy=e.pass_policy),null!=e.shared_link_policy&&(n.shared_link_policy=e.shared_link_policy),r={},null!=e.audience&&(r.audience=new j(e.audience)),null!=e.access_level&&(r.access_level=new j(e.access_level)),null!=e.expiry)if(o=e.expiry,"on"===o.status&&o.value)o.value.setHours(23),o.value.setMinutes(59),o.value.setSeconds(59),r.expiry=new j("set_expiry",ie(o.value)).toJSON();else{if("off"!==o.status)throw new Error("Bad expiry settings");r.expiry=new j("remove_expiry").toJSON()}return null!=e.password&&(i=e.password,"on"===i.status&&i.value?r.password=new j("set_password",i.value).toJSON():"off"===i.status&&(r.password=new j("remove_password").toJSON())),t.keys(r).length>0&&(n.link_settings=r),n},{accessLevelApiToConst:Q,accessLevelConstToApi:Z,accountInfoApiToRecord:X,combinedPolicyDiffToApi:J,contactsToMembers:$,fileMetadataApiToRecord:ee,filePermissionsApiToRecord:te,folderMetadataApiToRecord:ne,folderPermissionsApiToRecord:oe,folderPolicyApiToRecord:re,fullAccountApiToRecord:se,getCombinedPolicy:ae,groupMembershipApiToRecord:ue,hasFolderMetadataRecordInMetadata:de,inviteeMembershipApiToRecord:pe,linkMetadataApiToRecord:he,linkPermissionsApiToRecord:_e,listFilesResultApiToRecord:me,listFoldersResultApiToRecord:fe,makeMemberId:ge,makeMemberSelector:ve,memberAccessLevelApiToRecord:ye,memberCountsApiToRecord:Ee,memberPermissionsApiToRecord:be,membershipApiToRecord:Se,parseFolderPermissions:Te,parseFolderPolicy:Ce,parseSharedLinkMetadata:Ie,sharedContentLinkMetadataToRecord:Pe,sharedContentLinkPermissionsApiToRecord:Ae,sharedContentLinkSettingsToApi:Ne,sharingPrefsApiToRecord:Oe,teamMemberInfoApiToRecord:Re,teamSharingPoliciesApiToRecord:ke,userMembershipApiToRecord:De,visibilityPolicyApiToRecord:Le}}),define("modules/clean/sharing/components/button_group",["require","exports","tslib","external/react","external/classnames","modules/clean/react/css"],function(e,t,n,o,r,i){"use strict";var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this;return o.createElement("div",{className:"c-btn-group sharing-button-group"},this.props.options.map(function(t){var n=t.value,i=t.label,s=n===e.props.value;return o.createElement("button",{key:n,className:r({"c-btn":!0,"c-btn--secondary":!s,"c-btn--primary":s}),onClick:function(){return e.props.onSelectValue(n)},disabled:s},i)}))},t}(o.Component);t.ButtonGroup=i(s,["/static/css/sharing/components-vflrV8W4h.css"])}),define("modules/clean/sharing/confirmation_modals/confirm_with_option_modal",["require","exports","tslib","external/react","modules/clean/react/modal"],function(e,t,n,o,r){"use strict";var i=function(e){function t(t){var n=e.call(this,t)||this;if(null==n.props.children)throw new Error("Must have children prop");return n.state={checked:!1},n.handleOptionClick=n.handleOptionClick.bind(n),n.handleAccept=n.handleAccept.bind(n),n.handleDismissCompleted=n.handleDismissCompleted.bind(n),n}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(r.Modal,{acceptButtonText:this.props.confirmText,autoClose:this.props.autoClose,className:"simple-modal confirm-with-option-modal",dismissButtonText:this.props.cancelText,onAccept:this.handleAccept,onDismissCompleted:this.handleDismissCompleted,title:this.props.title},o.createElement("div",{className:"simple-modal-content"},o.createElement("div",{className:"confirm-with-option-modal__body-text"},this.props.children),this.renderOption()))},t.prototype.renderOption=function(){return this.props.showOption?o.createElement("div",{className:"u-mar-vertical-s confirm-with-option-modal__option"},o.createElement("input",{"aria-checked":this.state.checked,checked:this.state.checked,className:"confirm-with-option-modal__option-input",id:"confirm-with-option-modal__input",name:"confirmation_option",onClick:this.handleOptionClick,role:"checkbox",type:"checkbox"}),o.createElement("label",{className:"confirm-with-option-modal__option-label",htmlFor:"confirm-with-option-modal__input"},this.props.optionLabel)):null},t.prototype.handleOptionClick=function(){this.setState({checked:!this.state.checked})},t.prototype.handleAccept=function(){this.props.onConfirm&&this.props.onConfirm(this.state.checked)},t.prototype.handleDismissCompleted=function(){this.props.onCancel&&this.props.onCancel(this.state.checked)},t}(o.Component);t.ConfirmWithOptionModal=i}),define("modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal",["external/purify","external/react","modules/clean/em_string","modules/clean/react/modal","modules/clean/react_format","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_,m;return u=o.Modal,_=r.reactFormat,l=i.ConfirmWithOptionModal,c=s.MEMBER_ACTION,p=t.createElement,h=t.DOM,d=a.i18n_default_project("sharing")._,m=function(e,t,o,r,i,s,a){var m,f,g,v,y;return v=n.em_snippet(e,40),g=null,t===c.REMOVE?(y=d("Remove access for %(name)s?").format({name:v}),o?(m=r?_(d("<strong>%(name)s</strong> may still have access to this folder through a company group or parent folder."),{strong:h.strong(),name:v}):_(d("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to these files."),{strong:h.strong(),name:v}),i&&(g=d("%(name)s should be able to keep a copy of these files").format({name:v}))):m=_(d("If you continue, <strong>%(name)s</strong> will lose access to this file."),{strong:h.strong(),name:v}),f=d("Remove")):(y=d("Make %(name)s the owner of this folder?").format({name:v}),m=_(d("Only <strong>%(name)s</strong> will be able to unshare this folder or change folder settings."),{strong:h.strong(),name:v}),f=d("Make owner")),u.showInstance(p(l,{autoClose:!1,confirmText:f,cancelText:d("Cancel"),onConfirm:s,onCancel:a,optionLabel:g,showOption:null!=g,title:y},m))},{showMemberAccessChangeConfirmationModal:m}}),define("modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal",["external/purify","external/react","modules/clean/react/modal","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/core/i18n"],function(e,t,n,o,r){var i,s,a,l,c;return s=n.Modal,i=o.ConfirmWithOptionModal,l=t.createElement,a=r.i18n_default_project("sharing")._,c=function(e,t,n,o,r){var c,u,d;return u=null,e?(d=a("Remove your access to this folder?"),c=a(t?"You may still have access to this folder through a company group or parent folder.":"If you continue, you won’t be able to access this folder anymore."),r&&(u=a("Keep a copy of this folder"))):(d=a("Remove your access to this file?"),c=a("If you continue, you won’t be able to access this file anymore.")),s.showInstance(l(i,{cancelText:a("Cancel"),confirmText:a("Remove my access"),onCancel:o,onConfirm:n,optionLabel:u,showOption:null!=u,title:d},c))},{showRelinquishMembershipConfirmationModal:c}}),define("modules/clean/sharing/confirmation_modals/reset_access_modal",["require","exports","external/react","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/confirmation_modals/confirm_with_option_modal","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,o,r,i,s,a){"use strict";function l(e){var t;t=c(e.linkAccessLanguage?e.isFolder?"Everyone else will lose access to this folder and its link         except those who have access from a parent folder.         You’ll still keep a copy of this folder in your Dropbox.":"Everyone else will lose access to this file and its link         except those who have access from a parent folder.         You’ll still keep a copy of this file in your Dropbox.":e.isFolder?"Everyone else will lose access to this folder. You’ll         still keep a copy of this folder in your Dropbox.":"Everyone else will lose access to this file. You’ll         still keep a copy of this folder in your Dropbox.");var a=c("Unshare “%(content_name)s”?").format({content_name:o.em_snippet(e.contentName,s.SNIPPET_SIZES.FILENAME)});r.Modal.showInstance(n.createElement(i.ConfirmWithOptionModal,{cancelText:c("Cancel"),confirmText:c("Unshare"),onCancel:e.onCancel,onConfirm:e.onConfirm,optionLabel:c("Let my collaborators keep a copy of these files."),showOption:e.allowLeaveACopy&&e.isFolder,title:a},t))}var c=a.i18n_default_project("sharing")._;t.confirmResetAccess=l}),define("modules/clean/sharing/constants",["external/underscore","modules/constants/sharing"],function(e,t){var n,o,r;return n={ACCESS_NO_ACCESS:0,ACCESS_READER_NO_COMMENT:-10,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},o={PUBLIC:1,TEAM_ONLY:2,PASSWORD:3,ONLY_YOU:99},r={ACCESS_LEVEL:{OWNER:"owner",WRITER:"writer",READER:"reader",READER_NO_COMMENT:"reader_no_comment"},MEMBER_ACTION:{LEAVE_A_COPY:"leave_a_copy",MAKE_EDITOR:"make_editor",MAKE_OWNER:"make_owner",MAKE_VIEWER:"make_viewer",MAKE_VIEWER_NO_COMMENT:"make_viewer_no_comment",REMOVE:"remove",ALL:["leave_a_copy","make_editor","make_owner","make_viewer","make_viewer_no_comment","remove"]},SNIPPET_SIZES:{FILENAME:22,DISPLAY_NAME:26,EMAIL:30,OUT_OF_QUOTA_FOLDER_NAME:15},NameSpaceAccess:n,SHMODEL_LINK_TOKEN_VISIBILITY:o,VALIDATE_PATH_PERMISSIONS:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership"},VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unshare:"canUnshareFolder",update_confidentiality:"canUpdateConfidentiality",relinquish_membership:"canRelinquishMembership"},FOLDER_METADATA_PERMISSIONS:{change_options:"canChangeOptions",edit_contents:"canEditContents",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unmount:"canUnmountFolder",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership",leave_a_copy:"leaveACopy"},ALPHA_FOLDER_METADATA_PERMISSIONS:{change_options:"canChangeOptions",edit_contents:"canEditContents",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unmount:"canUnmountFolder",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership",leave_a_copy:"leaveACopy",enable_pass:"enable_viewer_info",disable_pass:"disable_viewer_info",remove_download_policy:"removeDownloadPolicy",set_download_policy:"setDownloadPolicy"},FOLDER_METADATA_PERMISSIONS_INTERNAL:{change_options:"canChangeOptions",edit_contents:"canEditContents",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unmount:"canUnmountFolder",unshare:"canUnshareFolder",update_confidentiality:"canUpdateConfidentiality",relinquish_membership:"canRelinquishMembership",leave_a_copy:"leaveACopy",enable_viewer_info:"enablePass",disable_viewer_info:"disablePass"},ALPHA_FILE_METADATA_PERMISSIONS:{change_options:"canChangeOptions",disable_pass:"disablePass",enable_pass:"enablePass",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",relinquish_membership:"canRelinquishMembership",remove_download_policy:"removeDownloadPolicy",set_download_policy:"setDownloadPolicy",unshare:"unshare"},FILE_METADATA_PERMISSIONS:{invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",relinquish_membership:"canRelinquishMembership",unshare:"unshare"},SHARE_ACTION_ORIGIN_TYPE:{BROWSE_FILE_ACTIONS:"BROWSE_FILE_ACTIONS",BROWSE_FILE_ROW:"BROWSE_FILE_ROW",BROWSE_GLOBAL_ACTIONS:"BROWSE_GLOBAL_ACTIONS",BROWSE_SHARED_FOLDER_BANNER:"BROWSE_SHARED_FOLDER_BANNER",CONTENT_MANAGER:"CONTENT_MANAGER",DESKTOP_CLIENT:"DESKTOP_CLIENT",EVENTS_PAGE:"EVENTS_PAGE",FILE_ROW_SHARE_MENU:"FILE_ROW_SHARE_MENU",GRANT_ACCESS:"GRANT_ACCESS",LEGACY_BROWSE:"LEGACY_BROWSE",LINKS_PAGE:"LINKS_PAGE",NOTIFICATION_WEB:"NOTIFICATION_WEB",OFFICE_INTEGRATION:"OFFICE_INTEGRATION",OUT_OF_QUOTA_MODAL:"OUT_OF_QUOTA_MODAL",PARENT_FOLDER_MODAL:"PARENT_FOLDER_MODAL",PREVIEW_PAGE:"PREVIEW_PAGE",PREVIEW_PAGE_FACEPILE:"PREVIEW_PAGE_FACEPILE",RECENTS:"RECENTS",SHARE:"SHARE",SHARE_LINK_MODAL:"SHARE_LINK_MODAL",SYNC_MODAL:"SYNC_MODAL",WIZARD:"WIZARD"},TOKEN_LINK_TYPE:{SHARED_LINK:"s",SHARED_CONTENT_LINK:"c"}},r.ACCESS_VALUES=e.values(r.ACCESS_LEVEL),e.extend(r,t),r});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/content_info",["external/immutable","modules/constants/python"],function(e,t){var n,o,r;return n=e.Record({extras:null,id:null,metadata:null},"ContentInfo"),o=e.Record({beaconContext:null,exists:!0,fileId:null,filename:null,fqPath:null,isFolder:null,isTeamSharedFolder:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,sjid:null,targetNsId:null,url:null,userHomeNs:null,teamGroupInfo:null},"ContentInfoExtras"),n.prototype.setNsId=function(e){var t;return t=this.setIn(["extras","targetNsId"],e),t.set("id",r(t.extras))},n.prototype.setFQPath=function(e){var t;return t=this.setIn(["extras","fqPath"],e),t.set("id",r(t.extras))},n.prototype.isFolder=function(){return this.extras.isFolder},n.prototype.isFile=function(){return!this.isFolder()},n.prototype.isFileFolder=function(){return this.isFolder()&&!this.isSharedFolder()},n.prototype.isSharedFolder=function(){return Boolean(this.extras.targetNsId)},n.prototype.isTeamSharedFolder=function(){return this.extras.isTeamSharedFolder},n.prototype.isInSharedFolder=function(){return Boolean(null!=this.extras.nsId&&this.extras.nsId!==this.extras.userHomeNs)},n.prototype.isNestedSharedFolder=function(){return this.isInSharedFolder()&&this.isSharedFolder()},n.prototype.isOSXPackage=function(){var e,n;return n=this.extras.fqPath,e=n.substr(n.lastIndexOf(".")),indexOf.call(t.PACKAGE_EXTS,e)>=0},n.prototype.isMounted=function(){return null==this.extras.url},n.prototype.url=function(){return this.extras.url},n.prototype.pathExists=function(){return Boolean(this.extras.exists)},n.prototype.name=function(){var e;return null!=this.displayPath()?null!=(e=this.displayPath())?e.split("/").pop():void 0:this.filename()},n.prototype.idForLink=function(){var e;if(e=this.extras.fileId||this.extras.fqPath,!e)throw new Error("No identifiers for getting links");return e},n.prototype.sharedFolderId=function(){var e;if(e=this.extras.targetNsId,!e)throw new Error("No shared folder ID");return e},n.prototype.displayPath=function(){return this.extras.fqPath},n.prototype.filename=function(){return this.extras.filename},n.prototype.nsId=function(){if(null==this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId},n.prototype.nsPath=function(){if(null==this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath},n.prototype.sjid=function(){return this.extras.sjid},n.prototype.teamGroupInfo=function(){var e;return null!=(e=this.extras)?e.teamGroupInfo:void 0},n.prototype.beaconContext=function(){var e;return null!=(e=this.extras)?e.beaconContext:void 0},n.createFromParams=function(e){var t;return t=new o(e),new n({extras:t,id:r(t)})},r=function(e){var t;if(t=e.isFolder?e.targetNsId||e.fqPath:e.fileId||e.fqPath,!t)throw new Error("Not enough fields provided for extras");return t},{ContentInfo:n,ContentInfoExtras:o}}),define("modules/clean/sharing/copy_public_link_modal",["require","exports","tslib","jquery","external/react","modules/clean/clipboard_v2","modules/clean/react/modal","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=a.i18n_default_project("sharing")._,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.clipboard=new i(this.props.publicLink,function(){l.success(c("Link copied to clipboard!")),s.Modal.close()},function(){return l.error(c("Unable to copy the link, please copy manually"))},null)},t.prototype.componentDidMount=function(){this.clipboard.setupCopy(o(".button-primary.dbmodal-button"),o(".db-modal-buttons")),this._selectLink()},t.prototype._selectLink=function(){o(".public-link").select()},t.prototype.render=function(){var e=this;return r.createElement(s.Modal,{title:c("Copy Public Link…"),acceptButtonText:i.is_supported()?c("Copy to clipboard"):null,dismissButtonText:c("Cancel"),onAccept:function(){e._selectLink(),e.clipboard.do_copy()}},r.createElement("div",{style:{position:"relative"}},c("To share this file with others, copy and paste this link:"),r.createElement("br",null),r.createElement("p",null,r.createElement("input",{type:"text",className:"textinput public-link",value:this.props.publicLink,style:{width:"98%","margin-top":"2px"}}))))},t}(r.Component);t.CopyPublicLinkModal=u}),define("modules/clean/sharing/delete_link_modal",["modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i){var s,a,l,c,u;return s=n.Modal,a=n.SimpleModal,l=r.i18n_default_project("sharing")._,c=function(e){var n,r,c,u,d,p,h,_;return n=e.client,_=e.url,r=e.contentName,d=null!=(p=e.onDeleteLink)?p:null,u=null!=(h=e.onCancel)?h:null,r=t.em_snippet(r,o.SNIPPET_SIZES.FILENAME),c=function(){return n.revokeSharedLink({url:_}).then(function(){var e;return e=l("Deleted link to “%(name)s”").format({name:r}),i.success(e),s.close(),"function"==typeof d?d():void 0})},a.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:u,cancel_text:l("Cancel"),confirm_callback:c,confirm_text:l("Delete link"),title_text:l("Delete link to “%(name)s”?").format({name:r})})},u=function(n){var r,c,u,d,p,h,_,m;return r=n.client,m=n.tkey,c=n.contentName,p=null!=(h=n.onDeleteLink)?h:null,d=null!=(_=n.onCancel)?_:null,c=t.em_snippet(c,o.SNIPPET_SIZES.FILENAME),u=function(){return e.WebRequest({url:"/sm/disable/"+m,type:"POST",data:{tkey:m},subject_user:r.userId,success:function(){var e;return e=l("Deleted link to “%(name)s”").format({name:c}),i.success(e),s.close(),"function"==typeof p?p():void 0}})},a.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:d,cancel_text:l("Cancel"),confirm_callback:u,confirm_text:l("Delete link"),title_text:l("Delete link to “%(name)s”?").format({name:c})})},{deleteLinkWithConfirm:c,deleteLinkWithConfirmLegacy:u}}),define("modules/clean/sharing/file_settings_modal",["external/purify","external/react","external/es6-promise","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/previews/util","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/user","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E){var b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee;return U=n.Promise,Y=o.catchApiError,x=s.PermissionHelper,V=a.SharedWithActionTypes,L=l.Modal,$=c.setStatePromise,R=u.FileShareApiClient,w=d.CombinedPolicy,T=d.DownloadPolicy,P=d.FilePermissions,A=d.FilePolicy,D=d.LinkMetadata,F=d.PassPolicy,q=d.SharedContentLinkMetadata,Z=p.confirmResetAccess,b=h.ALPHA_FILE_METADATA_PERMISSIONS,B=h.SNIPPET_SIZES,K=h.TRUELINK,H=_.SettingsModalButtons,G=_.SinglePolicyControl,S=m.AUDIENCE_POLICY,C=m.EXPIRY_POLICY,M=m.PASSWORD_POLICY,I=m.FILE_SETTINGS,k=m.LINK_SETTINGS,W=f.SharingSettingsModal,z=g.canChangePolicy,J=g.isCommonSharingSettingsPolicy,Q=t.createElement,X=t.DOM,j=y.i18n_default_project("sharing")._,N=t.createClass({displayName:"FileSettingsModal",propTypes:{fileName:t.PropTypes.string.isRequired,canChangeOptions:t.PropTypes.bool,canUnshareFile:t.PropTypes.bool.isRequired,contentId:t.PropTypes.string.isRequired,hasDisplayableMembers:t.PropTypes.bool,hasNonOwnerMembers:t.PropTypes.bool,initialPolicy:t.PropTypes.oneOfType([t.PropTypes.instanceOf(w),t.PropTypes.instanceOf(A)]),isLinkSettings:t.PropTypes.bool,linkMetadata:t.PropTypes.oneOfType([t.PropTypes.instanceOf(D),t.PropTypes.instanceOf(q)]),onCancel:t.PropTypes.func,onPolicySet:t.PropTypes.func,ownerTeam:t.PropTypes.shape({id:t.PropTypes.string.isRequired,name:t.PropTypes.string.isRequired}),permissions:t.PropTypes.instanceOf(P),updateLinkSettings:t.PropTypes.func,user:t.PropTypes.instanceOf(v).isRequired},getInitialState:function(){return{isSubmitting:!1,desiredPolicy:this.props.initialPolicy}},render:function(){return K.TRUELINK_UI[this.props.user.id]?this._openSharingSettingsModal():Q(O,{canChangeOptions:this.props.canChangeOptions,canUnshareFile:this.props.canUnshareFile,contentId:this.props.contentId,desiredPolicy:this.state.desiredPolicy,fileName:this.props.fileName,
handleUnshareFile:this._handleUnshareFile,isSubmitting:this.state.isSubmitting,onAccept:this._handleAcceptClick,onDismiss:this._handleDismissClick,onDismissCompleted:this._handleDismissCompleted,onPolicyUpdate:this._handlePolicyUpdate,user:this.props.user})},_getClient:function(){return new R({userId:this.props.user.id})},_openSharingSettingsModal:function(){var e;return e=function(e){return function(t,n){var o;return o=e.props.canChangeOptions,J(t)&&(o=z(t,e.props.initialPolicy,e.state.desiredPolicy,e.props.linkMetadata,e.props.permissions)),[e.state.desiredPolicy.get(t),o]}}(this),Q(W,{currentPolicy:this.props.initialPolicy,fileName:this.props.fileName,folderName:this.props.fileName,getEffectivePolicyValue:e,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,initialTab:this.props.isLinkSettings?k:I,isFolder:!1,isLoading:!1,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onDismiss:this._handleDismissClick,onOptionChange:this._handlePolicyUpdate,onSaveSettings:this._handleAcceptClick,onUnshare:this._handleUnshareFile,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,policyUpdate:this._getPolicyUpdate(),user:this.props.user})},_handleAcceptClick:function(){var e,t;return t=this._getPolicyUpdate(),null!=t?$(this,{isSubmitting:!0}).then(function(e){return function(){return e._getClient().updatePolicy({contentId:e.props.contentId,newPolicy:t,actions:Object.keys(b)})}}(this)).catch(Y(function(e){return function(){return e.setState({isSubmitting:!1}),U.reject()}}(this))).then(function(e){return function(t){var n;return E.success(j("File settings updated")),"function"==typeof(n=e.props).onPolicySet?n.onPolicySet(t):void 0}}(this)):"function"==typeof(e=this.props).onPolicySet?e.onPolicySet(null):void 0},_handleDismissClick:function(){var e;return L.close(),"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleDismissCompleted:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handlePolicyUpdate:function(e,t){return this.setState({desiredPolicy:this.state.desiredPolicy.set(e,t)})},_getPolicyUpdate:function(){return this.state.desiredPolicy.equals(this.props.initialPolicy)?null:this.state.desiredPolicy},_handleUnshareFile:function(){var e;return e=function(e){return function(){return e._getClient().unshare({contentId:e.props.contentId}).then(function(){return e._refreshSharedMemberData(),E.success(j("Unshared %(file_name)s").format({file_name:e.props.fileName})),L.close()})}}(this),Z({allowLeaveACopy:!1,contentName:this.props.fileName,isFolder:!1,linkAccessLanguage:K.TRUELINK_UI[this.props.user.id],onConfirm:e})},_refreshSharedMemberData:function(){return i.dispatch({type:V.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[this.props.contentId]}})}}),O=t.createClass({displayName:"FileSettingsModalContents",propTypes:{desiredPolicy:t.PropTypes.instanceOf(A).isRequired,canChangeOptions:t.PropTypes.bool.isRequired,contentId:t.PropTypes.string.isRequired,fileName:t.PropTypes.string.isRequired,handleUnshareFile:t.PropTypes.func,isSubmitting:t.PropTypes.bool.isRequired,onAccept:t.PropTypes.func,onDismiss:t.PropTypes.func,onDismissCompleted:t.PropTypes.func,canUnshareFile:t.PropTypes.bool.isRequired,onPolicyUpdate:t.PropTypes.func,user:t.PropTypes.instanceOf(v).isRequired},getDefaultProps:function(){return{desiredPolicy:null,onPolicyUpdate:null}},render:function(){return Q(L,{autoClose:!1,className:"file-settings-modal",buttonComponent:X.span(),onDismissCompleted:this.props.onDismissCompleted,title:j("“%(file_name)s” settings").format({file_name:r.em_snippet(this.props.fileName,B.FILENAME)})},X.div({className:"file-settings-form"},this._renderHeader(),this._renderPolicies(),this._renderButtons(),this.props.canChangeOptions?Q(H,{disableSave:!1,isAccepting:this.props.isSubmitting,onAccept:this.props.onAccept,onDismiss:this.props.onDismiss}):void 0))},_renderHeader:function(){return this.props.canChangeOptions?void 0:X.div({className:"u-pad-xs u-font-center u-mar-bottom-s file-settings-form__no-permission-banner"},j("You don’t have permission to change the settings on this file."))},_renderPolicies:function(){return X.div({},x.is_pass_enabled(this.props.user)?this._renderPassPolicy():void 0)},_renderPassPolicy:function(){return Q(G,{canChange:this.props.canChangeOptions,policyName:F.policy_name,policyDescription:j("Show who accessed this file?"),currentValue:this.props.desiredPolicy[F.policy_name],options:[{label:j("Only show to people on your Dropbox team"),value:F.enabled},{label:j("Don’t show"),value:F.disabled}],handleOptionChange:this.props.onPolicyUpdate})},_renderButtons:function(){return X.div({className:"u-mar-top-m clearfix"},this.props.canUnshareFile?X.div({className:"u-l-fl"},X.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.handleUnshareFile},j("Unshare file"))):void 0)}}),ee=function(e){return x.is_pass_enabled(e)||K.TRUELINK_UI[e.id]},{FileSettingsModal:N,FileSettingsModalContents:O,showFileSettingsModal:ee}}),define("modules/clean/sharing/folder_settings_modal",["external/classnames","external/immutable","external/purify","external/react","external/es6-promise","external/underscore","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/react/content_manager/api","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/actions/share_modal","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/sharing/settings_modal_components","modules/clean/sharing/share_page/action_types","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/sharing_settings_modal","modules/clean/sharing/sharing_settings_util","modules/clean/user","modules/constants/python","modules/core/i18n","modules/core/uri","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O){var R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de,pe,he,_e,me,fe,ge,ve,ye,Ee;return z=r.Promise,he=s.catchApiError,k=c.BrowseActionTypes,oe=c.SharedWithActionTypes,D=u.BrowseStore,Ee=d.shareFolder,K=h.Modal,ie=h.SimpleModal,ye=_.setStatePromise,Q=f.SNIPPET_SIZES,le=f.TRUELINK,V=g.GoldenGate,ge=g.genContentManagerBridgeUri,Z=v.SettingsModalButtons,se=v.SinglePolicyControl,J=y.SharePageActionTypes,q=E.FolderShareApiClient,X=E.ShareApiClient,ce=E.TeamSharingPolicies,L=b.CombinedPolicy,H=b.FolderPolicy,B=b.FolderPermissions,G=b.LinkMetadata,$=b.SharedContentLinkMetadata,ee=b.SharedFolderMetadata,me=S.confirmResetAccess,R=w.AUDIENCE_POLICY,M=w.EXPIRY_POLICY,j=w.PASSWORD_POLICY,U=w.FOLDER_SETTINGS,W=w.LINK_SETTINGS,re=T.SharingSettingsModal,pe=C.canChangePolicy,ve=C.isCommonSharingSettingsPolicy,ae=P.TRADEMARK_BUSINESS,_e=o.createElement,fe=o.DOM,ue=A.i18n_default_project("sharing")._,F={shared_folder_member_policy:"team"},x={shared_folder_member_policy:"team"},Y={member_policy:"shared_folder_member_policy"},te=o.createClass({displayName:"SharedFolderSettingsModal",propTypes:{actionHandler:o.PropTypes.instanceOf(m),altAction:o.PropTypes.node,folderName:o.PropTypes.string.isRequired,folderId:o.PropTypes.string,folderPath:o.PropTypes.string,hasDisplayableMembers:o.PropTypes.bool,hasNonOwnerMembers:o.PropTypes.bool,nsId:o.PropTypes.string,nsPath:o.PropTypes.string,initialHasParentSharedFolder:o.PropTypes.bool,initialIsTeamSharedFolder:o.PropTypes.bool,initialMetadata:o.PropTypes.instanceOf(ee),initialOwnerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),initialPermissions:o.PropTypes.instanceOf(B),initialPolicy:o.PropTypes.oneOfType([o.PropTypes.instanceOf(L),o.PropTypes.instanceOf(H)]),isFolderInsideTeamFolderTree:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isLinkSettings:o.PropTypes.bool,isSharedFolder:o.PropTypes.bool,isUserOnOwnerTeam:o.PropTypes.bool,linkMetadata:o.PropTypes.oneOfType([o.PropTypes.instanceOf(G),o.PropTypes.instanceOf($)]),onCancel:o.PropTypes.func,onPolicySet:o.PropTypes.func,onUnshare:o.PropTypes.func,showContentManagerBridge:o.PropTypes.bool,isInContentManager:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(ce),updateLinkSettings:o.PropTypes.func,user:o.PropTypes.instanceOf(I).isRequired},getInitialState:function(){return{currentPolicy:this.props.initialPolicy,hasParentSharedFolder:this.props.initialHasParentSharedFolder,isLoading:!(null!=this.props.initialPolicy&&null!=this.props.initialPermissions),isPolicyChangeRecursive:this._hasRecursivePolicyChanges(this.props.initialIsTeamSharedFolder,this.props.initialHasParentSharedFolder),isSubmitting:!1,isTeamSharedFolder:this.props.initialIsTeamSharedFolder,metadata:this.props.initialMetadata,teamPolicy:this.props.teamPolicy,newPolicy:this.props.initialPolicy,ownerTeam:this.props.initialOwnerTeam,permissions:this.props.initialPermissions}},componentDidMount:function(){return this.state.isLoading?this._fetchInitialState():void 0},render:function(){var e;return e={altAction:this.props.altAction,currentPolicy:this.state.currentPolicy,folderId:this.props.folderId,folderName:this.props.folderName,folderPath:this.props.folderPath,getEffectivePolicyValue:this._getEffectivePolicyValue,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.state.hasParentSharedFolder,isFolder:!0,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isLimitedTeam:this.props.isLimitedTeam,isLoading:this.state.isLoading,isSharedFolder:this.props.isSharedFolder,isSubmitting:this.state.isSubmitting,isTeamSharedFolder:this.state.isTeamSharedFolder,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onDismiss:this._handleDismiss,onOptionChange:this._handleOptionChange,onSaveSettings:this._handleSaveSettings,onUnshare:this._handleUnshareFolder,ownerTeam:this.state.ownerTeam,permissions:this.state.permissions,showContentManagerBridge:this.props.showContentManagerBridge,shouldHideHeader:this.state.shouldHideHeader,teamPolicy:this.state.teamPolicy,policyUpdate:this._getPolicyUpdate(),user:this.props.user},le.TRUELINK_UI[this.props.user.id]?(e=i.extend({initialTab:this.props.isLinkSettings?W:U},e),_e(re,e)):_e(ne,e)},_getClient:function(){return new q({userId:this.props.user.id})},_fetchFolderMetadata:function(){var e;return e=[{".tag":"change_options"},{".tag":"unshare"}],null!=this.props.folderId?this._getClient().getMetadata({contentId:this.props.folderId,actions:e}):this._getClient().validateFqPath({fqPath:this.props.folderPath,actions:e}).then(function(e){var t;return t=e.metadata})},_fetchInitialState:function(){return this._fetchFolderMetadata().then(function(e){return function(t){var n,o,r,i;return e.isMounted()?(n=t.policy,o={hasParentSharedFolder:null!=t.parent_shared_folder_id,isTeamSharedFolder:t.is_team_folder,shouldHideHeader:"folder_is_limited_team_folder"===(null!=(r=t.permissions)&&null!=(i=r.change_options)?i.reason:void 0),isLoading:!1,permissions:t.permissions,newPolicy:n,ownerTeam:t.owner_team,metadata:t},null!=e.props.folderId&&(o.currentPolicy=n),o.isPolicyChangeRecursive=e._hasRecursivePolicyChanges(o.isTeamSharedFolder,o.hasParentSharedFolder),ye(e,o)):void 0}}(this)).catch(he(function(){return K.close()}))},_hasRecursivePolicyChanges:function(e,t){return V.canDeepNest(this.props.user.id)&&(e||t)},_handlePolicyUpdate:function(e,t){return this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_handleSaveSettings:function(){var e,t,o;return t=this._getPolicyUpdate(),null!=t?(e=function(e){return function(){var n;return n=e.props.onPolicySet,(e.isMounted()?ye(e,{isSubmitting:!0}):z.resolve()).then(function(){var n,o,r;return n=function(e){return O.success(ue("Folder settings updated")),z.resolve({policyUpdate:t,sharedFolderMetadata:e})},null!=e.props.folderId?(o=le.TRUELINK_UI[e.props.user.id]?e._getClient().updatePolicyAlpha:e._getClient().updatePolicy,o({contentId:e.props.folderId,newPolicy:t,url:null!=(r=e.props.linkMetadata)?r.url:void 0}).then(n)):(t=le.TRUELINK_UI?new L(t):new H(t),e.props.actionHandler.shareIfFileFolder(t).then(n))}).then(function(e){var t,o;return t=e.policyUpdate,o=e.sharedFolderMetadata,"function"==typeof n?n(t,o):void 0}).catch(he(function(){return e.isMounted()?e.setState({isSubmitting:!1}):void 0}))}}(this),this.state.isPolicyChangeRecursive?(o=this.props,ie.show({title_text:ue("Save settings?"),body_html:this.state.isTeamSharedFolder?n.sanitize(ue("Your changes will be applied to this team folder and any folders inside it.")):n.sanitize(ue("Your changes will be applied to this folder and any folders inside it.")),confirm_text:ue("Save settings"),cancel_text:ue("Cancel"),autoclose:!1,confirm_callback:e,cancel_completed_callback:function(){return K.showInstance(_e(te,o))}})):e()):void 0},_handleDismiss:function(){var e;return K.close(),"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleDismissCompleted:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleUnshareFolder:function(){var e,t,n,o,r,i;return null!=this.props.folderId&&(null!=(n=this.state.permissions)&&null!=(o=n.unshare)?o.allow:void 0)?(e=function(e){return function(t){var n;return n=e._getClient().unshare({contentId:e.props.folderId,leaveACopy:t}),n.then(function(){return O.success(ue("Unshared “%(folder_name)s”").format({folder_name:e.props.folderName})),K.close(),l.dispatch({type:J.UNSHARE_FOLDER_SUCCESS,metadata:e.state.metadata,user:e.props.user})})}}(this),t=function(e){return function(){return K.showInstance(_e(te,e))}}(this.props),me({allowLeaveACopy:null!=(r=this.state.permissions)&&null!=(i=r.leave_a_copy)?i.allow:void 0,contentName:this.state.metadata.name,isFolder:!0,linkAccessLanguage:le.TRUELINK_UI[this.props.user.id],onCancel:t,onConfirm:e})):void 0},_getPolicyUpdate:function(){var e;return null==this.state.newPolicy&&null==this.state.currentPolicy?null:(e={},this.state.newPolicy.forEach(function(t){return function(n,o){var r,s,a,l;return l=t._getEffectivePolicyValue(o),s=l[0],r=l[1],r&&(a="object"==typeof n?i.isEqual(n,s):n===s,!a)?e[o]=n:void 0}}(this)),e)},_handleOptionChange:function(e,t){var n;return(null!=(n=this._getPolicyUpdate())?n[e]:void 0)!==t&&"function"==typeof this._handlePolicyUpdate?this._handlePolicyUpdate(e,t):void 0},_getEffectivePolicyValue:function(e,t){var n,o,r,i,s,a;return null==t&&(t=void 0),s=Y[e],null!=s&&null!=this.props.teamPolicy&&(a=this.props.teamPolicy.get(s)),o=null!=(r=null!=t?t[e]:void 0)?r:this.state.currentPolicy.get(e),n=null!=(i=this.state.permissions.change_options)?i.allow:void 0,null!=a&&F[s]===a&&(n=!1,o=x[s]),this.props.showContentManagerBridge&&(n=!1),ve(e)&&(n=pe(e,this.state.currentPolicy,this.state.newPolicy,this.props.linkMetadata,this.state.permissions,this.props.showContentManagerBridge)),[o,n]}}),de=o.createClass({displayName:"SharedFolderSettingsModalContents",propTypes:{altAction:o.PropTypes.node,currentPolicy:o.PropTypes.instanceOf(H),folderId:o.PropTypes.string,folderName:o.PropTypes.string.isRequired,folderPath:o.PropTypes.string,permissions:o.PropTypes.instanceOf(B),getEffectivePolicyValue:o.PropTypes.func,hasParentSharedFolder:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isLoading:o.PropTypes.bool.isRequired,isSharedFolder:o.PropTypes.bool,isSubmitting:o.PropTypes.bool,isTeamSharedFolder:o.PropTypes.bool,isUserOnOwnerTeam:o.PropTypes.bool,onDismiss:o.PropTypes.func,onSaveSettings:o.PropTypes.func,onOptionChange:o.PropTypes.func,onUnshare:o.PropTypes.func,ownerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),showContentManagerBridge:o.PropTypes.bool,shouldHideHeader:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(ce),policyUpdate:o.PropTypes.instanceOf(H)},getDefaultProps:function(){return{currentPolicy:null,folderId:null,getEffectivePolicyValue:null,hasParentSharedFolder:!1,isTeamSharedFolder:!1,onDismiss:null,onOptionChange:null,onSaveSettings:null,onUnshareFolder:null,ownerTeam:null,shouldHideHeader:!1,teamPolicy:null,policyUpdate:null}},render:function(){var t,n;return _e(K,{altAction:this.props.altAction,autoClose:!1,className:e({"shared-folder-settings-modal":!0,"shared-folder-settings-modal--no-permissions":!(null!=(t=this.props.permissions)&&null!=(n=t.change_options)?n.allow:void 0)}),buttonComponent:fe.span(),onDismissCompleted:this.props.onDismiss,title:this.props.isTeamSharedFolder?ue("“%(folder_name)s” team folder settings").format({folder_name:a.em_snippet(this.props.folderName,Q.FILENAME)}):ue("“%(folder_name)s” settings").format({folder_name:a.em_snippet(this.props.folderName,Q.FILENAME)})},this.props.isLoading?fe.div({className:"shared-folder-settings-modal__loading-text"},ue("Loading...")):fe.div({},this._renderHeader(),this._renderPolicies(),this._renderButtons()))},_renderHeader:function(){var t,n,o,r,s;if(!this.props.shouldHideHeader)return t={"shared-folder-settings-form__team-folder-banner":!0,"u-pad-xs":!0,"u-font-center":!0,"u-mar-bottom-s":!0},r=fe.div({},ue("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName})),this.props.isInContentManager?fe.div({className:e(t)},r):this.props.showContentManagerBridge?(s=ge(this.props.isLimitedTeam,this.props.folderPath),fe.div({className:e(t)},r,fe.div({},ue("You can change these settings in the Admin Console. "),fe.a({href:s.toString(),target:"_blank"},ue("Open in new tab."))))):(this.props.isTeamSharedFolder||this.props.hasParentSharedFolder)&&this.props.isUserOnOwnerTeam?fe.div({className:e(t)},r,fe.div({},fe.a({href:"/team",target:"_blank"},ue("To edit, ask your admin.")))):(null!=(n=this.props.permissions)&&null!=(o=n.change_options)?o.allow:void 0)?void 0:fe.div({className:e(i.extend(t,{"shared-folder-settings-form__team-folder-banner":!1,"shared-folder-settings-form__no-permissions-banner":!0}))},ue("You don’t have permission to change the settings on this folder."))},_renderPolicies:function(){var e,t;return t=null!=this.props.ownerTeam,e=this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree,fe.div({},t?this._renderPolicy("member_policy",ue(e?"Who can be added to folders?":"Who can be invited to this folder?"),[{label:this.props.isLimitedTeam?ue("Only people on your team"):ue("Only people on your %(trademark_business)s account").format({trademark_business:ae}),value:"team"},{label:ue("Anyone"),value:"anyone"}]):void 0,this._renderPolicy("acl_update_policy",ue(e?"Who can manage access to folders?":"Who can manage access to this folder?"),[{label:ue(e?"Only Team Admins":"Only owners"),value:"owner"},{label:t?this.props.isLimitedTeam?ue("Anyone on your team with edit permissions"):ue("Anyone on your %(trademark_business)s account with edit permissions").format({trademark_business:ae}):ue("People with edit permissions"),value:"editors"}]),t?this._renderPolicy("shared_link_policy",ue(this.props.isTeamSharedFolder?"Allow members of this team folder to share links with others?":"Allow links to be shared with people outside of this folder?"),[{label:ue("No"),value:"members"},{label:ue("Yes"),value:"anyone"}]):void 0)},_renderPolicy:function(e,t,n){var o,r,i;return i=this.props.getEffectivePolicyValue(e,this.props.policyUpdate),r=i[0],o=i[1],_e(se,{canChange:o,policyName:e,policyDescription:t,currentValue:r,options:n,handleOptionChange:this.props.onOptionChange})},_renderButtons:function(){var e,t,n;return e=null!=(t=this.props.permissions)&&null!=(n=t.unshare)?n.allow:void 0,fe.div({className:"u-mar-top-m clearfix"},this.props.isSharedFolder&&e?fe.div({className:"u-l-fl"},fe.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.onUnshare},ue(this.props.hasParentSharedFolder?"Reset membership":"Unshare folder"))):void 0,this._renderUpdateSettingsButtons())},_renderUpdateSettingsButtons:function(){var e;return(null!=(e=this.props.permissions)?e.change_options.allow:void 0)?_e(Z,{disableSave:null==this.props.policyUpdate,isAccepting:this.props.isSubmitting,onAccept:this.props.onSaveSettings,onDismiss:this.props.onDismiss}):void 0}}),ne=p(de,["/static/css/sharing/settings_modal-vflzQV5gA.css"],[se]),{SharedFolderSettingsModal:te,SharedFolderSettingsModalContents:ne}}),define("modules/clean/sharing/link_description",["external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/viewer","modules/core/i18n","modules/constants/python","modules/constants/sharing"],function(e,t,n,o,r,i,s,a,l){var c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P;return C=n.reactFormat,c=o.LinkAudience,u=r.SNIPPET_SIZES,d=a.TRADEMARK_BUSINESS,I=s.i18n_default_project("sharing"),p=I._,P=I.ungettext,y=e.DOM,S=function(e){return function(){switch(e){case"public":return p("Anyone with the link");case"team_only":return p("Only people on your Dropbox team");case"password":return p("Only people with the password");case"team_and_password":return p("Only people on your Dropbox team with the password");default:throw Error("Unknown visibility option "+e)}}()},E=function(e,n,o){return null==o&&(o=null),e?function(){switch(n){case"public":return p("Anyone with the link can comment.");case"team_only":return p("Only people on your Dropbox team can comment.");case"password":return p("Only people with the password can comment.");case"team_and_password":return p("Only people on your Dropbox team with the password can comment.");case"shared_folder_only":return p("Only members of the shared folder “%(shared_folder_name)s” can comment.").format({shared_folder_name:t.em_snippet(o,u.FILENAME)});case"only_you":return p("Only you can comment.");default:throw Error("Unknown visibility setting "+n)}}():p("No one can comment.")},w=function(e){var t,n,o,r;return t=null!=(r=null!=e?e.current_audience:void 0)?r:c.members,(null!=e?e.url:void 0)||t===c.members?(o=i.get_viewer().team_is_limited,n=function(){if(t===c.members)return p("Only invited members can access");if(t===c.public)return p(e.password_protected?"Anyone with the link and password can view":"Anyone with the link can view");if(t===c.team)return e.password_protected?o?p("Only people on your team with the password can view"):p("Only people on your %(trademark_business)s team with the password can view").format({trademark_business:d}):o?p("Only people on your team can view"):p("Only people on your %(trademark_business)s team can view").format({trademark_business:d});throw Error("Unknown link audience "+e.current_audience)}(),e.expiry&&t!==c.members&&(n=n+" ("+T(e)+")"),n):p("Updating link...")},T=function(e,t){var n,o,r,i,s;return s=e.expiry-new Date,i=36e5,r=24*i,n=Math.floor(s/r),1>n?(o=Math.floor(s/i)+1,t?P("Expires in the next hour","Expires in the next %(num_hours)s hours",o,"sharing").format({num_hours:o}):P("link turns off in the next hour","link turns off in the next %(num_hours)s hours",o,"sharing",'comes after a phrase like: "Anyone with the link can view"').format({num_hours:o})):t?P("Expires in 1 day","Expires in %(num_days)s days",n,"sharing").format({num_days:n}):P("link turns off in 1 day","link turns off in %(num_days)s days",n,"sharing",'comes after a phrase like: "Anyone with the link can view"').format({num_days:n})},b=function(e){return e.link_permissions.allow_download===!1?_(e):h(e)},h=function(e){return null!=e.expires?g(e):m(e)},_=function(e){return null!=e.expires?v(e):f(e)},m=function(e){return function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return C(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this folder"),{strong:y.strong()});case"public":return C(p("<strong>Anyone</strong> with the link can <strong>view</strong> this folder"),{strong:y.strong()});case"shared_folder_only":return C(p("<strong>Members of this folder</strong> with this link can <strong>view</strong> this folder"),{strong:y.strong()});case"team_and_password":return C(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder"),{strong:y.strong()});case"team_only":return C(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder"),{strong:y.strong()});case"only_you":return C(p("<strong>Only you</strong> can <strong>view</strong> via the link."),{strong:y.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return C(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this file"),{strong:y.strong()});case"public":return C(p("<strong>Anyone</strong> with the link can <strong>view</strong> this file"),{strong:y.strong()});case"shared_folder_only":return C(p("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file"),{strong:y.strong()});case"team_and_password":return C(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file"),{strong:y.strong()});case"team_only":return C(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file"),{strong:y.strong()});case"only_you":return C(p("<strong>Only you</strong> can <strong>view</strong> via the link."),{strong:y.strong()});default:throw Error("Unknown visibility setting")}}()},f=function(e){return function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return C(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:y.strong()});case"public":return C(p("<strong>Anyone</strong> with the link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:y.strong()});case"shared_folder_only":return C(p("<strong>Members of this folder</strong> with this link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:y.strong()});case"team_and_password":return C(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:y.strong()});case"team_only":return C(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:y.strong()});case"only_you":return C(p("<strong>Only you</strong> can <strong>view</strong> via the link. (Downloading is turned off.)"),{strong:y.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return C(p("<strong>Anyone</strong> with the link and password can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:y.strong()});case"public":return C(p("<strong>Anyone</strong> with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:y.strong()});case"shared_folder_only":return C(p("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:y.strong()});case"team_and_password":return C(p("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:y.strong()});case"team_only":return C(p("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:y.strong()});case"only_you":return C(p("<strong>Only you</strong> can <strong>view</strong> via the link. (Downloading is turned off.)"),{strong:y.strong()});default:throw Error("Unknown visibility setting")}}()},g=function(e){var t,n,o,r;return t=null!=e.expires?(n=e.expires-new Date,0>n?n=0:void 0,Math.floor(n/864e5)):null,r=null!=(o=e.teamInfo())?o.name:void 0,function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return C(P("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone </strong>with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"public":return C(P("<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"shared_folder_only":return C(P("<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"team_and_password":return C(P("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"team_only":return C(P("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"only_you":return C(P("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>)","<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return C(P("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"public":return C(P("<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"shared_folder_only":return C(P("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"team_and_password":return C(P("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});case"team_only":return C(P("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{
expires_days:t,strong:y.strong()});case"only_you":return C(P("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>)","<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:y.strong()});default:throw Error("Unknown visibility setting")}}()},v=function(e){var t,n,o,r,i;return o=864e5,t=null!=e.expires?(n=e.expires-new Date,0>n?n=0:void 0,Math.floor(n/o)):null,i=null!=(r=e.teamInfo())?r.name:void 0,function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return C(P("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"public":return C(P("<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"shared_folder_only":return C(P("<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Members of this folder</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"team_and_password":return C(P("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"team_only":return C(P("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"only_you":return C(P("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return C(P("<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"public":return C(P("<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"shared_folder_only":return C(P("<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Members of the containing shared folder</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"team_and_password":return C(P("<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"team_only":return C(P("<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Anyone on your Dropbox team</strong> with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});case"only_you":return C(P("<strong>Only you</strong> can <strong>view</strong> via the link. (expires in <strong>a day</strong>). (Downloading is turned off.)","<strong>Only you<strong> can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:y.strong()});default:throw Error("Unknown visibility setting")}}()},{formatLinkCommentingVisibility:E,formatLinkVisibilityOption:S,formatLinkDescription:b,formatSharedContentLinkDescription:w,formatSharedContentLinkExpiry:T}}),define("modules/clean/sharing/link_info",[],function(){var e;return e=function(){function e(e){this.expires=e.expires,this.isFolder=e.isFolder,this.name=e.name,this.teamId=e.teamId,this.teamName=e.teamName,this.url=e.url,this.visibility=e.visibility,this.isPackage=e.isPackage}return e}(),{LinkInfo:e}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/link_settings_modal",["external/classnames","external/es6-promise","external/immutable","external/react","external/underscore","modules/clean/api_v2/types","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/delete_link_modal","modules/clean/sharing/link_description","modules/clean/static_urls","modules/clean/user","modules/clean/previews/util","modules/constants/python","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T){var C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J;return R=t.Promise,Y=i.formatTimestamp,W=s.daysAfterToday,Q=s.format_date,Z=s.localized_date_format,K=l.file_extension,C=c.BubbleMenu,I=c.BubbleMenuItem,P=u.Calendar,O=p.Modal,L=_.ShareApiClient,A=m.LinkMetadata,N=m.LinkPolicy,k=m.RequestedVisibilityPolicy,D=m.ResolvedVisibilityPolicy,U=m.VisibilityDisallowedReason,G=g.deleteLinkWithConfirm,j=v.formatLinkCommentingVisibility,z=v.formatLinkVisibilityOption,J=y.static_url,F=S.TRADEMARK_BUSINESS,x=S.TRADEMARK_PLUS,q=o.createElement,V=o.DOM,B=w.i18n_default_project("sharing")._,H=o.createClass({displayName:"SharedLinkSettingsModal",propTypes:{client:o.PropTypes.instanceOf(L).isRequired,isFile:o.PropTypes.bool.isRequired,linkMetadata:o.PropTypes.instanceOf(A).isRequired,onClose:o.PropTypes.func,onDeleteLink:o.PropTypes.func,onPolicySet:o.PropTypes.func,showUpgradeToBiz:o.PropTypes.bool.isRequired,isTeam:o.PropTypes.bool},getInitialState:function(){var e,t,n;return t=this.props.linkMetadata.link_permissions.requested_visibility,n=this.props.linkMetadata.link_permissions.resolved_visibility,t===k.public&&n===D.team_only&&(t=k.team_only),e=N({requested_visibility:t,link_password:t===k.password?null:"",expires:this.props.linkMetadata.expires,allow_download:this.props.linkMetadata.link_permissions.allow_download}),{existingPolicy:e,isSubmitting:!1,newPolicy:e}},render:function(){var e,t;return e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.disallowed_reason===U.user_account_type}),t=e.length>0,q(O,{autoClose:!1,className:"shared-link-settings-modal",buttonComponent:V.span(),onDismissCompleted:this._handleDismissed,title:B("Link permissions for “%(content_name)s”").format({content_name:this.props.linkMetadata.name})},q(M,{canSubmit:!this.state.existingPolicy.equals(this.state.newPolicy),isFile:this.props.isFile,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onCancel:this._dismissModal,onSubmit:this._saveSettings,onPolicyUpdate:this._handlePolicyUpdate,onDeleteLink:this._deleteLink,renderedPolicy:this.state.newPolicy,showUpgradeToBiz:this.props.showUpgradeToBiz,showUpgradeMessage:t,isTeam:this.props.isTeam}))},_handlePolicyUpdate:function(e,t){return"expires"===e&&null!=t&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59)),this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_getModifiedSettings:function(){var e,t;if(t=this.state.newPolicy,t.requested_visibility===k.password){if(null==t.link_password)t=t.set("requested_visibility",null);else if(""===t.link_password)return T.error(B("Password can’t be empty")),null}else t=t.set("link_password",null);return e=this.props.linkMetadata.link_permissions.resolved_visibility,e===D.shared_folder_only&&(t=t.set("requested_visibility",null)),null!=t.expires&&(t=this.props.linkMetadata.link_permissions.can_set_expiry?t.set("expires",Y(t.expires)):t.set("expires",null)),t.allow_download===this.state.existingPolicy.allow_download&&(t=t.set("allow_download",void 0)),{url:this.props.linkMetadata.url,settings:t,remove_expiration:null!=this.props.linkMetadata.expires&&null==this.state.newPolicy.expires}},_saveSettings:function(){var e;return e=this._getModifiedSettings(),null!=e?(this.setState({isSubmitting:!0}),this.props.client.modifySharedLinkSettings(e).catch(function(e){return function(){return e.setState({isSubmitting:!1}),R.reject()}}(this)).then(function(e){return function(t){var n;return T.success(B("Settings saved.")),"function"==typeof(n=e.props).onPolicySet&&n.onPolicySet(t),e._dismissModal()}}(this))):void 0},_dismissModal:function(){return O.close(),this._handleDismissed()},_handleDismissed:function(){var e;return"function"==typeof(e=this.props).onClose?e.onClose():void 0},_deleteLink:function(){var e,t;return t=function(e){return function(){var t;return"function"==typeof(t=e.props).onDeleteLink?t.onDeleteLink():void 0}}(this),e=function(e){return function(){return O.showInstance(q(H,e))}}(this.props),G({client:this.props.client,contentName:this.props.linkMetadata.name,onCancel:e,onDeleteLink:t,url:this.props.linkMetadata.url})}}),M=o.createClass({displayName:"SharedLinkSettingsModalContents",propTypes:{canSubmit:o.PropTypes.bool.isRequired,isFile:o.PropTypes.bool.isRequired,isSubmitting:o.PropTypes.bool.isRequired,linkMetadata:o.PropTypes.instanceOf(A).isRequired,onCancel:o.PropTypes.func,onSubmit:o.PropTypes.func,onPolicyUpdate:o.PropTypes.func,onDeleteLink:o.PropTypes.func,renderedPolicy:o.PropTypes.instanceOf(N).isRequired,showUpgradeToBiz:o.PropTypes.bool.isRequired,showUpgradeMessage:o.PropTypes.bool.isRequired,isTeam:o.PropTypes.bool},getInitialState:function(){return{selectedExpiry:null!=this.props.renderedPolicy.expires?this.props.linkMetadata.link_permissions.can_set_expiry?"custom":"read-only":"no-expiry"}},render:function(){return V.div({className:"shared-link-settings-modal__contents"},this._renderHeader(),this._renderPolicies(),this._renderButtons())},_renderHeader:function(){var e,t;return this.props.showUpgradeToBiz?V.div({className:"shared-link-settings-modal__upgrade-to-biz-banner"},V.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-text"},B("Did you know %(trademark_business)s lets you add passwords and expiration dates to shared links?").format({trademark_business:F})),V.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-cta"},V.a({className:"c-btn c-btn--secondary shared-link-settings-modal__upgrade-to-biz-banner-cta-button",href:"/business?tk=teams&camp=sharing_link_modal",target:"_blank"},B("Learn More")))):this.props.showUpgradeMessage?(this.props.isTeam?(e="/team/upgrade",t=B("Upgrade to %(trademark_business)s to enable permission settings").format({trademark_business:F})):(e="/upgrade?oqa=sfp",t=B("Upgrade to Dropbox %(trademark_plus)s to enable permission settings.").format({trademark_plus:x})),V.div({className:"shared-link-settings-modal__upgrade-to-pro-banner"},V.a({href:e,target:"_blank"},t))):void 0},_renderPolicies:function(){return V.div({},this._renderVisibilityPolicies(),this._renderExpiryPolicy(),this._renderDownloadPolicy(),this._renderCommentsPolicy())},_renderVisibilityPolicies:function(){var e;return e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.allowed||e.disallowed_reason===U.user_account_type}),this._renderFieldset(B("Who can view this link?"),e.length<2?this._renderRestrictedBySharedFolderVisibility():e.map(this._renderVisibilityOption))},_renderRestrictedBySharedFolderVisibility:function(){var e,t,n;return t=this.props.linkMetadata.link_permissions.resolved_visibility,e=this.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason,V.span({},V.span({className:"shared-link-settings-modal__visibility-text"},function(){if(t===D.shared_folder_only)return n=this.props.linkMetadata.link_permissions.restricting_shared_folder_path,n=a.em_snippet(n,f.SNIPPET_SIZES.FILENAME),B("Only members of the shared folder “%(shared_folder_name)s” can view this link.").format({shared_folder_name:n});if(t===D.only_you)return B("Only you can view this link.");throw"Unexpected visibility "+t}.call(this))," ",V.span({className:"shared-link-settings-modal__visibility-advice u-font-meta"},function(){if(e===U.restricted_by_shared_folder)return B("To change who can access the link, go to the shared folder options.");if(e===U.delete_and_recreate)return B("To change who can access the link, delete this link and create a new one.");throw"Unexpected disallowed reason "+e}()))},_renderVisibilityOption:function(t){var n,o;return n=t.disallowed_reason===U.user_account_type,[V.label({className:e({"u-font-meta":!t.allowed}),key:"visibility-label"},V.input({checked:t.policy===this.props.renderedPolicy.requested_visibility,className:e((o={"shared-link-settings-modal__audience":!0},o["shared-link-settings-modal__audience-"+t.policy]=!0,o)),disabled:n,name:k.policy_name,onChange:function(e){return function(t){return e.props.onPolicyUpdate(t.target.name,t.target.value)}}(this),type:"radio",value:t.policy}),this._renderVisibilityLabelText(t)),t.policy===k.password&&this.props.renderedPolicy.requested_visibility===k.password?V.div({key:"password-input"},this._renderPasswordInput(n)):void 0]},_renderVisibilityLabelText:function(t){var n;return V.span({className:e((n={"shared-link-settings-modal__audience":!0},n["shared-link-settings-modal__audience-"+t.policy+"-label"]=!0,n))},z(t.resolved_policy))},_renderPasswordInput:function(e){var t,n;return n=null==this.props.renderedPolicy.link_password,V.div({className:"shared-link-settings-modal__password-container u-mar-left-m u-mar-right-xl u-mar-top-xs"},V.input({className:"shared-link-settings-modal__password-input c-input",disabled:e||n,name:"link_password",onChange:function(e){return function(t){return e.props.onPolicyUpdate(t.target.name,t.target.value)}}(this),placeholder:B("Set password"),value:null!=(t=this.props.renderedPolicy.link_password)?t:"123456",type:"password"}),n&&!e?V.button({className:"shared-link-settings-modal__password-change button-as-link",onClick:function(e){return function(){return e.props.onPolicyUpdate("link_password","")}}(this)},B("Change",{comment:"A link to change the password for the shared link"})):void 0)},_renderExpiryPolicy:function(){return this._renderFieldset(B("Add an expiry date to this link?"),V.div({},V.label({className:e({"shared-link-settings-modal__expiry-label-yes":!0,"u-font-meta":!this.props.linkMetadata.link_permissions.can_set_expiry})},V.input({checked:"no-expiry"!==this.state.selectedExpiry,className:"shared-link-settings-modal__expiry-option-yes",disabled:!this.props.linkMetadata.link_permissions.can_set_expiry,onChange:function(e){return function(){return"no-expiry"===e.state.selectedExpiry?e._handleExpirySelectChange(30):void 0}}(this),type:"radio"}),this._renderYesExpiryText()),"custom"===this.state.selectedExpiry?this._renderExpiryCustom():void 0,V.label({className:e({"u-font-meta":!this.props.linkMetadata.link_permissions.can_remove_expiry})},V.input({checked:null==this.props.renderedPolicy.expires,className:"shared-link-settings-modal__expiry-option-no",disabled:!this.props.linkMetadata.link_permissions.can_remove_expiry,onChange:function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate&&t.onPolicyUpdate("expires",null),e.setState({selectedExpiry:"no-expiry"})}}(this),type:"radio"}),B("No"))))},_renderYesExpiryText:function(){var e,t;if(7===(e=this.state.selectedExpiry)||30===e)return V.span({className:"shared-link-settings-modal__expiry-text-yes"},B("Yes, expires in",{comment:'Label followed by a date range e.g. "Yes, expires in 7 days"'})," ",this._renderExpirySelect());if("custom"===(t=this.state.selectedExpiry)||"read-only"===t)return V.span({className:"shared-link-settings-modal__expiry-text-yes"},B("Yes, expires on",{comment:'Label followed by a date. e.g. "Yes, expires on 5/10/2017"'})," ","read-only"===this.state.selectedExpiry?Q(this.props.linkMetadata.expires,Z):void 0);if("no-expiry"===this.state.selectedExpiry)return V.span({className:"shared-link-settings-modal__expiry-text-yes"},B("Yes"));throw"Expiry policy is in an unknown state"},_renderExpirySelect:function(){var e;return q(C,{position:C.POSITIONS.BOTTOM,targetFixed:!0,items:function(){var t,n,o,r;for(o=[7,30,"custom"],r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push(q(I,{onClick:function(e){return function(t){return function(){return e._handleExpirySelectChange(t)}}}(this)(e)},this._renderExpirySelectLabel(e)));return r}.call(this),targetButton:V.button({className:"shared-link-settings-modal__selected-expiry button-as-link"},this._renderExpirySelectLabel(this.state.selectedExpiry)," ",V.img({alt:"",className:"sprite sprite_web s_web_arrow-down-gray",src:J("/static/images/icons/icon_spacer-vflN3BYt2.gif")}))})},_renderExpirySelectLabel:function(e){if(7===e)return B("7 days",{comment:'as in "This link expires in 7 days"'});if(30===e)return B("30 days",{comment:'as in "This link expires in 30 days"'});if("custom"===e)return B("Custom date...",{comment:"Dropdown option for expiry date on a link. The user can choose 7 days, 30 days, or a custom expiry"});throw"Unknown selected expiry"},_handleExpirySelectChange:function(e){var t;return this.setState({selectedExpiry:e}),"custom"===e&&(e=30),"function"==typeof(t=this.props).onPolicyUpdate?t.onPolicyUpdate("expires",W(e)):void 0},_renderExpiryCustom:function(){var e;return V.span({className:"shared-link-settings-modal__calendar-input"},q(P,{alignAtLeft:!1,onDateChange:function(e){return function(t){var n;return"function"==typeof(n=e.props).onPolicyUpdate?n.onPolicyUpdate("expires",t):void 0}}(this),initDate:null!=(e=this.props.linkMetadata.expires)?e:W(30),firstDay:W(1),lastDay:W(365)}))},_renderDownloadPolicy:function(){var t,n,o;return o=this.props.linkMetadata.link_permissions.can_disallow_download,n=this.props.linkMetadata.link_permissions.can_allow_download,t=this.props.linkMetadata.link_permissions.allow_download,null==o||null==n||null==t||o===!1&&t===!0?void 0:this._renderFieldset(B("Allow people to download this?"),V.div({},V.label({className:e({"u-font-meta":!n})},V.input({checked:this.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__allow-download-yes",disabled:!n,onChange:function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate?t.onPolicyUpdate("allow_download",!0):void 0}}(this),type:"radio"}),B("Yes")),V.label({className:e({"u-font-meta":!o})},V.input({checked:!this.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__allow-download-no",disabled:!o,onChange:function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate?t.onPolicyUpdate("allow_download",!1):void 0}}(this),type:"radio"}),B("No"))),this._renderNoPreviewFileWarning())},_renderNoPreviewFileWarning:function(){var e,t,n,o;if(this.props.isFile&&(e=K(this.props.linkMetadata.name),t=e.toUpperCase(),!(null!=(null!=(o=this.props.linkMetadata)?o.preview_type:void 0)&&(n=this.props.linkMetadata.preview_type,indexOf.call(b.PreviewHelper.VALID_PREVIEW_TYPES,n)>=0))))return this.props.renderedPolicy.allow_download===!1?V.div({className:"shared-link-settings-modal__preview-warning c-banner c-banner--warning"},V.div({className:"o-flag"},V.div({className:"o-flag-fix"},q(h,{alt:"",group:"web",name:"page_white_32"})),V.div({className:"o-flag__flex u-pad-left-xs"},B("People can’t view this %(file_extension)s file if they can’t download it.",{comment:'as in "People can’t view this .PDF file'}).format({file_extension:"."+t})))):void 0},_renderCommentsPolicy:function(){return this.props.linkMetadata.link_permissions.team_restricts_comments?void 0:this._renderFieldset(B("Who can comment?"),V.div({},V.div({className:"shared-link-settings-modal__commenting-policy"},j(this.props.linkMetadata.link_permissions.allow_comments,this._getResolvedVisibility(this.props.renderedPolicy.requested_visibility),this.props.linkMetadata.link_permissions.restricting_shared_folder_path)),V.div({className:"shared-link-settings-modal__commenting-advice"},this.props.linkMetadata.link_permissions.allow_comments?V.a({href:"/help/9016/#comments",target:"_blank"},B("Learn how to disable comments")):V.a({href:"/help/9016/#comments",target:"_blank"},B("Learn how to enable comments")))))},_getResolvedVisibility:function(e){var t;if(t=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(t){return t.policy===e}),1!==t.length)throw"Logic error: "+t.length+" should be 1.";return t[0].resolved_policy},_renderFieldset:function(e,t,n){return null==n&&(n=null),V.fieldset({className:"settings-form-entry"},V.legend({className:"settings-form-entry__explanation u-trim-margin"},e),V.div({className:"settings-form-entry__options"},t),V.div({className:"u-mar-top-m"},n))},_renderButtons:function(){return V.div({className:"u-mar-top-m clearfix"},this.props.linkMetadata.link_permissions.can_revoke?V.div({className:"u-l-fl"},V.button({className:"button-as-link delete-link",onClick:this.props.onDeleteLink,style:{lineHeight:"32px"},type:"button"},B("Delete link"))):void 0,V.div({className:"u-l-fr"},V.button({className:"c-btn c-btn--primary confirm-button",disabled:this.props.isSubmitting||!this.props.canSubmit,onClick:this.props.onSubmit},B(this.props.isSubmitting?"Saving...":"Save settings")),V.button({className:"c-btn c-btn--secondary u-mar-left-xs cancel-button",onClick:this.props.onCancel},B("Cancel"))))}}),X=function(e){return f.SHARING_EXPERIMENTS.SHOW_UPGRADE_TO_BIZ_BANNER[e]},{SharedLinkSettingsModal:d(H,["/static/css/sharing/settings_modal-vflzQV5gA.css"]),SharedLinkSettingsModalContents:M,showUpgradeToBizBanner:X}});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/member_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/em_string","modules/clean/sharing/constants","modules/clean/sharing/link_description","modules/clean/sharing/ui_util","modules/clean/viewer","modules/core/i18n","modules/clean/static_urls"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g){var v,y,E,b,S,w,T,C,I,P,A;return I=u.nice_date_with_month_name,E=p.SHMODEL_LINK_TOKEN_VISIBILITY,b=p.SNIPPET_SIZES,C=h.formatSharedContentLinkDescription,v=_.GoldenGate,S=f._,A=f.ungettext,P=g.static_url,w=e.createElement,T=e.DOM,y={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e;return e=this.arePairedUsersInSf(this.props.joinedMembers),this.setState({paired_users_in_sf:e,paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t;return t=this.arePairedUsersInSf(e.joinedMembers),this.setState({paired_users_in_sf:t,paired_users_in_sf:t})},_wrap_with_avatar_type_and_data:function(e,t,n){return function(o){return e(t,n),o.stopPropagation()}},arePairedUsersInSf:function(e){var t,n,o,r,i,s,a;return e?(a=m.get_viewer(),!!(a.is_paired&&(s=a.get_user_ids(t=!0),n=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)o=e[t],r.push(o.user_id);return r}(),r=s[0],indexOf.call(n,r)>=0&&(i=s[1],indexOf.call(n,i)>=0)))):!1},findOwnerAndMeInJoinedMembers:function(e){var t,n,o,r,i,s;for(s=null,r=null,t=n=0,o=e.length;o>n&&(i=e[t],"owner"===i.access_type&&(s=i),i.user_id===this.props.user.id&&(r=i),null==s||null==r);t=++n);return[s,r]},addGroupsMembersInvitations:function(e,t,n,o,r){var i,s,a,l,c,u,d,p,h,_,m;for(null==r&&(r=[]),a=0,u=t.length;u>a;a++)i=t[a],e.push(this.renderGroup(i));for(l=0,d=n.length;d>l;l++)h=n[l],_=h.user_id,indexOf.call(r,_)<0&&e.push(this.renderJoinedMember(h));for(m=[],c=0,p=o.length;p>c;c++)s=o[c],m.push(e.push(this.renderInvitedPerson(s)));return m},renderAvatarList:function(e,t){var n;return null==t&&(t=""),v.hasNewMembershipUI(this.props.user.id)&&(n=function(e){return function(t){var n,r,i;return n=99,i=A("%(count)s more member","%(count)s more members",t).format({count:t}),r=t>=n?n+"+":""+t,w(o,{alt:i,dimension:e.props.avatarDimension,initials:r,color:"#7B8994",shape:"CIRCLE",onClick:e.props.onOverflowCountClick})}}(this)),w(l,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,overflowCountRenderer:n,animation:this.props.animation,inheritedCountAvatar:this.renderInheritedCount(e.length),className:t,isInAudienceBox:v.hasAudienceBox(this.props.user.id),isInSFPreviewPanel:this.props.isInSFPreviewPanel,reverseAvatars:v.hasNewMembershipUI(this.props.user.id)})},renderJoinedMember:function(e){var n,o,i,s,l,u,p,h,_,f,g,v;return g=m.get_viewer(),f=e.user_id,p=indexOf.call(g.get_user_ids(o=!0),f)>=0,l=null,p&&this.state.paired_users_in_sf?(u=e.user_id,_=g.get_user_by_role("personal",!0),v=g.get_user_by_role("work",!0),u===_.id?l="Personal":u===v.id&&null!=g.team_name&&(l=g.team_name)):l=e.display_name,this.props.isInAudienceBox&&(l=d.em_snippet(l,b.DISPLAY_NAME)),n=this.individualAccessTypeString(l,e.access_type,p,this.state.paired_users_in_sf),h=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"member",e),s={alt:n,dimension:this.props.avatarDimension,onPhotoClick:h,photoUrl:e.photo_url,defaultAvatar:w(r,{alt:n,dimension:this.props.avatarDimension,name:e.display_name,initials:this.props.isInAudienceBox?e.initials.toUpperCase():e.initials,shape:"CIRCLE",onClick:h})},i=p?w(a,s):w(t,s),w(c,{key:"user:"+e.user_id+":"+e.photo_url,text:n,direction:this.props.titleButtonDirection},i)},renderGroup:function(e){var t,n,o;return n=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"group",e),e.is_automatic?(o=this.teamAccessTypeString(e.name,e.access_type),t=w(i,{alt:o,dimension:this.props.avatarDimension,photoUrl:P("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:n})):(o=this.groupAccessTypeString(e.name,e.access_type,e.num_users),t=w(r,{alt:o,dimension:this.props.avatarDimension,name:e.name,shape:"SQUARE",initials:this.getInitials(e.name),onClick:n})),w(c,{key:"group:"+e.gid+":"+e.name,text:o,direction:this.props.titleButtonDirection},t)},renderInvitedPerson:function(e){var t,n;return n=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"invited",e),t=this.individualAccessTypeString(e.email_or_fbname,"pending",!1),w(c,{key:"invitation:"+e.invitation_id,text:t,direction:this.props.titleButtonDirection},w(o,{alt:t,dimension:this.props.avatarDimension,color:"#aaa",initials:this.getInitials(e.email_or_fbname),shape:"CIRCLE",onClick:n}))},renderInheritedCount:function(e){var t;return v.hasNewMembershipUI(this.props.user.id)&&this.props.numInheritedMembers>0?(t=A("%(inherited_count)s member from %(parent_folder)s folder","%(inherited_count)s members from %(parent_folder)s folder",this.props.numInheritedMembers).format({inherited_count:this.props.numInheritedMembers,parent_folder:this.props.parentFolderName}),T.div({},w(c,{text:t,direction:"south"},w(n,{inheritedMemberCount:this.props.numInheritedMembers,key:"count",onClick:this.props.onAvatarClick})),e>0?T.span({className:"members-column__plus-sign u-pad-left-xxs"},"+"):void 0)):void 0},getInitials:function(e){var t,n,o;return null!=e&&e.length>0?(o=e.split(" "),t=function(){var e,t,r;for(r=[],e=0,t=o.length;t>e;e++)n=o[e],r.push(n.charAt(0).toLowerCase());return r}(),t.length>2&&(t=t.splice(0,2)),t.join("")):""},teamAccessTypeString:function(e,t){var n;return n=S("editor"===t?"%(team_group_name)s can edit":"%(team_group_name)s can view"),n.format({team_group_name:d.em_snippet(e,b.DISPLAY_NAME)})},groupAccessTypeString:function(e,t,n){var o;return o="editor"===t?A("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",n):A("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",n),o.format({group_name:d.em_snippet(e,b.DISPLAY_NAME),num_users:n})},individualAccessTypeString:function(e,t,n,o){var r,i,s,a;return null==o&&(o=!1),r={viewer:S("You can view"),editor:S("You can edit"),owner:S("You’re the owner"),team:S("You’re a member of this team folder"),default:S("You")},a={viewer:S("%(name)s can view"),editor:S("%(name)s can edit"),owner:S("%(name)s is the owner"),pending:S("%(name)s hasn’t added this to their Dropbox yet"),team:S("%(name)s is a member of this team folder"),default:S("%(name)s"),"no access":S("No access")},i={viewer:S("You (%(name)s) can view"),editor:S("You (%(name)s) can edit"),owner:S("You (%(name)s) are the owner")},s=n?o&&null!=e?i:r:a,s.hasOwnProperty(t)?s[t].format({name:d.em_snippet(e,b.DISPLAY_NAME)}):""},renderSharedLink:function(e,t){var n,o,r,i;return n=this.getDescriptionForSharedLinkInfo(e,t),o=w(s,{alt:n,dimension:this.props.avatarDimension,hasAudienceBox:v.hasAudienceBox(this.props.user.id),isMaestroDesign:this.props.isMaestroDesign,onClick:function(t){return function(n){return t.props.onSharedLinkClick(e),n.stopPropagation()}}(this)}),(null!=e?e.allow_download:void 0)===!1?(r="sharing-icon-bubble-title u-font-center",i=!0):i=!1,w(c,{key:"shared_link",text:n,direction:"south",className:r,respectLineBreaks:i},o)},getDescriptionForSharedLinkInfo:function(e,t){var n,o,r,i,s,a,l,c,u,d,p,h;if(t)return C(t);if(h=e.visibility_type,i=e.expires_posix,d=e.shared_folder_link_policy,r="",i){if(c=(new Date).getTime()/1e3,u=i-c,o=Math.floor(u/86400),0>u)return S("Link Disabled");n=new Date(1e3*i),p=!1,a=!0,s=o>180,n=I(n,s,p,a)}if(e.allow_download===!1&&(r=". "+S("(Downloading is turned off.)",{comment:'This follows a description of link visibility. For example: "Anyone with the link can view this file. (Downloading is turned off.)"'})),l="MEMBERS_ONLY"===d,n){if(l)return S("Folder members with the link can view until %(date)s").format({
date:n})+r;if(h===E.PUBLIC)return S("People with the link can view until %(date)s").format({date:n})+r;if(h===E.PASSWORD)return S("People with the password can view until %(date)s").format({date:n})+r;if(h===E.TEAM_ONLY)return S("People at %(team_name)s can view until %(date)s").format({team_name:m.get_viewer().team_name,date:n})+r;if(h===E.ONLY_YOU)return S("Only you can view until %(date)s").format({date:n})+r}else{if(l)return S("Folder members with the link can view")+r;if(h===E.PUBLIC)return S("People with the link can view")+r;if(h===E.PASSWORD)return S("People with the password can view")+r;if(h===E.TEAM_ONLY)return S("People at %(team_name)s with the link can view").format({team_name:m.get_viewer().team_name})+r;if(h===E.ONLY_YOU)return S("Only you can view")+r}}}}),define("modules/clean/sharing/notifications",["jquery","modules/clean/browse_interface","modules/clean/sharing/api/client","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h;return c=n.ShareApiClient,l=n.FolderShareApiClient,u=i._,d=function(t){var n,o;return n=e(t).closest("form"),null!=(o=n.closest(".sc-invite-action"))&&o.addClass("loading"),n.length&&new c({userId:n[0]._subject_uid.value}).dismissInviteNotification({contentId:n[0].content_id.value}).finally(function(){return n.closest(".sc-invite-action").removeClass("loading"),n.closest(".feed-row").remove()}),!1},p=function(n){var i,c;return i=e(n),i.closest(".sc-invite-action").addClass("loading"),c=o.get_viewer().get_user_by_id(n._subject_uid.value),new l({userId:c.id}).mount({contentId:n.sf_id.value,origin:"NOTIFICATION_WEB"}).then(function(e){var n,o,l;return n=i.closest(".sc-invite-action"),n.addClass("sf-mounted"),o=e.path_lower,l=a({path:t.get_browse_root(c)+o}).toString(),r.redirect(l),s.success(u("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))}).finally(function(){return i.closest(".sc-invite-action").removeClass("loading")}),!1},h=function(){var e;return s.info(u("Continue upgrading to add the shared folder to your Dropbox.")),e=a({scheme:"https",authority:"www.dropbox.com",path:"/pro/buy"}),e.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),r.redirect(e.toString()),!1},{register_dismiss:d,register_mount:p,upgrade_to_mount:h}}),define("modules/clean/sharing/parent_folder_access_modal",["external/classnames","external/react","modules/clean/em_string","modules/clean/react/flag","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_,m,f,g,v,y,E;return h=r.Modal,p=s.MemberAccessLevelResult,u=a.ACCESS_LEVEL,m=a.SNIPPET_SIZES,d=l.ContentInfo,g=t.createElement,v=t.DOM,y=c.i18n_default_project("sharing"),f=y._,E=y.ungettext,_=t.createClass({displayName:"ParentFolderAccessModal",propTypes:{contentInfo:t.PropTypes.instanceOf(d).isRequired,memberAccessLevelResult:t.PropTypes.instanceOf(p).isRequired,memberDisplayName:t.PropTypes.string.isRequired,originalAction:t.PropTypes.oneOf(["remove","update"]).isRequired,isInContentManager:t.PropTypes.bool,onClose:t.PropTypes.func,onParentFolderClicked:t.PropTypes.func},_dismissModal:function(){return h.close(),this._handleDismissed()},_handleDismissed:function(){var e;return"function"==typeof(e=this.props).onClose?e.onClose():void 0},_handleNavigateToParentFolder:function(e){var t;return h.close(),"function"==typeof(t=this.props).onParentFolderClicked?t.onParentFolderClicked(e.shared_folder_id,this._arePermissionsAllowed(e.permissions)):void 0},_arePermissionsAllowed:function(e){return e.some(function(e){return null!=e?e.allow:void 0})},_memberCanEdit:function(){var e;return(e=this.props.memberAccessLevelResult.access_level)===u.OWNER||e===u.WRITER},_renderParentFolderContent:function(){var e;return e="remove"===this.props.originalAction?this.props.contentInfo.isFolder()?E("As a member of the parent folder listed below, %(member_name)s can still access the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access the contents of “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):E("As a member of the parent folder listed below, %(member_name)s can still access “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):"update"===this.props.originalAction?this.props.contentInfo.isFolder()?this._memberCanEdit()?E("As a member of the parent folder listed below, %(member_name)s can still edit the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit the contents of “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):E("As a member of the parent folder listed below, %(member_name)s can still view the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view the contents of “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):this._memberCanEdit()?E("As a member of the parent folder listed below, %(member_name)s can still edit “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):E("As a member of the parent folder listed below, %(member_name)s can still view “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still view “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):void 0,v.div({},e.format({member_name:n.em_snippet(this.props.memberDisplayName,m.DISPLAY_NAME),content_name:n.em_snippet(this.props.contentInfo.name(),m.FILENAME)}),v.div({className:"parent-folder-access-modal__folder-list u-mar-top-s"},v.ul({className:"o-list-ui o-list-ui--dividers"},this.props.memberAccessLevelResult.parentFolders.map(this._renderParentFolder))))},_renderParentFolder:function(e){var t;return t=g(i,{group:"web",name:"folder_user_32",className:"u-pad-right-xs",alt:""}),v.li({},v.div({className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:this._handleNavigateToParentFolder.bind(null,e)},g(o.Flag,{leftAttachment:t,rightAttachment:this._renderFolderLink(e)},v.span({className:"parent-folder-access-modal__folder-name"},n.em_snippet(e.name,m.FILENAME)))))},_renderFolderLink:function(e){return v.button({className:"button-as-link",onClick:this._handleNavigateToParentFolder.bind(null,e),type:"button"},f(this._arePermissionsAllowed(e.permissions)?"Manage membership":"View folder"))},_renderSimpleContent:function(){return v.div({},v.span({className:"parent-folder-access-modal__warning"},this.props.memberAccessLevelResult.warning),v.div({className:"u-mar-top-m clearfix"},v.div({className:"u-l-fr"},v.button({className:"c-btn c-btn--primary confirm-button",onClick:this._dismissModal},f("OK")))))},render:function(){var e;return e="remove"===this.props.originalAction?f(this.props.contentInfo.isFolder()?"%(member_name)s can still access this folder":"%(member_name)s can still access this file"):"update"===this.props.originalAction?f(this.props.contentInfo.isFolder()?this._memberCanEdit()?"%(member_name)s can still edit this folder":"%(member_name)s can still view this folder":this._memberCanEdit()?"%(member_name)s can still edit this file":"%(member_name)s can still view this file"):void 0,g(h,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:v.span(),onDismissCompleted:this._handleDismissed,title:e.format({member_name:n.em_snippet(this.props.memberDisplayName,m.DISPLAY_NAME)})},v.div({className:"parent-folder-access-modal__contents"},null==this.props.memberAccessLevelResult.parentFolders||this.props.isInContentManager?this._renderSimpleContent():this._renderParentFolderContent()))}}),{ParentFolderAccessModal:_}});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/sharing/role_selector_modal",["jquery","modules/clean/dbmodal","modules/clean/multiaccount_login","modules/clean/viewer"],function(e,t,n,o){var r,i;return r=t.DBModal,i=function(t){function r(e){this.onSelectRole=e,r.__super__.constructor.call(this,{element_id:"select-role-modal-sync"})}return extend(r,t),r.prototype.on_show=function(){return e(".role-options li").click(function(t){return function(r){var i;return i=e(r.target).closest("li").data("role"),t.hide(),o.get_viewer().is_role_signed_in(i)?t.onSelectRole(i):n.show_modal({role:i,on_success:function(){return t.onSelectRole(i)}})}}(this))},r}(r)}),define("modules/clean/sharing/set_confidential_modal",["external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react/modal","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_;return h=n.filename,_=n.parent_dir,a=o.Modal,l=i.SNIPPET_SIZES,d=e.createElement,p=e.DOM,u=s.i18n_default_project("sharing")._,c=e.createClass({displayName:"SetConfidentialModal",propTypes:{client:e.PropTypes.instanceOf(r).isRequired,folderId:e.PropTypes.string.isRequired,folderName:e.PropTypes.string.isRequired,folderPath:e.PropTypes.string.isRequired,initialIsConfidentialFolder:e.PropTypes.bool.isRequired,onCancel:e.PropTypes.func,onUpdateConfidentiality:e.PropTypes.func},getInitialState:function(){return{isAccepting:!1,setConfidential:this.props.initialIsConfidentialFolder}},render:function(){return d(a,{autoClose:!1,buttonComponent:p.span(),onDismissCompleted:this._handleDismiss,title:u("“%(folder_name)s” access").format({folder_name:t.em_snippet(this.props.folderName,l.FILENAME)})},this._renderContent(),this._renderButtons())},_renderContent:function(){var e;return e=t.em_snippet(h(_(this.props.folderPath)),l.FILENAME),p.div({className:"set-confidential-content"},p.div({className:"set-confidential-content__info"},u("Should members of the parent folder “%(parent_folder)s” automatically get access to the folder “%(folder_name)s”?").format({folder_name:t.em_snippet(this.props.folderName,l.FILENAME),parent_folder:e})),p.div({className:"set-confidential-content__options u-pad-top-s"},p.label({className:"u-l-b",key:"inherit"},p.input({checked:!this.state.setConfidential,name:"inherit",onChange:this._handleSetConfidentialValueUpdate,type:"radio",value:!1}),u("Yes, allow members of “%(parent_folder)s” to access").format({parent_folder:e})),p.label({className:"u-l-b",key:"confidential"},p.input({checked:this.state.setConfidential,name:"confidential",onChange:this._handleSetConfidentialValueUpdate,type:"radio",value:!0}),u("No, make this folder invite only"))))},_renderButtons:function(){return p.div({className:"u-l-fr"},p.button({className:"c-btn c-btn--primary",disabled:this.state.isAccepting||this.state.setConfidential===this.props.initialIsConfidentialFolder,onClick:this._handleAcceptClick},u(this.props.isAccepting?"Saving...":"Save")),p.button({className:"c-btn c-btn--secondary u-mar-left-xs",onClick:this._handleDismiss},u("Cancel")))},_handleSetConfidentialValueUpdate:function(e){return this.setState({setConfidential:"true"===e.target.value})},_handleAcceptClick:function(){return this.setState({isAccepting:!0}),this.props.folderId?this.props.client.setConfidentiality({contentId:this.props.folderId,confidential:this.state.setConfidential}).then(function(e){return function(t){var n;return"function"==typeof(n=e.props).onUpdateConfidentiality?n.onUpdateConfidentiality(t):void 0}}(this)):this.props.client.shareInternal({fqPath:this.props.folderPath,confidential:this.state.setConfidential}).then(function(e){return function(t){var n;return"function"==typeof(n=e.props).onUpdateConfidentiality?n.onUpdateConfidentiality(t):void 0}}(this))},_handleDismiss:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0}}),{SetConfidentialModal:c}}),define("modules/clean/sharing/settings_modal_components",["external/classnames","external/react","modules/clean/react/css","modules/core/i18n"],function(e,t,n,o){var r,i,s,a,l;return l=t.DOM,s=o.i18n_default_project("sharing")._,r=t.createClass({displayName:"SettingsModalButtons",propTypes:{disableSave:t.PropTypes.bool,isAccepting:t.PropTypes.bool,onAccept:t.PropTypes.func,onDismiss:t.PropTypes.func},render:function(){return l.div({className:"u-l-fr"},l.button({className:"confirm-button c-btn c-btn--primary",disabled:this.props.disableSave||this.props.isAccepting,onClick:this.props.onAccept},s(this.props.isAccepting?"Saving...":"Save")),l.button({className:"cancel-button c-btn c-btn--secondary u-mar-left-xs",onClick:this.props.onDismiss},s("Cancel")))}}),a=t.createClass({displayName:"SinglePolicyControl",propTypes:{canChange:t.PropTypes.bool,currentValue:t.PropTypes.string,handleOptionChange:t.PropTypes.func,options:t.PropTypes.array,policyDescription:t.PropTypes.string,policyName:t.PropTypes.string},getDefaultProps:function(){return{canChange:!0}},render:function(){var t;return l.fieldset({className:e({"settings-form-entry":!0,"settings-form-entry--no-permissions":!this.props.canChange})},l.legend({className:"settings-form-entry__explanation u-trim-margin"},this.props.policyDescription),l.div({className:"settings-form-entry__options"},function(){var e,n,o,r;for(o=this.props.options,r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push(l.label({key:t.value},l.input({checked:t.value===this.props.currentValue,className:"settings-form-entry-option-"+this.props.policyName+"__"+t.value,disabled:!this.props.canChange,name:this.props.policyName,onChange:function(e){return function(t){var n;return"function"==typeof(n=e.props).handleOptionChange?n.handleOptionChange(t.target.name,t.target.value):void 0}}(this),type:"radio",value:t.value}),t.label));return r}.call(this)))}}),i=n(a,["/static/css/sharing/settings_modal-vflzQV5gA.css"]),{SettingsModalButtons:r,SinglePolicyControl:i}}),define("modules/clean/sharing/share_modal",["external/es6-promise","external/immutable","external/react","external/underscore","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/growth/experiments/manage_shared_folders_modal","modules/clean/growth/experiments/sharing_paywall_info_modal","modules/clean/previews/util","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/pass/store","modules/clean/sharing/actions/share_modal","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/file_settings_modal","modules/clean/sharing/folder_settings_modal","modules/clean/sharing/set_confidential_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/modal_content","modules/clean/sharing/views/viewer_list_modal","modules/clean/user","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O){var R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de,pe,he,_e,me,fe,ge;return he=i.listenToStores,V=s.ManageSharedFoldersModal,oe=a.SharingPaywallInfoModal,j=l.PermissionHelper,ne=c.SharedWithActionTypes,G=u.Modal,R=h.ACCESS_LEVEL,H=h.MEMBER_ACTION,K=h.PASS_CONTROL_AVAILABILITY,re=h.TRUELINK,k=_.ContentInfo,Y=m.ShareApiClient,ie=m.TeamSharingPolicies,D=f.FilePermissions,L=f.FilePolicy,F=f.FolderPermissions,x=f.FolderPolicy,B=f.LinkMetadata,W=f.MemberCounts,$=f.SharedFileMetadata,ee=f.SharedFolderMetadata,J=f.SharedContentLinkMetadata,de=g.getCombinedPolicy,M=v.FileSettingsModal,fe=v.showFileSettingsModal,te=y.SharedFolderSettingsModal,z=E.SetConfidentialModal,X=b.SharePageActionTypes,U=w.GoldenGate,_e=w.logTiburonEvent,q=T.MODES,Z=C.ShareModalContent,se=I.ViewerListModal,ue=n.createElement,me=N.i18n_default_project("sharing"),ae=me._,ge=me.ungettext,pe=function(e){var n,r,i,s,a,l,c;return c=e.actionHandler.getSharingInfo(),l=e.actionHandler.getPassInfo(),i=l[0],r=l[1],a=l[2],s=l[3],n={actionHandler:e.actionHandler,areMembersFullyLoaded:c.areMembersFullyLoaded(),areSharingPrefsLoaded:c.areSharingPrefsLoaded(),banner:c.banner(),canChangeOptions:c.canChangeOptions(),canInviteEditor:c.canInviteEditor(),canInviteViewer:c.canInviteViewer(),canInviteViewerNoComment:c.canInviteViewerNoComment(),canMakeViewerNoComment:c.canMakeViewerNoComment(),canRelinquishMembership:c.canRelinquishMembership(),canShareLink:c.canShareLink(),canUnshareFile:c.canUnshareFile(),canUnshareFolder:c.canUnshareFolder(),canUpdateConfidentiality:c.canUpdateConfidentiality(),contactsError:c.contactsError(),contentInfo:c.contentInfo(),contentNameMessage:c.contentNameMessage(),contentNameMessageLevel:c.contentNameMessageLevel(),filePolicy:c.filePolicy(),folderPolicy:c.folderPolicy(),groupSeenStateInfo:r,hasDisplayableMembers:c.hasDisplayableMembers(),hasNonOwnerMembers:c.hasNonOwnerMembers(),hasParentSharedFolder:c.hasParentSharedFolder(),icon:c.icon(),initialRecipientRawInput:c.initialRecipientRawInput(),initialRecipientTokens:c.initialRecipientTokens(),isAddMessageAsCommentChecked:c.isAddMessageAsCommentChecked(),isAddMessageAsCommentHelpShown:c.isAddMessageAsCommentHelpShown(),isConfidentialFolder:c.isConfidentialFolder(),isContentNameFocused:c.isContentNameFocused(),isFolderInsideTeamFolderTree:c.isFolderInsideTeamFolderTree(),isLinkMetadataLoaded:c.isLinkMetadataLoaded(),isMetadataLoaded:c.isMetadataLoaded(),isNoCommentEnabledForFolders:c.isNoCommentEnabledForFolders(),isNoCommentEnabledForLinks:c.isNoCommentEnabledForLinks(),isOwner:c.isOwner(),isSharingPaywallInfoLoaded:c.isSharingPaywallInfoLoaded(),isTeamPolicyLoaded:c.isTeamPolicyLoaded(),isTeamSharedFolder:c.isTeamSharedFolder(),isTokenizerEmpty:c.isTokenizerEmpty(),isUserOnOwnerTeam:c.isUserOnOwnerTeam(),linkMetadata:c.linkMetadata(),linkOnlyReason:c.linkOnlyReason(),linkSeenStateInfo:i,memberCounts:c.memberCounts(),memberCountWithRecipients:c.memberCountWithRecipients(),members:c.members(),metadata:c.metadata(),ownerTeam:c.ownerTeam(),passFetchingStatus:s,pendingMemberAction:c.pendingMemberAction(),permissions:c.permissions(),presentAccountIds:new t.Set(a),recipientAccess:c.recipientAccess(),recipientMessage:c.recipientMessage(),recipientTokens:c.recipientTokens(),shareFolderPromise:c.shareFolderPromise(),sharingPaywallInfo:{foldersToUnshare:c.foldersToUnshare(),isInExperiment:c.isPaywallOn(),maxOwned:c.paywallMax(),numOwned:c.paywallNumOwned(),grandfatherModal:c.paywallGrandfatherModal()},shouldBlockMemberListOnPassLoad:c.shouldBlockMemberListOnPassLoad(),teamPolicy:c.teamPolicy(),uiMode:c.uiMode()},o.extend(o.extend({},c.getInitialProps()),n)},ce=n.PropTypes.shape({when_last_seen:n.PropTypes.number.isRequired,seen_state_user:n.PropTypes.shape({user_id:n.PropTypes.string.isRequired,display_name:n.PropTypes.string.isRequired,email:n.PropTypes.string,photo_circle_url:n.PropTypes.string,sharing_access_type:n.PropTypes.object}).isRequired}),le=n.createClass({displayName:"ShareModal",propTypes:{actionHandler:n.PropTypes.instanceOf(p),areMembersFullyLoaded:n.PropTypes.bool,areSharingPrefsLoaded:n.PropTypes.bool,canChangeOptions:n.PropTypes.bool,canInviteEditor:n.PropTypes.bool,canInviteViewer:n.PropTypes.bool,canInviteViewerNoComment:n.PropTypes.bool,canMakeViewerNoComment:n.PropTypes.bool,canRelinquishMembership:n.PropTypes.bool,canUnshareFile:n.PropTypes.bool,canUnshareFolder:n.PropTypes.bool,client:n.PropTypes.instanceOf(Y),contactsError:n.PropTypes.shape({level:n.PropTypes.string,message:n.PropTypes.oneOfType([n.PropTypes.string,n.PropTypes.array])}),contentInfo:n.PropTypes.instanceOf(k).isRequired,expSubgrowthBizUpsell:n.PropTypes.bool,filePolicy:n.PropTypes.instanceOf(L),folderPolicy:n.PropTypes.instanceOf(x),groupSeenStateInfo:n.PropTypes.object,hasDisplayableMembers:n.PropTypes.bool,hasNonOwnerMembers:n.PropTypes.bool,hasParentSharedFolder:n.PropTypes.bool,icon:n.PropTypes.string,initialRecipientRawInput:n.PropTypes.string,initialRecipientTokens:n.PropTypes.array,isAddMessageAsCommentChecked:n.PropTypes.bool,isAddMessageAsCommentHelpShown:n.PropTypes.bool,isMetadataLoaded:n.PropTypes.bool,isNoCommentEnabledForFolders:n.PropTypes.bool,isNoCommentEnabledForLinks:n.PropTypes.bool,isOwner:n.PropTypes.bool,isTeamSharedFolder:n.PropTypes.bool,isUserOnOwnerTeam:n.PropTypes.bool,linkMetadata:n.PropTypes.oneOfType([n.PropTypes.instanceOf(B),n.PropTypes.instanceOf(J)]),linkOnlyReason:n.PropTypes.string,linkSeenStateInfo:n.PropTypes.arrayOf(ce),memberCounts:n.PropTypes.instanceOf(W),memberCountWithRecipients:n.PropTypes.number,metadata:n.PropTypes.oneOfType([n.PropTypes.instanceOf(ee),n.PropTypes.instanceOf($)]),onDeleteLink:n.PropTypes.func,ownerTeam:n.PropTypes.shape({id:n.PropTypes.string.isRequired,name:n.PropTypes.string.isRequired}),pendingMemberAction:n.PropTypes.instanceOf(t.Set).isRequired,permissions:n.PropTypes.oneOfType([n.PropTypes.instanceOf(D),n.PropTypes.instanceOf(F)]),presentAccountIds:n.PropTypes.instanceOf(t.Set),shareFolderPromise:n.PropTypes.instanceOf(e),sharingPaywallInfo:n.PropTypes.shape({foldersToUnshare:n.PropTypes.object,isFolderOwner:n.PropTypes.bool,isInExperiment:n.PropTypes.bool,maxOwned:n.PropTypes.number,numOwned:n.PropTypes.number,onLearnMoreClick:n.PropTypes.func,onManageSharedFoldersClick:n.PropTypes.func,onUpgradeClick:n.PropTypes.func}),shouldBlockMemberListOnPassLoad:n.PropTypes.bool,teamPolicy:n.PropTypes.instanceOf(ie),user:n.PropTypes.instanceOf(P).isRequired,viewer:n.PropTypes.object,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),isInContentManager:n.PropTypes.bool,onSuccessSharing:n.PropTypes.func},getDefaultProps:function(){return{viewer:A.get_viewer()}},componentDidMount:function(){return this.client=this.props.client},componentWillUnmount:function(){return this.props.actionHandler.onShareModalUnmount(this._getTokenizer())},render:function(){var e,t;return e={headerId:"unified-share-modal-title",areCheckboxSettingsLoaded:this.props.areSharingPrefsLoaded,canMakeViewerNoComment:this.props.canMakeViewerNoComment,isLimitedTeam:this.props.viewer.team_is_limited,isPassEnabled:j.is_pass_enabled(this.props.user),onSettingsClick:this._handleSettingsClick,onLinkViewersClick:(null!=(t=this.props.linkSeenStateInfo)?t.length:void 0)?this._handleLinkViewersClick:null,onSetConfidentialClick:this._handleSetConfidentialClick,mode:this.props.uiMode,ref:"content",showContentManagerBridge:this._shouldRenderContentManagerBridge(),showPassFileSettings:this._showFileSettings(),sharingPaywallInfo:{foldersToUnshare:this.props.sharingPaywallInfo.foldersToUnshare,isFolderOwner:this.props.isOwner,isInExperiment:this.props.sharingPaywallInfo.isInExperiment,maxOwned:this.props.sharingPaywallInfo.maxOwned,numOwned:this.props.sharingPaywallInfo.numOwned,onLearnMoreClick:function(e){return function(){return e.props.actionHandler.paywallGrandfatherModalLearnMore()}}(this),onManageSharedFoldersClick:this._handleManageSharedFoldersClick,onUpgradeClick:this._handleUpgradeClick},suppressLinkUI:this._shouldSuppressLinkUI()},o.extend(e,o.omit(this.props,o.keys(e))),this._shouldShowGrandfatherModal()?this._renderSharingPaywallGrandfatherModal():ue(G,{style:"bare",acceptButtonText:null,dismissButtonText:null,headerId:"unified-share-modal-title",ref:"modal"},ue(Z,e))},_shouldSuppressLinkUI:function(){return this.props.isInContentManager&&!re.TRUELINK_UI[this.props.user.id]},_shouldShowGrandfatherModal:function(){var e,t,n,o;return(null!=(e=this.props.sharingPaywallInfo)&&null!=(t=e.grandfatherModal)?t.show:void 0)&&this.props.isOwner&&(null!=(n=this.props.sharingPaywallInfo)?n.isInExperiment:void 0)&&(null!=(o=this.props.contentInfo)?o.isFolder():void 0)},_renderSharingPaywallGrandfatherModal:function(){var e,t,n;return t=function(e){return function(){return e.props.actionHandler.paywallGrandfatherModalDismiss()}}(this),n=function(e){return function(){return e._handleManageSharedFoldersClick()}}(this),e={actionHandler:this.props.actionHandler,onDismiss:t,onManage:n,sharedFolderCount:this.props.sharingPaywallInfo.numOwned,grandfather:!this.props.sharingPaywallInfo.grandfatherModal.learnMore},ue(oe,e)},_showFileSettings:function(){return fe(this.props.user)},_refreshSharedWithColumnLinkData:function(){return r.dispatch({type:ne.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.props.contentInfo.displayPath()]}})},_handleFolderPolicySuccess:function(e,t){return r.dispatch({type:X.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,metadata:t,folderPolicy:e})},_handleLinkViewersClick:function(){return G.showInstance(ue(se,{contentInfo:this.props.contentInfo,seenStateInfo:this.props.linkSeenStateInfo,onCancel:this.props.actionHandler.openShareModal,presentAccountIds:this.props.presentAccountIds,user:this.props.user})),_e(this.props.contentInfo,this.props.user.id,"OPEN_SHARED_LINK_VIEWER_LIST_MODAL")},_getTokenizer:function(){var e;return null!=(e=this.refs.content)?e.getWrappedComponent().refs.tokenizer:void 0},_handleManageSharedFoldersClick:function(){var e;return e=function(e){return function(t,n){var o,r,i;return(null!=t?t.size:void 0)>0&&(e.props.actionHandler.onUnshareFromPaywall({foldersToUnshare:t,keepACopy:n}),i=ge("%(num_folders)s folder will be unshared","%(num_folders)s folders will be unshared",t.size).format({num_folders:t.size}),O.success(i)),(null!=(o=e.props.sharingPaywallInfo)&&null!=(r=o.grandfatherModal)?r.show:void 0)&&e.props.actionHandler.paywallGrandfatherModalDismiss(),e.props.actionHandler.openShareModal()}}(this),G.showInstance(ue(V,{maxOwned:this.props.sharingPaywallInfo.maxOwned,numOwned:this.props.sharingPaywallInfo.numOwned,user:this.props.user,onUnshare:e}))},_handleUpgradeClick:function(){return this.props.actionHandler.redirectToUpgrade()},_handleSettingsClick:function(e){return this.props.contentInfo.isFolder()?this._handleFolderSettingsClick(e):this._handleFileSettingsClick(e)},_handleFileSettingsClick:function(e){var t,n,o;return n=this.props.filePolicy,t=function(e){return function(t){return null!=t&&e.props.actionHandler.handleUpdateFilePolicy(t,n),e.props.actionHandler.openShareModal()}}(this),o=re.TRUELINK_UI[this.props.user.id]?de(this.props.filePolicy,this.props.linkMetadata):this.props.filePolicy,G.showInstance(ue(M,{fileName:this.props.contentInfo.name(),contentId:this.props.contentInfo.id,canChangeOptions:this.props.canChangeOptions,canUnshareFile:this.props.canUnshareFile,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,initialPolicy:o,isLinkSettings:e,isInContentManager:this.props.isInContentManager,linkMetadata:this.props.linkMetadata,onCancel:t,onPolicySet:t,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,updateLinkSettings:this.props.actionHandler.updateLinkSettings,user:this.props.user})),_e(this.props.contentInfo,this.props.user.id,"OPEN_FILE_SETTINGS_MODAL")},_handleFolderSettingsClick:function(e){var t,n,o,r;return n=re.TRUELINK_UI[this.props.user.id]?de(this.props.folderPolicy,this.props.linkMetadata):this.props.folderPolicy,t=function(e){return function(t,n){var o;return null!=n&&(e.props.actionHandler.handleGetMetadataSuccess(n),e._handleFolderPolicySuccess(t,n),"function"==typeof(o=e.props).onSuccessSharing&&o.onSuccessSharing(),n.policy.shared_link_policy!==e.props.folderPolicy.shared_link_policy&&(e.props.actionHandler.fetchLinkMetadata(),e._refreshSharedWithColumnLinkData())),e.props.actionHandler.openShareModal()}}(this),o=null,r=null,this.props.contentInfo.extras&&this.props.contentInfo.extras.nsId&&(o=this.props.contentInfo.extras.nsId,r=this.props.contentInfo.extras.nsPath),G.showInstance(ue(te,{actionHandler:this.props.actionHandler,folderName:this.props.contentInfo.name(),folderId:this.props.metadata.shared_folder_id,folderPath:this.props.contentInfo.displayPath(),nsId:o,nsPath:r,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,hasParentSharedFolder:this.props.hasParentSharedFolder,initialHasParentSharedFolder:this.props.hasParentSharedFolder,initialMetadata:this.props.metadata,initialOwnerTeam:this.props.ownerTeam,initialPermissions:this.props.permissions,initialPolicy:n,isInContentManager:this.props.isInContentManager,isLinkSettings:e,isSharedFolder:this.props.contentInfo.isSharedFolder(),initialIsTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isLimitedTeam:this.props.viewer.team_is_limited,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,onCancel:t,onPolicySet:t,showContentManagerBridge:this._shouldRenderContentManagerBridge(!0),teamPolicy:this.props.teamPolicy,updateLinkSettings:this.props.actionHandler.updateLinkSettings,user:this.props.user}))},_handleSetConfidentialClick:function(){var e;return e=function(e){return function(t){return t&&(e.props.actionHandler.handleGetMetadataSuccess(t),e.props.actionHandler.listMembers(t.shared_folder_id)),e.props.actionHandler.openShareModal()}}(this),G.showInstance(ue(z,{client:this.client,folderId:this.props.contentInfo.isSharedFolder()?this.props.contentInfo.sharedFolderId().toString():void 0,folderName:this.props.contentInfo.name(),folderPath:this.props.contentInfo.displayPath(),initialIsConfidentialFolder:this.props.isConfidentialFolder,onCancel:e.bind(this,null),onUpdateConfidentiality:e}))},_shouldRenderContentManagerBridge:function(e){return null==e&&(e=!1),U.hasContentManager(this.props.user.id)&&this.props.user.is_team_admin&&!this.props.isInContentManager&&(this.props.isTeamSharedFolder||e&&this.props.isFolderInsideTeamFolderTree)}}),Q=he(le,{SharingInfoStore:S,passStore:d},pe),{ShareModal:Q}}),define("modules/clean/sharing/share_modal_util",["external/react","external/underscore","modules/clean/account/email","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_folder_settings_modal","modules/clean/react/teams/modals/limited_team_share_folder_modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/content_info","modules/clean/sharing/copy_public_link_modal","modules/clean/sharing/share_modal","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/constants/env","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b){var S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q;return I=n.EmailVerification,w=r.BrowseLogger,N=i.FileTypes,S=s.BrowseContext,P=s.File,R=a.Modal,D=d.SharingApi,A=p.FileShareApiClient,O=p.FolderShareApiClient,T=h.ContentInfo,C=_.CopyPublicLinkModal,k=m.ShareModal,H=g.getNewFolderPathFromContentName,G=g.logTiburonEvent,F=e.createElement,U=function(){return Math.random()},V=function(e,n,o){var r,i,s;null==o&&(o={}),e.id||(e=y.get_viewer().get_user_by_id(e)),null==o.userHomeNs&&(o.userHomeNs=e.home_ns_id),s=q(n),t.extend(s,o),s.modalSessionId||(s.modalSessionId=U()),w.logViewShareModel({uid:e.id,modal_session_id:s.modalSessionId});try{i=T.createFromParams(s)}catch(e){i=null}return r=n instanceof S?n:s.browseContext,{browseContext:r,contentInfo:i,shareModalInfo:s,user:e}},Y=function(e,t,n){var o,r,i,s,a,l,c,d,p,h,_;return null==n&&(n={}),p=V(e,t,n),r=p.browseContext,s=p.contentInfo,_=p.shareModalInfo,e=p.user,null==s?!1:(G(s,e.id,"BEGIN_SHARE_FLOW"),
j(e,_,r)?!0:!_.skipPublicFolderCheck&&(d=B(e,s,r))?("function"==typeof K&&K(d),!0):(c=(null!=r?r.isNonUserRelativeContext:void 0)||_.isNonUserRelativeContext,I.get_for_user(e).verified_or_show()?(h=s.isFolder()?O:A,i=new h({userId:e.id}),o=new u(i,e,k),a=_.inLinksPage,l=_.prefillContacts,o.initializeShareModal({contentInfo:s,initialRecipientTokens:l,inLinksPage:a},{client:i,user:e,onDeleteLink:_.onDeleteLink,teamGroupInfo:s.teamGroupInfo(),isInContentManager:c,onSuccessSharing:_.onSuccessSharing}),o.openShareModal()):G(s,e.id,"SHARE_MODAL_EMAIL_UNVERIFIED"),!0))},j=function(e,t,n){var o;return t.isTeamSharedFolder&&y.get_viewer().team_is_limited?(!e.is_team_admin||"BROWSE_SHARED_FOLDER_BANNER"!==(o=t.origin)&&"BROWSE_GLOBAL_ACTIONS"!==o?c.showModalInstance({fqPath:t.fqPath}):l.showWithProps({folderId:t.targetNsId.toString(),folderName:n.getNameOfTargetFolder(),user:e}),!0):void 0},q=function(e){var t,n;return e instanceof P?(t=(n=e.type)===N.FILE||n===N.PACKAGE,{beaconContext:e.beacon_context,exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===N.TEAM_SHARED_FOLDER,sjid:e.sjid,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}):e instanceof S?L(e):e},L=function(e){return e.isInsideDeletedFolder||e.isInsideDeletedSharedFolder?null:e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID,isTeamSharedFolder:e.isInsideAutoTeamFolder}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}},z=function(e,t,n){var o;return null==t&&(t=null),null==n&&(n=null),t||(t=U()),o=function(){var e,t,o,r;for(e="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=o=1;100>=o;t=++o)e+=r.charAt(Math.floor(Math.random()*r.length));return H(e,n)},Y(e,{fqPath:o(),isFolder:!0,exists:!1,origin:"WIZARD",modalSessionId:t})},M=function(e){var t,n;return null!=(t=null!=e&&null!=(n=e.config)?n.publicFolderFqPath:void 0)?t:"/Public"},x=function(e,t){var n,o,r;return(null!=e?e.config.isPublicFolderEnabled:void 0)?(r=M(e),n=t.toLowerCase(),o=r.toLowerCase(),n.startsWith(o+"/")||n===o):!1},B=function(e,t,n){var o,r,i,s,a;return(null!=n?n.config:void 0)?(t instanceof T?o=t:(s=q(t),o=T.createFromParams(s)),null!=n.config.publicAppToken&&o.nsPath()?r="/spa/"+n.config.publicAppToken+o.nsPath()+"/data":x(n,o.displayPath())&&o.isFile()&&(i=M(n),r="/u/"+e.id+o.displayPath().substring(i.length)),r&&(a=String(new b({scheme:"https",authority:E.PUBSERVER,path:r}))),a):null},K=function(t){return R.showInstance(e.createElement(C,{publicLink:t}))},W=function(e,t,n){return t.is_dir&&x(n,t.fq_path)?!1:!e||t.isDeleted?!1:P.isTeamMemberFolder(t)?!1:P.canViewFileMembers(t,n)?(n.isNonUserRelativeContext,!0):!1},Q=function(e,t){var n,o;return n=new D(e),o=function(e){var n;return n=JSON.parse(e.responseText),f.showSharedContentSyncModal(n,t)},n.get_sync_vars_for_ns_id(t.ns_id,t.ns_path,o)},{fileIsInPublicFolder:x,generateModalSessionId:U,getLegacyPublicFolderShareURI:B,getShareModalInfo:q,getSharingInfo:V,isShareButtonEnabled:W,showCopyPublicLinkModal:K,showFastrakShareModalIfAllowed:j,showNewFolderShareModal:z,showSharedContentLinkSyncModal:Q,showShareModal:Y}}),define("modules/clean/sharing/share_page/action_types",["modules/clean/flux/action_type"],function(e){var t,n;return n=e.withActionNamespace,t=n("share-page",{INITIALIZE:"initialize-store",EMAIL_UNVERIFIED:"email-unverified",SWITCH_TAB:"switch-tab",SWITCH_ROLE:"switch-role",SWITCH_USER:"switch-user",LOAD_FOLDER_DATA_REQUEST:"load-folder-data-request",LOAD_FOLDER_DATA_SUCCESS:"load-folder-data-success",LOAD_FOLDER_DATA_ERROR:"load-folder-data-error",LOAD_FILE_DATA_REQUEST:"load-file-data-request",LOAD_FILE_DATA_SUCCESS:"load-file-data-success",LOAD_FILE_DATA_ERROR:"load-file-data-error",MOUNT_FOLDER_REQUEST:"mount-folder-request",MOUNT_FOLDER_SUCCESS:"mount-folder-success",MOUNT_FOLDER_ERROR:"mount-folder-error",UNMOUNT_FOLDER_REQUEST:"unmount-folder-request",UNMOUNT_FOLDER_SUCCESS:"unmount-folder-success",UNMOUNT_FOLDER_ERROR:"unmount-folder-error",UNSHARE_FOLDER_REQUEST:"unshare-folder-request",UNSHARE_FOLDER_SUCCESS:"unshare-folder-success",UNSHARE_FOLDER_ERROR:"unshare-folder-error",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_TEAM_POLICY_ERROR:"fetch-team-policy-error",FETCH_FOLDER_POLICY_SUCCESS:"fetch-folder-policy-success",FETCH_METADATA_SUCCESS:"fetch-metadata-success",RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:"relinquish-folder-membership-request",RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:"relinquish-folder-membership-success",RELINQUISH_FOLDER_MEMBERSHIP_ERROR:"relinquish-folder-membership-error",RELINQUISH_FILE_MEMBERSHIP_REQUEST:"relinquish-file-membership-request",RELINQUISH_FILE_MEMBERSHIP_SUCCESS:"relinquish-file-membership-success",RELINQUISH_FILE_MEMBERSHIP_ERROR:"relinquish-file-membership-error"}),{SharePageActionTypes:t}}),define("modules/clean/sharing/shared_content_link_sync_modal",["external/classnames","external/react","modules/clean/ajax","modules/clean/avatar/triple_avatars","modules/clean/analytics","modules/clean/avatar/avatar_with_default","modules/clean/avatar/faceholder","modules/clean/avatar/size","modules/clean/em_string","modules/clean/filepath","modules/clean/react/button","modules/clean/react/browse/models","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/constants","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/teams","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","require"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P){var A,N,O,R,k,D,L,M,F,x,U,B,H;return L=o.TripleAvatars,R=r.ShareTibEventLogger,A=a.AVATAR_DIMENSION_BY_SIZE,F=u.button,N=d.File,O=h.Modal,B=m.reactFormat,H=v.static_url,D=S.TRADEMARK_BUSINESS,M=T.i18n_default_project("sharing")._,U=t.DOM,x=t.createElement,k=t.createClass({statics:{showInstance:function(e){return O.showInstance(e)}},displayName:"SharedContentLinkSyncModal",ASK:"ask",ASKING:"asking",propTypes:{accessLevel:t.PropTypes.string.isRequired,folderName:t.PropTypes.string.isRequired,folderSize:t.PropTypes.string.isRequired,onMountSharedFolder:t.PropTypes.func.isRequired,previewCallback:t.PropTypes.func,previewUrl:t.PropTypes.string,outOfQuotaQP:t.PropTypes.string,ownerName:t.PropTypes.string,senderName:t.PropTypes.string,usageRemaining:t.PropTypes.string,usageNeeded:t.PropTypes.string,targetFile:t.PropTypes.instanceOf(N),syncNSId:t.PropTypes.string,expProSharingOverquotaModal:t.PropTypes.string,ownerProfilePhotoUrl:t.PropTypes.string,expSubgrowthBizUpsell:t.PropTypes.bool},getDefaultProps:function(){return{expSubgrowthBizUpsell:"V1"===b.SUBGROWTH_BIZ_UPSELL_VARIANT&&y.get_viewer().personal_user&&!y.get_viewer().work_user}},getInitialState:function(){return{state:this.ASK,ownerTeam:null}},componentWillMount:function(){var e,t,n,o;return o=E.start_time(),e=(new Date).getTime(),this.userId=y.get_viewer().get_users()[0].id,n=f.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL,t=this.props.targetFile?"UNMOUNTED_SEARCH_MODAL_RENDER":"SYNC_MODAL_RENDER",R.log(this.userId,t,n,{timing:e-o,ns_id:this.props.syncNSId})},_renderTopPanelIcon:function(){return this.props.targetFile?x(_,{alt:"",group:"web",name:this.props.targetFile.icon}):x(_,{alt:"",group:"web",name:"folder_user_32"})},_renderTopPanelTitle:function(){return this.props.targetFile?l.em_snippet(c.filename(this.props.targetFile.fq_path,15)):l.em_snippet(this.props.folderName,15)},_renderTopPanelSubtitle:function(){return this.props.targetFile?null!=this.props.ownerName?M("Owned by %(name)s").format({name:this.props.ownerName}):M("Not currently owned"):this.props.folderSize},_renderAccessText:function(){return this.props.expSubgrowthBizUpsell?this.state.ownerTeam?this.props.outOfQuotaQP?U.div({},U.div({className:"content-link-sync-modal__access-text u-mar-top-m"},x(L,{contacts:this.state.ownerTeam.contacts,count:this.state.ownerTeam.count})),U.div({className:"content-link-sync-modal__access-text"},M("Your Dropbox is full—join the %(team_name)s Dropbox?").format({team_name:this.state.ownerTeam.name}))):U.div({className:"content-link-sync-modal__access-text"},null!=this.props.senderName?"can_view"===this.props.accessLevel?M("%(name)s gave you access to view this folder").format({name:this.props.senderName}):M("%(name)s gave you access to edit this folder").format({name:this.props.senderName}):M("can_view"===this.props.accessLevel?"You have access to view this folder":"You have access to edit this folder")):U.div({}):U.div({className:"content-link-sync-modal__access-text"},this.props.outOfQuotaQP?M("Not enough space"):null!=this.props.senderName?"can_view"===this.props.accessLevel?M("%(name)s gave you access to view this folder").format({name:this.props.senderName}):M("%(name)s gave you access to edit this folder").format({name:this.props.senderName}):M("can_view"===this.props.accessLevel?"You have access to view this folder":"You have access to edit this folder"))},_renderSharedFolderInfo:function(){var e;return U.div({className:"content-link-sync-modal__shared-folder-info"},U.div({className:"content-link-sync-modal__shared-folder-text"},M((null!=(e=this.props.targetFile)?e.is_dir:void 0)?"This folder is part of a shared folder:":"This file is part of a shared folder:")),U.div({},x(_,{alt:"",group:"web",name:"folder_user_32"})),U.p({className:"u-font-meta"},this.props.folderName,U.br({}),this.props.folderSize))},_renderTipBody:function(){return this.props.expSubgrowthBizUpsell?this.props.outOfQuotaQP?this.state.ownerTeam?this.state.ownerTeam.contacts.length>0?M("Join %(name)s and your coworkers and get more space to work together.").format({name:this.state.ownerTeam.contacts[0].display_name}):void 0:U.img({className:"content-link-sync-modal__loader",src:H("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:M("Loading")}):this.state.state===this.ASKING?U.img({src:H("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:M("Loading")}):M("can_view"===this.props.accessLevel?this.props.targetFile?"For easy access to this file in the future, add the folder to your Dropbox.":"For easy access to this folder in the future, add it to your Dropbox.":this.props.targetFile?"To start working on this file, you need to add the folder to your Dropbox first.":"To start working on this folder, you need to add it to your Dropbox first."):this.props.outOfQuotaQP?this.props.usageRemaining?M("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have %(remaining)s of space left.").format({remaining:this.props.usageRemaining,needed:this.props.usageNeeded}):M("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have no space left.").format({needed:this.props.usageNeeded}):this.state.state===this.ASKING?U.img({src:H("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:M("Loading")}):M("can_view"===this.props.accessLevel?this.props.targetFile?"For easy access to this file in the future, add the folder to your Dropbox.":"For easy access to this folder in the future, add it to your Dropbox.":this.props.targetFile?"To start working on this file, you need to add the folder to your Dropbox first.":"To start working on this folder, you need to add it to your Dropbox first.")},render:function(){var t,n,o,r,i;return o="V1"===(r=this.props.expProSharingOverquotaModal)||"V2"===r||"V3"===r,n=e({"content-link-sync-modal":!0,"exp-subgrowth-biz-upsell":this.props.expSubgrowthBizUpsell,"content-link-sync-modal--pro-variant":o}),this.props.outOfQuotaQP&&o?(i=this.renderVariant(),t=this.renderButtonsVariant()):(i=this.renderControl(),t=this.renderButtons()),x(O,{autoClose:!1,buttonComponent:t,className:n,clickOutToClose:!1,ref:"modal",showX:!1,title:""},i)},renderControl:function(){return U.div({className:"content-link-sync-modal__content u-mar-bottom-xs"},U.div({className:"content-link-sync-modal__top-panel u-pad-s"},U.div({className:"content-link-sync-modal__icon"},this._renderTopPanelIcon()),U.div({className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},U.h3({className:"u-font-strong"},this._renderTopPanelTitle()),U.h4({className:"u-trim-margin u-font-meta"},this._renderTopPanelSubtitle())),U.div({className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},x(g,{onClick:function(e){return function(){return e.refs.modal.close()}}(this)}))),U.div({className:"content-link-sync-modal__tip-panel"},this.props.targetFile?this._renderSharedFolderInfo():this._renderAccessText(),U.div({className:"content-link-sync-modal__tip-body"},this._renderTipBody())))},renderVariant:function(){var e,t,n;return n=this.props.usageRemaining>0?B(M("To add this folder, you’ll need <strong>%(needed)s</strong> of space in your Dropbox. You currently have <span>%(remaining)s</span> of space left."),{strong:U.strong(),span:U.span({className:"content-link-sync-modal__alert"}),remaining:this.props.usageRemaining,needed:this.props.usageNeeded}):B(M("To add this folder, you’ll need <strong>%(needed)s</strong> of space in your Dropbox. You currently have no space left."),{strong:U.strong(),needed:this.props.usageNeeded}),t=null!=this.props.ownerName,U.div({className:"content-link-sync-modal--pro-variant__content u-mar-bottom-xs"},U.div({className:"content-link-sync-modal--pro-variant__close u-pad-xs u-font-right"},x(g,{onClick:function(e){return function(){return e.refs.modal.close()}}(this)})),U.div({className:"content-link-sync-modal--pro-variant__container"},U.div({className:"content-link-sync-modal--pro-variant__left-container"},"V1"===this.props.expProSharingOverquotaModal?x(p,{src:H("/static/images/pro/overquota/big-shared-folder-vflkQGYtl.svg")}):"V2"===this.props.expProSharingOverquotaModal?U.div({className:"content-link-sync-modal--pro-variant__folder-container"},x(p,{src:H("/static/images/pro/overquota/big-shared-folder-vflkQGYtl.svg")}),t?U.div({className:"avatar-img"},x(i,{dimension:A.MEDIUM,photoUrl:this.props.ownerProfilePhotoUrl,shape:"CIRCLE",defaultAvatar:x(s,{dimension:A.MEDIUM})})):void 0):"V3"===this.props.expProSharingOverquotaModal?x(p,{src:H("/static/images/pro/overquota/spot-overquota-folder-vflUsxn3C.svg")}):"V4"===this.props.expProSharingOverquotaModal?x(p,{src:H("/static/images/pro/overquota/big-shared-folder-vflkQGYtl.svg")}):void 0,U.div({className:"content-link-sync-modal--pro-variant__content"},U.div({className:"content-link-sync-modal--pro-variant__folder-name"},l.em_snippet(this.props.folderName,f.OUT_OF_QUOTA_FOLDER_NAME)),"V1"!==(e=this.props.expProSharingOverquotaModal)&&"V2"!==e&&"V3"!==e||!t?void 0:U.div({className:"content-link-sync-modal--pro-variant__owner-name"},l.em_snippet(this.props.ownerName,f.DISPLAY_NAME)))),U.div({className:"content-link-sync-modal--pro-variant__right-container"},U.div({className:"content-link-sync-modal--pro-variant__tip-title"},M("Not enough space")),U.div({className:"content-link-sync-modal--pro-variant__tip-body"},n))))},renderButtons:function(){return this.props.expSubgrowthBizUpsell?this.state.ownerTeam?U.div({className:"content-link-sync-modal__buttons u-mar-bottom-s"},this.props.outOfQuotaQP?U.div({},x(F,{importance:"primary",className:"content-link-sync-modal__request-to-join-button",disabled:this.state.state===this.ASKING,onClick:this.onRequestButtonClicked},M(this.state.ownerTeam.is_limited?"Join the team":"Request to join")),x(F,{importance:"tertiary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},M("Upgrade to add folder"))):U.div({},x(F,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},M("Add to Dropbox"))),"can_view"===this.props.accessLevel?U.div({},U.span({className:"content-link-sync-modal__or"},M("Or")),U.button({className:"content-link-sync-modal__not-now-label button-as-link",onClick:this.onPreviewButtonClicked},M(this.props.targetFile.is_dir?"preview this folder":"preview this file"))):void 0):U.div({}):U.div({className:"content-link-sync-modal__buttons u-mar-bottom-s"},x(F,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},M(this.props.outOfQuotaQP?"Upgrade to add folder":this.props.targetFile?"Add folder to Dropbox":"Add to Dropbox")),"can_view"===this.props.accessLevel?U.div({},U.span({className:"content-link-sync-modal__or"},M("Or")),U.button({className:"content-link-sync-modal__not-now-label button-as-link",onClick:this.onPreviewButtonClicked},M(!this.props.targetFile||this.props.targetFile.is_dir?"preview this folder":"preview this file"))):void 0)},renderButtonsVariant:function(){return U.div({className:"content-link-sync-modal--pro-variant__buttons"},x(F,{importance:"primary",className:"content-link-sync-modal--pro-variant__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onUpgradeButtonClicked},M("Upgrade to add folder")))},requestCallback:function(){return this.props.outOfQuotaQP?w.redirect(I({path:"/pro/buy"}).updateQuery({oqa:this.props.outOfQuotaQP})):(this.props.targetFile&&R.log(this.userId,"UNMOUNTED_SEARCH_SYNC","SYNC_MODAL",{ns_id:this.props.syncNSId}),this.props.onMountSharedFolder())},onSyncButtonClicked:function(){return this.setState({state:this.ASKING}),this.props.expSubgrowthBizUpsell&&!this.props.outOfQuotaQP&&this.state.ownerTeam&&this.state.ownerTeam.count<100?this.activateRequestModal():this.requestCallback()},onPreviewButtonClicked:function(){var e;return null!=this.props.previewCallback?(R.log(this.userId,"UNMOUNTED_SEARCH_PREVIEW","SYNC_MODAL",{ns_id:this.props.syncNSId}),this.props.previewCallback()):(e=null!=this.props.previewUrl?I.parse(this.props.previewUrl):w.get_uri().removeQuery("sm"),e.updateQuery({from_sync_modal:!0}),w.redirect(e))},onRequestButtonClicked:function(){return this.setState({state:this.ASKING}),P(["modules/clean/teams/membership_discovery_util"],function(e){return function(t){var n;return(n=t.sendTeamRequest)(e.state.ownerTeam.id,function(){return O.close()})}}(this))},activateRequestModal:function(){return this.props.expSubgrowthBizUpsell?P(["modules/clean/teams/membership_request_modal"],function(e){return function(t){var n;return n=t.MembershipRequestModal,O.showInstance(x(n,{senderName:e.props.senderName,team:e.state.ownerTeam,folderName:l.em_snippet(e.props.folderName,15),requestCallback:e.requestCallback}))}}(this)):void 0},componentDidMount:function(){return this.props.expSubgrowthBizUpsell?P(["modules/clean/teams/membership_discovery_util"],function(e){return function(t){var n;return n=t.getDiscoverableTeamForFolder,e.setState({state:e.ASKING}),n(e.props.syncNSId,function(t){return e.setState({state:e.ASK,ownerTeam:t})})}}(this)):void 0}})}),define("modules/clean/sharing/shared_content_link_sync_utils",["external/react","modules/clean/ajax","modules/clean/api_v2/root_aware_client","modules/clean/browse_interface","modules/clean/multiaccount_login","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/role_selector_modal","modules/clean/sharing/shared_content_link_sync_modal","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){var _,m,f,g,v,y,assert;return v=t.WebRequest,m=n.ApiV2RootAwareClient,f=i.FolderShareApiClient,_=s.ACCESS_LEVEL,assert=d.assert,y=p.i18n_default_project("sharing")._,g={mountSharedFolder:function(e,t,n,i,s,l){var d,p,_,m,E,b;if(null==i&&(i=!1),null==s&&(s=null),null==l&&(l=!1),t){if(!c.get_viewer().is_role_signed_in(t))return void r.show_modal({role:t,on_success:function(){return g.mountSharedFolder(e,t,n)}})}else if(c.get_viewer().is_paired)return p=function(t){return n="PREVIEW_PAGE",g.mountSharedFolder(e,t,n)},void new a(p).show();return b=c.get_viewer(),t?E=b.get_uid_by_role(t):(assert(!b.is_paired,"role can not be unspecified for paired viewer"),E=b.get_user_ids()[0]),_=y("Adding to your Dropbox..."),b.is_paired&&(b.get_user_by_id(E).is_team?(_=y("Adding to your %(team_name)s Dropbox..."),_=_.format({team_name:b.team_name})):_=y("Adding to your personal Dropbox...")),h.success(_),m=function(e){var t,n,r;return n=e,null!=s&&(n+=s.ns_path),t=c.get_viewer().get_user_by_id(E),r=o.browse_uri_for_fq_path(t,n),r.updateQuery({from_scl_sync_modal:i}),u.redirect(r)},l?v({url:"/share_action/rejoin",subject_user:E,data:{ns_id:e},success:m,error:function(){return h.error(y("We were unable to complete your request."))}}):(d=new f({userId:E}),d.mount({contentId:e,origin:n}).then(function(e){return m(e.path_lower)}).catch(function(e){return h.error(y("We were unable to complete your request."))}))},showSharedContentSyncModal:function(t,n){var o,r,i;return(null!=t?t.sync_ns_id:void 0)?(r="SYNC_MODAL",i=t.sync_owner_name||t.ownerName,o=g.mountSharedFolder.bind(null,t.sync_ns_id,t.sync_role,r,!0,n),l.showInstance(e.createElement(l,{accessLevel:t.access_level,folderName:t.sync_folder_name,folderSize:t.sync_folder_size,outOfQuotaQP:t.sync_out_of_quota_qp,usageRemaining:t.sync_usage_remaining,usageNeeded:t.sync_usage_needed,senderName:t.sync_sender_name,ownerName:i,targetFile:n,previewCallback:null!=n?u.redirect.bind(u,t.sync_preview_url):void 0,previewUrl:t.sync_preview_url,onMountSharedFolder:o,syncNSId:t.sync_ns_id,expProSharingOverquotaModal:t.expProSharingOverquotaModal,ownerProfilePhotoUrl:t.ownerProfilePhotoUrl}))):void 0},proSharingOverquotaModalExperiment:function(e,t,n,o){var r,i;return t.expProSharingOverquotaModal=o,"V1"===o||"V2"===o||"V3"===o?(r=new f({userId:n,client:new m}),i=t.nsId||t.sync_ns_id,r.listMembers({contentId:i}).then(function(e){var n,o,r,i,s,a;return r=e.users.filter(function(e){return e.access_type===_.OWNER}),1===(null!=r?r.size:void 0)?(i=r.entries().next().value,o=i[0],n=i[1],t.ownerName=null!=n&&null!=(s=n.account)?s.display_name:void 0,t.ownerProfilePhotoUrl=null!=n&&null!=(a=n.account)?a.profile_photo_url:void 0):void 0}).finally(function(){return e(t)})):e(t)}}}),define("modules/clean/sharing/sharing_settings_constants",["require","exports"],function(e,t){"use strict";t.MEMBER_POLICY="member_policy",t.ACL_UPDATE_POLICY="acl_update_policy",t.DOWNLOAD_POLICY="download_policy",t.PASS_POLICY="pass_policy",t.AUDIENCE_POLICY="audience",t.FOLDER_LINK_AUDIENCE_POLICY="shared_link_policy",t.PASSWORD_POLICY="password",t.EXPIRY_POLICY="expiry",t.DROPDOWN="dropdown",t.TOGGLE="toggle",t.PASSWORD_INPUT="password_input",t.EXPIRY_INPUT="expiry_input",t.FILE_SETTINGS="file_settings",t.FOLDER_SETTINGS="folder_settings",t.LINK_SETTINGS="link_settings"}),define("modules/clean/sharing/sharing_settings_dropdown",["require","exports","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,n,o,r){"use strict";function i(e){var t=e.customButton||n.createElement("button",{className:"c-btn c-btn--secondary sharing-settings-dropdown__button"},n.createElement("span",{className:"sharing-settings-dropdown__button-label"},e.optionsDict[e.currentValue].label),n.createElement(r,{alt:"",className:"u-l-fr",group:"web",name:"arrow-down-gray"})),i=e.valuesList.map(function(t){var i=n.createElement("span",null);return t===e.currentValue&&(i=n.createElement(r,{alt:"",group:"web",name:"check_gray"})),n.createElement(o.BubbleMenuItem,{checked:t===e.currentValue,key:t,onClick:function(){return e.onValueSelected(t)}},n.createElement("div",{className:"sharing-settings-dropdown-item"},n.createElement("div",{className:"sharing-settings-dropdown-item__left-margin"},i),n.createElement("div",{className:"sharing-settings-dropdown-item__label"},n.createElement("div",{className:"sharing-settings-dropdown-item__title"},e.optionsDict[t].label),n.createElement("div",{className:"sharing-settings-dropdown-item__description u-font-meta"},e.optionsDict[t].description))))});return n.createElement(o.BubbleMenu,{targetButton:t,targetFixed:!0,position:e.openUp?o.BubbleMenu.POSITIONS.TOP_ALIGN_RIGHT:o.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-settings-dropdown",items:i,shouldShowArrow:!1})}t.SettingDropdown=i}),define("modules/clean/sharing/sharing_settings_modal",["require","exports","tslib","external/classnames","external/react","external/underscore","modules/clean/datetime","modules/clean/em_string","modules/clean/previews/util","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/tabs/tab_nav","modules/clean/react/tabs/tab_util","modules/clean/sharing/components/button_group","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/sharing/ui_util","modules/constants/python","modules/core/i18n","modules/clean/sharing/api/types/metadata","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_constants","modules/clean/sharing/sharing_settings_util"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T){"use strict";var C=E.i18n_default_project("sharing")._,I=r.createElement,P=function(e){function t(t){var n=e.call(this,t)||this;return n.handleTogglePasswordPolicy=function(e){n.props.onOptionChange(w.PASSWORD_POLICY,{status:e}),n.setState({passwordInputDisabled:"on"===n.props.currentPolicy.get(w.PASSWORD_POLICY).status})},n.handleChangePasswordClick=function(){n.setState({passwordInputDisabled:!1})},n.state={passwordInputDisabled:!0,currentTab:t.initialTab},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=i.extend({},this.props);return t=i.extend(t,{currentTab:this.state.currentTab,onChangePasswordClick:this.handleChangePasswordClick,onTabSelected:function(t){e.setState({currentTab:t})},onTogglePasswordPolicy:this.handleTogglePasswordPolicy,passwordInputDisabled:this.state.passwordInputDisabled}),I(N,t)},t}(r.Component);t.SharingSettingsModal=P;var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getDefaultProps=function(){return{hasDisplayableMembers:!1,hasNonOwnerMembers:!1}},t.prototype.render=function(){var e;return e=this.props.isLoading?r.createElement("div",{className:"sharing-settings-modal__loading-text"},C("Loading...")):r.createElement("div",{className:"sharing-settings-modal"},this.renderHeader(),this.renderTabs(),this.renderTabContent(),r.createElement("div",{className:"sharing-settings-modal__footer"},this.renderButtons())),r.createElement(d.Modal,{altAction:this.props.altAction,style:"bare"},e)},t.prototype.renderHeader=function(){var e,t={folder_name:a.em_snippet(this.props.folderName,f.SNIPPET_SIZES.FILENAME)};return e=C("Sharing settings for “%(folder_name)s”").format(t),r.createElement("div",{className:"sharing-settings-modal__header"},r.createElement("div",{className:"sharing-settings-modal__title-row"},r.createElement("div",{className:"u-l-fr"},r.createElement(m,{onClick:function(){return d.Modal.close()}})),r.createElement("div",{className:"u-l-b"},e)))},t.prototype.renderTabs=function(){return r.createElement(p,{tabs:this.getTabs(),onChange:this.props.onTabSelected,defaultSelectedIndex:this.getDefaultIndex(),variant:h.variants.UNDERLINE})},t.prototype.getTabs=function(){var e=this,t={value:w.FILE_SETTINGS,label:C("File settings")},n={value:w.FOLDER_SETTINGS,label:C("Folder settings")},o={value:w.LINK_SETTINGS,label:C("Link settings")},r=this.props.isFolder?[n]:[t];return!this.props.isTeamSharedFolder&&this.props.linkMetadata&&r.push(o),r.filter(function(t){return e.getTabInfo(t.value).policies.length>0})},t.prototype.getDefaultIndex=function(){return this.getTabs().map(function(e){return e.value}).indexOf(this.props.currentTab)},t.prototype.renderTabContent=function(){var e=this,t=this.getTabInfo(this.props.currentTab),n=r.createElement("div",null);return t.bannerContent&&(n=r.createElement("div",{className:"sharing-settings-modal__banner u-font-center"},t.bannerContent)),r.createElement("div",null,n,r.createElement("div",{className:"sharing-settings-modal__tab-content"},r.createElement("div",{className:"tab-content-header"},r.createElement("div",{className:"tab-content-header__title"},t.title),r.createElement("div",{className:"tab-content-header__description u-font-meta"},t.description)),r.createElement("div",null,t.policies.map(function(t){var n=e.getPolicyDict(t);return e.renderPolicy(t,n)}))))},t.prototype.getLinkSettingsBannerContent=function(){return this.props.linkMetadata.link_permissions.some(function(e){return e.allow})?this.props.linkMetadata.link_permissions.set_password.reason===b.VisibilityDisallowedReason.user_account_type?this.props.user.is_team?r.createElement("a",{href:"/team/upgrade",target:"_blank"},C("Upgrade to %(trademark_business)s to enable expiration and password settings").format({trademark_business:y.TRADEMARK_BUSINESS})):r.createElement("a",{href:"/upgrade?oqa=sfp",target:"_blank"},C("Upgrade to Dropbox %(trademark_plus)s to enable expiration and password settings.").format({trademark_plus:y.TRADEMARK_PLUS})):void 0:C("You don’t have permission to modify these link settings")},t.prototype.getFolderSettingsBannerContent=function(){if(!this.props.shouldHideHeader&&this.props.isFolder){var e=C("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName});if(this.props.isInContentManager)return e;if(this.props.showContentManagerBridge){var t=v.genContentManagerBridgeUri(this.props.isLimitedTeam,this.props.folderPath);return r.createElement("div",null,e,r.createElement("div",null,C("You can change these settings in the Admin Console.")+" ",r.createElement("a",{href:t.toString(),target:"_blank"},C("Open in new tab."))))}return this.isTeamFolderTree()?r.createElement("div",null,e,r.createElement("div",null,r.createElement("a",{href:"/team",target:"_blank"},C("To edit, ask your admin.")))):this.props.permissions.change_options.allow?void 0:C("You don’t have permission to change the settings on this folder.")}},t.prototype.isTeamFolderTree=function(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree},t.prototype.getMemberPolicyQuestion=function(){return C(this.isTeamFolderTree()?"Who can be added to folders?":"Who can be invited to this folder?")},t.prototype.getAclUpdatePolicyQuestion=function(){return C(this.isTeamFolderTree()?"Who can manage access to folders?":"Who can manage access to this folder?")},t.prototype.getDownloadsPolicyDescription=function(){return C(this.isTeamFolderTree()?"Lets people download the folders. People with edit access can always download.":this.props.isFolder?"Lets people download this folder. People with edit access can always download.":"Lets people download this file. People with edit access can always download.")},t.prototype.getPassPolicyDescription=function(){return C(this.props.isFolder?"Shows who viewed the files.":"Shows who viewed the file.")},t.prototype.getFolderSettingPolicies=function(){var e=[];return Boolean(this.props.ownerTeam)&&(e.push(w.MEMBER_POLICY),e.push(w.FOLDER_LINK_AUDIENCE_POLICY)),e.push(w.ACL_UPDATE_POLICY),this.canChangePolicy(w.DOWNLOAD_POLICY)&&e.push(w.DOWNLOAD_POLICY),f.PASS_CONTROL_AVAILABILITY.SHOW_FOLDER_SETTINGS&&e.push(w.PASS_POLICY),e},t.prototype.getLinkSettingPolicies=function(){return[w.AUDIENCE_POLICY,w.EXPIRY_POLICY,w.PASSWORD_POLICY]},t.prototype.getFileSettingPolicies=function(){var e=[];return this.canChangePolicy(w.DOWNLOAD_POLICY)&&e.push(w.DOWNLOAD_POLICY),l.PermissionHelper.is_pass_enabled(this.props.user)&&e.push(w.PASS_POLICY),
e},t.prototype.canChangePolicy=function(e){return this.props.getEffectivePolicyValue(e,this.props.policyUpdate)[1]},t.prototype.getMemberPolicyTeamLabel=function(){return this.props.isLimitedTeam?C("Only people on your team"):C("Only people on your %(trademark_business)s team").format({trademark_business:y.TRADEMARK_BUSINESS})},t.prototype.getAclUpdatePolicyEditorsDescription=function(){return this.props.ownerTeam?this.props.isLimitedTeam?C("Anyone on your team with edit access can add new members and change link settings."):C("Anyone on your %(trademark_business)s team with edit access              can add new members and change link settings.").format({trademark_business:y.TRADEMARK_BUSINESS}):C("Anyone with edit access can add new members and change link settings.")},t.prototype.getPolicyDict=function(e){switch(e){case w.MEMBER_POLICY:return{title:C("Members"),description:this.getMemberPolicyQuestion(),optionsDict:{team:{label:this.getMemberPolicyTeamLabel()},anyone:{label:C("Anyone")}},optionsList:["team","anyone"],type:w.DROPDOWN};case w.ACL_UPDATE_POLICY:return{title:C("Management"),description:this.getAclUpdatePolicyQuestion(),optionsDict:{owner:{label:C(this.isTeamFolderTree()?"Only Team Admins":"Only me"),description:C(this.isTeamFolderTree()?"Only Team Admins can add new members and change link settings.":"Only you (the owner) can add new members and change link settings.")},editors:{label:C("Anyone with edit access"),description:this.getAclUpdatePolicyEditorsDescription()}},optionsList:["owner","editors"],type:w.DROPDOWN};case w.DOWNLOAD_POLICY:return{title:C("Downloads"),description:this.getDownloadsPolicyDescription(),optionsDict:{allow:{label:C("On")},disallow:{label:C("Off")}},optionsList:["allow","disallow"],type:w.TOGGLE};case w.PASS_POLICY:return{title:C("Viewer info"),description:this.getPassPolicyDescription(),optionsDict:{enabled:{label:C("On")},disabled:{label:C("Off")}},optionsList:["enabled","disabled"],type:w.TOGGLE};case w.AUDIENCE_POLICY:return{title:C("Link access"),description:C("Who can open the shared link?"),optionsDict:T.getAudienceOptionsDict(this.props.isFolder,this.props.isLimitedTeam,this.props.hasNonOwnerMembers,this.props.hasDisplayableMembers),optionsList:this.props.linkMetadata.audience_options.valueSeq().toArray(),type:w.DROPDOWN};case w.FOLDER_LINK_AUDIENCE_POLICY:if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");var t=void 0;return t=this.props.isLimitedTeam?C("Show “Only people on your team” and “Only                invited members.”"):C("Show “Only people on your %(trademark_business)s team”                and “Only invited members.”").format({trademark_business:y.TRADEMARK_BUSINESS}),{title:C("Link restrictions"),description:C("Limits who can access this folder via a link."),optionsDict:{anyone:{label:C("No restrictions"),description:C("Show all access options for links.")},team:{label:C("Team and invite-only"),description:t},members:{label:C("Invite-only"),description:C("Show “Only invited members” only.")}},optionsList:["anyone","team","members"],type:w.DROPDOWN};case w.PASSWORD_POLICY:return{title:C("Password protection"),description:C("Add a password to the shared link"),optionsDict:{on:{label:C("On")},off:{label:C("Off")}},optionsList:["on","off"],type:w.PASSWORD_INPUT};case w.EXPIRY_POLICY:return{title:C("Expiration"),description:C("Disables the shared link on a specific date"),optionsDict:{on:{label:C("On")},off:{label:C("Off")}},optionsList:["on","off"],type:w.EXPIRY_INPUT};default:throw new Error("Policy name not found")}},t.prototype.getFolderSettingsDescription=function(){return C(this.isTeamFolderTree()?"Only team admins can change these settings":this.canChangePolicy(w.ACL_UPDATE_POLICY)?"Only you (the owner) can change these settings":"Only the owner can change these settings")},t.prototype.getLinkSettingsDescription=function(){return C("owner"===this.props.currentPolicy.get(w.ACL_UPDATE_POLICY)?this.isTeamFolderTree()?"Only team admins can change these settings":this.canChangePolicy(w.AUDIENCE_POLICY)?"Only you (the owner) can change these settings":"Only the owner can change these settings":"Only editors can change these settings")},t.prototype.getTabInfo=function(e){switch(e){case w.FILE_SETTINGS:return{title:C("File settings"),bannerContent:void 0,description:"",policies:this.getFileSettingPolicies()};case w.FOLDER_SETTINGS:return{title:C("Folder settings"),bannerContent:this.getFolderSettingsBannerContent(),description:this.getFolderSettingsDescription(),policies:this.getFolderSettingPolicies()};case w.LINK_SETTINGS:return{title:C("Link settings"),bannerContent:this.getLinkSettingsBannerContent(),description:this.getLinkSettingsDescription(),policies:this.getLinkSettingPolicies()};default:throw new Error("tabName not found")}},t.prototype.renderPolicy=function(e,t){var n,i,s=this,a=t.title,l=t.description,c=t.optionsDict,u=t.optionsList,d=t.type;h=this.props.getEffectivePolicyValue(e,this.props.policyUpdate),n=h[0],i=h[1];var p;if(d===w.DROPDOWN)p=r.createElement(S.SettingDropdown,{currentValue:n,valuesList:u,optionsDict:c,onValueSelected:function(t){return s.props.onOptionChange(e,t)}});else if(d===w.TOGGLE)p=r.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(u,c),value:n,onSelectValue:function(t){return s.props.onOptionChange(e,t)}});else if(d===w.PASSWORD_INPUT)p=this.renderPasswordInput(e,n,c,u);else{if(d!==w.EXPIRY_INPUT)throw new Error("Selector type not found");p=this.renderExpiryInput(e,n,c,u)}return r.createElement("div",{className:o({policy:!0,"policy--no-permissions":!i})},r.createElement("div",{className:"policy__left"},r.createElement("div",{className:"policy__title"},a),r.createElement("div",{className:"policy__description u-font-meta"},l)),r.createElement("div",{className:"policy__selector"},p));var h},t.prototype.renderPasswordInput=function(e,t,n,o){var i=this,s=t,a=r.createElement("div",null);if("on"===s.status){var l=r.createElement("div",null);this.props.passwordInputDisabled&&this.props.linkMetadata.link_permissions.set_password.allow&&(l=r.createElement("button",{className:"password-input__change-button button-as-link",onClick:this.props.onChangePasswordClick},"Change")),a=r.createElement("div",{className:"password-input u-pad-top-s"},r.createElement("label",{for:"password-input"},"Password:"),r.createElement("br",null),r.createElement("input",{className:"c-input password-input__input",disabled:this.props.passwordInputDisabled,onChange:function(t){i.props.onOptionChange(e,{status:"on",value:t.target.value})},id:"password-input",placeholder:C("Enter a new password"),value:this.props.passwordInputDisabled?123456:s.value||"",type:"password"}),l)}return r.createElement("div",null,r.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(o,n),value:s.status,onSelectValue:this.props.onTogglePasswordPolicy}),a)},t.prototype.renderExpiryInput=function(e,t,n,o){var i=this,a=t,l=r.createElement("div",null),u=s.daysAfterToday(30);return"on"===a.status&&(l=r.createElement("div",{className:"u-pad-top-s"},r.createElement("div",null,C("Link deactivates on:")),r.createElement(c.Calendar,{alignAtLeft:!1,disabled:!this.props.linkMetadata.link_permissions.set_expiry.allow,firstDay:s.daysAfterToday(1),initDate:a.value?new Date(a.value):u,lastDay:s.daysAfterToday(365),onDateChange:function(t){return i.props.onOptionChange(e,{status:"on",value:t})}}))),r.createElement("div",null,r.createElement(_.ButtonGroup,{options:this.getButtonGroupOptions(o,n),value:a.status,onSelectValue:function(t){i.props.onOptionChange(e,{status:t,value:a.value||u})}}),l)},t.prototype.getButtonGroupOptions=function(e,t){return e.map(function(e){return{value:e,label:t[e].label}})},t.prototype.renderButtons=function(){var e;if(this.props.permissions.unshare.allow&&(this.props.isSharedFolder||!this.props.isFolder)){var t=void 0;t=C(this.props.isFolder?this.props.isFolderInsideTeamFolderTree?"Reset membership":"Unshare folder":"Unshare file"),e=r.createElement("div",{className:"u-l-fl"},r.createElement("button",{className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.onUnshare},t))}return r.createElement("div",{className:"clearfix sharing-settings-modal__buttons"},e,r.createElement(g.SettingsModalButtons,{disableSave:!this.props.policyUpdate||0===i.keys(this.props.policyUpdate).length,isAccepting:this.props.isSubmitting,onAccept:this.props.onSaveSettings,onDismiss:this.props.onDismiss}))},t}(r.Component);t.SharingSettingsModalContentsView=A;var N=u(A,["/static/css/sharing/settings_modal-vflzQV5gA.css"])}),define("modules/clean/sharing/sharing_settings_util",["require","exports","modules/clean/sharing/sharing_settings_constants","modules/constants/python","modules/core/i18n"],function(e,t,n,o,r){"use strict";var i=r.i18n_default_project("sharing")._;t.canChangePolicy=function(e,t,o,r,i,s){switch(e){case n.AUDIENCE_POLICY:return r&&r.link_permissions.change_audience.allow;case n.PASSWORD_POLICY:return r&&"members"!==o.get(n.AUDIENCE_POLICY)&&(r.link_permissions.set_password.allow||r.link_permissions.remove_password.allow&&"off"!==t.get(n.PASSWORD_POLICY).status);case n.EXPIRY_POLICY:return r&&"members"!==o.get(n.AUDIENCE_POLICY)&&(r.link_permissions.set_expiry.allow||r.link_permissions.remove_expiry.allow&&"off"!==t.get(n.EXPIRY_POLICY).status);case n.DOWNLOAD_POLICY:return!i||s?!1:"allow"===t.get(n.DOWNLOAD_POLICY)?i.set_download_policy&&i.set_download_policy.allow:i.remove_download_policy&&i.remove_download_policy.allow;case n.PASS_POLICY:return!i||s?!1:"enabled"===t.get(n.PASS_POLICY)?i.disable_pass&&i.disable_pass.allow:i.enable_pass&&i.enable_pass.allow;default:throw new Error("Link policy not found")}},t.isCommonSharingSettingsPolicy=function(e){return-1!==[n.AUDIENCE_POLICY,n.DOWNLOAD_POLICY,n.EXPIRY_POLICY,n.PASS_POLICY,n.PASSWORD_POLICY].indexOf(e)},t.getAudienceOptionsDict=function(e,t,n,r){var s=r&&!n;return{public:{label:i("Anyone with the link"),description:i(e?"Anyone who has the link can access this folder.":"Anyone who has the link can access this file.")},team:{label:t?i("Only people on your team"):i("Only people on your %(trademark_business)s team").format({trademark_business:o.TRADEMARK_BUSINESS}),description:i("Only people in your company can use the link.")},members:{label:i(s?"Only you":"Only invited members"),description:i(s?"Only you can use the link":"Only invited members can use the link.")}}}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/signup_modal_proxy",["external/es6-promise"],function(e){var t,n;return t=e.Promise,new(n=function(){function e(){this.signup=bind(this.signup,this),this._defaultModalSignupPromiseResolver=bind(this._defaultModalSignupPromiseResolver,this),this.signupForDirectDownload=bind(this.signupForDirectDownload,this),this._directDownloadSignupPromiseResolver=bind(this._directDownloadSignupPromiseResolver,this),this.disconnectModal=bind(this.disconnectModal,this),this.connectModal=bind(this.connectModal,this),this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null}return e.prototype.connectModal=function(e){return this._signupModal=e},e.prototype.disconnectModal=function(){return this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null},e.prototype._directDownloadSignupPromiseResolver=function(e,t){var n,o;return o=function(t){return function(){return t._directDownloadPromise=null,e()}}(this),n=function(e){return function(){return e._directDownloadPromise=null,t()}}(this),this._signupModal.handle_direct_download(o),this._signupModal.handle_direct_download_cancel(n)},e.prototype.signupForDirectDownload=function(){var e;return null==this._signupModal?t.resolve():(null==this._directDownloadPromise&&(this._directDownloadPromise=new t(this._directDownloadSignupPromiseResolver)),e=this._directDownloadPromise,this._signupModal.on_request_direct_download(),e)},e.prototype._defaultModalSignupPromiseResolver=function(e,t){var n,o;return n=function(t){return e(t)},o=function(e){return function(){return e._defaultModalPromise=null,t()}}(this),this._signupModal.handle_default_modal_authenticate(n),this._signupModal.handle_default_modal_cancel(o),this._signupModal.on_request_default_signup()},e.prototype.signup=function(){return null==this._signupModal?t.reject():(null==this._defaultModalPromise&&(this._defaultModalPromise=new t(this._defaultModalSignupPromiseResolver)),this._defaultModalPromise)},e}())});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/sharing/stores/sharing_info",["external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/core/exception"],function(e,t,n,o,r,i,s,a,l,c,u){var d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,assert,D,L,M,F,x,U,B,H,q;return L=t.file_icon,M=t.folder_icon,I=o.SharingActionTypes,T=o.ShareModalActionTypes,w=r.ShareApiClient,f=r.FileShareApiClient,g=r.FolderShareApiClient,m=i.FilePolicy,b=i.PassPolicy,S=i.PermissionSetting,B=i.makeMemberKey,E=i.MemberCounts,C=i.SharedContentLinkMetadata,O=i.SharingPrefs,k=i.UserMembershipInfo,d=s.ACCESS_LEVEL,R=s.TRUELINK,F=a.getContentIdsForMetadata,q=l.validateContacts,U=l.getNewFolderPathFromContentName,x=l.getMemberCountForTokens,y=c.MODES,p=c.BANNERS,_=c.CONTENT_NAME_MESSAGE_LEVELS,h=c.CONTENT_NAME_EMPTY_TOOLTIP,v=c.LINK_ONLY_REASON,assert=u.assert,D=function(e,t){return t=String(t),t.startsWith("id:")||(t=t.toLowerCase()),e+"::"+t},A=function(e){function t(){return this._mapContentIdsToSharingInfo=bind(this._mapContentIdsToSharingInfo,this),this.getSharingInfo=bind(this.getSharingInfo,this),t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype._init=function(){return this.sharingInfoMap={}},t.prototype.getSharingInfo=function(e,t){return t?this.sharingInfoMap[D(e,t)]:null},t.prototype._mapContentIdsToSharingInfo=function(e,t,n){var o,r,i,s;for(s=[],r=0,i=t.length;i>r;r++)o=t[r],o?s.push(this.sharingInfoMap[D(e,o)]=n):s.push(void 0);return s},t.prototype._new_payload=function(e){var t,n,o;switch(null!=e&&null!=(t=e.action)?t.type:void 0){case I.CLEAR_EVERYTHING:return this.sharingInfoMap={};case I.FETCH_METADATA_BATCH_SUCCESS:return o=e.action.user,e.action.data.forEach(function(e){return function(t){return e._new_payload_for_single_content(T.FETCH_METADATA_SUCCESS,o,F(t),{metadata:t})}}(this)),this.emit_change();default:if(!(null!=e&&null!=(n=e.action)?n.contentIds:void 0))return;if(this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data))return this.emit_change()}},t.prototype._new_payload_for_single_content=function(e,t,n,o){var r,i,s,a,l;for(assert(t.id,"valid user needed"),assert(n.length>0,"contentIds cannot be empty"),l=null,i=0,a=n.length;a>i;i++)if(r=n[i],s=D(t.id,r),s in this.sharingInfoMap){l=this.sharingInfoMap[s];break}return l||(l=new P(t)),this._mapContentIdsToSharingInfo(t.id,n,l),l._new_payload(e,o)},t}(n),P=function(){function e(e){this._areMembersFullyLoaded=!1,this._areSharingPrefsLoaded=!1,this._hasDisplayableMembers=!1,this._initialProps=null,this._fetchingMembersRequest=null,this._fetchingMetadataPromise=null,this._isLinkMetadataLoaded=!1,this._isTeamPolicyLoaded=!1,this._isUpdatingLinkAudience=!1,this._linkMetadata=null,this._memberCounts=null,this._members=null,this._metadata=null,this._modalInfo=null,this._shareFolderPromise=null,this._sharingPrefs=new O,this._sharingPaywallInfo=null,this._shouldBlockMemberListOnPassLoad=!0,this._teamPolicy=null,this._user=e}return e.prototype._new_payload=function(e,t){var n,o,r,i,s,a,l;switch(e){case T.CHANGE_LINK_AUDIENCE_REQUEST:r=this._metadata,this._linkMetadata||(r=this._metadata.set("link_metadata",new C)),r=r.setIn(["link_metadata","current_audience"],t.newAudience),this._setMetadata(r),this._isUpdatingLinkAudience=!0;break;case T.CHANGE_LINK_AUDIENCE_FAILURE:this._isUpdatingLinkAudience=!1,this._setMetadata(this._metadata.setIn(["link_metadata","current_audience"],t.prevAudience));break;case T.CHANGE_LINK_AUDIENCE_SUCCESS:this._isUpdatingLinkAudience=!1,this._setMetadata(t.metadata);break;case T.CHANGE_MEMBER_ACCESS_FAILURE:n=t.member,this._members=this._members.setIn([n.type(),n.memberKey(),"access_type"],t.prevAccess);break;case T.CHANGE_MEMBER_ACCESS_REQUEST:n=t.member,this._members=this._members.setIn([n.type(),n.memberKey(),"access_type"],t.newAccess);break;case T.CHANGE_RECIPIENTS:this._modalInfo._recipientTokens=t.recipientTokens,this._modalInfo._recipientRawInput=t.recipientRawInput,i=null,t.recipientTokens.length>0||t.recipientRawInput.length>0?this.uiMode()===y.MEMBERSHIP&&(i=y.SHARE):this.uiMode()===y.SHARE&&(i=y.MEMBERSHIP),i&&(this._modalInfo._uiMode=i);break;case T.CHANGE_RECIPIENT_ACCESS:this._modalInfo._recipientAccess=t.newAccess;break;case T.CHANGE_RECIPIENT_MESSAGE:this._modalInfo._recipientMessage=t.message;break;case T.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:this._members=this._members.update("users",function(e){return e.map(function(e){return e.set("time_last_seen",null)})});break;case T.CLEAR_UNSHARE_FROM_PAYWALL:this._sharingPaywallInfo.foldersToUnshare=[],this._sharingPaywallInfo.keepACopy=null;break;case T.CREATE_LINK_SUCCESS:this._linkMetadata=t.linkMetadata;break;case T.FETCH_MEMBER_COUNTS_SUCCESS:this._memberCounts=t.memberCounts;break;case T.FETCH_METADATA_FAILURE:this._fetchingMetadataPromise=null,this._modalInfo&&(this._modalInfo._uiMode=y.LINK_ONLY,this._modalInfo._linkOnlyReason!==v.LINKS_PAGE&&(this._modalInfo._linkOnlyReason=t.reason));break;case T.FETCH_METADATA_REQUEST:this._fetchingMetadataPromise=t.promise;break;case T.FETCH_METADATA_SUCCESS:this._fetchingMetadataPromise=null,this._setMetadata(t.metadata);break;case T.FETCH_SHARING_PREFS_REQUEST:this._areSharingPrefsLoaded=!1;break;case T.FETCH_SHARING_PREFS_SUCCESS:this._areSharingPrefsLoaded=!0,this._sharingPrefs=t.sharingPrefs;break;case T.FETCH_SHARING_PAYWALL_INFO_REQUEST:this._modalInfo._isSharingPaywallInfoLoaded=!1;break;case T.FETCH_SHARING_PAYWALL_INFO_SUCCESS:this._modalInfo._isSharingPaywallInfoLoaded=!0,this._sharingPaywallInfo=t.sharingPaywallInfo;break;case T.FETCH_LINK_METADATA_FAILURE:this._isLinkMetadataLoaded=!0,this._linkMetadata=null;break;case T.FETCH_LINK_METADATA_SUCCESS:this._isLinkMetadataLoaded=!0,this._linkMetadata=t.linkMetadata;break;case T.FETCH_USER_ACCOUNTS_REQUEST:this._fetchingMembersRequest={limitNonNull:t.limitNonNull,promise:t.promise,requestId:t.requestId};break;case T.FETCH_USER_ACCOUNTS_SUCCESS:if(t.requestId!==(null!=(s=this._fetchingMembersRequest)?s.requestId:void 0))return!1;if(this._hasDisplayableMembers&&(null!=(a=this._fetchingMembersRequest)?a.limitNonNull:void 0)<this._members.count())return;this._hasDisplayableMembers=!0,t.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=null),this._members=t.members;break;case T.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:if(t.requestId!==(null!=(l=this._fetchingMembersRequest)?l.requestId:void 0))return!1;t.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=null),this._members=this._members.mergeDeep(t.members);break;case T.FETCH_TEAM_POLICY_REQUEST:this._isTeamPolicyLoaded=!1;break;case T.FETCH_TEAM_POLICY_SUCCESS:this._isTeamPolicyLoaded=!0,this._teamPolicy=t.teamPolicy;break;case T.FETCH_FILE_MEMBER_COUNT_SUCCESS:this._memberCounts=new E({total_unique_users:t.count,users_outside_team:0,exceeds_count:t.exceeds_limit});break;case T.HANDLE_CONTENT_NAME_CHANGE:""===t.name?(this._modalInfo._contentNameMessage=h,this._modalInfo._contentNameMessageLevel=_.INFO):(this._modalInfo._contentNameMessage=null,this._modalInfo._contentNameMessageLevel=_.INFO);break;case T.HANDLE_CONTENT_NAME_FOCUS_CHANGE:this._modalInfo._isContentNameFocused=t.focus;break;case T.MEMBER_ACTION_COMPLETE:this._modalInfo._pendingMemberAction=this._modalInfo._pendingMemberAction.delete(t.member.memberKey());break;case T.MEMBER_ACTION_PENDING:this._modalInfo._pendingMemberAction=this._modalInfo._pendingMemberAction.add(t.member.memberKey());break;case T.REMOVE_MEMBER_KEEP_ACCESS:n=t.member,this._members=this._members.setIn([n.type(),n.memberKey(),"access_type"],t.access),this._modalInfo._pendingMemberAction=this._modalInfo._pendingMemberAction.delete(n.memberKey());break;case T.REMOVE_MEMBER_SUCCESS:n=t.member,this._members=this._members.deleteIn([n.type(),n.memberKey()]),this._modalInfo._pendingMemberAction=this._modalInfo._pendingMemberAction.delete(n.memberKey());break;case T.SEND_SHARE_FAILURE:this._modalInfo._uiMode=y.SHARE;break;case T.SEND_SHARE_REQUEST:this._modalInfo._uiMode=y.SHARE_SENDING;break;case T.SEND_SHARE_SUCCESS:this._modalInfo._uiMode=y.SHARE;break;case T.SET_COMMENT_CHECKBOX_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_checked",t.checked);break;case T.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_help_shown",!1);break;case T.PAYWALL_GRANDFATHER_MODAL_DISMISS:this._sharingPaywallInfo.grandfather_modal.show=!1;break;case T.PAYWALL_GRANDFATHER_MODAL_LEARN_MORE:this._sharingPaywallInfo.grandfather_modal.learnMore=!0,this._sharingPaywallInfo.grandfather_modal.show=!0;break;case T.SHARE_FOLDER_FAILURE:this._shareFolderPromise=null;break;case T.SHARE_FOLDER_REQUEST:this._shareFolderPromise=t.promise;break;case T.SHARE_FOLDER_SUCCESS:this._setMetadata(t.metadata),this._shareFolderPromise=null;break;case T.SHARE_MODAL_CLOSE:this._modalInfo._initialRecipientTokens=t.tokens||[],this._modalInfo._initialRecipientRawInput=t.value||"";break;case T.SHARE_MODAL_OPEN:this._handleShareModalOpen(t);break;case T.TRANSFER_OWNER_SUCCESS:this._metadata=null,this._isLinkMetadataLoaded=!1,this._hasDisplayableMembers=!1;break;case T.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:this._shouldBlockMemberListOnPassLoad=!1;break;case T.UNSHARE_FROM_PAYWALL:this._sharingPaywallInfo.num_shared_folders_owned-=t.foldersToUnshare.size,this._sharingPaywallInfo.foldersToUnshare=t.foldersToUnshare,this._sharingPaywallInfo.keepACopy=t.keepACopy;break;case T.UPDATE_BANNER:this._modalInfo._banner=t.banner;break;case T.VALIDATE_CONTENT_NAME_ERROR:this._modalInfo._contentNameMessage=t.errorMsg,this._modalInfo._contentNameMessageLevel=_.ERROR;break;case T.VALIDATE_CONTENT_NAME_SUCCESS:o=U(t.contentName,this._user.cdm_tmf_path),this._modalInfo._contentInfo=this._modalInfo._contentInfo.setFQPath(o),H._mapContentIdsToSharingInfo(this._user.id,[o],this);break;default:return!1}return!0},e.prototype._handleShareModalOpen=function(e){return this._modalInfo=new N(e.shareModalInfo.contentInfo),this._modalInfo._initialRecipientTokens=e.shareModalInfo.initialRecipientTokens||[],this._initialProps=e.initialProps,e.shareModalInfo.inLinksPage&&(this._modalInfo._uiMode=y.LINK_ONLY,this._modalInfo._linkOnlyReason=v.LINKS_PAGE),this._modalInfo._icon=this._calcIcon(),this._areMembersFullyLoaded=!1},e.prototype._calcIcon=function(){var e,t,n;return this.isFolder()?this.contentInfo().pathExists()?(e=(null!=(t=this._metadata)&&null!=(n=t.permissions.edit_contents)?n.allow:void 0)===!1,M({isTeamFolder:this.isTeamSharedFolder(),isShared:this.contentInfo().isSharedFolder(),isViewOnly:e,isInTeamFolderTree:this.isFolderInsideTeamFolderTree()})):"folder_user_32":L(this.contentInfo().name())+"_32"},e.prototype._setMetadata=function(e){var t,n;return R.TRUELINK_UI[this._user.id]&&(this._isUpdatingLinkAudience&&(e=e.setIn(["link_metadata","current_audience"],this._linkMetadata.current_audience)),this._isLinkMetadataLoaded=!0,e.link_metadata&&(this._linkMetadata=e.link_metadata)),t=e.permissions||(null!=(n=this._metadata)?n.permissions:void 0),this._metadata=e.set("permissions",t),null!=this._modalInfo&&(null!=e.shared_folder_id&&(this._modalInfo._contentInfo=this._modalInfo._contentInfo.setNsId(e.shared_folder_id)),this._modalInfo._icon=this._calcIcon()),H._mapContentIdsToSharingInfo(this._user.id,F(e),this)},e.prototype._isViewerNoCommentEnabled=function(){return this.isFolder()?this.isNoCommentEnabledForFolders():this.isNoCommentEnabledForLinks()},e.prototype.hasNonOwnerMembers=function(){var e,t,n;return e=null!=(n=this._members)?n.getMemberCount():void 0,e?1===e&&1===this._members.users.count()?(t=this._members.users.first(),t.account_id!==this._user.account_id):!0:!1},e.prototype.memberCountWithRecipients=function(){var e,t,n;return e=(null!=(t=this.memberCounts())?t.total_unique_users:void 0)||(null!=(n=this.members())?n.getMemberCount():void 0)||0,e+x(this.recipientTokens())},e.prototype.getInitialProps=function(){return this._initialProps},e.prototype.areMembersFullyLoaded=function(){return this._areMembersFullyLoaded},e.prototype.areSharingPrefsLoaded=function(){return this._areSharingPrefsLoaded},e.prototype.banner=function(){return this._modalInfo._banner},e.prototype.canChangeOptions=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.change_options)?t.allow:void 0)},e.prototype.canInviteEditor=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.invite_editor)?t.allow:void 0)},e.prototype.canInviteViewer=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.invite_viewer)?t.allow:void 0)},e.prototype.canInviteViewerNoComment=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.invite_viewer_no_comment)?t.allow:void 0)&&this._isViewerNoCommentEnabled()},e.prototype.canMakeViewerNoComment=function(){return this._isViewerNoCommentEnabled()},e.prototype.canRelinquishMembership=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.relinquish_membership)?t.allow:void 0)},e.prototype.canShareLink=function(){return!this.isTeamSharedFolder()&&this.contentInfo().pathExists()},e.prototype.canUnshareFile=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.unshare)?t.allow:void 0)},e.prototype.canUnshareFolder=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.unshare)?t.allow:void 0)},e.prototype.canUpdateConfidentiality=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.update_confidentiality)?t.allow:void 0)},e.prototype.contactsError=function(){return q(this.recipientTokens(),this._user,this.ownerTeam(),this.folderPolicy(),this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients())},e.prototype.contentId=function(){return this._modalInfo._contentInfo.id},e.prototype.contentInfo=function(){return this._modalInfo._contentInfo},e.prototype.contentNameMessage=function(){return this._modalInfo._contentNameMessage},e.prototype.contentNameMessageLevel=function(){return this._modalInfo._contentNameMessageLevel},e.prototype.fetchingMembersRequest=function(){return this._fetchingMembersRequest},e.prototype.fetchingMetadataPromise=function(){return this._fetchingMetadataPromise},e.prototype.filePolicy=function(){var e;return null!=(e=this._metadata)?e.file_policy:void 0},e.prototype.folderPolicy=function(){var e;return null!=(e=this._metadata)?e.policy:void 0},e.prototype.foldersToUnshare=function(){var e;return null!=(e=this._sharingPaywallInfo)?e.foldersToUnshare:void 0},e.prototype.fqPath=function(){return this._modalInfo._contentInfo.displayPath()},e.prototype.hasDisplayableMembers=function(){return this._hasDisplayableMembers},e.prototype.hasParentSharedFolder=function(){var e;return null!=(e=this._metadata)?e.is_inside_team_folder:void 0},e.prototype.icon=function(){return this._modalInfo._icon},e.prototype.initialRecipientRawInput=function(){return this._modalInfo._initialRecipientRawInput},e.prototype.initialRecipientTokens=function(){return this._modalInfo._initialRecipientTokens},e.prototype.isAddMessageAsCommentChecked=function(){return Boolean(this._sharingPrefs.add_message_as_comment_checked)},e.prototype.isAddMessageAsCommentHelpShown=function(){return Boolean(this._sharingPrefs.add_message_as_comment_help_shown)},e.prototype.isNoCommentEnabledForFolders=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_shared_folders)},e.prototype.isNoCommentEnabledForLinks=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_content_links)},e.prototype.isNonUserRelativeContext=function(){return this.getInitialProps().isInContentManager},e.prototype.isFolder=function(){return this._modalInfo._contentInfo.isFolder()},e.prototype.isConfidentialFolder=function(){var e;return Boolean(null!=(e=this._metadata)?e.is_confidential:void 0)},e.prototype.isContentNameFocused=function(){return this._modalInfo._isContentNameFocused},e.prototype.isFolderInsideTeamFolderTree=function(){var e;return null!=(e=this._metadata)?e.is_inside_team_folder:void 0},e.prototype.isInsideSharedFolder=function(){var e;return Boolean(null!=(null!=(e=this._metadata)?e.parent_shared_folder_id:void 0)||this.contentInfo().isInSharedFolder())},e.prototype.isLinkMetadataLoaded=function(){return this._isLinkMetadataLoaded},e.prototype.isMetadataLoaded=function(){return null!=this._metadata},e.prototype.isOwner=function(){var e;return Boolean((null!=(e=this._metadata)?e.access_type:void 0)===d.OWNER)},e.prototype.isPaywallOn=function(){var e;return Boolean(null!=(e=this._sharingPaywallInfo)?e.is_on:void 0)},e.prototype.isUserOnOwnerTeam=function(){var e,t;return Boolean((null!=(e=this._metadata)&&null!=(t=e.owner_team)?t.id:void 0)===this._user.team_dbtid)},e.prototype.isTeamPolicyLoaded=function(){return this._isTeamPolicyLoaded},e.prototype.isTeamSharedFolder=function(){var e;return Boolean((null!=(e=this._metadata)?e.is_team_folder:void 0)||this.contentInfo().isTeamSharedFolder())},e.prototype.isTokenizerEmpty=function(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length},e.prototype.isSharingPaywallInfoLoaded=function(){return this._modalInfo._isSharingPaywallInfoLoaded},e.prototype.isUpdatingLinkAudience=function(){return this._isUpdatingLinkAudience},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.linkOnlyReason=function(){return this._modalInfo._linkOnlyReason},e.prototype.memberCounts=function(){return this._memberCounts},e.prototype.members=function(){return this._members},e.prototype.metadata=function(){return this._metadata},e.prototype.ownerTeam=function(){var e;return null!=(e=this._metadata)?e.owner_team:void 0},e.prototype.parentSharedFolderId=function(){var e;return null!=(e=this._metadata)?e.parent_shared_folder_id:void 0},e.prototype.paywallKeepACopy=function(){var e;return Boolean(null!=(e=this._sharingPaywallInfo)?e.keepACopy:void 0)},e.prototype.paywallMax=function(){var e;return null!=(e=this._sharingPaywallInfo)?e.max_owned_shared_folders:void 0},e.prototype.paywallNumOwned=function(){var e;return null!=(e=this._sharingPaywallInfo)?e.num_shared_folders_owned:void 0},e.prototype.paywallGrandfatherModal=function(){var e;return null!=(e=this._sharingPaywallInfo)?e.grandfather_modal:void 0},e.prototype.pendingMemberAction=function(){return this._modalInfo._pendingMemberAction},e.prototype.permissions=function(){var e;return null!=(e=this._metadata)?e.permissions:void 0},e.prototype.recipientAccess=function(){return this._modalInfo._recipientAccess},e.prototype.recipientMessage=function(){return this._modalInfo._recipientMessage},e.prototype.recipientRawInput=function(){return this._modalInfo._recipientRawInput},e.prototype.recipientTokens=function(){return this._modalInfo._recipientTokens},e.prototype.shareFolderPromise=function(){return this._shareFolderPromise;
},e.prototype.shouldBlockMemberListOnPassLoad=function(){return this._shouldBlockMemberListOnPassLoad},e.prototype.teamPolicy=function(){return this._teamPolicy},e.prototype.uiMode=function(){return this._modalInfo._uiMode},e}(),N=function(){function t(t){this._banner=p.NO_MEMBERS,this._canRelinquishMembership=!1,this._contentInfo=t,this._contentNameMessage=t.pathExists()?null:h,this._contentNameMessageLevel=_.INFO,this._icon=null,this._initialRecipientRawInput="",this._initialRecipientTokens=[],this._isContentNameFocused=t.pathExists(),this._isSharingPaywallInfoLoaded=!1,this._linkOnlyReason=null,this._pendingMemberAction=new e.Set,this._recipientAccess=this._contentInfo.isFolder()?d.WRITER:d.READER,this._recipientMessage="",this._recipientRawInput="",this._recipientTokens=[],this._uiMode=y.MEMBERSHIP}return t}(),H=new A}),define("modules/clean/sharing/stores/sharing_info_util",["require","exports"],function(e,t){"use strict";t.getContentIdsForMetadata=function(e){return[e.shared_folder_id,e.id,e.path_lower].filter(Boolean)},t.getContentIdsForContentInfo=function(e){var t=[];return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push("ns:"+e.nsId()+e.nsPath())),e.displayPath()&&t.push(e.displayPath()),t}}),define("modules/clean/sharing/strings",["modules/clean/sharing/constants","modules/core/i18n"],function(e,t){var n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g;return n=e.ACCESS_LEVEL,i=e.MEMBER_ACTION,d=t.i18n_default_project("sharing")._,p={},p[""+n.OWNER]=d("Owner"),p[""+n.WRITER]=d("Can edit"),p[""+n.READER]=d("Can view"),p[""+n.READER_NO_COMMENT]=d("View-only"),o=p,h={},h[""+n.OWNER]=d("Owner"),h[""+n.WRITER]=d("Can edit"),h[""+n.READER]=d("Can comment"),h[""+n.READER_NO_COMMENT]=d("Can view"),r=h,_={},_[""+i.MAKE_EDITOR]=d("People can edit, delete, comment, and add the file to their Dropbox"),_[""+i.MAKE_VIEWER]=d("People can view, download, and comment"),_[""+i.MAKE_VIEWER_NO_COMMENT]=d("People can only view and download the files"),l=_,m={},m[""+i.MAKE_EDITOR]=d("People can edit, delete, comment, and add the files to their Dropbox"),m[""+i.MAKE_VIEWER]=d("People can view, download, and comment"),m[""+i.MAKE_VIEWER_NO_COMMENT]=d("People can only view and download the file"),s=m,f={},f[""+i.MAKE_EDITOR]=d("Lets them view, comment, and edit."),f[""+i.MAKE_VIEWER]=d("Lets them view and comment, but not edit."),f[""+i.MAKE_VIEWER_NO_COMMENT]=d("Lets them view only. They can’t see comments."),c=f,g={},g[""+i.MAKE_EDITOR]=d("Lets them view, comment, and edit."),g[""+i.MAKE_VIEWER]=d("Lets them view and comment, but not edit."),g[""+i.MAKE_VIEWER_NO_COMMENT]=d("Lets them view only. They can’t see comments."),a=g,u={ACCESS_NAME:o,ACCESS_NAME_NO_COMMENT:r,MEMBER_ACTION_FOLDER:l,MEMBER_ACTION_FILE:s,MEMBER_ACTION_FOLDER_NO_COMMENT:c,MEMBER_ACTION_FILE_NO_COMMENT:a}}),define("modules/clean/sharing/ui_util",["external/react","external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/filepath","modules/clean/previews/util","modules/clean/react_format","modules/clean/react/browse/store","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/constants/python","modules/core/i18n","modules/core/notify","modules/core/uri","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g){var v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se;return O=o.ShareTibEventLogger,y=r.AppError,w=i.ContactTokenState,G=a.file_icon,j=a.folder_icon,P=a.ICON_SIZES,ee=a.normalize,te=a.parent_dir,A=l.PermissionHelper,ne=c.reactFormat,E=u.BrowseStore,I=d.GroupMembershipInfo,v=p.ACCESS_LEVEL,T=p.GOLDEN_GATE,k=h.TRADEMARK_PLUS,V=e.DOM,oe=_.i18n_default_project("sharing"),D=oe._,re=oe.ungettext,C={canActOnInheritedMembers:function(e){return T.CAN_ACT_ON_INHERITED_MEMBERS[e]},canDeepNest:function(e){return T.CAN_DEEP_NEST[e]},canSetFolderConfidential:function(e){return T.CAN_SET_FOLDER_CONFIDENTIAL[e]},hasNewMembershipUI:function(e){return T.HAS_NEW_MEMBERSHIP_UI[e]},hasAudienceBox:function(e){return T.HAS_AUDIENCE_BOX[e]},hasContentManager:function(e){return T.HAS_CONTENT_MANAGER[e]},hasContentManagerAndSuperAdmin:function(e){return T.HAS_CONTENT_MANAGER_AND_SUPER_ADMIN[e]},hasContentManagerActionsDisabled:function(e){return T.HAS_CONTENT_MANAGER_ACTIONS_DISABLED[e]},hasContentManagerCdm:function(e){return T.HAS_CONTENT_MANAGER_CDM[e]},hasContentManagerCdmInTSD:function(e){return T.HAS_CONTENT_MANAGER_CDM_IN_TSD[e]},hasManagedSync:function(e){return T.HAS_MANAGED_SYNC[e]},SHARING_TOTAL_LIMIT:T.SHARING_TOTAL_LIMIT||200},R={},N={SHARED_FILE:"shared-file",SHARED_FOLDER:"shared-folder",SHARED_LINK:"shared-link",LEGACY_TEAM_FOLDER:"team-folder",PUBLIC:"public",NO_SHARE:"no-share"},S={SINGLE_INVALID:D("The email address you entered is invalid"),SINGLE_OUT_OF_TEAM:D("This person isn’t on your Dropbox team"),SINGLE_TOO_MANY_MEMBERS:D("Can’t share with this many people"),GENERAL_INVALID:D("One or more names or email addresses you entered are invalid."),GENERAL_OUT_OF_TEAM:D("One or more invitees are outside your Dropbox team."),GENERAL_TOO_MANY_MEMBERS:ne(D("This will put the folder over its %(member_limit)s-member limit. <a>Learn more.</a>",{comment:"member_limit will be a number greater than 200"}),{member_limit:C.SHARING_TOTAL_LIMIT,a:V.a({href:"/help/9292",target:"_blank",key:"help_center_article"})}),NONGROUP_INVITEE:D("Only groups can be added to team folders.")},b={ERROR:"error",WARN:"warn"},F=function(e,t){var n,o,r,i,s;return i=t.memberId()===e?"0":"1",r=t.access_type===v.OWNER?"0":"1",o=t.is_inherited?"0":"1",n=t instanceof I?"0":"1",s=t.displayName().toLowerCase(),""+i+r+o+n+"-"+s},L=function(e,t){return t.displayName().toLowerCase()},M=function(e){return function(t,n){var o,r,i,s,a;return i=n.memberId()===t?"0":"1",r=n instanceof I?"0":"1",s=n.displayName().toLowerCase(),o=function(e){var t,n;return t=String(Number.MAX_SAFE_INTEGER-Number(e)),n=String(Number.MAX_SAFE_INTEGER).length,t.length<n&&(t=""+Array(n-t.length+1).join("0")+t),t},a=null!=n.account_id&&e.has(n.account_id)?"a":null!=n.time_last_seen?"b"+o(n.time_last_seen):"c",""+i+r+a+s}},$=function(e,t,n){var o;return o=function(){return n&&A.is_pass_enabled(e)?M(t):C.canActOnInheritedMembers(e.id)?L:F},function(t,n){var r,i,s;return s=o(),r=s(e.account_id,t),i=s(e.account_id,n),i>r?-1:r===i?0:1}},se=function(e,t,n,o,r,i,s){var a,l,c,u,d,p,h,_,m,f;for(l=null,c=null,f=0,u=0,d=e.length;d>u;u++){if(a=e[u],h=ie(a,t,n,o,r,i,0),m=h.state,p=h.msg,m===w.invalid){if(l=b.ERROR,p===S.SINGLE_INVALID){c=S.GENERAL_INVALID;break}p===S.SINGLE_OUT_OF_TEAM&&(c=S.GENERAL_OUT_OF_TEAM),p===S.NONGROUP_INVITEE&&(c=S.NONGROUP_INVITEE)}m===w.warn&&p===S.SINGLE_OUT_OF_TEAM&&(l||(l=b.WARN,c=S.GENERAL_OUT_OF_TEAM)),f+=null!=(_=a.group_size)?_:1}return(r||i)&&e.length>0&&l!==b.ERROR&&s>C.SHARING_TOTAL_LIMIT&&(l=b.ERROR,c=S.GENERAL_TOO_MANY_MEMBERS),{level:l,message:c}},ie=function(e,t,n,o,r,i,s){var a;if(a={state:w.ok},r&&!e.group_id)return{state:w.invalid,msg:S.NONGROUP_INVITEE};if((r||i)&&s>C.SHARING_TOTAL_LIMIT)return{state:w.invalid,msg:S.SINGLE_TOO_MANY_MEMBERS};if(e.invalid)a={state:w.invalid,msg:S.SINGLE_INVALID};else{if(e.email===t.email)return a;null!=n&&t.is_team&&e.dbx_team_id!==n.id&&!e.group_id&&(a={msg:S.SINGLE_OUT_OF_TEAM},"team"===(null!=o?o.member_policy:void 0)||"team"===(null!=o?o.resolved_member_policy:void 0)?a.state=w.invalid:a.state=w.warn)}return a},x=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}},q=function(e){var t,n,o;return t=e.displayName(),{access_type:x(e.access_type),display_name:t,initials:null!=(n=e.initials)?n:g.getInitials(t),photo_url:null!=(o=e.account)?o.profile_photo_url:void 0,user_id:e.memberId()}},B=function(e){return{access_type:x(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}},H=function(e){return{access_type:x(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()}},J=function(e,n,o,r){return null==r&&(r={}),O.log(n,o,e.extras.origin,t.extend(r,{file_id:e.extras.fileId,fq_path:e.displayPath(),ns_id:e.isSharedFolder()?e.sharedFolderId():void 0,modal_session_id:e.extras.modalSessionId}))},U={access_error:D("You don’t have access to this content."),email_unverified:D("You haven’t verified your email. Check your email and try again."),bad_member:D("You entered an invalid name or email address."),cant_share_outside_team:D("Your team settings don’t allow sharing outside your team."),too_many_members:D("You’re sharing with too many people."),too_many_pending_invites:D("You’re sharing with too many people."),rate_limit:D("You’ve hit the limit of invites for today. Try again later."),insufficient_plan:D("You need a Dropbox %(trademark_plus)s or Business account to do this.").format({trademark_plus:k}),team_folder:D("You can’t add members to a team folder. Contact your team admin."),no_permission:D("You don’t have permission to do this. Contact the owner.")},z=function(e){return e.message?e.message:e instanceof y&&e.error[".tag"]&&U[e.error[".tag"]]?U[e.error[".tag"]]:D("There was a problem completing this request.")},Q=function(e,t,n,o){var r,i,a,l,c,u,d,p;if(a=e.filter(function(e){var t;return(t=e.type)===s.EMAIL||t===s.DBX_ID}),r=e.filter(function(e){return e.type===s.NEW_STYLE_GROUP}),(n||o)&&(i=r.map(function(e){var t;return null!=(t=e.group_size)?t:1}),d=function(e,t){return e+t},p=i.reduce(d,0),p+=a.length,p>=C.SHARING_WARN_THRESHOLD))return D("This change may take a while.");if(l={content_name:t,group_name:null!=(c=r[0])?c.name:void 0,num_groups:r.length,num_people:a.length,recipient:null!=(u=a[0])?u.email:void 0},a.length>0&&0===r.length)return n?re("Added %(recipient)s to “%(content_name)s”.","Added %(num_people)s people to “%(content_name)s”.",a.length).format(l):o?re("Securely added %(recipient)s to “%(content_name)s”.","Securely added %(num_people)s people to “%(content_name)s”.",a.length).format(l):re("Securely shared “%(content_name)s” with %(recipient)s.","Securely shared “%(content_name)s” with %(num_people)s people.",a.length).format(l);if(0===a.length&&r.length>0)return n?re("Added %(group_name)s to “%(content_name)s”.","Added  %(num_groups)s groups to “%(content_name)s”.",r.length).format(l):o?re("Securely added %(group_name)s to “%(content_name)s”.","Securely added  %(num_groups)s groups to “%(content_name)s”.",r.length).format(l):re("Securely shared “%(content_name)s” with %(group_name)s.","Securely shared “%(content_name)s” with %(num_groups)s groups.",r.length).format(l);if(1===a.length&&r.length>0)return n?re("Added %(recipient)s and 1 group to “%(content_name)s”.","Added %(recipient)s and %(num_groups)s groups to “%(content_name)s”.",r.length).format(l):o?re("Securely added %(recipient)s and 1 group to “%(content_name)s”.","Securely added %(recipient)s and %(num_groups)s groups to “%(content_name)s”.",r.length).format(l):re("Securely shared “%(content_name)s” with %(recipient)s and 1 group.","Securely shared “%(content_name)s” with %(recipient)s and %(num_groups)s groups.",r.length).format(l);if(a.length>1&&r.length>0)return n?D("Shared “%(content_name)s.”").format(l):D("Securely shared “%(content_name)s.”").format(l);throw"Logic error: There should be at least 1 recipient"},K=function(e){var t;return j({isShared:e.isSharedFolder(),isDeleted:null==e.path_lower,isInTeamFolderTree:null!=e.parent_shared_folder_id,isTeamFolder:e.is_team_folder,isViewOnly:null!=(null!=(t=e.permissions)?t.edit_contents:void 0)?!e.permissions.edit_contents.allow:!1})},W=function(e){return G(e.name,{size:P.LARGE})},Y=function(e,t){return f(e?{path:"/preview_admin_console"}:{path:"/team/admin/team_folders/home"+((t?ee(te(t)):void 0)||""),query:t?{select:t}:void 0})},X=function(e,t){return t?t+"/"+e:"/"+e},Z=function(e){return null==e?0:e.map(function(e){return e.group_size||1}).reduce(function(e,t){return e+t},0)},{apiInviteeMemberToAvatarInfo:H,apiGroupMemberToAvatarInfo:B,apiUserMemberToAvatarInfo:q,CONTACT_ERROR_LEVEL:b,CONTACT_ERROR_MESSAGES:S,fileIconForMetadata:W,folderIconForMetadata:K,makeMemberSortCmp:$,GoldenGate:C,SharingExperiments:R,SHARE_UI_TYPE:N,genAddMemberErrorMessage:z,genShareSuccessMessage:Q,genContentManagerBridgeUri:Y,getMemberCountForTokens:Z,getNewFolderPathFromContentName:X,logTiburonEvent:J,validateContact:ie,validateContacts:se}}),define("modules/clean/sharing/views/comments_help",["external/classnames","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,r,i,s){var a,l,c,u,d;return d=i.static_url,l=s._,c=t.createElement,u=t.DOM,a=t.createClass({displayName:"ShareModalCommentsHelp",mixins:[t.addons.PureRenderMixin],propTypes:{onClose:t.PropTypes.func.isRequired,onButtonClick:t.PropTypes.func.isRequired,isFeedbackRequest:t.PropTypes.bool},renderText:function(){return this.props.isFeedbackRequest?[u.h1({key:"heading"},l("Get feedback on your work")),u.p({key:"content"},l("This will ask recipients to leave comments on your file and post your message as a comment."))]:u.p({},l("New! You can now post your message as a comment on the file. Anyone who views this file can see this comment."))},render:function(){return u.div({className:e(["bubble-dropdown","right-bottom","u-font-center","u-pad-m","u-l-b","comments-help-dialog"])},u.div({className:"close-button u-font-right"},c(r,{onClick:this.props.onClose})),c(o,{src:d("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:d("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),this.renderText(),u.button({className:"c-btn c-btn--primary",onClick:this.props.onButtonClick},l("Try it out")),u.div({className:"bubble-arrow-border"}),u.div({className:"bubble-arrow"}))}}),a=n(a,["/static/css/components/bubble_dropdown-vflTPbDJ3.css"])}),define("modules/clean/sharing/views/constants",["external/underscore","modules/core/i18n"],function(e,t){var n,o;return o=t.i18n_default_project("sharing")._,n={MODES:{LINK_ONLY:"link-only",LOADING:"loading",MEMBERSHIP:"membership",SHARE:"share",SHARE_SENDING:"share-sending"},BANNERS:{NO_MEMBERS:"no-members",INPUT_CONTENT_NAME:"input-content-name"},CONTENT_NAME_MESSAGE_LEVELS:{INFO:"info",ERROR:"error"},LINK_ONLY_REASON:{INSIDE_SHARED_FOLDER:"inside_shared_folder",CONTAINS_SHARED_FOLDER:"contains_shared_folder",LINKS_PAGE:"links_page"},CONTENT_NAME_EMPTY_TOOLTIP:o("Name your shared folder")},n.MODE_VALUES=e.values(n.MODES),n.BANNER_VALUES=e.values(n.BANNERS),n.CONTENT_NAME_MESSAGE_LEVEL_VALUES=e.values(n.CONTENT_NAME_MESSAGE_LEVELS),n}),define("modules/clean/sharing/views/hover_close_button",["external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,r){var i,s,a,l;return s=r.i18n_default_project("sharing")._,a=t.createElement,l=t.DOM,i=t.createClass({displayName:"HoverCloseButton",propTypes:{className:t.PropTypes.string},getInitialState:function(){return{hover:!1}},render:function(){var t;return t={className:e("c-borderless-button",this.props.className),onMouseOver:function(e){return function(){return e.setState({hover:!0})}}(this),onMouseOut:function(e){return function(){return e.setState({hover:!1})}}(this)},l.button(n.extend(t,n.omit(this.props,Object.keys(t))),a(o,{group:"web",name:this.state.hover?"xclose":"xclose_light_gray",alt:s("Close Modal")}))}})}),define("modules/clean/sharing/views/member_list",["external/immutable","external/react","external/underscore","modules/clean/react/modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/content_info","modules/clean/sharing/views/member_list_item","modules/clean/sharing/views/modal_viewers_line","modules/clean/sharing/views/viewer_info","modules/clean/sharing/views/viewer_list_modal","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_){var m,f,g,v,y,E,b,S,w,T,C,I,P,A;return g=o.Modal,b=i.SharingMembership,m=s.ContentInfo,E=a.SharingMemberListItem,v=l.ModalViewersLine,S=c.ViewerInfo,w=u.ViewerListModal,f=d.GoldenGate,P=d.logTiburonEvent,A=d.makeMemberSortCmp,T=_.i18n_default_project("sharing")._,C=t.createElement,I=t.DOM,y=t.createClass({displayName:"SharingMemberList",propTypes:{actionHandler:t.PropTypes.instanceOf(r),areMembersFullyLoaded:t.PropTypes.bool,canInviteMembers:t.PropTypes.bool,canMakeViewerNoComment:t.PropTypes.bool,canRelinquishMembership:t.PropTypes.bool,canUpdateConfidentiality:t.PropTypes.bool,contentInfo:t.PropTypes.instanceOf(m).isRequired,disabled:t.PropTypes.bool,groupSeenStateInfo:t.PropTypes.object,membership:t.PropTypes.instanceOf(b).isRequired,onSetConfidentialClick:t.PropTypes.func,pendingMemberAction:t.PropTypes.instanceOf(e.Set).isRequired,presentAccountIds:t.PropTypes.instanceOf(e.Set),shouldShowPassUI:t.PropTypes.bool,user:t.PropTypes.instanceOf(p).isRequired},getDefaultProps:function(){return{disabled:!1,groupSeenStateInfo:{},presentAccountIds:new e.Set}},render:function(){var e,t,n,o,r,i;return n=A(this.props.user,this.props.presentAccountIds,this.props.shouldShowPassUI),o=this._membersByInheritance(),e=null!=(r=o.get(!1))?r.sort(n):void 0,t=null!=(i=o.get(!0))?i.sort(n):void 0,I.div({className:"sharing-member-list"},(null!=e?e.count():void 0)>0?I.ul({className:"o-list-ui u-trim-margin u-pad-horizontal-m"},e.map(this._renderMembersListItem).toArray()):void 0,(null!=t?t.count():void 0)>0?[I.h5({className:"sharing-member-list__inherited-separator u-pad-vertical-xs u-pad-horizontal-s u-font-meta u-font-strong",key:"separator"},[T("Can access via parent folders"),this.props.canUpdateConfidentiality?I.button({className:"button-as-link u-l-fr",onClick:this.props.onSetConfidentialClick},T("Manage access")):void 0]),I.ul({className:"o-list-ui u-trim-margin u-pad-horizontal-m u-pad-top-xs",key:"inherited-members"},t.map(this._renderMembersListItem).toArray())]:void 0,this.props.areMembersFullyLoaded?void 0:I.div({className:"sharing-member-list__loading c-loader u-mar-horizontal-auto u-l-b"},T("Loading more members...")))},_renderMembersListItem:function(e){var t,n;return n=e.memberKey(),t=e.memberId()in this.props.groupSeenStateInfo?this._renderGroupViewersLine(e):null,C(E,{actionHandler:this.props.actionHandler,canInviteMembers:this.props.canInviteMembers,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,contentInfo:this.props.contentInfo,disabled:this.props.disabled,groupViewersLine:t,hasGroupSeenStateInfo:null!=t,isMemberActionPending:this.props.pendingMemberAction.has(n),isPresent:this.props.shouldShowPassUI&&this._isMemberCurrentlyViewing(e),key:n,member:e,user:this.props.user})},_isMemberCurrentlyViewing:function(e){return this._memberIsAssumed(e)?!1:this.props.presentAccountIds.has(e.account_id)},_memberIsAssumed:function(e){return e.account_id===this.props.user.account_id&&h.get_viewer().is_assume_user_session},_membersByInheritance:function(){return null==this.props.membership?e.Map():this.props.membership.groups.valueSeq().concat(this.props.membership.invitees.valueSeq()).concat(this.props.membership.users.valueSeq()).groupBy(function(e){return function(t){return e._shouldSortByInherited()&&t.is_inherited}}(this))},_shouldSortByInherited:function(){return f.canSetFolderConfidential(this.props.user.id)||!f.canActOnInheritedMembers(this.props.user.id)},_renderGroupViewersLine:function(e){var t,n;return t=this.props.groupSeenStateInfo[e.memberId()],n=t.map(function(e){return new S(e)}).filter(function(e){return function(t){return null!=t.time_last_seen||e.props.presentAccountIds.has(t.account_id)}}(this)),0===n.length?null:I.span({className:"sharing-member-info__group-seen-state",onClick:function(n){return function(){return g.showInstance(C(w,{contentInfo:n.props.contentInfo,groupName:e.displayName(),onCancel:n.props.actionHandler.openShareModal,presentAccountIds:n.props.presentAccountIds,seenStateInfo:t,user:n.props.user})),P(n.props.contentInfo,n.props.user.id,"OPEN_GROUP_VIEWER_LIST_MODAL",{group_id:e.memberId()})}}(this)},C(v,{currentUserAccountId:this.props.user.account_id,presentAccountIds:this.props.presentAccountIds,viewers:n}))}})}),define("modules/clean/sharing/views/member_list_item",["external/classnames","external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/datetime","modules/clean/em_string","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/sharing/views/viewer_info","modules/clean/static_urls","modules/clean/user","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g){var v,y,E,b,S,w,T,C,I,P,A,N,O,R,k,D,L,M,F,x;return y=i.AVATAR_DIMENSION_BY_SIZE,k=s.ago,w=c.GroupMembershipInfo,S=c.GroupManagementType,T=c.InviteeMembershipInfo,C=c.MemberPermissions,I=c.PermissionSetting,N=c.UserMembershipInfo,v=u.ACCESS_VALUES,P=u.SNIPPET_SIZES,E=d.ContentInfo,O=h.ViewerInfo,F=_.static_url,M=f.i18n_default_project("sharing"),R=M._,x=M.ungettext,D=t.createElement,L=t.DOM,b={FIRST_LINE:"FIRST_LINE",SECOND_LINE:"SECOND_LINE"},A=t.createClass({displayName:"SharingMemberListItem",propTypes:{actionHandler:t.PropTypes.instanceOf(l),canInviteMembers:t.PropTypes.bool,canMakeViewerNoComment:t.PropTypes.bool,canRelinquishMembership:t.PropTypes.bool,disabled:t.PropTypes.bool,isMemberActionPending:t.PropTypes.bool,isPresent:t.PropTypes.bool,isViewOnly:t.PropTypes.bool,member:t.PropTypes.oneOfType([t.PropTypes.instanceOf(w),t.PropTypes.instanceOf(T),t.PropTypes.instanceOf(N),t.PropTypes.instanceOf(O)]).isRequired,contentInfo:t.PropTypes.instanceOf(E).isRequired,groupViewersLine:t.PropTypes.element,onMemberAccessChange:t.PropTypes.func,pendingAccessChange:t.PropTypes.oneOf(v),user:t.PropTypes.instanceOf(m).isRequired},getDefaultProps:function(){return{canInviteMembers:!1,canMakeViewerNoComment:!1,canRelinquishMembership:!1,disabled:!1,isPendingRemoval:!1,isPresent:!1,isViewOnly:!1,groupViewersLine:null,onMemberAccessChange:null}},_shouldLinkMemberName:function(e){return"group"===e&&this.props.member.same_team&&(this.props.user.is_team_admin||this.props.member.is_member&&this.props.member.group_management_type!==S.system_managed)},render:function(){var t,n,i,s,l,c,u,d,h,_,m,f,v,E,S,T,C,A,M,U,B,H;if(f=null,this.props.member instanceof N){if(H=this.props.member.account,E="user",null==H)return null;C=H.profile_photo_url,f=this.props.member.time_last_seen}else this.props.member instanceof w?(H=null,E="group",C="team"===this.props.member.group_type?F("/static/images/icons/team_24@2x-vflR8kGKs.png"):void 0):this.props.member instanceof O?(H={email:this.props.member.email,email_verified:null!=this.props.member.email},E="user",C=this.props.member.photo_circle_url,f=this.props.member.time_last_seen):(H=null,E="invitee");return M=this.props.isPresent?R("currently viewing"):f?R("viewed %(time_str)s").format({time_str:k(f,!1)}):"",n=(null!=H?H.disabled:void 0)?R("Deleted"):"",d="group"===E&&this.props.member.member_count?x("%(member_num)s member","%(member_num)s members",this.props.member.member_count).format({member_num:this.props.member.member_count}):"",_=d?null!=this.props.groupViewersLine?b.FIRST_LINE:b.SECOND_LINE:null,S=n||M||!this.props.user.is_team||this.props.member.same_team?"":R("Outside of your Dropbox team"),s=this.props.member.displayName(),m=this.props.member.initials||g.getInitials(s),B="group"===E?"SQUARE":"CIRCLE",L.li({className:"sharing-member-list__item o-flag"},L.div({className:"o-flag__flex"},L.div({className:e(["sharing-member-info","o-flag",this.props.isViewOnly?null:"u-pad-right-m"])},L.div({className:"o-flag__fix"},D(o,{dimension:y.MEDIUM,photoUrl:C,shape:B,defaultAvatar:D(r,{dimension:y.MEDIUM,shape:B,initials:m,name:s})})),L.div({className:"sharing-member-info__contact o-flag__flex"},L.div({className:e([this.props.isMemberActionPending?"u-font-meta":null,"u-font-strong","u-ellip"])},s?(U=M?a("  ·  "+M).length:0,i=n?a("  ·  "+n).length:0,h=_===b.FIRST_LINE?a("  ·  "+d).length:0,T=S?a("  ·  "+S).length:0,l=P.DISPLAY_NAME-U-i-h-T,c=a.em_snippet(s,l),u=c!==s?s:null,this._shouldLinkMemberName(E)?L.a({href:"/team#groups/"+this.props.member.group_id,target:"_blank",className:"sharing-member-info__group-name-link sharing-member-info__display-name",title:u},c):L.span({className:"sharing-member-info__display-name",title:u},c)):void 0,n?[L.span({className:"u-font-meta dot"},"·"),L.span({className:"u-font-danger"},n)]:void 0,M?[L.span({className:"u-font-meta dot"},"·"),L.span({className:"u-font-meta sharing-member-info__last-seen-text"},M)]:void 0,_===b.FIRST_LINE?[L.span({className:"u-font-meta dot"},"·"),L.span({className:"u-font-meta sharing-member-info__group-count-text"},d)]:void 0,S?[L.span({className:"u-font-meta dot"},"·"),L.span({className:"u-font-meta"},S)]:void 0),L.div({className:"u-font-meta u-ellip sharing-member-info__details"},"group"===E?null!=this.props.groupViewersLine?this.props.groupViewersLine:_===b.SECOND_LINE?d:void 0:(null!=H?H.email:void 0)&&(null!=H?H.email_verified:void 0)?a.em_snippet(H.email,P.EMAIL):void 0)))),L.div({className:"o-flag__fix"},this.props.isMemberActionPending?L.img({src:F("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:R("Changing access")}):this.props.isViewOnly?L.span({}):(t=(null!=(A=this.props.member.permissions.get("make_viewer_no_comment"))?A.allow:void 0)&&this.props.canMakeViewerNoComment,v=this.props.member.permissions.set("make_viewer_no_comment",new I({allow:t})),D(p,{allowRelinquishMembership:this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership,canInviteMembers:this.props.canInviteMembers,canMakeViewerNoComment:t,contentInfo:this.props.contentInfo,currentAccess:this.props.member.access_type,disabled:this.props.disabled,isInherited:this.props.member.is_inherited,memberPermissions:v,onAccessChange:function(e){return function(t){var n;return null!=(n=e.props.actionHandler)?n.handleMemberAccessChange(e.props.member,t):void 0}}(this),pendingAccessChange:this.props.pendingAccessChange}))))}}),{SharingMemberListItem:A}}),define("modules/clean/sharing/views/modal_content",["external/classnames","external/es6-promise","external/immutable","external/react","external/react-dom","external/underscore","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/contacts/util","modules/clean/em_string","modules/clean/growth/experiments/shared_folder_paywall_view","modules/clean/react/css","modules/clean/react/image","modules/clean/react/pass/constants","modules/clean/react/sprite","modules/clean/react/bubble","modules/clean/react_format","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/comments_help","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/static_urls","modules/clean/user","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O){var R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z,Y,Q,Z,X,J,$,ee,te,ne,oe,re,ie,se,ae,le,ce,ue,de;return U=s.ContactsTokenizer,Q=h.PASS_FETCHING_STATUS,ae=f.reactFormat,H=v.FolderPolicy,W=v.LinkMetadata,j=v.MemberCounts,z=v.MemberPermissions,Z=v.PermissionSetting,$=v.SharedContentLinkMetadata,ee=v.SharingMembership,R=y.ACCESS_VALUES,L=y.COMMENTING,X=y.SNIPPET_SIZES,te=y.TRUELINK,B=E.ContentInfo,M=b.CONTACT_ERROR_LEVEL,se=b.genContentManagerBridgeUri,q=b.GoldenGate,de=b.validateContact,G=S.MODES,K=S.MODE_VALUES,k=S.BANNERS,D=S.BANNER_VALUES,F=S.CONTENT_NAME_MESSAGE_LEVELS,x=S.CONTENT_NAME_MESSAGE_LEVEL_VALUES,V=S.LINK_ONLY_REASON,Y=I.ModalLinkInfo,ce=A.static_url,re=o.createElement,ie=o.DOM,le=O.i18n_default_project("sharing"),ne=le._,ue=le.ungettext,oe=o.createClass({displayName:"ShareModalContent",statics:{MODES:G},propTypes:{actionHandler:o.PropTypes.instanceOf(g).isRequired,areMembersFullyLoaded:o.PropTypes.bool,banner:o.PropTypes.oneOf(D),canInviteEditor:o.PropTypes.bool.isRequired,canInviteViewer:o.PropTypes.bool.isRequired,canInviteViewerNoComment:o.PropTypes.bool.isRequired,canMakeViewerNoComment:o.PropTypes.bool.isRequired,canRelinquishMembership:o.PropTypes.bool,canShareLink:o.PropTypes.bool.isRequired,canUpdateConfidentiality:o.PropTypes.bool,contactsError:o.PropTypes.shape({level:o.PropTypes.string,message:o.PropTypes.oneOfType([o.PropTypes.string,o.PropTypes.array])}),contentInfo:o.PropTypes.instanceOf(B).isRequired,contentNameMessage:o.PropTypes.string,contentNameMessageLevel:o.PropTypes.oneOf(x),displayContentNameTooltip:o.PropTypes.bool,displayContentNameBanner:o.PropTypes.bool,folderPolicy:o.PropTypes.instanceOf(H),groupSeenStateInfo:o.PropTypes.object,hasDisplayableMembers:o.PropTypes.bool.isRequired,hasNonOwnerMembers:o.PropTypes.bool.isRequired,headerId:o.PropTypes.string,icon:o.PropTypes.string,initialRecipientRawInput:o.PropTypes.string,initialRecipientTokens:o.PropTypes.array,isAddMessageAsCommentChecked:o.PropTypes.bool,isAddMessageAsCommentHelpShown:o.PropTypes.bool,isConfidentialFolder:o.PropTypes.bool,isContentNameFocused:o.PropTypes.bool,isFolderInsideTeamFolderTree:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isLinkMetadataLoaded:o.PropTypes.bool.isRequired,isMetadataLoaded:o.PropTypes.bool.isRequired,isPassEnabled:o.PropTypes.bool,isTeamSharedFolder:o.PropTypes.bool,isTokenizerEmpty:o.PropTypes.bool.isRequired,linkMetadata:o.PropTypes.oneOfType([o.PropTypes.instanceOf(W),o.PropTypes.instanceOf($)]),linkOnlyReason:o.PropTypes.oneOf(i.values(V)),linkSeenStateInfo:o.PropTypes.array,memberCounts:o.PropTypes.instanceOf(j),memberCountWithRecipients:o.PropTypes.number,members:o.PropTypes.instanceOf(ee),mode:o.PropTypes.oneOf(K),name:o.PropTypes.string,onSettingsClick:o.PropTypes.func,onLinkViewersClick:o.PropTypes.func,onSetConfidentialClick:o.PropTypes.func,ownerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),passFetchingStatus:o.PropTypes.string,pendingMemberAction:o.PropTypes.instanceOf(n.Set).isRequired,presentAccountIds:o.PropTypes.instanceOf(n.Set),recipientAccess:o.PropTypes.oneOf(R).isRequired,recipientMessage:o.PropTypes.string.isRequired,recipientTokens:o.PropTypes.array,shareFolderPromise:o.PropTypes.instanceOf(t),sharingPaywallInfo:o.PropTypes.shape({foldersToUnshare:o.PropTypes.object,isFolderOwner:o.PropTypes.bool,isInExperiment:o.PropTypes.bool,maxOwned:o.PropTypes.number,numOwned:o.PropTypes.number,onLearnMoreClick:o.PropTypes.func,onManageSharedFoldersClick:o.PropTypes.func,onUpgradeClick:o.PropTypes.func}),shouldBlockMemberListOnPassLoad:o.PropTypes.bool,showContentManagerBridge:o.PropTypes.bool,showPassFileSettings:o.PropTypes.bool,suppressLinkUI:o.PropTypes.bool,teamGroupInfo:o.PropTypes.shape({id:o.PropTypes.string,name:o.PropTypes.string}),user:o.PropTypes.instanceOf(N).isRequired},getDefaultProps:function(){return{contactsError:{level:null,message:null},headerId:"unified-share-modal-title",linkMetadata:null,members:null,initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:G.MEMBERSHIP,onFolderSettingsClick:null,onLinkViewersClick:null}},componentDidMount:function(){return this.logTTI(),this.refs.contentNameInput?r.findDOMNode(this.refs.contentNameInput).focus():void 0},componentDidUpdate:function(e,t){
return this.logTTI()},logTTI:function(){return this.props.mode===G.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore("VIEW_LINK_ONLY_MODAL"):this.props.isMetadataLoaded&&(this.props.actionHandler.logIfHaventBefore("VIEW_SHARE_MODAL"),!this._shouldRenderMainLoading())?this.props.actionHandler.logIfHaventBefore("MEMBER_LIST_LOADED",{member_count:this._getMemberNum()}):void 0},render:function(){return ie.div({className:"unified-share-modal unified-share-modal--"+this.props.mode},this._renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderConfidentialFolderSection(),this._renderMainSection(),this._renderPaywallSection(),this._renderFooterSection())},_renderHeaderSection:function(){var t,n,o,r,i;return n=this._getMemberNum(),o=this.props.user.is_team&&(null!=(r=this.props.memberCounts)?r.users_outside_team:void 0)>0&&null!=this.props.ownerTeam?ue("%(outside_team_count)s outside your Dropbox team","%(outside_team_count)s outside your Dropbox team",this.props.memberCounts.users_outside_team).format({outside_team_count:this.props.memberCounts.users_outside_team}):void 0,t=n?o?ue("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",n,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):ue("%(member_num)s member","%(member_num)s members",n):"",t=t.format({member_num:n+((null!=(i=this.props.memberCounts)?i.exceeds_count:void 0)?"+":""),outside_team_string:o}),ie.div({className:"unified-share-modal__section"},ie.div({className:"unified-share-modal__close u-l-fr o-flag__fix u-mar-top-xxs"},re(T,{className:"u-mar-left-s u-mar-top-xs",onClick:function(e){return function(){var t;return null!=(t=e.refs.tokenizer)&&t.finishLogging(!0),e.props.actionHandler.closeModal()}}(this)})),ie.div({className:"unified-share-modal__header o-flag"},ie.span({className:"o-flag__fix"},re(_,{alt:"",className:"unified-share-modal__title-icon",group:"web",name:this.props.icon})),ie.div({className:e("unified-share-modal__title","o-flag__flex",n?"unified-share-modal__title--member-count":void 0)},this.props.contentInfo.pathExists()?ie.h3({className:"u-font-strong",id:this.props.headerId},c.em_snippet(this.props.contentInfo.name(),X.FILENAME)):this._renderContentNameInput(),n?ie.h4({className:"u-trim-margin u-font-meta"},t):void 0),te.TRUELINK_UI[this.props.user.id]?ie.span({className:"u-l-fr o-flag__fix"},this._renderContentSettings()):void 0))},_renderContentNameInput:function(){return ie.div({className:"unified-share-modal__content-name"},null==this.props.contentNameMessage||!this.props.isContentNameFocused&&this.props.contentNameMessageLevel!==F.ERROR?void 0:re(m,{arrow:m.ARROW.TOP,className:e({"unified-share-modal__content-name__tooltip":!0,"unified-share-modal__content-name__tooltip-error":this.props.contentNameMessageLevel===F.ERROR,"u-font-strong":!0})},ie.div({className:e(["u-pad-top-xxs","u-pad-bottom-xxs","u-pad-left-xs","u-pad-right-xs"])},this.props.contentNameMessage)),ie.input({className:e(["u-trim-padding","u-trim-margin","u-l-ib","u-font-strong"]),id:this.props.headerId,ref:"contentNameInput",onChange:function(e){return function(t){return e.props.actionHandler.handleContentNameChange(t.target.value)}}(this),onFocus:function(e){return function(){return e.props.actionHandler.handleContentNameFocusChange(!0)}}(this),onBlur:function(e){return function(){return e.props.actionHandler.handleContentNameFocusChange(!1)}}(this),onKeyUp:function(e){return function(t){var n,o;return(null!=(n=e.refs.tokenizer)&&null!=(o=n.refs.tokenizer)?o.refs.input:void 0)&&13===t.keyCode?r.findDOMNode(e.refs.tokenizer.refs.tokenizer.refs.input).focus():void 0}}(this),placeholder:this.props.isContentNameFocused?void 0:ne("Folder name")}))},_renderToSection:function(){var t,n;return this._shouldRenderPaywallBlocker()?null:this.props.linkOnlyReason===V.LINKS_PAGE?null:this.props.mode===G.LINK_ONLY?this._renderNoPermissionSection():this.props.isMetadataLoaded?this.props.showContentManagerBridge?this._renderContentManagerBridge():this.props.canInviteEditor||this.props.canInviteViewer?(this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree)&&(null!=(t=this.props.memberCounts)?t.total_unique_users:void 0)>=q.SHARING_TOTAL_LIMIT?this._renderOverLimitSection():(n=this.props.contentInfo.isFile()&&!this.props.canInviteEditor&&!this.props.canInviteViewerNoComment,ie.div({className:"unified-share-modal__section unified-share-modal__section--to"},ie.div({className:"o-flag"},ie.label({className:"o-flag__fix u-font-strong",htmlFor:"unified-share-modal-contacts-tokenizer"},this.props.isTeamSharedFolder?ne("Add groups:",{comment:"Label for with whom to share"}):ne("To:",{comment:"Label for with whom to share"})),ie.div({className:"unified-share-modal__to-input-box o-flag__flex"},re(U,{ref:"tokenizer",context:"tiburon",customContactFilter:this.props.isTeamSharedFolder?function(e){return e.type!==a.FB&&e.group_id}:function(e){return function(t){return t.type!==a.FB&&t.email!==e.props.user.email}}(this),focusOnMount:this.props.contentInfo.pathExists(),id:"unified-share-modal-contacts-tokenizer",onContentsChange:this.props.actionHandler.recipientsChange,populatedInputData:{tokens:this.props.initialRecipientTokens,value:this.props.initialRecipientRawInput},customContactValidator:function(e){return function(t){return de(t,e.props.user,e.props.ownerTeam,e.props.folderPolicy,e.props.isTeamSharedFolder,e.props.isFolderInsideTeamFolderTree,e.props.memberCountWithRecipients)}}(this),placeholder:ne(this.props.isTeamSharedFolder?"Group names":this.props.user.is_team?"Email, name, or group":"Email or name"),shouldLogContactSearch:!0,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:null,user:this.props.user})),ie.div({className:e({"o-flag__fix":!0,"c-title-bubble":n}),"data-title":ne("Only folders can be shared with edit access")},n?ie.span({className:"ax-visually-hidden"},ne("Only folders can be shared with edit access")):void 0,re(P,{asButton:!0,canMakeViewerNoComment:this.props.canMakeViewerNoComment,contentInfo:this.props.contentInfo,currentAccess:this.props.recipientAccess,disabled:this.props.showContentManagerBridge,memberPermissions:new z({make_editor:new Z({allow:this.props.canInviteEditor}),make_viewer:new Z({allow:this.props.canInviteViewer}),make_viewer_no_comment:new Z({allow:this.props.canInviteViewerNoComment})}),onAccessChange:this.props.actionHandler.changeRecipientAccess}))))):this._renderNoPermissionSection():ie.div({className:"unified-share-modal__section unified-share-modal__section--to"},ie.div({className:"unified-share-modal__to-placeholder"}," "))},_shouldRenderContentSettingsShareButton:function(){var e;return this.props.isMetadataLoaded&&this.props.mode!==G.LINK_ONLY&&(this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||(e=this.props.mode)===G.SHARE||e===G.SHARE_SENDING)&&!this._shouldRenderPaywallBlocker()},_shouldRenderFooterSection:function(){return this._renderLinkRowInFooter()?this._shouldRenderLinkRow():this._shouldRenderContentSettingsShareButton()},_renderFooterSection:function(){return this._shouldRenderFooterSection()?ie.div({className:"unified-share-modal__section unified-share-modal__section--footer clearfix"},this._renderLinkRowInFooter()?this._renderLinkRowContent():this._renderContentSettingsShareButton()):void 0},_renderContentSettingsShareButton:function(){return this._shouldRenderContentSettingsShareButton()?ie.div({},te.TRUELINK_UI[this.props.user.id]?void 0:ie.div({className:"u-l-fl"},this._renderContentSettings()),ie.div({className:"u-l-fr"},function(){switch(this.props.mode){case G.SHARE:case G.SHARE_SENDING:return ie.button({className:"unified-share-modal__share-send c-btn c-btn--primary",disabled:this.props.mode===G.SHARE_SENDING||this.props.isTokenizerEmpty||this.props.contactsError.level===M.ERROR||null!=this.props.contentNameMessage,onClick:function(e){return function(){return e.props.actionHandler.sendShare(e.refs.tokenizer,e.refs.contentNameInput)}}(this)},ne(this.props.mode===G.SHARE_SENDING?this.props.isTeamSharedFolder?"Adding...":"Sharing...":this.props.isTeamSharedFolder?"Add":"Share"));default:return null}}.call(this))):void 0},_renderContentSettings:function(){var e;if(this.props.isMetadataLoaded)return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings?ie.button({className:"unified-share-modal__settings u-font-meta c-borderless-button",disabled:this.props.mode===G.SHARE_SENDING,onClick:function(e){return function(){return e.props.onSettingsClick(!1)}}(this)},re(_,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),ne(te.TRUELINK_UI[this.props.user.id]?"Settings":this.props.contentInfo.isFile()?"File settings":"Folder settings")):!this.props.contentInfo.isFolder()&&(this._canSendFeedbackRequest()||(null!=(e=this.props.recipientMessage)?e.length:void 0)>0)?this._renderFeedbackCheckbox():void 0},_renderErrorMessageSection:function(){return this.props.contactsError.message?ie.div({className:e(["unified-share-modal__section","unified-share-modal__error-message","u-font-center",this.props.contactsError.level===M.WARN?"unified-share-modal__warn":void 0,this.props.contactsError.level===M.ERROR?"unified-share-modal__error":void 0])},this.props.contactsError.message):null},_shouldRenderMainLoading:function(){var e,t,n,o;return n=this.props.isMetadataLoaded,t=this.props.hasNonOwnerMembers||this.props.areMembersFullyLoaded,o=!this.props.isPassEnabled||this._isPassInfoLoaded(),e=this.props.shouldBlockMemberListOnPassLoad&&!o,!n||!t||e},_renderMainSection:function(){if(this.props.mode===G.LINK_ONLY)return this._renderMainLinkOnly();if(this._shouldRenderMainLoading())return this._renderMainLoading();switch(this.props.mode){case G.MEMBERSHIP:return this._renderMainMembership();case G.SHARE:case G.SHARE_SENDING:return this._renderMainShare();default:return null}},_shouldRenderPaywallBlocker:function(){var e,t,n;return null===this.props.sharingPaywallInfo?!1:(null!=(n=this.props.sharingPaywallInfo.foldersToUnshare)?n.size:void 0)>0?!1:(e=this.props.contentInfo.isFolder()&&!this.props.contentInfo.isSharedFolder(),t=this.props.sharingPaywallInfo.numOwned>=this.props.sharingPaywallInfo.maxOwned,this.props.sharingPaywallInfo.isInExperiment&&e&&t)},_shouldRenderPaywallBanner:function(){var e,t,n,o;return null===this.props.sharingPaywallInfo?!1:(null!=(o=this.props.sharingPaywallInfo.foldersToUnshare)?o.size:void 0)>0?!0:(t=this.props.sharingPaywallInfo.isFolderOwner,n=this.props.sharingPaywallInfo.numOwned<this.props.sharingPaywallInfo.maxOwned,e=this.props.contentInfo.isFolder()&&!this.props.contentInfo.isSharedFolder(),this.props.sharingPaywallInfo.isInExperiment&&(this.props.contentInfo.isSharedFolder()&&t||e&&n))},_renderPaywallSection:function(){var t;return this.props.isMetadataLoaded&&this._shouldRenderPaywallBanner()?(this.props.actionHandler.logPaywallEvent("show_sharing_paywall_banner_in_share_modal"),t=0===this.props.sharingPaywallInfo.numOwned?ue("You can own %(max)s shared folder.","You can own %(max)s shared folders.",this.props.sharingPaywallInfo.maxOwned).format({max:this.props.sharingPaywallInfo.maxOwned}):ue("You own %(num)s shared folder (max is %(max)s).","You own %(num)s shared folders (max is %(max)s).",this.props.sharingPaywallInfo.numOwned).format({num:this.props.sharingPaywallInfo.numOwned,max:this.props.sharingPaywallInfo.maxOwned}),ie.div({className:e(["paywall-banner","unified-share-modal__section","unified-share-modal__no-permission","u-font-center"])},t," ",ie.button({className:"button-as-link",onClick:this.props.sharingPaywallInfo.onLearnMoreClick},ne("Learn more")))):null},_renderNoPermissionSection:function(){var e;return ie.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},this.props.mode===G.LINK_ONLY?this.props.contentInfo.isOSXPackage()?ne(te.TRUELINK_UI[this.props.user.id]?"Package files can’t be shared.":"This package file can only be shared as a link."):this.props.linkOnlyReason===V.INSIDE_SHARED_FOLDER?te.TRUELINK_UI[this.props.user.id]?ne("You don’t have permission to share this folder."):ie.span({},ne("This folder can only be shared as a link because it’s in a shared folder.")+" ",ie.a({href:"/help/1931",target:"_blank"},ne("Learn more"))):te.TRUELINK_UI[this.props.user.id]?ne("This folder can’t be shared"):this.props.linkOnlyReason===V.CONTAINS_SHARED_FOLDER?ie.span({},ne("This folder can only be shared as a link because it contains a shared folder.")+" ",ie.a({href:"/help/1931",target:"_blank"},ne("Learn more"))):ne("This folder can only be shared as a link."):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?ne("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):this.props.isTeamSharedFolder?ae(ne("Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."),{admin_link:ie.a({href:"/team?_tk=left_nav_team",target:"_blank"}),group_link:ie.a({href:"/help/7232#transfer",target:"_blank"})}):ne(this.props.contentInfo.isFolder()?te.TRUELINK_UI[this.props.user.id]&&(null!=(e=this.props.permissions)?e.change_options.allow:void 0)?"To add new members, you’ll need to add them to the parent folder.":"You don’t have permission to manage membership of this folder":"You don’t have permission to manage membership of this file"))},_renderConfidentialFolderSection:function(){return this.props.isConfidentialFolder?ie.div({className:"unified-share-modal__section unified-share-modal__confidential-folder u-font-center"},ie.span({},ae(ne("<b>Invite only.</b> Members of parent folders can’t access."),{b:ie.b()})," ",this.props.canUpdateConfidentiality?ie.a({onClick:this.props.onSetConfidentialClick},ne("Settings")):void 0)):void 0},_renderContentManagerBridge:function(){var e;return e=se(this.props.isLimitedTeam,this.props.contentInfo.displayPath()),ie.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},ie.span({},ne("You can manage folder membership in the Admin Console. "),ie.a({href:e.toString(),target:"_blank"},ne("Open in new tab."))))},_renderOverLimitSection:function(){return ie.div({className:"unified-share-modal__section unified-share-modal__no-permission u-font-center"},ie.div({},ne("This folder is over its %(member_limit)s-member limit.",{comment:"member limit is a number greater than 200"}).format({member_limit:q.SHARING_TOTAL_LIMIT})),ie.div({},ne("Please remove some members.")," ",ie.a({href:"/help/9292",target:"_blank"},ne("Learn more."))))},_shouldRenderTeamFolderNoPermissionMessage:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){var n,o;return"team"===e.group_type&&(null!=(n=e.permissions.make_editor)?n.allow:void 0)&&(null!=(o=e.permissions.make_viewer)?o.allow:void 0)})},_isOwnerOfAtLeastOneGroup:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return e.is_owner})},_renderMainLoading:function(){return ie.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),ie.div({className:"u-font-center u-font-meta u-pad-top-xl"},ie.div({className:"c-loader"},ne("Loading..."))))},_renderMainLinkOnly:function(){return te.TRUELINK_UI[this.props.user.id]&&this.props.linkOnlyReason!==V.LINKS_PAGE?null:ie.div({className:e(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow())},_renderMainMembership:function(){return ie.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer",this._shouldRenderPaywallBlocker()?"unified-share-modal__main--paywall":void 0,this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0])},this._renderLinkRow(),this._shouldRenderPaywallBlocker()?(this.props.actionHandler.logPaywallEvent("view_shared_folder_paywall"),re(u,{actionHandler:this.props.actionHandler,maxOwned:this.props.sharingPaywallInfo.maxOwned,numOwned:this.props.sharingPaywallInfo.numOwned,onLearnMoreClick:this.props.sharingPaywallInfo.onLearnMoreClick,onUpgradeClick:this.props.sharingPaywallInfo.onUpgradeClick,onManageClick:this.props.sharingPaywallInfo.onManageSharedFoldersClick})):this.props.hasNonOwnerMembers?re(C,{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,groupSeenStateInfo:this.props.groupSeenStateInfo,membership:this.props.members,onSetConfidentialClick:this.props.onSetConfidentialClick,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,shouldShowPassUI:this.props.isPassEnabled&&this.props.passFetchingStatus===Q.PASS_SUCCESS,user:this.props.user,viewer:this.props.viewer}):this.props.banner===k.INPUT_CONTENT_NAME?ie.div({className:e(["unified-share-modal__input-content-name-banner","u-font-center","u-font-meta","u-mar-top-xs"])},re(p,{src:ce("/static/images/sharing/illo-name-folder-vfl38PzAv.png"),srcHiRes:ce("/static/images/sharing/illo-name-folder@2x-vflzK0uJv.png")}),ie.h3({className:e(["u-font-strong","u-mar-top-xs"])},ne("Name your shared folder")),ie.p({className:e(["u-pad-left-xxl","u-pad-right-xxl"])},ne("Shared folders are for collaborting on projects, client works, and organizing departments"))):ie.div({className:e(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-font-center","u-font-meta"])},this.props.isTeamSharedFolder?null!=this.props.teamGroupInfo?[ie.p({className:"u-mar-top-xxl"},ie.a({onClick:this._addEveryoneGroup},ne("Add everyone at %(team_name)s").format({team_name:this.props.ownerTeam.name}))),ie.p({},ne("Or, add groups to this team folder.")+" ",ie.a({href:"/team#groups/newgroup"},ne("Create a group")))]:ie.p({className:"u-mar-top-xxl"},ne("Add groups to this team folder.")+" ",ie.a({href:"/team#groups/newgroup"},ne("Create a group"))):ie.div({},re(p,{className:"unified-share-modal__illo",src:ce("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:ce("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),ie.p({className:"u-mar-top-s"},ne("Add people you want to share with")))))},_renderMainShare:function(){return ie.div({className:"unified-share-modal__main unified-share-modal__section u-pad-horizontal-m"},this.props.isTeamSharedFolder?void 0:ie.textarea({placeholder:ne("Add a message (optional)"),onChange:function(e){return function(t){return e.props.actionHandler.changeRecipientMessage(t.target.value)}}(this),value:this.props.recipientMessage}))},_renderLinkRow:function(){return this._renderLinkRowInFooter()?void 0:this._renderLinkRowContent()},_renderLinkRowContent:function(){var e,t;if(this._shouldRenderLinkRow())return t=!this.props.contentInfo.isMounted()&&this.props.isPassEnabled&&this._isPassInfoLoaded()&&this.props.isMetadataLoaded,t||this.props.isLinkMetadataLoaded&&(this.props.isMetadataLoaded||this.props.mode===G.LINK_ONLY)?ie.div({className:"unified-share-modal__link-info"},re(Y,{actionHandler:this.props.actionHandler,canShareLink:this.props.canShareLink||this.props.mode===G.LINK_ONLY,contentInfo:this.props.contentInfo,hasDisplayableMembers:this.props.hasDisplayableMembers,hasNonOwnerMembers:this.props.hasNonOwnerMembers,isLimitedTeam:this.props.isLimitedTeam,linkMetadata:this.props.linkMetadata,linkSeenStateInfo:this.props.linkSeenStateInfo,mode:this.props.mode,onLinkViewersClick:this.props.onLinkViewersClick,openSharingSettings:this.props.onSettingsClick,shareFolderPromise:this.props.shareFolderPromise,teamName:null!=(e=this.props.ownerTeam)?e.name:void 0,presentAccountIds:this.props.presentAccountIds,user:this.props.user})):this.props.mode===G.LINK_ONLY?ie.div({className:"unified-share-modal__link-info--loading"},ie.div({className:"c-loader c-loader--spinner--blue u-l-b u-mar-horizontal-auto"},ne("Loading…"))):this.props.contentInfo.isTeamSharedFolder()?void 0:ie.div({className:"unified-share-modal__link-info--filler"})},_renderFeedbackCheckbox:function(){var e,t;return t=this._canSendFeedbackRequest(),e=ne(t?"I want feedback on this file":"Post this message as a comment"),ie.div({className:"u-pad-top-xs"},ie.div({className:"unified-share-modal__add-message-as-comment-checkbox-container"},ie.input({type:"checkbox",id:"add_message_as_comment",name:"add_message_as_comment",checked:this.props.isAddMessageAsCommentChecked,onChange:this._handleAddMessageAsCommentChange}),this.props.isAddMessageAsCommentHelpShown?re(w,{onClose:this._commentsHelpClosed,onButtonClick:this._commentsHelpButtonClicked,isFeedbackRequest:t}):void 0),ie.label({htmlFor:"add_message_as_comment"},e))},_getMemberNum:function(){var e;return null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:null!=(e=this.props.members)?e.getMemberCount():void 0},_isPassInfoLoaded:function(){var e;return(e=this.props.passFetchingStatus)===Q.PASS_SUCCESS||e===Q.ERROR},_handleAddMessageAsCommentChange:function(e){return this.props.actionHandler.setAddMessageAsCommentChecked(e.target.checked)},_commentsHelpClosed:function(){return this.props.actionHandler.setAddMessageAsCommentHelpClosed()},_commentsHelpButtonClicked:function(){return this.props.actionHandler.setAddMessageAsCommentHelpClosed(),this.props.actionHandler.setAddMessageAsCommentChecked(!0)},_canSendFeedbackRequest:function(){return!this._renderLinkRowInFooter()},_addEveryoneGroup:function(){var e;return null!=(e=this.refs.tokenizer)?e.addExternalContacts([l.teamGroupInfoToContact(this.props.teamGroupInfo)]):void 0},_renderLinkRowInFooter:function(){return this.props.mode===G.LINK_ONLY?!1:this.props.mode===G.SHARE||this.props.mode===G.SHARE_SENDING?!1:this.props.isMetadataLoaded?te.TRUELINK_UI[this.props.user.id]:!1},_shouldRenderLinkRow:function(){return te.TRUELINK_UI[this.props.user.id]&&this.props.isLinkMetadataLoaded&&!this.props.linkMetadata?!1:!this.props.suppressLinkUI&&this.props.canShareLink}}),J=d(oe,["/static/css/react/contacts_tokenizer-vflR5K70C.css","/static/css/scooter/scooter-scoped-vflebHNBy.css","/static/css/sharing/settings_modal-vflzQV5gA.css","/static/css/sharing/share_modal-vfli6yzwo.css"]),{ShareModalContent:J,MODES:G}}),define("modules/clean/sharing/views/modal_link_info",["jquery","external/classnames","external/es6-promise","external/immutable","external/react","external/react-dom","modules/clean/clipboard_v2","modules/clean/react_format","modules/clean/react/sprite","modules/clean/react/util","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/link_description","modules/clean/sharing/sharing_settings_dropdown","modules/clean/sharing/sharing_settings_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/modal_viewers_line","modules/clean/sharing/views/viewer_info","modules/clean/user","modules/constants/python","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S,w,T){var C,I,P,A,N,O,R,k,D,L,M,F,x,U,B,H,q,V,W,G,K,j,z;return k=o.Set,G=a.reactFormat,j=c.setStatePromise,I=d.LinkAudience,P=d.LinkMetadata,L=d.SharedContentLinkMetadata,C=h.ContentInfo,H=_.formatLinkDescription,q=_.formatSharedContentLinkExpiry,D=m.SettingDropdown,V=f.getAudienceOptionsDict,W=g.logTiburonEvent,A=v.MODES,N=v.MODE_VALUES,R=y.ModalViewersLine,F=E.ViewerInfo,M=S.TRADEMARK_BUSINESS,K=w.i18n_default_project("sharing"),x=K._,z=K.ungettext,U=r.createElement,B=r.DOM,O=r.createClass({displayName:"ModalLinkInfo",propTypes:{actionHandler:r.PropTypes.instanceOf(u),canShareLink:r.PropTypes.bool.isRequired,contentInfo:r.PropTypes.instanceOf(C).isRequired,hasDisplayableMembers:r.PropTypes.bool,hasNonOwnerMembers:r.PropTypes.bool,isLimitedTeam:r.PropTypes.bool,linkMetadata:r.PropTypes.oneOfType([r.PropTypes.instanceOf(P),r.PropTypes.instanceOf(L)]),linkSeenStateInfo:r.PropTypes.array,mode:r.PropTypes.oneOf(N),onLinkViewersClick:r.PropTypes.func,openSharingSettings:r.PropTypes.func,presentAccountIds:r.PropTypes.instanceOf(k),shareFolderPromise:r.PropTypes.instanceOf(n),teamName:r.PropTypes.string,user:r.PropTypes.instanceOf(b).isRequired},getInitialState:function(){return{showingUrl:!1}},componentWillMount:function(){var e;return this.clipboard=new s(null!=(e=this.props.linkMetadata)?e.url:void 0,function(){return T.success(x("Link copied to clipboard"))},function(){return T.error(x("Unable to copy the link, please copy manually"))},this._handleCopyLinkClicked)},componentDidMount:function(){return this.setupCopy()},componentDidUpdate:function(){return this.setupCopy()},setupCopy:function(){var t;return t=e(".copy-link-button"),t.length?this.clipboard.setupCopy(t,e(".copy-link-container")):void 0},render:function(){return null!=this.props.linkMetadata||this._isSharedContentLink()?this._renderLink():this.props.contentInfo.isMounted()?this.props.canShareLink?this._renderNoLink():null:this._renderUnmountedLinkInfo()},_renderLink:function(){var e,n;return B.div({className:t(["unified-share-modal-link-info","o-flag"])},B.div({className:"o-flag__fix"},this._renderLinkIcon()),B.div({className:this._detailsClassName(),onClick:this._handleInfoClick},function(){var n;if(this.state.showingUrl)return[B.label({className:"ax-visually-hidden",htmlFor:"unified-share-modal-link-url",key:"link-label"},x("Shared link URL")),B.input({className:"unified-share-modal-link-info__url",id:"unified-share-modal-link-url",key:"link-url-input",onClick:this._handleUrlClick,readOnly:!0,ref:"urlField",type:"text",value:this.props.linkMetadata.url})];if(e=null,this.props.linkMetadata instanceof P)e=H(this.props.linkMetadata);else{if(!(this.props.linkMetadata instanceof L))throw Error("Unsupported link metadata type "+(null!=(n=this.props.linkMetadata)?n.name:void 0));e=this._renderSharedContentLinkInfo()}return B.span({},null!=e?B.span({className:t(["unified-share-modal-link-info__description",this._isSharedContentLink()?"unified-share-modal-link-info__description--content-link":void 0])},e):void 0,this._renderLinkViewers())}.call(this)),B.ul({className:"unified-share-modal-link-info__actions o-flag__fix"},this._isSharedContentLink()?(null!=(n=this.props.linkMetadata)?n.url:void 0)?this._renderCopyLink():this._isSharingFolder()?void 0:this._renderGetLink():B.span({},this._renderLinkSettings(),this._renderDivider(),this._renderCopyLink())))},_renderLinkSettings:function(){return this.state.showingUrl?void 0:B.li({className:"u-l-ib"},B.button({className:"button-as-link",onClick:function(e){return function(){return e._isSharedContentLink()?e.props.openSharingSettings(!0):e.props.actionHandler.handleLinkSettingsClick()}}(this)},x("Link settings")))},_renderDivider:function(){return this.state.showingUrl?void 0:B.span({className:"u-l-ib u-mar-left-xs u-mar-right-xs"},"•")},_renderCopyLink:function(){return B.li({className:"u-l-ib"},B.button({className:"button-as-link copy-link-container",onClick:this._handleCopyLinkClicked},this.state.showingUrl?x("Hide link"):s.is_supported()?B.span({className:"copy-link-button"},x("Copy link")):x("Show link")))},_renderGetLink:function(){return B.li({className:"u-l-ib"},B.button({className:"button-as-link",onClick:this.props.actionHandler.shareIfFileFolder},x("Get link")))},_renderUnmountedLinkInfo:function(){var e;return e=this._renderLinkViewers(),B.div({className:t(["unified-share-modal-link-info","o-flag",this._isSharedContentLink()?void 0:"u-mar-horizontal-s","u-mar-bottom-s","u-pad-top-s"])},B.div({className:"o-flag__fix"},this._renderLinkIcon()),B.div({className:this._detailsClassName(),onClick:this._handleInfoClick},null!=e?e:x("No one else has viewed the link")))},_detailsClassName:function(){var e;return e=["unified-share-modal-link-info__details","o-flag__flex"],this._detailsClickShowsLinkViewers()&&e.push("unified-share-modal-link-info__details--clickable"),t(e)},_renderNoLink:function(){var e,n;return e=(null!=(n=this.props.linkSeenStateInfo)?n.length:void 0)?B.span({},x("You haven’t created a link yet"),this._renderLinkViewers()):x("No link created yet"),B.div({className:t(["unified-share-modal-link-info","unified-share-modal-link-info--no-link","o-flag"])},B.div({className:"o-flag__fix"},B.div({className:"unified-share-modal-link-info__icon"},U(l,{alt:"",group:"web",name:"shared_link_gray"}))),B.div({className:this._detailsClassName(),onClick:this._handleInfoClick},e),B.div({className:"unified-share-modal-link-info__actions o-flag__fix"},B.button({className:"button-as-link",onClick:this._handleCreateLinkClicked},x("Create a link"))))},_handleCreateLinkClicked:function(){if(this._isSharedContentLink())throw Error("Should not display this for shared content link");return this.props.actionHandler.createSharedLink()},_handleCopyLinkClicked:function(){return this.state.showingUrl||W(this.props.contentInfo,this.props.user.id,"CLICK_TIB_COPY_LINK"),j(this,{showingUrl:!this.state.showingUrl}).then(function(e){return function(){var t;return null!=e.refs.urlField?(t=i.findDOMNode(e.refs.urlField),t.focus(),t.select(),e.clipboard.do_copy()):void 0}}(this))},_handleInfoClick:function(){return this._detailsClickShowsLinkViewers()?this.props.onLinkViewersClick():void 0},_detailsClickShowsLinkViewers:function(){var e;return(null!=(e=this.props.linkSeenStateInfo)?e.length:void 0)&&!this.state.showingUrl},_handleUrlClick:function(e){return e.target.select()},_renderLinkViewers:function(){var e,t;return(null!=(e=this.props.linkSeenStateInfo)?e.length:void 0)?(t=this.props.linkSeenStateInfo.map(function(e){return new F(e)}),B.div({className:"unified-share-modal-link-info__viewers"},U(R,{currentUserAccountId:this.props.user.account_id,presentAccountIds:this.props.presentAccountIds,viewers:t}))):null},_isSharedContentLink:function(){return p.TRUELINK.TRUELINK_UI[this.props.user.id]},_renderLinkIcon:function(){return B.div({className:"unified-share-modal-link-info__icon"},U(l,{alt:"",group:"web",name:"shared_link_white"}))},_isSharingFolder:function(){return Boolean(this.props.shareFolderPromise)},_renderSharedContentLinkInfo:function(){var e,t,n;return this._isSharingFolder()?B.div({},x("Updating link"),B.div({className:"c-loader"})):(t=this.props.linkMetadata.audience_options.length>1,n=this.props.linkMetadata.current_audience===I.members?this.props.hasDisplayableMembers&&!this.props.hasNonOwnerMembers?G(x("<strong>Only you</strong> can use the link"),{strong:B.strong()}):G(x("<strong>Only invited members</strong> with the link can view"),{strong:B.strong()}):this.props.linkMetadata.current_audience===I.team?this.props.isLimitedTeam?G(x("<strong>Only people on your team</strong> with the link can view"),{strong:B.strong()}):G(x("<strong>Only people on your %(trademark_business)s team</strong> with the link can view"),{strong:B.strong(),trademark_business:M}):this.props.linkMetadata.current_audience===I.public?G(x("<strong>Anyone</strong> with the link can view"),{strong:B.strong()}):void 0,B.div({},B.div({},t?(e=B.button({className:"c-borderless-button change-audience-button"},n,U(l,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"
})),D({currentValue:this.props.linkMetadata.current_audience,valuesList:this.props.linkMetadata.audience_options.valueSeq().toArray(),optionsDict:V(this.props.contentInfo.isFolder(),this.props.isLimitedTeam,this.props.hasNonOwnerMembers,this.props.hasDisplayableMembers),onValueSelected:this.props.actionHandler.handleSelectLinkAudience,customButton:e,openUp:this.props.mode!==A.LINK_ONLY})):n),B.div({},this.props.linkMetadata.expiry?q(this.props.linkMetadata,!0):void 0,this.props.linkMetadata.password_protected&&this.props.linkMetadata.expiry?this._renderDivider():void 0,this.props.linkMetadata.password_protected?x("Password protected"):void 0)))}}),{ModalLinkInfo:O}}),define("modules/clean/sharing/views/modal_viewers_line",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/react/title_bubble","modules/clean/sharing/constants","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c){"use strict";var u=8,d=function(){function e(){}return e.prototype.formatOne=function(e){return l._("<NameSpan>%(first_user)s</NameSpan> is viewing now").format({first_user:e})},e.prototype.formatTwo=function(e,t){return l._("<NameSpan>%(first_user)s</NameSpan> and <NameSpan>%(second_user)s</NameSpan> are viewing").format({first_user:e,second_user:t})},e.prototype.formatMulti=function(e,t,n){return l.ungettext("<NameSpan>%(first_user)s</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d other are viewing</PositioningTarget>","<NameSpan>%(first_user)s</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d others are viewing</PositioningTarget>",n).format({first_user:e,second_user:t,in_bubble_count:n})},e}(),p=function(){function e(){}return e.prototype.formatOne=function(e){return l._("<NameSpan>You</NameSpan> are viewing now")},e.prototype.formatTwo=function(e,t){return l._("<NameSpan>You</NameSpan> and <NameSpan>%(second_user)s</NameSpan> are viewing now").format({second_user:t})},e.prototype.formatMulti=function(e,t,n){return l.ungettext("<NameSpan>You</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d other are viewing</PositioningTarget>","<NameSpan>You</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d others are viewing</PositioningTarget>",n).format({second_user:t,in_bubble_count:n})},e}(),h=function(){function e(){}return e.prototype.formatOne=function(e){return l._("<NameSpan>%(first_user)s</NameSpan> viewed").format({first_user:e})},e.prototype.formatTwo=function(e,t){return l._("<NameSpan>%(first_user)s</NameSpan> and <NameSpan>%(second_user)s</NameSpan> viewed").format({first_user:e,second_user:t})},e.prototype.formatMulti=function(e,t,n){return l.ungettext("<NameSpan>%(first_user)s</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d other viewed</PositioningTarget>","<NameSpan>%(first_user)s</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d others viewed</PositioningTarget>",n).format({first_user:e,second_user:t,in_bubble_count:n})},e}(),_=function(){function e(){}return e.prototype.formatOne=function(e){return l._("<NameSpan>You</NameSpan> viewed")},e.prototype.formatTwo=function(e,t){return l._("<NameSpan>You</NameSpan> and <NameSpan>%(second_user)s</NameSpan> viewed").format({second_user:t})},e.prototype.formatMulti=function(e,t,n){return l.ungettext("<NameSpan>You</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d other viewed</PositioningTarget>","<NameSpan>You</NameSpan>, <NameSpan>%(second_user)s</NameSpan>, <PositioningTarget>and %(in_bubble_count)d others viewed</PositioningTarget>",n).format({second_user:t,in_bubble_count:n})},e}(),m=function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.render=function(){for(var e=null,t=[],n=[],o=!0,r=0,i=this.props.viewers;r<i.length;r++){var s=i[r],a=this.props.presentAccountIds.has(s.account_id);s.account_id===this.props.currentUserAccountId?e=s:a?t.push(s):n.push(s),a||(o=!1)}var l;l=e?o?new p:new _:o?new d:new h;var c=e?[e]:[];return c.push.apply(c,t.concat(n)),this.buildViewerComponent(c,l)},t.prototype.buildViewerComponent=function(e,t){var n,r=function(e){return i.reactFormat(e,{NameSpan:o.createElement("span",null)})};switch(e.length){case 0:return o.createElement("span",null);case 1:n=r(t.formatOne(this.getName(e,0,!1)));break;case 2:n=r(t.formatTwo(this.getName(e,0),this.getName(e,1)));break;default:n=this.buildComplexTooltip(e,t)}return o.createElement("div",{className:"viewer-list-line"},n)},t.prototype.getName=function(e,t,n){void 0===n&&(n=!0);var o=e[t].display_name;return n&&(o=c.getShortName(o)),r.em_snippet(o,a.SNIPPET_SIZES.DISPLAY_NAME)},t.prototype.buildComplexTooltip=function(e,t){for(var n=e.length,r=n-2,a=[this.getName(e,2,!1)],c=Math.min(2+u,n),d=3;c>d;d++)a.push(o.createElement("br",null),this.getName(e,d,!1));var p=n-c;if(p){var h=l.ungettext("and %(num_additional)d more…","and %(num_additional)d more…",p,{comment:"text in a list of members, indicates there are also num_additional members not shown"}).format({num_additional:p});a.push(o.createElement("br",null),h)}var _=t.formatMulti(this.getName(e,0),this.getName(e,1),r),m=i.reactFormat(_,{NameSpan:o.createElement("span",null),PositioningTarget:o.createElement("span",{className:s.POSITIONING_TARGET_CLASS})});return o.createElement(s,{content:o.createElement("div",null,a),children:o.createElement("span",null,m),position:s.POSITIONS.BOTTOM,isTargetPositionFixed:!0})},t}(o.Component);t.ModalViewersLine=m}),define("modules/clean/sharing/views/sharing_bubble_menu",["external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l,c){var u,d,p,h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A;return _=n.BubbleMenu,m=n.BubbleMenuItem,T=r.Tooltip,C=r.TooltipPosition,S=i.MemberPermissions,u=s.ACCESS_LEVEL,h=s.ACCESS_VALUES,g=s.MEMBER_ACTION,f=a.ContentInfo,d=l.ACCESS_NAME,p=l.ACCESS_NAME_NO_COMMENT,E=l.MEMBER_ACTION_FOLDER,v=l.MEMBER_ACTION_FILE,b=l.MEMBER_ACTION_FOLDER_NO_COMMENT,y=l.MEMBER_ACTION_FILE_NO_COMMENT,I=c.i18n_default_project("sharing")._,P=t.createElement,A=t.DOM,w=t.createClass({displayName:"SharingBubbleMenu",propTypes:{allowRelinquishMembership:t.PropTypes.bool,asButton:t.PropTypes.bool,canInviteMembers:t.PropTypes.bool,canMakeViewerNoComment:t.PropTypes.bool,contentInfo:t.PropTypes.instanceOf(f).isRequired,currentAccess:t.PropTypes.oneOf(h).isRequired,disabled:t.PropTypes.bool,isInherited:t.PropTypes.bool,memberPermissions:t.PropTypes.instanceOf(S).isRequired,onAccessChange:t.PropTypes.func.isRequired,pendingAccessChange:t.PropTypes.oneOf(h)},getDefaultProps:function(){return{allowRelinquishMembership:!1,asButton:!1,canInviteMembers:!1,canMakeViewerNoComment:!1,disabled:!1,pendingAccessChange:null}},_getMemberActionInfo:function(){var e,t,n;return e=d,this.props.canMakeViewerNoComment&&(e=p),n=E,this.props.canMakeViewerNoComment&&(n=b),t=v,this.props.canMakeViewerNoComment&&(t=y),[[g.MAKE_EDITOR,{value:u.WRITER,title:e[u.WRITER],folder_description:n[g.MAKE_EDITOR],file_description:t[g.MAKE_EDITOR]}],[g.MAKE_VIEWER,{value:u.READER,title:e[u.READER],folder_description:n[g.MAKE_VIEWER],file_description:t[g.MAKE_VIEWER]}],[g.MAKE_VIEWER_NO_COMMENT,{value:u.READER_NO_COMMENT,title:e[u.READER_NO_COMMENT],folder_description:n[g.MAKE_VIEWER_NO_COMMENT],file_description:t[g.MAKE_VIEWER_NO_COMMENT]}],[g.MAKE_OWNER,{value:u.OWNER,title:I("Make owner")}],[g.REMOVE,{value:"remove",title:this.props.allowRelinquishMembership?A.div({className:"u-font-danger"},I("Remove my access")):A.div({className:"u-font-danger"},I("Remove"))}]]},_renderMenuItem:function(e){var t,n,r,i,s;return s=e.value,i=e.title,n=e.file_description,r=e.folder_description,t=this.props.contentInfo.isFolder()?r:n,P(m,{className:"sharing-access-menu-item",key:s,onClick:function(e){return function(){return s!==e.props.currentAccess?e.props.onAccessChange(s):void 0}}(this)},A.div({className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"},s===this.props.currentAccess?P(o,{alt:"",group:"web",name:"check_gray"}):void 0),A.div({className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},A.div({className:"u-font-nowrap u-font-black sharing-access-menu-item__title"},i),A.div({className:"u-font-wrap u-font-meta sharing-access-menu-item__description"},t)))},_renderCurrentAccessText:function(t){return A.button({className:e(["sharing-access-menu__current-access","u-font-nowrap",this.props.asButton?["sharing-access-menu__current-access--button","c-btn","c-btn--secondary","u-trim-margin"]:{"c-borderless-button":!0,"change-access-button":!t}]),disabled:t},this.props.canMakeViewerNoComment?p[this.props.currentAccess]:d[this.props.currentAccess],t?void 0:[A.div({className:"gray-arrow",key:"gray"},P(o,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"})),A.div({className:"blue-arrow",key:"blue"},P(o,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-blue"}))])},render:function(){var e,t,n,o,r,i,s,a;for(r=[],i=this._getMemberActionInfo(),t=0,o=i.length;o>t;t++)s=i[t],e=s[0],n=s[1],(n.value===this.props.currentAccess||(null!=(a=this.props.memberPermissions.get(e))?a.allow:void 0)||n.value===g.REMOVE&&this.props.allowRelinquishMembership)&&r.push(this._renderMenuItem(n));return r.length<=1&&this.props.isInherited&&this.props.canInviteMembers?P(T,{position:C.RIGHT,tooltip_contents:I("This member’s permissions can only be changed from a parent folder."),tooltip_classname:"sharing-access-menu__tooltip"},A.span({className:"ax-visually-hidden"},I("This member’s permissions can only be changed from a parent folder.")),this._renderCurrentAccessText(!0)):r.length<=1||this.props.pendingAccessChange?this._renderCurrentAccessText(!0):P(_,{targetButton:this._renderCurrentAccessText(this.props.disabled),targetFixed:!0,position:_.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-access-menu o-list-ui o-list-ui--dividers",items:r,shouldShowArrow:!1,disabled:this.props.disabled,verticalDisplacement:this.props.asButton?-5:0})}})}),define("modules/clean/sharing/views/sync_coachmark",["external/react","modules/clean/ajax","modules/clean/react/bubble","modules/clean/react/button","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,r,i,s,a){var l,c,u,d,p,h,_,m;return d=o.button,_=o.link_button,m=s.static_url,h=e.DOM,p=e.createElement,c=a.i18n_default_project("sharing")._,u=e.createClass({displayName:"SharingSyncCoachmark",getInitialState:function(){return{show:!0}},componentWillMount:function(){return t.BackgroundRequest({url:"/sharing/seen_sync_coachmark"})},render:function(){return this.state.show?p(n,{arrow:n.ARROW.TOP_RIGHT,className:"sync-coachmark u-pad-s"},p(i,{className:"u-l-ib",src:m("/static/images/sharing/sync_coachmark-vflyzarQZ.png"),srcHiRes:m("/static/images/sharing/sync_coachmark@2x-vflMrQ12G.png")}),h.div({className:"u-l-ib u-pad-left-s sync-coachmark__content"},h.h2({},c("Stay in sync")),h.p({},c("For easy access to this folder in the future, add it to your Dropbox.")),h.button({className:"c-btn c-btn--secondary",onClick:function(e){return function(){return e.setState({show:!1})}}(this)},c("Got it")))):h.div({})}}),l=r(u,["/static/css/sharing/sync_coachmark-vfl_8vkAL.css"]),{SharingSyncCoachmark:l}}),define("modules/clean/sharing/views/viewer_info",["require","exports"],function(e,t){"use strict";var n=function(){function e(e){e.when_last_seen&&(this.time_last_seen=new Date(1e3*e.when_last_seen));var t=e.seen_state_user;this.account_id=t.user_id,this.display_name=t.display_name,this.email=t.email,this.photo_circle_url=t.photo_circle_url,this.same_team=!0}return e.prototype.displayName=function(){return this.display_name},e.prototype.memberId=function(){return""},e}();t.ViewerInfo=n}),define("modules/clean/sharing/views/viewer_list_modal",["require","exports","tslib","external/react","modules/clean/react/modal","modules/clean/sharing/views/member_list_item","modules/clean/sharing/ui_util","modules/clean/sharing/views/viewer_info","modules/core/i18n"],function(e,t,n,o,r,i,s,a,l){"use strict";var c=o.createElement,u=function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.render=function(){return c(r.Modal,{autoclose:!1,className:"viewer-list-modal",buttonComponent:o.createElement("span",null),onDismissCompleted:this.props.onCancel,title:this._modalTitle()},this._createMemberList())},t.prototype._modalTitle=function(){return this.props.groupName?l._("Members of %(group_name)s who viewed").format({group_name:this.props.groupName}):l._("People who viewed this link")},t.prototype._createMemberList=function(){var e=this.props.seenStateInfo.map(function(e){return new a.ViewerInfo(e)}),t=s.makeMemberSortCmp(this.props.user,this.props.presentAccountIds,!0);return e.sort(t),o.createElement("div",{className:"sharing-member-list"},o.createElement("ul",{className:"o-list-ui u-trim-margin"},e.map(this._renderMemberListItem.bind(this))))},t.prototype._renderMemberListItem=function(e){return c(i.SharingMemberListItem,{canInviteMembers:!1,canMakeViewerNoComment:!1,canRelinquishMembership:!1,contentInfo:this.props.contentInfo,disabled:!1,isMemberActionPending:!1,isPendingRemoval:!1,isPresent:this.props.presentAccountIds.has(e.account_id),isViewOnly:!0,key:e.account_id,member:e,onMemberAccessChange:null,user:this.props.user})},t}(o.Component);t.ViewerListModal=u}),define("modules/clean/teams/admin/api/admin_console_api_client",["require","exports","modules/clean/api_v2/client","modules/clean/teams/admin/api/types/managed_sync","modules/clean/filepath","modules/clean/viewer","external/underscore"],function(e,t,n,o,r,i,s){"use strict";var a=function(){function e(e){void 0===e&&(e=!1);var t=i.get_viewer();t.work_user&&(this.teamMemberId=t.work_user.team_member_id),this.userId=t.get_uid_by_role("work"),this.rpcClient=new n.TeamActionsClient,this.isCMForCDM=e}return e.prototype.setPermanentDeletePolicy=function(e){var t={permanent_delete_enabled:e},n="team/set_permanent_delete_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setMultipleAccountsPolicy=function(e){var t={multiple_accounts_enabled:e},n="team/set_multiple_accounts_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setFileRequestPolicy=function(e){var t={file_request_enabled:e},n="team/sharing/set_file_request_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSharedLinkPolicy=function(e,t){var n={sharing_outside_enabled:e};1==e&&(n.default_visibility=t);var o="team/sharing/set_shared_link_policy";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.setSharedFolderSharingPolicy=function(e){var t={sharing_outside_enabled:e},n="team/sharing/set_shared_folder_sharing_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSharedFolderJoiningPolicy=function(e){var t={joining_outside_enabled:e},n="team/sharing/set_shared_folder_joining_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setCommentingPolicy=function(e){var t={commenting_enabled:e},n="team/sharing/set_commenting_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.resetsAllPasswords=function(){var e="team/reset_all_passwords";return this.rpcClient.rpc(this.userId,e)},e.prototype.setPaperPolicy=function(e,t,n,o){var r={paper_enabled:e};t&&(r.dropbox_terms="agree");var i={paper_deployment_type:n,enabled_members_update:{users_to_add:this.make_user_selector_list(o.users_to_add),users_to_remove:this.make_user_selector_list(o.users_to_remove)}};r.paper_deployment_mode=i;var s="team/paper/set_paper_policy";return this.rpcClient.rpc(this.userId,s,r)},e.prototype.setPaperSharingPolicy=function(e,t){var n={external_sharing_allowed:void 0===e?!0:e,default_visibility:t},o="team/paper/set_paper_sharing_policy";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.setRequestMembershipPolicy=function(e){var t={request_membership:e},n="team/set_request_membership_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSuggestMembersPolicy=function(e){var t={suggest_members_enabled:e},n="team/set_suggest_members_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.deviceManagementGetExcludedUsers=function(){var e="team/device_management/get_excluded_users";return this.rpcClient.rpc(this.userId,e,null)},e.prototype.deviceManagementUpdateExcludedUsers=function(e,t){var n={users_to_add:e,users_to_remove:t},o="team/device_management/update_excluded_users";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.deviceManagementConfigureSettings=function(e){var t="team/device_management/configure_settings";return this.rpcClient.rpc(this.userId,t,e)},e.mapValueToRolloutMethod=function(e){return 0===e?"unlink_all":1===e?"unlink_most_inactive":"add_member_to_exceptions"},e.prototype.deviceManagementConfigureSettingsForAcf=function(t,n,o,r,i){var s={is_enabled:!0,can_user_remove_device:n,rollout_method:{".tag":e.mapValueToRolloutMethod(i)},users_to_add:t.users_to_add,users_to_remove:t.users_to_remove};-1==o?s.desktop_devices_limit={".tag":"unlimited"}:s.desktop_devices_limit={limited:Number(o),".tag":"limited"},-1==r?s.mobile_devices_limit={".tag":"unlimited"}:s.mobile_devices_limit={limited:Number(r),".tag":"limited"};var a="team/device_management/configure_settings";return this.rpcClient.rpc(this.userId,a,s)},e.prototype.deviceManagementExclusionList=function(e){var t="team/device_management/update_excluded_users";return this.rpcClient.rpc(this.userId,t,e)},e.prototype.deviceManagementConfigureSettingsDisable=function(){var e={is_enabled:!1},t="team/device_management/configure_settings";return this.rpcClient.rpc(this.userId,t,e)},e.prototype.deviceManagementRemoveDevice=function(e,t,n){var o={user_id:e,device_id:t,delete_data:n},r="team/device_management/remove_device";return this.rpcClient.rpc(this.userId,r,o)},e.prototype.deviceManagementRemoveClient=function(e,t,n,o){var r={user_id:e,device_id:t,client_unique_identifier:n,delete_data:o},i="team/device_management/remove_client";return this.rpcClient.rpc(this.userId,i,r)},e.prototype.webSessionManagementConfigureSettings=function(e,t){var n={remember_session_expires:e,idle_session_timeout:t},o="team/web_session_management/configure_settings";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.teamFolderArchive=function(e,t){void 0===t&&(t=!1);var n="team/team_folder/archive",o={team_folder_id:String(e),force_async_off:!t};return this.rpcClient.rpc(this.userId,n,o)},e.prototype.teamFolderUnarchive=function(e){var t="team/team_folder/activate",n={team_folder_id:String(e)};return this.rpcClient.rpc(this.userId,t,n)},e.prototype.teamFolderCreate=function(e,t){var n="team/team_folder/create_internal",r={name:e,default_sync_setting:o.defaultSyncSettingToApi(t)};return this.rpcClient.rpc(this.userId,n,r)},e.prototype.teamFoldersList=function(e){void 0===e&&(e=1e3);var t={limit:e},n="team/team_folder/list_internal";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.teamFolderRename=function(e,t){var n="team/team_folder/rename",o={team_folder_id:String(e),name:t};return this.rpcClient.rpc(this.userId,n,o)},e.prototype.teamFolderPermanentlyDelete=function(e){var t="team/team_folder/permanently_delete",n={team_folder_id:String(e)};return this.rpcClient.rpc(this.userId,t,n)},e.prototype.updateDefaultSyncSetting=function(e,t,n){void 0===n&&(n="");var r={team_folder_id:String(e),default_sync_setting:o.defaultSyncSettingToApi(t),target_path:n},i="team/team_folder/update_default_sync_setting";return this.rpcClient.rpc(this.userId,i,r)},e.prototype.updateAllSyncSettings=function(e){var t={default_sync_setting:o.defaultSyncSettingToApi(e)},n="team/team_folder/update_all_default_sync_settings";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setTeamFolderInitialSyncSetting=function(e){var t={initial_sync_setting:o.defaultSyncSettingToApi(e)},n="team/set_team_folder_initial_sync_setting";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSharedFolderInitialSyncSetting=function(e){var t={initial_sync_setting:o.defaultSyncSettingToApi(e)},n="team/set_shared_folder_initial_sync_setting";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setGroupsCreationPolicy=function(e){var t={group_creation:e},n="team/groups/set_creation_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setNTSBlockTrafficPolicy=function(e){var t={block_traffic_enabled:e},n="team/nts/set_block_traffic_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.configureSso=function(e,t,n,o,r){var i={sso_policy:e,saml_cert:t,sign_in_url:n,sign_out_url:o,nameid_format:r},s="team/configure_sso";return this.rpcClient.rpc(this.userId,s,i)},e.prototype.configureGoogleLoginPolicy=function(e){var t={google_login_enabled:e},n="team/configure_google_login_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setResellerSupportSetting=function(e){var t={reseller_support_enabled:e},n="team/change_reseller_support";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.folderCreate=function(e,t,n){"/"!=t&&(t+="/");var o="ns:"+e+t+n,r={path:o},i="files/create_folder",s={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,i,r,s)},e.prototype.confidentialFolderCreate=function(e,t,n){"/"!=t&&(t+="/");var o="ns:"+e+t+n,r={path:o,confidentiality:"confidential"},i="sharing/share_folder_internal",s={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,i,r,s)},e.prototype.bulkFileDelete=function(e){for(var t=[],n=null,o=0,r=e.length;r>o;o++)n=e[o],t.push({path:"ns:"+n.ns_id+n.ns_path});var i={entries:t},s="files/delete_batch_with_changeset_sync",a={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,s,i,a)},e.prototype.fileRename=function(e,t,n){var o="ns:"+e+t,r=t.substring(0,t.lastIndexOf("/"))+"/"+n,i="ns:"+e+r,s={from_path:o,to_path:i,autorename:!0},a="files/move",l={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,a,s,l)},e.prototype.shareFolder=function(e,t,n){void 0===n&&(n=null);var o="ns:"+e+t,r={path:o};if(n)for(var i=0;i<n._keys.length;++i){var s=n._keys[i],a=n[s];"resolved_member_policy"!=s&&a&&(r[s]={".tag":a})}var l="sharing/share_folder",c={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,l,r,c)},e.prototype.validateFolderPath=function(e,t,n,o){var r="ns:"+e+t,i={path:r,actions:n,list_members_arg:o},s="sharing/validate_folder_path",a={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,s,i,a)},e.prototype.restoreFile=function(e,t,n){var o="ns:"+e+t,r={path:o,rev:n},i="files/restore",s={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,i,r,s)},e.prototype.permanentDeleteFile=function(e,t){var n="ns:"+e+t,o={path:n},r="files/permanently_delete",i={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,r,o,i)},e.prototype.listRevisions=function(e,t){var n="ns:"+e+t,o={path:n},r="files/list_revisions",i={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,r,o,i)},e.prototype.setInfinitePolicy=function(e){var t={setting:e},n="team/set_infinite_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.getTeamFolderNsPathForFile=function(e){if(this.isCMForCDM)return e.fq_path;var t=e.fq_path.split("/"),n="/"+t.slice(2).join("/");return n},e.prototype.bulkFileMove=function(e,t,n){for(var o,i,s=[],a=null,l=0,c=t.length;c>l;l++)o=t[l],a=this.getTeamFolderNsPathForFile(o),i=r.filename(o.fq_path),s.push({from_path:"ns:"+e+a,to_path:"ns:"+e+n+"/"+i});var u={entries:s,autorename:!0},d="files/move_batch_sync",p={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,d,u,p)},e.prototype.bulkFileCopy=function(e,t,n){for(var o,i,s=[],a=null,l=0,c=t.length;c>l;l++)o=t[l],a=this.getTeamFolderNsPathForFile(o),i=r.filename(o.fq_path),s.push({from_path:"ns:"+e+a,to_path:"ns:"+e+n+"/"+i});var u={entries:s,autorename:!0,allow_shared_folder:!0},d="files/copy_batch_sync",p={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,d,u,p)},e.prototype.setMemberSpaceLimits=function(e){var t={limit_level:e},n="team/member_space_limits/set_default_limit";return this.rpcClient.rpc(this.userId,n,t)},e.prototype._create_user_selector_json=function(e){return{".tag":"email",email:e}},e.prototype.make_user_selector_list=function(e){for(var t=[],n=0;n<e.length;n++)t.push(this._create_user_selector_json(e[n]));return t},e.prototype.memberSpaceLimitsUpdateExclusionList=function(e){var t="team/member_space_limits/update_excluded_users",n=this.make_user_selector_list(e.users_to_add),o=this.make_user_selector_list(e.users_to_remove);return this.rpcClient.rpc(this.userId,t,{users_to_add:n,users_to_remove:o})},e.prototype.listAllMembers=function(e,t){void 0===t&&(t=null);var n="sharing/list_all_members",o={shared_folder_id:String(e)};t&&(o.path=t);var r={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,n,o,r)},e.prototype.teamFolderGetAccessPoints=function(e,t,n){var o="team/team_folder/get_access_points",r={dropbox_id:e,team_folder_id:String(t),path:n};return this.rpcClient.rpc(this.userId,o,r)},e.prototype.teamFolderGetFileMetadata=function(e,t){void 0===t&&(t=null);var n="team/team_folder/get_file_metadata",o={team_folder_id:String(e)};return t&&(o.path=t),this.rpcClient.rpc(this.userId,n,o)},e.prototype.getUserInfos=function(e){var t="users/get_account_batch",n={account_ids:e},o={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,t,n,o)},e.prototype.emmConfigureSettings=function(e,t){var n="team/emm/configure_settings",o=s.mapObject(t,this.make_user_selector_list.bind(this)),r={emm_policy:e,exclusion_list:o};return this.rpcClient.rpc(this.userId,n,r)},e}();t.AdminConsoleApiClient=a,Object.defineProperty(t,"__esModule",{value:!0}),t.default=a}),define("modules/clean/teams/admin/api/types/managed_sync",["external/immutable","modules/clean/api_v2/types"],function(e,t){var n,o,r,i,s,a,l,c,u,d,p;return l=t.UnionScalar,n={SYNC:"sync",NO_SYNC:"no_sync"},i={INITIALIZE_SYNC_PAGE:"INITIALIZE_SYNC_PAGE",SET_SYNC_SETTING_REQUEST:"SET_SYNC_SETTING_REQUEST",SET_SYNC_SETTING_FAILURE:"SET_SYNC_SETTING_FAILURE",SET_SYNC_SETTING_SUCCESS:"SET_SYNC_SETTING_SUCCESS",SET_ALL_SYNC_SETTING_REQUEST:"SET_ALL_SYNC_SETTING_REQUEST",SET_ALL_SYNC_SETTING_FAILURE:"SET_ALL_SYNC_SETTING_FAILURE",SET_ALL_SYNC_SETTING_SUCCESS:"SET_ALL_SYNC_SETTING_SUCCESS",SET_TEAM_FOLDER_DEFAULT_REQUEST:"SET_TEAM_FOLDER_DEFAULT_REQUEST",SET_TEAM_FOLDER_DEFAULT_FAILURE:"SET_TEAM_FOLDER_DEFAULT_FAILURE",SET_SHARED_FOLDER_DEFAULT_REQUEST:"SET_SHARED_FOLDER_DEFAULT_REQUEST",SET_SHARED_FOLDER_DEFAULT_FAILURE:"SET_SHARED_FOLDER_DEFAULT_FAILURE",SET_INFINITE_POLICY_REQUEST:"SET_INFINITE_POLICY_REQUEST",SET_INFINITE_POLICY_FAILURE:"SET_INFINITE_POLICY_FAILURE"},o={LOCKED_ROOT_POLICY:new l("locked_root_policy")},r={ON_DEMAND:new l("on_demand"),LOCAL:new l("local")},c=function(e){switch(e){case n.SYNC:return new l(n.SYNC);case n.NO_SYNC:return new l(n.NO_SYNC)}},u=function(e){return e?n.SYNC:n.NO_SYNC},a=!1,s=e.Record({name:"",nsId:0,shouldSync:!0},"ManagedSyncInfo"),p=function(e){return new s({name:e.name,nsId:e.target_ns,shouldSync:0===e.managed_sync_setting})},d=function(e){var t,n,o,r,i,s;for(s=p(e.team_folder),i={},r=e.subfolders,n=0,o=r.length;o>n;n++)t=r[n],i[t.name]=p(t);return[s,i]},{DEFAULT_SYNC_SETTING:n,ManagedSyncActionTypes:i,InfinitePolicy:o,InfinitePolicySetting:r,defaultSyncSettingToApi:c,getDefaultSyncSetting:u,ManagedSyncInfo:s,serverManagedSyncInfoToRecord:p,serverManagedSyncInfoMapToRecord:d,SHOULD_RENDER_SIZE_COL:a}}),define("modules/clean/teams/limited_team_invite_form",["external/underscore","external/classnames","external/react","modules/core/uri","modules/core/i18n","modules/clean/react_format","modules/clean/ajax","modules/clean/css","modules/clean/contacts/contact","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/react/input","modules/clean/react/modal"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S,w,T,C,I,P,A,N,O;b=r._,O=r.ungettext,A=i.reactFormat,h=l.Contact,m=c.ContactsTokenizer,_=c.ContactTokenState,E=p.Modal,w=n.DOM,P=n.PropTypes,f=function(){function e(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}return e.prototype.whenReady=function(e){return this.inFlight?this.callbacks.push(e):e()},e.prototype.resultArrived=function(e,t){var n,o,r,i;if(this.inFlight){for(this.inFlight=!1,this.canInvite=e,this.reason=t,i=this.callbacks,o=0,r=i.length;r>o;o++)(n=i[o])();return delete this.callbacks}},e}(),g=function(){function e(e){this.checkUrl=e,this.checkedEmails={}}return e.prototype.checkEmails=function(e,t){var n,o,r,i,a,l,c;if(l={},c=e.length,0===c)return t(l);for(r=[],i=0,a=e.length;a>i;i++)o=e[i],n=this.checkedEmails[o],n||(n=this.checkedEmails[o]=new f,r.push(o)),n.whenReady(function(){return l[o]=n,0===--c?t(l):void 0});!function(e){return function(t){return s.WebRequest({url:e.checkUrl,data:{emails:t.join(",")},success:function(t){var n,r,i,s,a,l;i=JSON.parse(t),l=[];for(o in i)s=i[o],n=s.can_invite,r=s.reason,l.push(null!=(a=e.checkedEmails[o])?a.resultArrived(n,r):void 0);return l},error:function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)o=t[n],i.push(delete e.checkedEmails[o]);return i}})}}(this)(r)},e.prototype.getEmailCheckResult=function(e){return this.checkedEmails[e]},e}(),v={existingTeam:{id:"existingTeam",checkUrl:"/team/manage/check_can_invite"},createLimitedTeam:{id:"createLimitedTeam",checkUrl:"/team/create_limited/check_can_invite"}},T={};for(I in v)N=v[I],C=N.id,S=N.checkUrl,T[C]=new g(S);return y=n.createClass({displayName:"LimitedTeamInviteForm",propTypes:{user:P.object.isRequired,invitationContext:P.oneOf(e.values(v)),populatedCustomMessage:P.string,populatedContacts:P.arrayOf(P.instanceOf(h)),customClass:P.string,onChange:P.func,emailPlaceholder:P.string,messagePlaceholder:P.string,errorMessageSpaceFixed:P.bool,emailCheckerStore:P.object,includeCustomMessage:P.bool,autofocusTokenizer:P.bool,memberInviteLimit:P.number,maxTeamSize:P.number,tokenSpacing:P.number},statics:{InvitationContexts:v},getDefaultProps:function(){return{customClass:"",invitationContext:v.existingTeam,populatedContacts:[],emailPlaceholder:b("Name or email"),messagePlaceholder:b("Add a message (optional)"),includeCustomMessage:!0,autofocusTokenizer:!0}},getInitialState:function(){return{errorMessage:null}},componentWillMount:function(){return a.require_css("/static/css/teams/limited_team_invite_form-vflcSjpys.css"),a.require_css("/static/css/react/contacts_tokenizer-vflR5K70C.css"),this.emailCheckerStore=this.props.emailCheckerStore||T[this.props.invitationContext.id],this.props.populatedContacts.length>0?this._ensureContactsStateUpdated(this.props.populatedContacts,function(e){return function(){var t;return e._updateErrorMessage(),"function"==typeof(t=e.props).onChange?t.onChange():void 0}}(this)):void 0},getContacts:function(){return this.refs.tokenizer.getContacts()},getFinalData:function(t){var n,o;return this.refs.tokenizer.tokenizeAll(),n=this.getContacts(),this.props.includeCustomMessage&&(o=this.refs.message.getValue()),this._ensureContactsStateUpdated(n,function(r){return function(){var i,s;return i=e.filter(n,function(e){return e.type===u.EMAIL}),s=e.map(i,function(e){return e.email}),r._updateErrorMessage(),t({emails:s,custom_message:o})}}(this))},areAllContactsValid:function(){var t;return this._overInviteLimit()?!1:(t=this.refs.tokenizer.serializeInputData().tokens,
0===t.length?!0:e.all(t,function(e){return function(t){return e._validateContact(t).state===_.ok}}(this)))},isEmpty:function(){var e,t,n;return e=this.refs.tokenizer.serializeInputData(),t=e.tokens,n=e.value,0===t.length&&0===n.length},_ensureContactsStateUpdated:function(t,n){var o;return t=e.filter(t,function(e){return e.type===u.EMAIL&&!e.invalid&&!e.on_team}),o=e.map(t,function(e){return e.email}),this.emailCheckerStore.checkEmails(o,function(e){return function(){return e.isMounted()?n():void 0}}(this))},_validateContact:function(e){var t,n;return e.invalid?n={state:_.invalid,msg:b("Invalid email.")}:e.on_team?n={state:_.invalid,msg:b("User is already a member of this team.")}:(t=this.emailCheckerStore.getEmailCheckResult(e.email),n=t?t.inFlight?{state:_.pending}:t.canInvite?{state:_.ok}:{state:_.invalid,msg:function(){switch(t.reason){case"team_member":return b("This person is already on another team.");case"already_on_this_team":return b("User is already invited to this team.");case"error":return b("User isn’t eligible to join this team.");default:return null}}()}:{state:_.invalid}),n},_overInviteLimit:function(){var e;return e=this.refs.tokenizer.serializeInputData().tokens,null!=this.props.memberInviteLimit&&e.length>this.props.memberInviteLimit},_updateErrorMessage:function(){var e,t,n,r,i,s,a,l,c;for(s=this.refs.tokenizer.serializeInputData().tokens,t=0,n=s.length;n>t;t++)if(e=s[t],a=this._validateContact(e),l=a.state,r=a.msg,l!==_.ok)return void this.setState({errorMessage:r});return this._overInviteLimit()?(i={tk:this.props.maxTeamSize,_camp:"invite"},c=o({path:"/team/upgrade",query:i}),void this.setState({errorMessage:A(O("You have %(num_rem)s invite remaining. <upgradeLink>Upgrade</upgradeLink> now to add as many members as you like to your team.","You have %(num_rem)s invites remaining. <upgradeLink>Upgrade</upgradeLink> now to add as many members as you like to your team.",this.props.memberInviteLimit),{num_rem:this.props.memberInviteLimit,upgradeLink:w.a({href:c.toString()})})})):this.setState({errorMessage:null})},onContentsChange:function(e,t){return this._ensureContactsStateUpdated(e,function(e){return function(){var t;return e._updateErrorMessage(),"function"==typeof(t=e.props).onChange?t.onChange():void 0}}(this))},render:function(){var e;return e={"limited-team-invite-form":!0,"error-message-fixed":this.props.errorMessageSpaceFixed,"has-custom-message":this.props.includeCustomMessage},this.props.customClass&&(e[this.props.customClass]=!0),w.div({className:t(e)},w.div({className:"error-message u-mar-bottom-xss"},this.state.errorMessage),n.createElement(m,{ref:"tokenizer",user:this.props.user,placeholder:this.props.emailPlaceholder,onContentsChange:this.onContentsChange,autofocus:this.props.autofocusTokenizer,populatedInputData:{tokens:this.props.populatedContacts,value:""},tokenSpacing:this.props.tokenSpacing,customContactValidator:this._validateContact,customContactFilter:function(e){return function(t){return t.type===u.EMAIL&&!t.team&&t.name&&t.email!==e.props.user.email}}(this)}),this.props.includeCustomMessage?n.createElement(d.textarea,{ref:"message",className:"custom-message","disable-errors":!0,placeholder:this.props.messagePlaceholder,value:this.props.populatedCustomMessage}):void 0)}})}),define("modules/clean/teams/membership_discovery_util",["modules/clean/ajax","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i){var s,a,l,c,u,d,p,h,_;return s=t.TRADEMARK_BUSINESS,a=o._,_=o.ungettext,c=function(t,n){return e.WebRequest({url:"/team/discover/get_discoverable_team_for_folder",type:"POST",data:{ns_id:t},success:function(e){return e=JSON.parse(e),n(null!=e?e.team:void 0)},error:function(){return n()}})},p=function(t,o){return e.WebRequest({url:"/team/discover/join_ajax",data:{team_id:t,cont:"#"},success:function(e){switch(e=JSON.parse(e),null!=e?e.result:void 0){case"request_sent":r.success(a("Request to join sent."));break;case"can_join":n.redirect(e.url);break;case"max_team_size_achieved":r.error(a("This team has reached the maximum size. Please ask the admins of this team to upgrade to %(trademark_business)s, which allows teams to add as many members as possible.").format({trademark_business:s}));break;case"pending_approval":r.success(a("Your request to join is pending."));break;default:r.error(a("Invalid request"))}return"function"==typeof o?o(e):void 0},error:function(){return r.error(a("Error sending request.")),"function"==typeof o?o():void 0}})},d=function(t,n,o){return e.WebRequest({url:"/account/team/add_users",subject_user:n,data:{emails:t,team_id:o},success:function(e){var t;return e=JSON.parse(e),e.num_invited?(t=_("Invitation sent.","Invitations sent.",e.num_invited),r.success(t)):void 0},error:function(){var e;return e=_("Error sending invitation.","Error sending invitations.",t.length),r.error(e)}})},u=function(t,o,s){return e.WebRequest({url:"/account/team/add_users",subject_user:o,data:{emails:t,team_id:s},success:function(e){var t;return e=JSON.parse(e),e.num_invited?(t=_("Invitation sent.","Invitations sent.",e.num_invited),r.success(t)):void 0},error:function(){return h(t,function(){return n.redirect(new i({path:"/team/admin/requests",query:{invite_emails:t}}))})}})},h=function(t,n,o){return e.WebRequest({url:"/team/discover/suggest_ajax",data:{emails:JSON.stringify(t)},success:function(e){var o;return o=_("Suggestion sent.","Suggestions sent.",t.length),r.success(o),"function"==typeof n?n(e):void 0},error:function(){var e;return e=_("Error sending suggestion.","Error sending suggestions.",t.length),r.error(e),"function"==typeof o?o():void 0}})},l=function(t,n,o){return e.WebRequest({url:"/team/discover/filter_suggestable_ajax",type:"POST",data:{emails:JSON.stringify(t)},success:function(e){return e=JSON.parse(e),"function"==typeof n?n(e):void 0},error:function(){return"function"==typeof o?o():void 0}})},{getDiscoverableTeamForFolder:c,sendAdminTeamInvitations:u,sendTeamRequest:p,sendLimitedTeamInvitations:d,sendTeamSuggestions:h,filterSuggestableUsers:l}}),define("modules/clean/teams/membership_request_block",["external/react","jquery","modules/clean/analytics","modules/clean/avatar/triple_avatars","modules/clean/react/button","modules/clean/react/css","modules/clean/teams/membership_discovery_util","modules/clean/viewer","modules/constants/python","modules/constants/teams","modules/core/browser","modules/core/cookies","modules/core/i18n","modules/core/notify","modules/core/user_i18n"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h,_){var m,f,g,v,y,E,b,S,w,T,C,I;return v=n.TeamsWebActionsLogger,y=o.TripleAvatars,S=r.button,C=s.sendTeamRequest,g=l.TRADEMARK_BUSINESS,w=e.createElement,T=e.DOM,I=a.get_viewer(),m="_MRBD",E=p.i18n_default_project("sharing")._,b=e.createClass({displayName:"MembershipRequestBlock",propTypes:{membershipRequestOptions:e.PropTypes.shape({contacts:e.PropTypes.arrayOf(e.PropTypes.object),limited:e.PropTypes.bool,id:e.PropTypes.int,name:e.PropTypes.string,size:e.PropTypes.int})},getInitialState:function(){return{isUnloaded:"true"===d.read(m)}},componentDidMount:function(){var e,t,n,o,r,i,s;return r="V1"===c.SUBGROWTH_BIZ_UPSELL_VARIANT,i=this.props.membershipRequestOptions,s=this.state.isUnloaded,r&&i&&!s?v.log("magnet_sl_request_to_join_block_open",{user_id:null!=(e=I.personal_user)?e.id:void 0,requested_team_id:null!=(t=this.props.membershipRequestOptions)?t.id:void 0,is_limited:null!=(n=this.props.membershipRequestOptions)?n.limited:void 0,size:null!=(o=this.props.membershipRequestOptions)?o.size:void 0}):void 0},render:function(){var e;return"V1"!==c.SUBGROWTH_BIZ_UPSELL_VARIANT||!this.props.membershipRequestOptions||this.props.membershipRequestOptions.size>=100?T.div({}):this.state.isUnloaded?T.div({}):T.div({className:"membership-request-block u-pad-top-m"},T.div({className:"membership-request-block__close",onClick:this.onCloseClick}),T.div({className:"u-mar-top-m"},T.div({className:"membership-request-block__avatars"},w(y,{contacts:this.props.membershipRequestOptions.contacts,count:this.props.membershipRequestOptions.size})),T.div({},T.div({className:"membership-request-block__header u-mar-top-m"},E("Join %(name)s and your coworkers on the %(team_name)s Dropbox team").format({name:null!=(e=this.props.membershipRequestOptions.contacts[0])?e.display_name:void 0,team_name:this.props.membershipRequestOptions.name})),this.props.membershipRequestOptions.limited?T.div({className:"membership-request-block__subheader u-mar-top-xs"}):T.div({className:"membership-request-block__subheader u-mar-top-xs"},"ON"===c.SUBGROWTH_BIZ_ORION_LAUNCH_VARIANT?E("Unlock business tools and get more space for sharing and collaboration—ask your admin to add you to the %(team_name)s team.").format({team_name:this.props.membershipRequestOptions.name}):E("Unlock business tools and get all the space you need—ask your admin to add you to the %(team_name)s team.").format({team_name:this.props.membershipRequestOptions.name}))),T.button({className:"c-btn c-btn--primary c-btn--big u-mar-top-l",onClick:this.onRequestClick},E(this.props.membershipRequestOptions.limited?"Join the team":"Request to join"))))},requestMembership:function(){return C(this.props.membershipRequestOptions.id)},onRequestClick:function(){var e,t,n,o;return v.log("magnet_sl_request_to_join_block",{user_id:null!=(e=I.personal_user)?e.id:void 0,requested_team_id:null!=(t=this.props.membershipRequestOptions)?t.id:void 0,is_limited:null!=(n=this.props.membershipRequestOptions)?n.limited:void 0,size:null!=(o=this.props.membershipRequestOptions)?o.size:void 0}),this.requestMembership(),this.setState({isUnloaded:!0})},onCloseClick:function(){var e,t,n,o;return v.log("magnet_sl_skip_request_to_join_block",{user_id:null!=(e=I.personal_user)?e.id:void 0,requested_team_id:null!=(t=this.props.membershipRequestOptions)?t.id:void 0,is_limited:null!=(n=this.props.membershipRequestOptions)?n.limited:void 0,size:null!=(o=this.props.membershipRequestOptions)?o.size:void 0}),d.create(m,"true"),this.setState({isUnloaded:!0})}}),f=i(b,["/static/css/scooter/scooter-scoped-vflebHNBy.css","/static/css/teams/membership_request_block-vfly7tYHH.css"]),{MembershipRequestBlock:f}}),define("modules/clean/teams/modals/create_team_prompt_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/react/button","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){"use strict";var h;!function(e){e[e.CLICK_CREATE=0]="CLICK_CREATE",e[e.DISMISS=1]="DISMISS",e[e.CLICK_NEXT_TIME=2]="CLICK_NEXT_TIME"}(h||(h={}));var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCreate=function(){var e=t.props.invitedMembers.map(function(e){return e.email}).filter(function(e){return"string"==typeof e&&""!==e}),n=new p({path:"/team",query:{tk:"tib_upsell",invite_members:e.join(",")}});u.redirect(n.toString()),t.logClick(h.CLICK_CREATE)},t.onClickNextTime=function(){l.Modal.close(),t.logClick(h.CLICK_NEXT_TIME)},t.onDismiss=function(){r.WebRequest({url:"/team/stop_show_create_team_modal"}),t.logClick(h.DISMISS)},t}return n.__extends(t,e),t.prototype.logClick=function(e){i.TeamsWebActionsLogger.log("share_crt_team_modal",{num_shared:this.props.invitedMembers.length,clicked_create:e===h.CLICK_CREATE,clicked_nxt_time:e===h.CLICK_NEXT_TIME,dismissed:e===h.DISMISS})},t.prototype.renderButtons=function(){return o.createElement("div",{className:"db-modal-buttons"},o.createElement(s.Button,{className:"dbmodal-button",importance:"primary",onClick:this.onClickCreate},d._("Create free work Dropbox")),o.createElement(s.Button,{className:"dbmodal-button",importance:"tertiary",onClick:this.onClickNextTime},d._("Ask me next time")))},t.prototype.render=function(){for(var e=[],t=0,n=this.props.invitedMembers;t<n.length;t++){var r=n[t];r.name&&r.name!==r.email&&e.push(r.name)}var i=d._("Work with these people often?");return 2===e.length&&2===this.props.invitedMembers.length?i=d._("Work with %(firstname_1)s and %(firstname_2)s often?").format({firstname_1:e[0],firstname_2:e[1]}):3===e.length&&3===this.props.invitedMembers.length&&(i=d._("Work with %(firstname_1)s, %(firstname_2)s, and %(firstname_3)s often?").format({firstname_1:e[0],firstname_2:e[1],firstname_3:e[2]})),o.createElement(l.Modal,{style:"clean",className:"create-team-modal-after-sharing",buttonComponent:this.renderButtons(),onDismiss:this.onDismiss,clickOutToClose:!1,showX:!0,width:500},o.createElement("div",null,o.createElement(a,{className:"create-team-modal__team-illo u-mar-top-l",alt:d._("Work together"),src:c.static_url("/static/images/teams/modals/illo_how-create-vfl99WbqQ.png"),srcHiRes:c.static_url("/static/images/teams/modals/illo_how-create@2x-vflvsB25f.png")}),o.createElement("h1",{className:"create-team-modal__header u-mar-top-m u-mar-bottom-s"},i),o.createElement("div",{className:"create-team-modal__subheader"},d._("Get a free 2 GB work Dropbox to organize projects in one place,               collaborate from anywhere, and stay in sync."))))},t}(o.Component);t.CreateTeamPromptModal=_}),define("modules/clean/teams/modals/suggest_team_invite_modal",["external/react","external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/ajax","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/teams/limited_team_invite_form","modules/clean/react/modal","modules/clean/react/input","modules/clean/viewer"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E;return g=o._,f=i.TeamsWebActionsLogger,h=a.Contact,_=u.Modal,v=e.DOM,y=e.PropTypes,E=p.get_viewer(),m=e.createClass({displayName:"SuggestTeamInviteModal",statics:{showIfNeeded:function(n,o){return m.showInviteModal(function(r){return r?m.validateSuggestions(n,function(r){var i;return r.length>0?("function"==typeof o.onCheckCompleted&&o.onCheckCompleted(!0),o=t.extend({},o,{usersSharedOnFolder:n.emails,suggestedUsersToInviteToTeam:r}),i=e.createElement(m,o),_.showInstance(i)):"function"==typeof o.onCheckCompleted?o.onCheckCompleted(!1):void 0}):"function"==typeof o.onCheckCompleted?o.onCheckCompleted(!1):void 0})},validateSuggestions:function(e,t){return s.WebRequest({url:"/team/validate_emails_to_suggest_inviting",data:{emails_to_verify:JSON.stringify(e.emails)},success:function(e){return e=JSON.parse(e),t(e)}})},showInviteModal:function(e){var t;return(null!=(t=E.work_user)?t.is_team:void 0)?m._getShouldShowInviteModalData(function(t){return e(t.isOnLimitedTeam&&!t.hasSeenSuggestTeamInviteModal)}):e(!1)},_getShouldShowInviteModalData:function(e){return s.WebRequest({url:"/team/should_show_invite_modal",success:function(t){return t=JSON.parse(t),e(t)}})}},propTypes:{sharingType:y.string.isRequired,suggestedUsersToInviteToTeam:y.arrayOf(y.string).isRequired,usersSharedOnFolder:y.arrayOf(y.string),teamName:y.string,onDidAccept:y.func,onDidDismiss:y.func,onDidClose:y.func},getDefaultProps:function(){return{onDidAccept:function(){},onDidDismiss:function(){},teamName:E.team_name}},getInitialState:function(){return{canAccept:this.props.suggestedUsersToInviteToTeam.length>0,submitting:!1,errors:null}},_canAccept:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onAccept:function(e){return this.refs.members.getFinalData(function(e){return function(o){var i,a,l;return l=o.emails,a=o.custom_message,i=e._canAccept(),e.setState({canAccept:i}),i?(e.setState({submitting:!0}),s.WebRequest({url:"/account/team/add_users",subject_user:E.work_user,data:{emails:l,custom_message:a,team_id:E.team_id},complete:function(){return null!=e.refs.modal?e.setState({submitting:!1}):void 0},success:function(n){var o,i,s,a,c;return n=JSON.parse(n),a=t.values(n.users),c=void 0,1===a.length?c=g("Member invited."):a.length>1&&(c=g("Members invited.")),c?(r.success(c),f.log("team_member_invited_to_team_while_sharing",s={sharing_type:e.props.sharingType,num_users_invited_to_team:null!=l?l.length:void 0}),"function"==typeof(o=e.props).onDidAccept&&o.onDidAccept(),e.refs.modal.close(),"function"==typeof(i=e.props).onDidClose?i.onDidClose():void 0):r.error(g("There was a problem completing this request."))},error:function(e){return"rate-limit"===e.getResponseHeader("x-dropbox-app-error")?r.error(new n(g('%(team_name)s has reached the maximum number of team members allowed on Dropbox Basic. Please <a href="/business/contact">contact sales</a> to add more members to your team.').format({team_name:E.team_name}))):r.error(g("There was a problem completing this request."))}})):void 0}}(this))},onDidDismiss:function(){var e,t;return"function"==typeof(e=this.props).onDidDismiss&&e.onDidDismiss(),"function"==typeof(t=this.props).onDidClose?t.onDidClose():void 0},onMembersFormChange:function(){return this.setState({canAccept:this._canAccept()})},componentDidMount:function(){var e,t,n;return f.log("team_member_saw_suggestions_while_sharing",e={sharing_type:this.props.sharingType,num_users_shared:null!=(t=this.props.usersSharedOnFolder)?t.length:void 0,num_users_suggested_to_team:null!=(n=this.props.suggestedUsersToInviteToTeam)?n.length:void 0}),s.WebRequest({url:"/team/saw_suggest_team_invite_modal"})},render:function(){var t,n;return n=function(){var e,n,o,r;for(o=this.props.suggestedUsersToInviteToTeam,r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push(new h({email:t,type:l.EMAIL}));return r}.call(this),e.createElement(_,{className:"suggest-team-invite-modal",title:g("Do you want to invite these people to join your “%(team_name)s” team?").format({team_name:this.props.teamName}),acceptButtonText:g("Invite"),dismissButtonText:g("No thanks"),acceptButtonDisabled:!this.state.canAccept,submitting:this.state.submitting,onAccept:this.onAccept,onDismissCompleted:this.onDidDismiss,autoClose:!1,ref:"modal"},e.createElement(c,{ref:"members",errorMessageSpaceFixed:!0,invitationContext:c.InvitationContexts.existingTeam,onChange:this.onMembersFormChange,user:E.work_user,populatedContacts:n,autofocusTokenizer:!0}))}})}),define("modules/clean/teams/team_assume_user_personal_locked_modal",["external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,n){var o,r,i,s,a;return i=t._,r=n.Modal,a=e.DOM,s=e.createElement,o=e.createClass({displayName:"AssumePersonalLockedModal",statics:{show:function(e){return r.showInstance(s(o,e))}},propTypes:{displayName:e.PropTypes.string,teamName:e.PropTypes.string},_close:function(e){return e.preventDefault(),r.close()},_getModalProps:function(){return{title:i("Personal account not accessible"),acceptButtonText:i("Close"),dismissButtonText:null,onAccept:this._close}},render:function(){return s(r,this._getModalProps(),a.div({className:"team-assume-user-modal"},i("%(display_name)s’s personal account isn’t managed by the %(team_name)s team, so its contents aren’t accessible to admins.").format({display_name:this.props.displayName,team_name:this.props.teamName})))}}),{AssumePersonalLockedModal:o}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/teams/team_folder_modal",["modules/core/browser","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/dbmodal"],function(e,t,n){var o,r;return o=n.DBModal,r=function(n){function o(){return this.on_confirm_button_click=bind(this.on_confirm_button_click,this),this._$form=bind(this._$form,this),o.__super__.constructor.apply(this,arguments)}return extend(o,n),o.prototype._$form=function(){return this.$modal_window.find(".new_team_folder_form")},o.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this._$form().submit()},o.prototype.on_show=function(){var n;return n=this._$form(),new t(n),n.on(t.SUCCESS_EVENT,function(t){return function(n,o){return t.options.open_created_folder?e.redirect(o.sf_info.href):e.reload()}}(this)),this.options.back_fn?this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn(t,e)}}(this)):void 0},o}(o)});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/tokenizer",["external/classnames","external/react","external/react-dom","jquery","external/underscore","modules/clean/keycode","modules/clean/typeahead"],function(e,t,n,o,r,i,s){var a,l,c,u;return c=s.TypeaheadSelector,u=t.DOM,a=t.createClass({displayName:"Token",propTypes:{className:t.PropTypes.string,data:t.PropTypes.any,onRemove:t.PropTypes.func},render:function(){var t;return t={"tokenizer-token":!0},t[this.props.className]=!0,u.a(o.extend({tabIndex:-1},this.props,{className:e(t)}),String(this.props.data),this._makeCloseButton())},_makeCloseButton:function(){return this.props.onRemove?u.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),l=t.createClass({displayName:"Tokenizer",propTypes:{customClass:t.PropTypes.string,dataSource:t.PropTypes.object.isRequired,initialInputText:t.PropTypes.string,logSearchBegin:t.PropTypes.func,logSearchComplete:t.PropTypes.func,logTokenChangeEvent:t.PropTypes.func,onContentsChange:t.PropTypes.func,onTokensAdd:t.PropTypes.func,onTokenRemove:t.PropTypes.func,placeholderText:t.PropTypes.string,populatedTokenData:t.PropTypes.array,renderToken:t.PropTypes.func.isRequired,renderTokenHover:t.PropTypes.func,renderInput:t.PropTypes.func.isRequired,renderSelector:t.PropTypes.func.isRequired,stringTokenizer:t.PropTypes.func.isRequired,tokenSpacing:t.PropTypes.number,focusOnMount:t.PropTypes.bool,tabIndex:t.PropTypes.number},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return u.input()},renderSelector:function(){return t.createElement(c,null)},renderToken:function(e){return t.createElement(a,{data:e})},stringTokenizer:function(e,t){var n,o;return n=e.split(","),o=t?"":n.pop(),{tokens:n,value:o}},tokenSpacing:3,focusOnMount:!1,logSearchBegin:null,logSearchComplete:null}},getInitialState:function(){return this.tokenData=[],this.queryResults=null,{queryResults:this.queryResults,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount:function(){var e,t;return setTimeout(this._resizeTokenizerInput,0),n.findDOMNode(this.refs.input).value=this.props.initialInputText,o(n.findDOMNode(this.refs.tokenizer_input)).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&n.findDOMNode(this.refs.input).focus(),"function"==typeof(e=this.props.dataSource).registerForUpdates&&e.registerForUpdates(this._dataUpdatedCallback),(null!=(t=this.props.populatedTokenData)?t.length:void 0)>0?this._addTokens(this.props.populatedTokenData,!1,null):void 0},componentWillUnmount:function(){return o(n.findDOMNode(this.refs.tokenizer_input)).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(){return this._resizeTokenizerInput()},render:function(){var t,n;return t={"react-tokenizer":!0},null!=this.props.customClass&&(t[this.props.customClass]=null!=this.props.customClass),n={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},this.state.numLines>3&&(n.overflowY="auto",n.overflowX="visible"),u.div({onClick:this._handleMyClick,className:e(t)},u.div({className:"tokenizer-input",ref:"tokenizer_input",style:n},u.div({className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:n.findDOMNode(this.refs.input).value}},tokenizeAll:function(){var e,t;return e=n.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value,!0).tokens,t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens:function(e){this._addTokens(e,!1,null),this.refs.selector.close()},_getCurrentValue:function(){var e,t,o,r;return e=n.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value),o=t.tokens,r=t.value,r},queryDataSource:function(e){var t,n,o;return n=function(t){return function(n){var o,i;return e||(n=null),o=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},i=r.map(t.tokenData,o),n=null!=n?n.filter(function(e){var t;return t=o(e),indexOf.call(i,t)<0}):null}}(this),o=function(t){return function(o){var r;return o=n(o),t.queryResults=o,t.setState({queryResults:t.queryResults}),"function"==typeof(r=t.props).logSearchComplete?r.logSearchComplete(e,(null!=o?o.length:void 0)||0,!0):void 0}}(this),t=function(t){return function(o){var r;return e===t._getCurrentValue()&&(o=n(o),o&&o.length&&(t.queryResults=t.queryResults?t.queryResults.concat(o):o,t.setState({queryResults:t.queryResults}))),"function"==typeof(r=t.props).logSearchComplete?r.logSearchComplete(e,(null!=o?o.length:void 0)||0,!1):void 0}}(this),this.props.dataSource.query(e,o,t)},_dataUpdatedCallback:function(){var e,t;return this.isMounted()?(e=Boolean(this.state.queryResults),null!=(t=this.refs.selector)&&"function"==typeof t.reset&&t.reset(),e&&n.findDOMNode(this.refs.input).focus(),this.queryDataSource(n.findDOMNode(this.refs.input).value)):void 0},_addTokens:function(e,t,o){var i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b;for(null==t&&(t=!1),null==o&&(o=null),c=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},b=r.map(this.tokenData,c),m=[],u=0,h=e.length;h>u;u++)E=e[u],p=c(E),indexOf.call(b,p)<0&&(m.push(E),b.push(p));for(this.tokenData=this.tokenData.concat(m),this.setState({tokenData:this.tokenData}),"function"==typeof(i=this.props).onTokensAdd&&i.onTokensAdd(m,this),"function"==typeof(s=this.props).onContentsChange&&s.onContentsChange(this.tokenData,null!=(f=n.findDOMNode(this.refs.input))?f.value:void 0),l=t?{search_expr:o,selected_pos:(null!=(g=this.refs.selector)?g.state.selectionIndex:void 0)||0,num_query_results:null!=(v=this.state.queryResults)?v.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1},y=[],d=0,_=m.length;_>d;d++)E=m[d],y.push("function"==typeof(a=this.props).logTokenChangeEvent?a.logTokenChangeEvent(E,!1,l):void 0);return y},_addToken:function(e,t,n){return null==t&&(t=!1),null==n&&(n=null),this._addTokens([e],t,n)},removeTokens:function(e){var t,o,r,i,s,a,l,c,u,d,p,h,_,m;for(m=this.state.selectedTokenIndex,_=[],a=0,u=e.length;u>a;a++)i=e[a],h=this.tokenData.indexOf(i),-1!==h&&(m===h?m=null:m>h&&(m-=1),this.tokenData.splice(h,1),_.push(i));for(s=n.findDOMNode(this.refs.input),s.focus(),this._setSelectedToken(m),this.queryResults=null,this.setState({tokenData:this.tokenData,queryResults:this.queryResults}),l=0,d=_.length;d>l;l++)i=_[l],"function"==typeof(t=this.props).onTokenRemove&&t.onTokenRemove(i);for(c=0,p=_.length;p>c;c++)i=_[c],"function"==typeof(o=this.props).logTokenChangeEvent&&o.logTokenChangeEvent(i,!0);return"function"==typeof(r=this.props).onContentsChange?r.onContentsChange(this.tokenData,s.value):void 0},removeToken:function(e){return this.removeTokens([e])},replaceTokens:function(e){var t,o,i,s;return i=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},o=function(e){var t,n;return t=e[0],n=e[1],i(t)===i(n)},e.length===this.tokenData.length&&r.every(r.zip(this.tokenData,e),o)?void 0:(this.tokenData=e,this.setState({tokenData:e}),"function"==typeof(t=this.props).onContentsChange?t.onContentsChange(this.tokenData,null!=(s=n.findDOMNode(this.refs.input))?s.value:void 0):void 0)},_renderTokens:function(){var n,o,r,i,s,a,l,c,u,d,p,h;for(d=[],l=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},u=this.state.tokenData,s=a=0,c=u.length;c>a;s=++a)r=u[s],h=this.props.renderToken(r),p=this.state.selectedTokenIndex===s,i="function"==typeof(n=this.props).renderTokenHover?n.renderTokenHover(r):void 0,o=[{selected:p,"c-title-bubble":null!=i,"c-title-bubble--s":null!=i}],d.push(t.cloneElement(h,{ref:"token"+s,key:"token"+l(r),style:{margin:"0 0 "+this.props.tokenSpacing+"px "+this.props.tokenSpacing+"px"},className:e(o,h.props.className),"data-title":i,onClick:this._setSelectedToken.bind(this,s),onRemove:this.removeToken.bind(this,r),tokenSpacing:this.props.tokenSpacing}));return d},_renderSelector:function(){return t.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var e;return e=this.state.tokenData.length?"":this.props.placeholderText,t.cloneElement(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null)})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenComponents:function(){var e;return function(){var t,n,o;for(o=[],e=t=0,n=this.state.tokenData.length;n>=0?n>t:t>n;e=n>=0?++t:--t)o.push(this.refs["token"+e]);return o}.call(this).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(n.findDOMNode(this.refs["token"+e]).focus(),this.refs.selector.close()):n.findDOMNode(this.refs.input).focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(){var e,t,o,r,i,s,a,l,c,u,d,p,h;for(r=function(e){return n.findDOMNode(e).clientWidth},t=80,p=r(this._getTokenizerInput()),o=this.props.tokenSpacing+2,e=this.props.tokenSpacing,l=0,h=this._getTokenComponents(),c=1,s=0,a=h.length;a>s;s++)u=h[s],d=r(u)+o,l+d+e>p&&(c+=1,l=0),l+=d;return i=p-l-e-2,t>i&&(c+=1,i=p-e),i!==this.state.inputWidth&&this.setState({inputWidth:i}),c!==this.state.numLines?this.setState({numLines:c}):void 0},_onSelect:function(e){var t;return t=n.findDOMNode(this.refs.input),t.focus(),this._addToken(e,!0,t.value),t.value="",this.queryResults=null,this.setState({queryResults:this.queryResults})},_handleMyClick:function(e){var t;return"function"==typeof(t=e.nativeEvent).stopImmediatePropagation?t.stopImmediatePropagation():void 0},_handleDocumentClick:function(e){return this.refs.selector.close()},_proxyKeys:function(e){var t;if(this._shouldListenForTokenNavigation())switch(t=this.state.selectedTokenIndex,e.keyCode){case i.BACKSPACE:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]));case i.LEFT:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case i.RIGHT:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case i.DELETE:if(null!==t)return void this.removeToken(this.state.tokenData[t])}return this.refs.selector.onKeyDown(e),e.isDefaultPrevented()?void 0:e.keyCode===i.TAB&&""!==n.findDOMNode(this.refs.input).value?(this.tokenizeAll(),e.preventDefault()):void 0},_shouldListenForTokenNavigation:function(){var e;return this.state.tokenData.length?(e=n.findDOMNode(this.refs.input),0===e.selectionStart&&0===e.selectionEnd):!1},_textUpdated:function(){var e,t,o,r,i,s,a;return o=n.findDOMNode(this.refs.input),r=o.value,i=this.props.stringTokenizer(r),s=i.tokens,a=i.value,"function"==typeof(e=this.props).logSearchBegin&&e.logSearchBegin(a),a!==r&&(o.value=a,a||this.refs.selector.close()),s.length>0?this._addTokens(s,!1):"function"==typeof(t=this.props).onContentsChange&&t.onContentsChange(this.tokenData,a),this.queryDataSource(a)},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults
})}}),{Token:a,Tokenizer:l}}),define("modules/clean/top_notif",["jquery","modules/clean/ajax"],function(e,t){var n,o,r,i,s,a,l,c;return l={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){return e("#top-notification-bar-container").remove(),e("body").removeClass("top-notification-bar"),e(".maestro .has-top-notification").removeClass("has-top-notification"),e(".maestro #notify-wrapper.with-top-notification").removeClass("with-top-notification"),e(document).trigger(this.HIDE_EVENT)}},o={init:function(){return e(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_eu_cookie_notification"})})}},i={init:function(){return e(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_expired_ios_notification"})})}},s={init:function(){return e("#locale-switch-banner-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_locale_switch_banner"})})}},a={init:function(){return e("#super-inactive-recover-bar-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_super_inactive_recover_bar"})})}},c={init:function(){return e("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_browser_msg"})})}},r={init:function(n){return e(".expired-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_expired_cc_notification",data:{source:n}})})}},n={init:function(n){return e(".beta-locale-dismiss").on("click",function(e){return e.preventDefault(),l.hide(),t.SilentBackgroundRequest({url:"/dismiss_beta_locale_notification",data:{source:n}})})}},{TopNotificationBar:l,EUCookieNotificationBar:o,ExpiredIOSNotificationBar:i,LocaleSwitchBar:s,SuperInactiveRecoverBar:a,UnsupportedBrowser:c,ExpiredCCNotificationBar:r,BetaLocaleNotificationBar:n}}),define("modules/clean/typeahead",["external/classnames","external/react","external/react-dom","external/underscore","modules/clean/fuzzy","modules/clean/keycode","require"],function(e,t,n,o,r,i,s){var a,l,c,u,d;return d=t.DOM,l=function(){function e(e){this.local=(null!=e?e:{}).local}return e.prototype.query=function(e,t){var n;return n=o.map(r.filter(e,this.local),function(e){return e.original}),t(n)},e}(),u={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){var e;return this.props.queryOptions?(e=this.props.maxVisible||this.props.queryOptions.length,this.props.queryOptions.slice(0,e)):[]},renderOptions:function(){var n,o,r,i,s,a,l,c,u;for(u=[],c=this.getOptions(),s=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},i=r=0,a=c.length;a>r;i=++r)o=c[i],n={selected:this.state.selectionIndex===i,"typeahead-option":!0,"u-pad-xs":!0},l=this.renderOption(o),u.push(t.cloneElement(l,{className:e(n,l.props.className),key:"option"+s(o),onMouseEnter:this._hover.bind(this,i),onClick:this.onSelect.bind(this,o)}));return u},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){switch(e.keyCode){case i.UP:return this._navigate(-1),e.preventDefault();case i.DOWN:return this._navigate(1),e.preventDefault();case i.ENTER:return this._selectSelectionIndex(e);case i.ESC:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case i.TAB:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex:function(e){var t,n;return n=this.getOptions(),n.length&&(t=this.state.selectionIndex,-1!==t)?(this.onSelect(n[t]),e.preventDefault()):void 0},reset:function(){return this._changeSelectionIndex(0)},close:function(){var e;return"function"==typeof(e=this.props).onClose&&e.onClose(),this.reset()},_hover:function(e){return this._changeSelectionIndex(e)},_navigate:function(e){var t,n,o;return(n=this.getOptions().length)?(t=this.state.selectionIndex+e,o=n+1,-1>t?t+=o:t>=n&&(t-=o),this._changeSelectionIndex(t)):void 0},_changeSelectionIndex:function(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}},a=t.createClass({displayName:"Autocomplete",propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,dataSource:t.PropTypes.object.isRequired,onBlur:t.PropTypes.func,onSelect:t.PropTypes.func,onChange:t.PropTypes.func,placeholder:t.PropTypes.string,renderCompletionText:t.PropTypes.func.isRequired,renderInput:t.PropTypes.func.isRequired,renderSelector:t.PropTypes.func.isRequired,value:t.PropTypes.string,name:t.PropTypes.string},getDefaultProps:function(){return{value:"",maxVisible:7,onBlur:function(){},onSelect:function(e){},onChange:function(e){},renderCompletionText:function(e){return String(e)},renderInput:function(){return d.input()},renderSelector:function(){return t.createElement(c)}}},getInitialState:function(){return{queryResults:null,value:this.props.value,focus:!1}},render:function(){var t;return t={},t[this.props.customClass]=null!=this.props.customClass,d.div({className:e(t),onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave},this._renderInput(),this._renderSelector())},_onMouseOver:function(){return this.setState({focus:!0})},_onMouseLeave:function(){return this.setState({focus:!1})},_onBlur:function(){return this.props.onBlur(),this.state.focus?void 0:this._clearResults()},_onFocus:function(){return this._queryDataSource(this.state.value),this.refs.selector.reset()},_renderInput:function(){var e;return e=this.props.renderInput(),t.cloneElement(e,{ref:"input",onChange:function(t){return function(n){return null!=e.props.onChange&&e.props.onChange(n),t._inputChanged(n)}}(this),onKeyDown:function(t){return function(n){return null!=e.props.onKeyDown&&e.props.onKeyDown(n),t._proxyKeys(n)}}(this),onBlur:function(t){return function(n){return null!=e.props.onBlur&&e.props.onBlur(n),t._onBlur(n)}}(this),onFocus:function(t){return function(n){return null!=e.props.onFocus&&e.props.onFocus(n),t._onFocus(n)}}(this),placeholder:this.props.placeholder,value:this.state.value,name:this.props.name,autoComplete:"off"})},_renderSelector:function(){return t.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults,maxVisible:this.props.maxVisible})},_inputChanged:function(e){var t;return t=e.target.value,this.setState({value:e.target.value}),this.props.onChange(t),this._queryDataSource(t),this.refs.selector.reset()},_getCurrentValue:function(){return n.findDOMNode(this.refs.input).value},_queryDataSource:function(e){var t,n;return n=function(e){return function(t){return e.queryResults=t,e.setState({queryResults:e.queryResults})}}(this),t=function(t){return function(o){var r;return e===t._getCurrentValue()&&o&&o.length?(r=t.queryResults?t.queryResults.concat(o):o,n(r)):void 0}}(this),this.props.dataSource.query(e,n,t)},_proxyKeys:function(e){return this.refs.selector.onKeyDown(e)},_autocomplete:function(e){var t;return t=n.findDOMNode(this.refs.input),t.focus(),e=this.props.renderCompletionText(e),this.setState({value:e}),this.props.onSelect(e),this._clearResults()},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults})},componentWillReceiveProps:function(e){return this.setState({value:e.value})}}),c=t.createClass({displayName:"TypeaheadSelector",mixins:[u],propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,onClose:t.PropTypes.func.isRequired,onSelect:t.PropTypes.func.isRequired,queryOptions:t.PropTypes.array,renderQueryOption:t.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(e){},renderQueryOption:function(e){return d.li({},String(e))}}},render:function(){var t;return this.getOptions().length?(t={"typeahead-selector":!0},t[this.props.customClass]=null!=this.props.customClass,d.ul({className:e(t)},this.renderOptions())):d.div({})}}),{Autocomplete:a,DataSource:l,TypeaheadSelector:c,TypeaheadSelectorMixin:u}}),define("modules/clean/unity/check_file_cache",["modules/clean/unity/features"],function(e){var t;if(null!=e)return t=function(){function t(){}return t._cache={},t.is_cached_and_locally_available=function(t,n){var o;return o=this._cache[e.server_path(t,n)],null!=o&&o.is_locally_available},t.get=function(t,n){return this._cache[e.server_path(t,n)]},t.set=function(e,t){return this._cache[e]=t},t.set_batch=function(e){var t,n,o;n=[];for(o in e)t=e[o],n.push(this._cache[o]=t);return n},t.clear=function(){return this._cache={}},t}()});var bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/unity/connection",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/connection_error","modules/clean/unity/logger","modules/clean/unity/versions","modules/clean/unity/web_socket","modules/clean/viewer"],function(e,t,n,o,r,i,s,a,l,c){var u;if(l.web_sockets_supported())return u=function(){function u(){this._on_response_timeout=bind(this._on_response_timeout,this),this._on_message=bind(this._on_message,this),this._set_connection_state=bind(this._set_connection_state,this),this._on_error=bind(this._on_error,this),this._on_close=bind(this._on_close,this),r.getGandalfRule("unity-web-debug")&&(window.uc=this),this.client_version=null,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._ws=null,this._port=null,this._active_ports={},this._connection_state=u._CONNECTION_PENDING,this._current_message_id=1,this._permission_level=null,this.logger=new s,this._routes={check_unity_version:this._check_unity_version.bind(this),fetch_unity_nonce:this._fetch_unity_nonce.bind(this),complete_handshake:this._complete_handshake.bind(this)}}return u._CONNECTION_OPENED_STATE=0,u._VERSION_CHECK_STATE=1,u._FETCHING_NONCE_STATE=2,u._NONCE_RETURNED_TO_CLIENT_STATE=3,u._HANDSHAKE_COMPLETED_STATE=4,u._CONNECTION_PENDING=0,u._CONNECTION_ESTABLISHED=1,u._CONNECTION_CLOSED=2,u._CONNECTION_RETRYING=3,u._RESPONSE_TIMEOUT=5e3,u._MIN_PORT=17600,u._MAX_PORT=17602,u.SECURE_PERMISSION="secure",u.INSECURE_WEB_PERMISSION="insecure_web",u.INSECURE_CLIENT_PERMISSION="insecure_client",u.INSECURE_PERMISSION="insecure",u.prototype.start=function(){return l.load_flash_policy_if_needed()?this._attempt_handshake():void this._set_connection_state(u._CONNECTION_CLOSED)},u.prototype._attempt_handshake=function(){var e,t,o,r,i,s,a,c;try{for(r=o=i=u._MIN_PORT,s=u._MAX_PORT;s>=i?s>=o:o>=s;r=s>=i?++o:--o)this._active_ports[r]=!0,a={scheme:"ws",authority:"127.0.0.1:"+r.toString(),path:"/ws"},c=l.create(n(a).toString()),c.onmessage=this._on_message({ws:c,port:r,state:u._CONNECTION_OPENED_STATE,client_version:null,client_has_auth:null}),c.onclose=this._on_close(r),c.onerror=this._on_error(r)}catch(t){e=t,this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Message: "+e.message,error_name:e.name,port:r}),this._set_connection_state(u._CONNECTION_CLOSED)}return this.logger.report_event("handshake_started")},u.prototype._on_close=function(e){return function(t){return function(n){var o;return 1e3===(o=n.code)||1001===o||1005===o||1006===o||t.logger.report_event("unity_failure",{message:"WebSocket closed. Code: "+n.code+". Reason: "+n.reason,port:e}),t._close_port(e)}}(this)},u.prototype._on_error=function(e){return function(t){return function(n){return t.logger.report_event("unity_failure",{message:"WebSocket error. Message: "+n.data,port:e}),t._close_port(e)}}(this)},u.prototype._close_port=function(t){return t in this._active_ports&&(delete this._active_ports[t],e.isEmptyObject(this._active_ports))?this._connection_state===u._CONNECTION_ESTABLISHED?this._retry_connection():this._set_connection_state(u._CONNECTION_CLOSED):void 0},u.prototype._retry_connection=function(){return this.logger.report_event("connection_retrying"),this._set_connection_state(u._CONNECTION_RETRYING),this.client_version=this._ws=this._port=null,this._attempt_handshake()},u.prototype._set_connection_state=function(e){var n,o,r,s,a,l,c,d,p,h,_,m,f,g,v,y,E,b,S,w;if(e!==this._connection_state){if(h=this._connection_state,t.assert(h!==u._CONNECTION_CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===u._CONNECTION_ESTABLISHED){if(t.assert(this._is_connection_in_progress(h),"Can only establish from pending or retrying."),this.logger.report_event("handshake_complete"),h===u._CONNECTION_PENDING)for(g=this._on_open_callbacks,s=0,c=g.length;c>s;s++)(m=g[s])();for(S=[];this._pending_callbacks.length;)v=this._pending_callbacks.pop(),o=v[0],r=v[1],this.is_ready()?S.push(o()):S.push("function"==typeof r?r(i.UNEXPECTED_ERROR):void 0);return S}if(e!==u._CONNECTION_RETRYING){if(e===u._CONNECTION_CLOSED){if(h===u._CONNECTION_PENDING)for(this.logger.report_event("connection_not_established"),y=this._on_open_failed_callbacks,a=0,d=y.length;d>a;a++)(f=y[a])();else if(h===u._CONNECTION_RETRYING)for(this.logger.report_event("connection_terminated"),E=this._on_close_callbacks,l=0,p=E.length;p>l;l++)(_=E[l])();else t.assert(!1,"CONNECTION_CLOSED can only be set from PENDING or RETRYING");for(w=[];this._pending_callbacks.length;)b=this._pending_callbacks.pop(),n=b[0],r=b[1],w.push("function"==typeof r?r(i.CONNECTION_CLOSED):void 0);return w}return t.assert(!1,"Changing connection_state to CONNECTION_PENDING not supported.")}}},u.prototype._on_message=function(e){return function(t){return function(n){var o,r,i,s,a,l;return r=JSON.parse(n.data),null==r.func||null==(null!=(i=r.header)?i.message_id:void 0)||null==(null!=(s=r.header)?s.should_respond:void 0)?void t._terminate_handshake(e.ws,"Malformed message from client.",{message:n.data}):(null!=(null!=(a=r.header)?a.log_data:void 0)&&t.logger.update(r.header.log_data),t.logger.update({port:e.port}),"response"===r.func?t._on_response(r.header.message_id,r.data):(o=t._routes[r.func],null==o?void t._terminate_handshake(e.ws,"Unknown function.",{function:r.func}):(l=t.is_ready()?o(r.data):o(e,r.data),r.header.should_respond?t.send("response",l,null,null,r.header.message_id):void 0)))}}(this)},u.prototype.send=function(e,t,n,o,r){return null==t&&(t=null),null==n&&(n=null),null==o&&(o=null),null==r&&(r=null),this._send_with_ws(this._ws,e,t,n,o,r)},u.prototype._send_with_ws=function(e,n,o,r,s,a){var l,c,d,p;null==o&&(o=null),null==r&&(r=null),null==s&&(s=null),null==a&&(a=null),null==a&&(a=this._current_message_id,t.assert(this._current_message_id%2===1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==r&&(p=window.setTimeout(this._on_response_timeout(a),u._RESPONSE_TIMEOUT),this._response_callbacks[a]=[r,s,p]),d={func:n,header:{message_id:a,should_respond:null!==r,log_data:this.logger.get_log_data_for_client()}},null!=o&&(d.data=o);try{return e.send(JSON.stringify(d))}catch(e){return l=e,this.logger.report_event("unity_failure",{message:"WebSocket send failed. Message: "+l.message,error_name:l.name}),"function"==typeof s?s(i.COULD_NOT_SEND):void 0}},u.prototype._on_response=function(e,t){var n,o,r,i;return e in this._response_callbacks?(o=this._response_callbacks[e],r=o[0],n=o[1],i=o[2],delete this._response_callbacks[e],window.clearTimeout(i),r(t)):void 0},u.prototype._on_response_timeout=function(e){return function(t){return function(){var n,o,r;return r=t._response_callbacks[e],n=r[0],o=r[1],n=r[2],delete t._response_callbacks[e],"function"==typeof o?o(i.CONNECTION_TIMEOUT):void 0}}(this)},u.prototype._check_unity_version=function(e,t){var n;return e.state!==u._CONNECTION_OPENED_STATE?void this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol."):(e.state=u._VERSION_CHECK_STATE,e.client_version=t.client_version,t.client_version<a.UNITY_HANDSHAKE?void this._terminate_handshake(e.ws,"Client version is too old."):(n=c.get_viewer().is_signed_in,t.client_version<a.PERMISSION_LEVELS&&!n?void this._terminate_handshake(e.ws,"Client version is too old to support insecure web connections."):(this.logger.report_event("handshake_version_check"),t.client_version>=a.PERMISSION_LEVELS?this._send_with_ws(e.ws,"initiate_handshake",{secure_web:n}):this._send_with_ws(e.ws,"initiate_handshake"))))},u.prototype._fetch_unity_nonce=function(e,t){return e.state===u._VERSION_CHECK_STATE?(e.state=u._FETCHING_NONCE_STATE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},u.prototype._retrieve_unity_nonce=function(e,r){return o.WebRequest({url:n({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:r},success:function(n){return function(o){var r;switch(o.status){case"OK":return e.state=u._NONCE_RETURNED_TO_CLIENT_STATE,e.client_version>=a.PORT_CHECK&&(t.assert(o.message.client_port,"Port check must happen in version "+e.client_version),o.message.client_port!==e.port)?void n._terminate_handshake(e.ws,"Mismatched ports.",{client_port:o.message.client_port,web_port:e.port}):(e.client_has_auth=o.message.client_has_auth,r=c.get_viewer().is_signed_in,e.client_has_auth&&r?n._permission_level=u.SECURE_PERMISSION:(t.assert(e.client_version>=a.PERMISSION_LEVELS,"Insecure connections only supported by client_version >= "+a.PERMISSION_LEVELS+"."),n._permission_level=e.client_has_auth?u.INSECURE_WEB_PERMISSION:r?u.INSECURE_CLIENT_PERMISSION:u.INSECURE_PERMISSION),n.logger.update({unity_permission_level:n._permission_level}),n.logger.report_event("handshake_nonce_sent_to_unity_server"),n._send_with_ws(e.ws,"verify_unity_nonce",{nonce:o.message.nonce}));case"MISMATCHED_USER_IDS":return n._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:o.message.client_user_ids,web_user_ids:o.message.web_user_ids});case"INVALID":return n._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.");case"AUTH_REQUIRED":return n._terminate_handshake(e.ws,"Did not have the necessary authentication to retrieve nonce.");case"LOCAL_INFORMATION_PERMISSION_REQUIRED":return n._terminate_handshake(e.ws,"Did not have permission to start a local-information-allowed connection.")}}}(this),error:function(t){return function(n,o,r){return t._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:o,error_string:r})}}(this)})},u.prototype._complete_handshake=function(e,t){var n;return e.state===u._NONCE_RETURNED_TO_CLIENT_STATE&&t.is_success?(e.state=u._HANDSHAKE_COMPLETED_STATE,this._connection_state===u._CONNECTION_CLOSED?this._terminate_handshake(e.ws,"No more handshakes are allowed to complete."):null!=this._ws?(n="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.",this._terminate_handshake(e.ws,n),this._terminate_handshake(this._ws,n),this.client_version=null,this._ws=null,this._port=null,this._set_connection_state(u._CONNECTION_CLOSED)):(this.client_version=e.client_version,this._ws=e.ws,this._port=e.port,this._set_connection_state(u._CONNECTION_ESTABLISHED))):this._terminate_handshake(e.ws,"Unable to complete handshake.")},u.prototype._terminate_handshake=function(t,n,o){var i;return null==o&&(o=null),i={message:n},null!=o&&e.extend(i,o),r.getGandalfRule("unity-web-debug")&&console.error(i),this.logger.report_event("unity_failure",i),t?t.close():void 0},u.prototype._is_connection_in_progress=function(e){return e===u._CONNECTION_PENDING||e===u._CONNECTION_RETRYING},u.prototype.add_on_open_callback=function(e){return this._on_open_callbacks.push(e)},u.prototype.add_on_open_failed_callback=function(e){return this._on_open_failed_callbacks.push(e)},u.prototype.add_on_close_callback=function(e){return this._on_close_callbacks.push(e)},u.prototype.call_when_ready=function(e,t){return null==t&&(t=null),this.is_ready()?e():this._is_connection_in_progress(this._connection_state)?this._pending_callbacks.push([e,t]):"function"==typeof t?t(i.CONNECTION_CLOSED):void 0},u.prototype.is_ready=function(){var e;return(null!=(e=this._ws)?e.readyState:void 0)===WebSocket.OPEN&&this._connection_state===u._CONNECTION_ESTABLISHED},u.prototype.feature_supported=function(e,n){var o;return t.assert(null!==this._permission_level,"Connection is not ready."),this.client_version<e?!1:(o=this._permission_level,indexOf.call(n,o)>=0)},u}()}),define("modules/clean/unity/connection_error",[],function(){var e;return e=function(){function e(){}return e.CONNECTION_TIMEOUT="connection_timeout",e.CONNECTION_CLOSED="connection_closed",e.COULD_NOT_SEND="could_not_send",e.UNEXPECTED_ERROR="unexpected_error",e}()}),define("modules/clean/unity/features",["jquery","modules/clean/ajax","modules/clean/filepath","modules/clean/unity/connection","modules/clean/unity/versions","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,r,i,s,a,l){var c;if(null!=o)return c=function(){function c(){}return c._uc=new o,c._has_handshake_started=!1,c._start_handshake_if_needed=function(){return this._has_handshake_started?void 0:(this._uc.start(),this._has_handshake_started=!0)},c._cached_file_browser_display_name=null,c.continue_as_user=function(e,t,n,i){return null==i&&(i=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(s){return function(){return s._uc.feature_supported(r.WEB_DESTINY,[o.INSECURE_WEB_PERMISSION])?(s._uc.logger.report_event("continue_as_user",{browser:e,refresh_token:t}),s._uc.send("continue_as_user",{browser:e,refresh_token:t},n,i)):void 0}}(this),i)},c.continue_as_user_direct=function(e,t){return null==t&&(t=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(n){return function(){return n._uc.feature_supported(r.WEB_DESTINY_V2,[o.INSECURE_WEB_PERMISSION])?(n._uc.logger.report_event("continue_as_user_direct"),n._uc.send("continue_as_user_direct",null,e,t)):void 0}}(this),t)},c.web_destiny_info=function(e,t){return null==t&&(t=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(n){return function(){return n._uc.feature_supported(r.WEB_DESTINY_V2,[o.INSECURE_WEB_PERMISSION])?(n._uc.logger.report_event("web_destiny_info"),n._uc.send("web_destiny_info",null,e,t)):void 0}}(this),t)},c.client_supports_open_in_file_browser=function(){return this._uc.feature_supported(r.OPEN_IN_FILE_BROWSER,[o.SECURE_PERMISSION])},c.open_file=function(e,s,a,c,u,d){var p;return null==u&&(u=null),null==d&&(d=!1),this._start_handshake_if_needed(),p=this.server_path(e,s),this._uc.call_when_ready(function(e){return function(){var s;return e._uc.feature_supported(r.UNITY_HANDSHAKE,[o.SECURE_PERMISSION])?(e._uc.logger.report_event("open_file",{user_id:a,path_id:p,file_extension:n.file_extension(p),in_file_browser:d}),t.SilentBackgroundRequest({url:l({path:"/unity_open_log"}),data:{user_id:a,server_path:p,file_extension:n.file_extension(p),in_file_browser:d,unity_session_id:e._uc.logger.unity_session_id(),buildno:e._uc.logger._data.buildno,host_id:e._uc.logger._data.host_id}}),s={server_path:p,user_id:a},e._uc.client_version>=r.OPEN_IN_FILE_BROWSER?s.in_file_browser=d:i.assert(!d,"The connected client doesn't support opening in file browser."),e._uc.send("open_file",s,c,u)):void 0}}(this),u)},c.standard_open_file_handler=function(e){return e?void 0:a.error(s._("Error opening file"))},c.check_file=function(e,t,i,s,a){var l,c;return null==a&&(a=null),this._start_handshake_if_needed(),c=this.server_path(e,t),l=function(e){return function(t){return e._check_file_deprecated_on_client()&&(t={is_locally_available:t}),s(t)}}(this),this._uc.call_when_ready(function(e){return function(){return e._uc.feature_supported(r.UNITY_HANDSHAKE,[o.SECURE_PERMISSION])?(e._uc.logger.report_event("check_file",{user_id:i,path_id:c,file_extension:n.file_extension(c)}),e._uc.send("check_file",{server_path:c,user_id:i},l,a)):void 0}}(this),a)},c.add_on_ready_callback=function(e){return this._uc.call_when_ready(e)},c.check_file_batch=function(t,i,s,a){var l,c,u,d,p;return null==a&&(a=null),l=e.Deferred(),this._start_handshake_if_needed(),p=function(){var e,n,o;for(o=[],e=0,n=t.length;n>e;e++)u=t[e],o.push(this.server_path(u.ns_id,u.ns_path));return o}.call(this),d=function(e){return function(t){var n,o;if(e._check_file_deprecated_on_client())for(n in t)o=t[n],t[n]={is_locally_available:o};return s(t),l.resolve(t)}}(this),c=function(e){return"function"==typeof a&&a(e),l.reject(e)},this._uc.call_when_ready(function(e){return function(){var t;return e._uc.feature_supported(r.UNITY_HANDSHAKE,[o.SECURE_PERMISSION])?(e._uc.logger.report_event("check_file_batch",{user_id:i,path_ids:p,file_extensions:function(){var e,o,r;for(r=[],e=0,o=p.length;o>e;e++)t=p[e],r.push(n.file_extension(t));return r}()}),e._uc.send("check_file_batch",{server_paths:p,user_id:i},d,c)):void 0}}(this),c),l.promise()},c.file_browser_display_name=function(e,t){var n,i;return null==t&&(t=null),null!=this._cached_file_browser_display_name?void e(this._cached_file_browser_display_name):(n=function(t){return function(n){return t._cached_file_browser_display_name=n,e(n)}}(this),this._start_handshake_if_needed(),i=function(i){return function(){return i._uc.feature_supported(r.CHECK_FILE_RETURNS_OBJ,[o.SECURE_PERMISSION])?(i._uc.logger.report_event("file_browser_display_name"),i._uc.send("file_browser_display_name",null,n,t)):e(null)}}(this),this._uc.call_when_ready(i,t))},c._check_file_deprecated_on_client=function(){return r.UNITY_HANDSHAKE<=this._uc.client_version&&this._uc.client_version<r.CHECK_FILE_RETURNS_OBJ},c.server_path=function(e,t){return e+":"+t},c.has_chime=function(e,t){var n;return null==t&&(t=null),this._start_handshake_if_needed(),n=function(n){return function(){return n._uc.feature_supported(r.CHIME_OPEN,[o.SECURE_PERMISSION])?(n._uc.logger.report_event("has_chime"),n._uc.send("has_chime",null,e,t)):void 0}}(this),this._uc.call_when_ready(n,t)},c.open_chime=function(e,t,n){var i;return null==n&&(n=null),this._start_handshake_if_needed(),i=function(i){return function(){return i._uc.feature_supported(r.CHIME_OPEN,[o.SECURE_PERMISSION])?(i._uc.logger.report_event("open_chime",{parameters:e}),i._uc.send("open_chime",e,t,n)):void 0}}(this),this._uc.call_when_ready(i,n)},c}()}),define("modules/clean/unity/flash_config",["modules/clean/gandalf_util","modules/clean/unity/websocket_config","modules/constants/static"],function(e,t,n){return window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,window.DefaultWebSocket=window.WebSocket,t.useFlashShim()&&(window.WEB_SOCKET_FORCE_FLASH=!0),window.WEB_SOCKET_SWF_LOCATION=n.static_url_web_socket_swf,e.getGandalfRule("unity-web-debug")?void 0:window.WEB_SOCKET_LOGGER={log:function(){},error:function(){}}}),define("modules/clean/unity/logger",["jquery","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/versions"],function(e,t,n,o,r){var i;return i=function(){function i(){this._data={logging_source:"web",web_unity_version:r.LATEST}}return i.prototype.update=function(t){return e.extend(this._data,t)},i.prototype.report_event=function(e,r){return null==r&&(r=null),this._data.event_name=e,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify(r||{}),n.SilentBackgroundRequest({url:t({path:"/unity_connection_log"}),data:this._data}),o.getGandalfRule("unity-web-debug")?console.log(this._data):void 0},i.prototype.get_log_data_for_client=function(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}},i.prototype.unity_session_id=function(){return this._data.unity_session_id},i}()}),define("modules/clean/unity/versions",function(){var e;return e=function(){function e(){}return e.LATEST=10,e.INITIAL_UNITY=1,e.UNITY_HANDSHAKE=2,e.REUNITY=3,e.OPEN_IN_FILE_BROWSER=4,e.CHECK_FILE_RETURNS_OBJ=5,e.PERMISSION_LEVELS=6,e.WEB_DESTINY=7,e.WEB_DESTINY_V2=8,e.PORT_CHECK=9,e.CHIME_OPEN=10,e}()}),define("modules/clean/unity/web_socket",["modules/constants/page_load","modules/clean/unity/logger","modules/clean/unity/websocket_config","external/web_socket"],function(e,t,n,o){var r,i;return r=17603,i=function(){function e(){}return e.create=function(e){return"function"==typeof o.__initialize&&o.__initialize(),new o(e)},e.load_flash_policy_if_needed=function(){var e;if(e=new t,null!=(null!=o?o.loadFlashPolicyFile:void 0))e.report_event("load_flash_policy_file"),o.loadFlashPolicyFile("xmlsocket://127.0.0.1:"+r);else{if(n.useFlashShim())return e.report_event("unity_failure",{message:"Could not use WebSockets."}),!1;e.report_event("using_default_web_socket")}return!0},e.web_sockets_supported=function(){return null!=o},e}()}),define("modules/clean/unity/websocket_config",["external/flash_detect","modules/constants/unity","modules/core/browser"],function(e,t,n){var o;return o=function(){function o(){}return o.useFlashShim=function(){var o;return t.FORCE_NATIVE_WEBSOCKET?!1:e.versionAtLeast(10,3)?(o=parseInt(n.version,10),n.safari&&9>o?!1:!(n.chrome&&o>=53)):!1},o}()}),define("modules/clean/web_user_action_logger",["modules/clean/ajax"],function(e){var t,n,o,r;return r={DOWNLOAD:"download",MOVE:"move",OPEN_MOVE_MODAL:"open_move_modal",RENAME:"rename",ADD_COMMENT:"add_comment",OPEN_COPY_MODAL:"open_copy_modal",COPY:"copy",DELETE:"delete",PERMANENT_DELETE:"permanent_delete",VERSIONS:"versions",SORT_RECORDS:"sort_records",SELECT_ROW:"select_row",OPEN_ROW:"open_row",UPLOAD_FILE:"upload_file",CREATE_FOLDER:"create_folder",VIEW_SHARE_MODEL:"view_share_model",TOGGLE_DELETED_FILES:"toggle_deleted_files",NAV_NEW_PAGE:"nav_new_page",SWITCH_ACCOUNT:"switch_account",VIEW_IN_PHOTOS:"view_in_photos"},n=3,t=6e5,o=function(){function o(){}return o.prototype.error_count=0,o.prototype.last_error=Date.now(),o.prototype.should_report=!0,o.prototype.log=function(o,r,i){return this.should_report&&(this.error_count<n||Date.now()-this.last_error>t)?e.SilentBackgroundRequest({url:"/log/web_user_action",data:{_subject_uid:o,event_type:r,extra_params:JSON.stringify(i)},error:function(e){return function(t){return 429===t.status?e.error_count=n:e.error_count+=1,e.last_error=Date.now()}}(this),success:function(e){return function(t){var n,o,r;try{return n=JSON.parse(t),(null!=n?n.continue_sending:void 0)||(e.should_report=!1),e.error_count=0}catch(t){throw o=t,e.error_count+=1,e.last_error=Date.now(),o}}}(this)}):void 0},o}(),{WebUserActionLog:new o,WebUserActionLogEvents:r,WebUserActionLogClass:o,MAX_ERRORS:n}}),define("modules/clean/zendesk_feedback",["jquery","external/classnames","external/react","external/react-dom","modules/core/i18n","modules/clean/ajax","modules/clean/react/modal","modules/clean/react/image","modules/clean/static_urls","modules/clean/react/css","modules/clean/react/select","modules/clean/sharing/views/hover_close_button","modules/core/notify"],function(e,t,n,o,r,i,s,a,l,c,u,d,p){var h,_,m,f,g,v,y,E,b,S,w,T,C,I,P;return h=s.Modal,I=l.static_url,_=u.input,m=u.option,S=n.DOM,b=n.createElement,P=n.addons.update,v=r.i18n_default_project("sharing")._,y=n.createClass({displayName:"ZendeskFeedbackForm",propTypes:{forAirshare:n.PropTypes.bool.isRequired},getInitialState:function(){return{}},componentDidMount:function(){return o.findDOMNode(this.refs.textbox).focus()},render:function(){return b(h,{className:"zendesk-feedback-form",title:v("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:v("Send feedback"),autoClose:!1,dismissButtonText:v("Cancel"),onAccept:function(e){return function(){var t,n,o,r;return e.setState({isSending:!0}),r=e.props.forAirshare?"airshare_form":"tiburon_form",t=r+"_"+e.refs.category.getValue(),n={categoryTag:e.state.message},o=r+"_feedback",w(o,n,function(){return e.setState({isSending:!1
})})}}(this)},S.label({htmlFor:"feedback-category"},v("Category")),b(_,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:"fdbk_shrr"},b(m,{value:"fdbk_shrr"},v("I have feedback about sharing files with others")),b(m,{value:"fdbk_rcvr"},v("I have feedback about accessing files shared with me")),b(m,{value:"fdbk_gen"},v("I have general feedback")),b(m,{value:"fdbk_bug"},v("I found a bug"))),S.label({htmlFor:"feedback-content"},v("What is your feedback?")),S.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:function(e){return function(t){return e.setState({message:t.target.value})}}(this),ref:"textbox"}))}}),E=n.createClass({displayName:"ZendeskQuantitativeForm",SCORES:{PASS:[{NAME:"seen_feature_score",PROMPT:v("Have you seen this feature at the top of Dropbox file previews?"),TYPE:"YESNO",HAS_IMAGE:!0,IMAGE_SRC:I("/static/images/pass/pass_feedback_feature_example-vflVrEgNf.png"),IMAGE_SRC_HI_RES:I("/static/images/pass/pass_feedback_feature_example@2x-vflEAv7uE.png"),IMAGE_ALT:v("An image of the presence and seen state feature")},{NAME:"knowledge_about_feature_score",PROMPT:v("Do you know that this feature has information about who has viewed this file?"),TYPE:"YESNO",HAS_IMAGE:!1},{NAME:"value_of_feature_score",PROMPT:v("How valuable has this feature been?"),ONE_LABEL:v("Not at all"),FIVE_LABEL:v("Very"),HIDDEN_ONE_LABEL:v("1 means not at all valuable"),HIDDEN_FIVE_LABEL:v("5 means very valuable"),TYPE:"SCALE"}]},propTypes:{title:n.PropTypes.string.isRequired,feedbackTag:n.PropTypes.string.isRequired,formType:n.PropTypes.string.isRequired},getInitialState:function(){return{message:"",scores:{}}},_renderScaleQuestion:function(e){var n;return S.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-xs",role:"radiogroup"},S.label({},e.PROMPT),function(){var o,r;for(r=[],n=o=1;6>o;n=++o)r.push(S.button({"aria-checked":this.state.scores[e.NAME]===n.toString(),onClick:function(e){return function(t,n){return function(){var o;return o={},o[n.NAME]={$set:t.toString()},e.setState({scores:P(e.state.scores,o)})}}}(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.toString()})},n));return r}.call(this),S.div({},S.span({className:"zendesk-feedback-form__score-label"},e.ONE_LABEL),S.span({className:"ax-visually-hidden"},e.HIDDEN_ONE_LABEL),S.span({className:"zendesk-feedback-form__score-label"},e.FIVE_LABEL),S.span({className:"ax-visually-hidden"},e.HIDDEN_FIVE_LABEL)))},_renderYesNoQuestion:function(e){var n,o;return o=e.HAS_IMAGE?S.div({},b(a,{className:"zendesk-feedback-form__question-image",src:e.IMAGE_SRC,srcHiRes:e.IMAGE_SRC_HI_RES,alt:e.IMAGE_ALT})):void 0,S.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-xs",role:"radiogroup"},S.label({},e.PROMPT),o,function(){var o,r,i,s;for(i=[{key:"YES",answer_text:v("Yes")},{key:"NO",answer_text:v("No")}],s=[],o=0,r=i.length;r>o;o++)n=i[o],s.push(S.button({"aria-checked":this.state.scores[e.NAME]===n.key,onClick:function(e){return function(t,n){return function(){var o;return o={},o[n.NAME]={$set:t.key},e.setState({scores:P(e.state.scores,o)})}}}(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.key})},n.answer_text));return s}.call(this))},_renderFreeResponseQuestion:function(){var e;return e=v("PASS"===this.props.formType?"Please describe one way that this feature has helped or hurt your productivity:":"What’s the main reason for your scores?"),S.div({},S.label({htmlFor:"feedback--main-reason"},e),S.textarea({className:"zendesk-feedback-form__textbox",id:"feedback--main-reason",onChange:function(e){return function(t){return e.setState({message:t.target.value})}}(this)}))},render:function(){var t;return b(h,{className:"zendesk-feedback-form",title:this.props.title,acceptButtonDisabled:this.state.isSending||this.SCORES[this.props.formType].reduce(function(e){return function(t,n){return!e.state.scores[n.NAME]||t}}(this),!1),acceptButtonText:v("Send feedback"),autoClose:!1,dismissButtonText:v("Cancel"),onAccept:function(t){return function(){var n;return t.setState({isSending:!0}),n=e.extend({},t.state.scores),n.free_response=t.state.message,w(t.props.feedbackTag,n,function(){return t.setState({isSending:!1})})}}(this)},function(){var e,n,o,r;for(o=this.SCORES[this.props.formType],r=[],e=0,n=o.length;n>e;e++)t=o[e],"SCALE"===t.TYPE?r.push(this._renderScaleQuestion(t)):"YESNO"===t.TYPE?r.push(this._renderYesNoQuestion(t)):r.push(void 0);return r}.call(this),this._renderFreeResponseQuestion())}}),f=c(y,["/static/css/zendesk_feedback-vflL65H-l.css"]),g=c(E,["/static/css/zendesk_feedback-vflL65H-l.css"]),T=function(){return h.showInstance(b(g,{title:v("Send us your feedback"),feedbackTag:"pass_feedback",formType:"PASS"}))},C=function(e){return null==e&&(e=!1),h.showInstance(b(f,{forAirshare:e}))},w=function(e,t,n){return i.WebRequest({url:"/log/file_collab_feedback",data:{feedback_tag:e,user_feedback:JSON.stringify(t)},success:function(){return p.success(v("Thanks for helping make Dropbox better!")),h.close()},error:n})},{showQualitativeFeedbackForm:C,showPASSFeedbackForm:T}}),define("modules/core/type",["external/underscore"],function(e){var t,n,o,r,i,s,a,l;return i={},i.Type=t=function(){function t(t,n){if(!e.isString(t)&&!e.isFunction(t))throw new TypeError("First parameter needs to be a string identifying the type");if(!e.isFunction(n))throw new TypeError("Second parameter needs to be a predicate defining the type");e.isFunction(t)?this.getTypeString=t:this.getTypeString=function(){return t},this.predicate=n}return t}(),o=function(n){var r,i;if(l(n))return!0;if(n instanceof t)return!0;if(e.isFunction(n))return!0;if(e.isArray(n)){if(1!==n.length)return!1;if(!o(n[0]))return!1}else{if(!(e.isObject(n)&&null==n.prototype&&n.constructor===Object&&e.keys(n).length>0))return!1;for(r in n)if(i=n[r],!o(i))return!1}return!0},n=function(){var n,r,i,s,a,l,c;return c=new t("undefined",e.isUndefined),r=new t("null",e.isNull),n=new t("Boolean",e.isBoolean),i=new t("Number",e.isNumber),a=new t("String",e.isString),s=new t("Object",function(t){return e.isObject(t)&&!e.isFunction(t)&&!e.isArray(t)}),l=new t("Type",o),function(e){return"undefined"==typeof e?c:null===e?r:e===Boolean?n:e===Number?i:e===String?a:e===Object?s:e===t?l:void 0}}(),i.isBasicType=l=function(e){return null!=n(e)},i.firstFailingKeypath=s=function(o,r,i){var a,c,u,d,p,h,_,m,f,g,v,y,E;if(null==i&&(i=[]),l(o)){if(!n(o).predicate(r))return i}else if(o instanceof t){if(!o.predicate(r))return i}else if(e.isFunction(o)){if(!(r instanceof o))return i}else if(e.isArray(o)){if(s(Array,r,i))return i;for(c=u=0,h=r.length;h>u;c=++u){if(a=r[c],i.push(c),s(o[0],a,i))return i;i.pop()}}else{if(s(Object,r,i))return i;for(y=e.keys(o),E=e.keys(r),g=e.difference(y,E),p=0,_=g.length;_>p;p++)if(d=g[p],s(o[d],void 0,i))return i;for(v=e.intersection(E,y),f=0,m=v.length;m>f;f++){if(d=v[f],i.push(d),s(o[d],r[d],i))return i;i.pop()}}},i.checkType=r=function(e,t){return null==s(e,t)},i.getTypeString=a=function(o){var r,i,s;if(l(o))return n(o).getTypeString();if(o instanceof t)return o.getTypeString();if(e.isFunction(o))return o.name;if(e.isArray(o))return"["+a(o[0])+"]";i=[];for(r in o)s=o[r],i.push(r+": "+a(s));return"{"+i.join(", ")+"}"},i});var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},slice=[].slice;define("modules/core/types",["external/underscore","modules/constants/page_load","modules/core/type"],function(e,t,n){var o,r,i,s,a,l,c,u,d,p,h,_,m,f,g,v,y,E,b,S;return h=n.Type,_=n.checkType,v=n.getTypeString,g=n.firstFailingKeypath,y=n.isBasicType,u=function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}}(),p=function(e){function t(e){t.__super__.constructor.call(this,v.bind(null,e),_.bind(null,e))}return extend(t,e),t}(h),a=function(t){function n(t,o){null!=n.names?n.names.set(this,t):this.__name===t,null!=o&&e.extend(this,o)}extend(n,t);try{n.names=new WeakMap}catch(e){n.names=null}return n.prototype.getTypeString=function(){return null!=n.names?n.names.get(this):this.__name},n.prototype.predicate=function(t){return indexOf.call(e.values(this),t)>=0},n}(h),i=function(e){function t(e){this.valType=e}return extend(t,e),t.prototype.getTypeString=function(){return"Dict[string -> "+v(this.valType)+"]"},t.prototype.predicate=function(e){var t,n;return function(){var o;o=[];for(t in e)n=e[t],o.push(_(this.valType,n));return o}.call(this).every(function(e){return e})},t}(h),m=function(t,n){var o,r,i,s,a,l,c,u;if(y(t));else if(t instanceof h)null!=t.parameter_types&&e.isFunction(n)&&!n.isTypeChecked&&(n=S.apply(null,slice.call(t.parameter_types).concat([n])));else if(e.isFunction(t));else if(e.isArray(t))for(i=s=0,l=n.length;l>s;i=++s)o=n[i],r=m(t[0],o),r!==o&&(n=n.slice(),n[i]=r);else for(a in t)c=t[a],u=m(c,n[a]),u!==n[a]&&(n=e.clone(n),n[a]=u);return n},E=function(t,n,o,r){var i,s,a,l;for(i=0,l=n.length;l>i;i++)s=n[i],r=r[s],o=e.isArray(o)?o[0]:o[s];return n.length>0&&(a=", key "+n.join(".")),a=null!=a?a:"","Argument "+t+a+": Value "+JSON.stringify(r,null,"  ")+" doesn't match type "+v(o)},S=function(){var t,n,o,r;return r=2<=arguments.length?slice.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],o=function(){var n,o,i,s,a,l,c,u,d,h,_,f;for(o=1<=arguments.length?slice.call(arguments,0):[],n=r,u=e.find(r,function(e){return e instanceof p}),null!=u&&(d=e.indexOf(n,u),h=Math.max(o.length-n.length+1,0),_=[d,1],e.times(h,function(){return _.push(u)}),n=n.slice(),n.splice.apply(n,_)),s=a=0,l=n.length;l>a;s=++a){if(f=n[s],i=g(f,o[s]),null!=i)throw c=E(s,i,f,o[s]),new TypeError(c);o[s]=m(f,o[s])}return t.apply(this,o)},o.isTypeChecked=!0,o},b=function(e,t){var n;return n=function(){var n,o,r,i;if(n=1<=arguments.length?slice.call(arguments,0):[],i=t.apply(this,n),o=g(e,i),null!=o)throw r=E(0,o,e,i),new TypeError(r);return i},t.isTypeChecked&&(n.isTypeChecked=!0),n},s=function(e,t){var n,o;return n=function(){return"("+v(e)+"|"+v(t)+")"},o=function(n){return _(e,n)||_(t,n)},new h(n,o)},c=function(e){var t,n,o;return e instanceof h&&e.isOptional||e instanceof p?e:(t=function(){return"?"+v(e)},n=function(t){return null==t||_(e,t)},o=new h(t,n),e instanceof h&&null!=e.parameter_types&&(o.parameter_types=e.parameter_types),o.isOptional=!0,o)},l=function(){var t,n,o,r;return r=1<=arguments.length?slice.call(arguments,0):[],t=function(){return"function("+r.map(v).join(", ")+")"},n=e.isFunction,o=new h(t,n),o.parameter_types=r,o},d=function(e){return new p(e)},r=function(e){return new i(e)},f={},f.takes=b(Function,S(d(h),Function,S)),f.returns=b(Function,S(h,Function,b)),f.Type=h,f.Enum=a,f.Dict=b(h,S(h,r)),f.Either=b(h,S(h,h,s)),f.Maybe=b(h,S(h,c)),f.Splat=b(h,S(h,d)),f.Any=o=new h("Any",function(e){return!0}),f.Func=b(h,S(d(h),l)),f.inject=b(Object,S(Object,function(t){return e.extend(t,e.omit(f,"inject"))})),u||(f.takes=function(){var e,t,n;return e=2<=arguments.length?slice.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++]},f.returns=function(){var e,t,n;return e=2<=arguments.length?slice.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++]}),f}),define("modules/core/user_i18n",["require","exports","modules/constants/page_load"],function(e,t,n){"use strict";function o(e){if(!e)return"";var t=e.trim().split(" "),n=t[0],o=a(n),r=t[t.length-1],l=a(r);if(t.length>=2)return s()?l[0]+o[0]:o[0]+l[0];var c=a(e);return s()&&!i(e)&&c.length>1?c[0]+c[1]:c[0]}function r(e){if(!e)return"";var t=e.trim().split(" ");return t.length<2?e:s()?t[t.length-1][0]+" "+t[0]:t[0]+" "+t[t.length-1][0]}function i(e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)>=128)return!1;return!0}function s(){return-1!==["zh","ja","ko"].indexOf(n.USER_LOCALE)}function a(e){for(var t=[],n=e.length,o=0;n>o;){var r=e[o];if(r>="�"&&"�">=r){if(!(n-1>o))break;var i=e[o+1],s=r+i;t.push(s),o+=2}else t.push(r),o+=1}return t}t.getInitials=o,t.getShortName=r});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/growth/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/clean/sharing/signup_modal_proxy","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/legacy_pyxl_controllers/login_form","modules/clean/dbmodal","modules/clean/growth/experiments/logger","modules/clean/profile_services/third_party_signup","modules/clean/register_form"],function(e,t,n,o,r,i,s,a,l,c,u,d,p,h){var _,m,f,g,v,y,E;return g=e.SharingModel,E=i._,y=l.WebMiscActivityLogger,_=u.DBModal,v=p.ThirdPartySignup,f=h.RegisterForm,m=function(){function e(e){this.kind=e,this.register_success=bind(this.register_success,this),this.show_login_form=bind(this.show_login_form,this),this.save_to_dropbox=bind(this.save_to_dropbox,this),this.direct_download=bind(this.direct_download,this),this.handle_default_modal_cancel=bind(this.handle_default_modal_cancel,this),this.handle_default_modal_authenticate=bind(this.handle_default_modal_authenticate,this),this.handle_direct_download_cancel=bind(this.handle_direct_download_cancel,this),this.handle_direct_download=bind(this.handle_direct_download,this),this.on_request_default_signup=bind(this.on_request_default_signup,this),this.on_request_direct_download=bind(this.on_request_direct_download,this),this.show_create_password_modal=bind(this.show_create_password_modal,this),this.show_welcome_modal=bind(this.show_welcome_modal,this),this.before_create_password_modal=bind(this.before_create_password_modal,this),this.before_download_signup_modal=bind(this.before_download_signup_modal,this),this.before_default_signup_modal=bind(this.before_default_signup_modal,this),this.before_signup_modal=bind(this.before_signup_modal,this),this.init_modals=bind(this.init_modals,this),this.init_modals(),o.connectModal(this),"immediate"===this.kind&&(y.log("signup_modal-show-upfront",{auth_google:null!=t.find(".auth-google")}),this.default_signup_modal.show()),"download"!==this.kind?(t("#download_button_link, #default_content_download_button").click(this.direct_download),this.has_seen_modal=!0):t("#download_button_link, #default_content_download_button").click(function(e){return function(){return e.has_seen_modal?e.direct_download():(e.has_seen_modal=!0,y.log("signup_modal-show-download",{auth_google:null!=t.find(".auth-google")}),e.download_type="direct_download",e.download_signup_modal.show())}}(this)),t(".add_to_my_dropbox_link, #default_content_a2md").click(function(e){return function(){return e.download_type="add_to_dropbox",e.download_signup_modal.show()}}(this))}return e.prototype.init_modals=function(){return this.default_signup_modal=new _({element_id:"shared-link-immediate-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.default_signup_modal.on_hide=function(e){return function(){return e._has_authenticated?void 0:"function"==typeof e._on_default_modal_cancel?e._on_default_modal_cancel():void 0}}(this),this.download_signup_modal=new _({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.download_signup_modal.on_hide=function(e){return function(){return e._direct_download_started?void 0:"function"==typeof e._on_direct_download_cancel?e._on_direct_download_cancel():void 0}}(this),this.welcome_modal=new _({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal,this.create_password_modal=new _({element_id:"shared-link-create-password-modal"}),this.create_password_modal.before_show=this.before_create_password_modal},e.prototype.before_signup_modal=function(e){var t,n;return e.find(".toggle-form-link").click(function(t){return function(){return t.toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&(n.on(f.NEW_ACCOUNT_FROM_3RD_PARTY,function(t){return function(n,o){return t.profile_info=o,t.show_create_password_modal(e,t.profile_info)}}(this)),n.on(f.USER_EXISTS,function(t){return function(n){return t.show_login_form(e,n)}}(this)),n.on(f.REGISTER_SUCCESS,function(e){return function(t,n){return e.user_info=n,e.register_success(e.user_info)}}(this))),t=e.find(".login-form"),t.length?t.on(c.LOGIN_SUCCESS,function(e){return function(t,n){return e.user_info=n,s.success(E("Successfully signed in to Dropbox")),e.download_type?"direct_download"===e.download_type?(e.direct_download(),e.reload()):"add_to_dropbox"===e.download_type?e.save_to_dropbox(!1):void 0:e.reload()}}(this)):void 0},e.prototype.before_default_signup_modal=function(e){return this.before_signup_modal(e),e.find(".close-link").click(function(e){return function(){return e.default_signup_modal.hide()}}(this))},e.prototype.before_download_signup_modal=function(e){return this.before_signup_modal(e),this._direct_download_started=!1,"add_to_dropbox"===this.download_type&&(e.find(".login-form-component").is(":visible")||this.toggle_form(e)),e.find(".close-link").click(function(e){return function(){return e.direct_download(),e.download_signup_modal.hide()}}(this))},e.prototype.before_create_password_modal=function(e){var t,n;return e.find(".close-link").click(function(e){return function(){return e.create_password_modal.hide()}}(this)),t=e.find(".create-password-form-component"),v.handlePictureUrl(this.profile_info.picture_url,null,null,!1),n=t.find(".register-form"),n.on(f.REGISTER_SUCCESS,function(e){return function(t,n){return e.user_info=n,e.register_success(e.user_info)}}(this))},e.prototype.before_welcome_modal=function(e){return d.log("sharing","shared_link_welcome_modal_view"),e.find(".go-to-dropbox-button").click(function(){return d.log("sharing","shared_link_welcome_modal_button_click")}),e.find(".welcome-modal-no-thanks a").click(function(){return r.reload()})},e.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},e.prototype.show_create_password_modal=function(e,t){var n,o,r;return this.default_signup_modal.hide(),this.download_signup_modal.hide(),r={".input-fname":this.profile_info.fname,".input-lname":this.profile_info.lname,".input-email":this.profile_info.email,"input[name=email_sig]":this.profile_info.email_sig,"input[name=refresh_token]":this.profile_info.refresh_token},this.create_password_modal.show(n="input[name=password]",o=r)},e.prototype.on_request_direct_download=function(){return this.has_seen_modal?this.direct_download():(this.has_seen_modal=!0,y.log("signup_modal-show-download",{auth_google:null!=t.find(".auth-google")}),this.download_type="direct_download",this.download_signup_modal.show())},e.prototype.on_request_default_signup=function(){return this.download_type="add_to_dropbox",this._has_authenticated=!1,this.default_signup_modal.show()},e.prototype.handle_direct_download=function(e){return this._direct_download_override_callback=e},e.prototype.handle_direct_download_cancel=function(e){return this._on_direct_download_cancel=e},e.prototype.handle_default_modal_authenticate=function(e){return this._on_default_modal_authenticate=e},e.prototype.handle_default_modal_cancel=function(e){return this._on_default_modal_cancel=e},e.prototype.direct_download=function(){var e;return this._direct_download_started=!0,null!=this._direct_download_override_callback?void this._direct_download_override_callback():(e=r.get_uri().updateQuery({dl:1}),r.redirect(e))},e.prototype.reload=function(){return r.reload()},e.prototype.save_to_dropbox=function(e){var t;return null!=this._on_default_modal_authenticate?(this._on_default_modal_authenticate(this.user_info.id),this._has_authenticated=!0,void this.default_signup_modal.hide()):(e||s.success(E("Saving to your Dropbox ...")),t=g.c2d_vars,t.job=g.is_folder,n.WebRequest({url:g.c2d_url,data:t,subject_user:this.user_info.id,success:function(t){return e?void 0:(s.success(E("Successfully saved to your Dropbox.")),r.redirect(t))}}))},e.prototype.show_login_form=function(e,t){var n,o,r,i,s;o=e.find(".login-form-component"),r=o.find(".login-form"),i=t.prefill;for(n in i)s=i[n],r.find(n).val(s);return r.find(t.focus).focus(),o.is(":visible")?void 0:this.toggle_form(e,!0)},e.prototype.toggle_form=function(e,n){var o,r;return r=e.find(".register-form-component"),o=e.find(".login-form-component"),r.is(":visible")?r.fadeOut({complete:function(){return o.show(),null!=n?setTimeout(function(){return t(o.find(".login-form .login-password input[name='login_password']")[0]).focus()},0):void 0}}):o.fadeOut({complete:function(){return r.show()}})},e.prototype.register_success=function(e){return s.success(E("Successfully signed up for Dropbox.")),this.download_type?"direct_download"===this.download_type?(this.direct_download(),this.show_welcome_modal()):"add_to_dropbox"===this.download_type?this.save_to_dropbox(!1):void 0:this.show_welcome_modal()},e}()});
//# sourceMappingURL=pkg-aa.min.js-vflmRn3gm.map